# 控制系統（一）：系統建模與轉移函數

## 🔰 本章基礎觀念（零基礎必讀）

> 你每天都在使用控制系統——冷氣讓房間維持在 26°C、汽車定速巡航維持 100 km/h、手機陀螺儀讓畫面保持水平。這些系統的共同點是：**量測→比較→修正**。本章帶你從零開始，學會如何用數學描述這些系統。

---

## 一、什麼是控制系統？

### 1.1 日常生活中的控制系統

| 例子 | 想控制的量 | 感測器 | 執行器 |
|------|-----------|--------|--------|
| 冷氣 | 室溫 26°C | 溫度感測器 | 壓縮機 |
| 巡航定速 | 車速 100 km/h | 車速感測器 | 油門 |
| 馬桶水箱 | 水位高度 | 浮球 | 進水閥 |
| 人體體溫 | 37°C | 下視丘 | 流汗/發抖 |

### 1.2 控制系統的基本架構

```
輸入 r(t) → [控制器] → [受控體(Plant)] → 輸出 y(t)
```

- **輸入（參考訊號）r(t)**：你希望系統達到的目標值
- **受控體（Plant）**：你想控制的對象（馬達、溫度、速度...）
- **輸出 y(t)**：系統實際的表現
- **控制器（Controller）**：根據誤差調整的「大腦」

---

## 二、開迴路 vs 閉迴路系統

### 2.1 開迴路系統（Open-Loop System）

```
r(t) → [控制器] → [受控體] → y(t)
```

**特點**：輸出不回饋，控制器「盲目」地執行。

**例子**：烤箱定時器——你設 10 分鐘，不管烤焦或沒熟，時間到就停。

**優點**：結構簡單、成本低
**缺點**：無法應對干擾、精度差

### 2.2 閉迴路系統（Closed-Loop System / Feedback System）

```
r(t) → ⊕ → [控制器] → [受控體] → y(t)
        ↑                              |
        +---- [感測器] ←---------------+

誤差 e(t) = r(t) - y(t)
```

**特點**：輸出經感測器回饋，與參考訊號比較，產生誤差來驅動控制器。

**例子**：冷氣——溫度感測器不斷量測室溫，與設定溫度比較，自動調整壓縮機。

**優點**：抗干擾、精度高
**缺點**：結構複雜、可能不穩定（若設計不當）

---

## 三、微分方程建模

### 3.1 為什麼需要數學模型？

要設計控制器，必須先用數學描述受控體的行為。最基本的工具就是**微分方程**。

### 3.2 彈簧-質量-阻尼系統（Spring-Mass-Damper）

```
         f(t)（外力）
          ↓
    ┌─────┐
    │  M  │───── b（阻尼器）
    └──┬──┘
       │
       k（彈簧）
       │
      ///（固定端）
```

由牛頓第二定律：

$$M\ddot{x}(t) + b\dot{x}(t) + kx(t) = f(t)$$

- M：質量（kg）
- b：阻尼係數（N·s/m）
- k：彈簧常數（N/m）
- x(t)：位移（m）
- f(t)：外力（N）

### 3.3 RC 電路

```
    R
 ──/\/\/──┬──
+         |
v_i(t)   === C    v_o(t)
-         |
 ─────────┘
```

由 KVL（基爾霍夫電壓定律）：

$$RC\dot{v}_o(t) + v_o(t) = v_i(t)$$

這是一個**一階微分方程**，時間常數 τ = RC。

### 3.4 直流馬達（DC Motor）

電氣方程：$L_a \frac{di_a}{dt} + R_a i_a + K_b \dot{\theta} = v_a(t)$

機械方程：$J\ddot{\theta} + b\dot{\theta} = K_t i_a$

- $v_a$：電樞電壓
- $i_a$：電樞電流
- $K_b$：反電動勢常數
- $K_t$：轉矩常數
- $J$：轉動慣量
- $b$：摩擦係數
- $\theta$：角位移

---

## 四、拉普拉斯轉換求轉移函數 G(s)

### 4.1 拉普拉斯轉換速查表

| 時域 f(t) | 頻域 F(s) |
|-----------|-----------|
| δ(t)（脈衝）| 1 |
| u(t)（步階）| 1/s |
| t | 1/s² |
| e^(-at) | 1/(s+a) |
| sin(ωt) | ω/(s²+ω²) |
| cos(ωt) | s/(s²+ω²) |
| df/dt | sF(s) - f(0) |
| d²f/dt² | s²F(s) - sf(0) - f'(0) |

### 4.2 轉移函數的定義

> **轉移函數（Transfer Function）**：在零初始條件下，輸出的拉普拉斯轉換與輸入的拉普拉斯轉換之比。

$$G(s) = \frac{Y(s)}{X(s)}$$

### 4.3 從微分方程到轉移函數

**步驟**：
1. 寫出微分方程
2. 取拉普拉斯轉換（假設零初始條件）
3. 整理為 Y(s)/X(s) 的形式

**【例題 1】RC 電路轉移函數**

微分方程：$RC\dot{v}_o + v_o = v_i$

取拉普拉斯（零初始條件）：$RCsV_o(s) + V_o(s) = V_i(s)$

$$G(s) = \frac{V_o(s)}{V_i(s)} = \frac{1}{RCs + 1} = \frac{1}{\tau s + 1}$$

其中 τ = RC 為時間常數。

**【例題 2】彈簧-質量-阻尼系統轉移函數**

微分方程：$M\ddot{x} + b\dot{x} + kx = f$

取拉普拉斯：$Ms^2X(s) + bsX(s) + kX(s) = F(s)$

$$G(s) = \frac{X(s)}{F(s)} = \frac{1}{Ms^2 + bs + k}$$

若 M=1, b=3, k=2：

$$G(s) = \frac{1}{s^2 + 3s + 2} = \frac{1}{(s+1)(s+2)}$$

極點在 s = -1 和 s = -2（都在左半平面，系統穩定）。

---

## 五、方塊圖（Block Diagram）

### 5.1 方塊圖基本元件

| 元件 | 符號 | 說明 |
|------|------|------|
| 方塊 | [G(s)] | 轉移函數，輸出 = G(s)×輸入 |
| 加法器 | ⊕ | 訊號相加或相減 |
| 分支點 | • | 訊號分叉，一個訊號分送多處 |

### 5.2 方塊圖化簡規則

#### 規則一：串聯（Series / Cascade）

```
X → [G₁] → [G₂] → Y
```

等效：$G_{eq}(s) = G_1(s) \cdot G_2(s)$

#### 規則二：並聯（Parallel）

```
     ┌→ [G₁] →┐
X →──┤         ├──⊕→ Y
     └→ [G₂] →┘
```

等效：$G_{eq}(s) = G_1(s) + G_2(s)$

#### 規則三：負回授（Negative Feedback）

```
R(s) → ⊕ → [G(s)] → Y(s)
       ↑-              |
       └── [H(s)] ←───┘
```

等效（閉迴路轉移函數）：

$$T(s) = \frac{Y(s)}{R(s)} = \frac{G(s)}{1 + G(s)H(s)}$$

> 這是控制系統中最重要的公式之一！

#### 規則四：正回授（Positive Feedback）

$$T(s) = \frac{G(s)}{1 - G(s)H(s)}$$

#### 其他化簡技巧

| 操作 | 等效 |
|------|------|
| 分支點往前移過方塊 G | 分支後加 1/G |
| 分支點往後移過方塊 G | 分支後加 G |
| 加法器往前移過方塊 G | 移動後的訊號乘 1/G |
| 加法器往後移過方塊 G | 移動後的訊號乘 G |

**【例題 3】方塊圖化簡**

已知系統：
```
R → ⊕ → [G₁] → ⊕ → [G₂] → Y
    ↑-            ↑-          |
    └──[H₂]←─────┘           |
    ↑-                        |
    └────── [H₁] ←───────────┘
```

**解法**：由內而外化簡。

步驟一：先化簡內迴路（G₂ 和 H₂ 構成負回授）

$$G_{inner}(s) = \frac{G_2}{1 + G_2 H_2}$$

步驟二：內迴路與 G₁ 串聯

$$G_{cascade}(s) = G_1 \cdot \frac{G_2}{1 + G_2 H_2}$$

步驟三：再與 H₁ 構成外迴路負回授

$$T(s) = \frac{G_1 G_2 / (1 + G_2 H_2)}{1 + G_1 G_2 H_1 / (1 + G_2 H_2)} = \frac{G_1 G_2}{1 + G_2 H_2 + G_1 G_2 H_1}$$

---

## 六、信號流程圖（Signal Flow Graph, SFG）

### 6.1 基本概念

信號流程圖是方塊圖的另一種表示法，由**節點（Node）**和**分支（Branch）**組成。

- **節點**：代表一個訊號（變數）
- **分支**：帶箭頭的線，上面標轉移函數（增益）
- **路徑（Path）**：從輸入到輸出，沿箭頭方向通過的連續分支
- **迴路（Loop）**：起點和終點相同的路徑
- **不接觸迴路（Non-touching Loops）**：沒有共用節點的迴路

### 6.2 從方塊圖轉為信號流程圖

```
方塊圖：R → ⊕ → [G] → Y
            ↑-         |
            └── [H] ←─┘

信號流程圖：
  R ──(1)──→ E ──(G)──→ Y
              ↑          |
              └──(-H)────┘
```

---

## 七、Mason 增益公式

### 7.1 公式

$$T(s) = \frac{Y(s)}{R(s)} = \frac{\sum_k P_k \Delta_k}{\Delta}$$

其中：
- $P_k$：第 k 條前進路徑的增益
- $\Delta = 1 - \sum L_i + \sum L_i L_j - \sum L_i L_j L_k + \cdots$
  - $\sum L_i$：所有個別迴路增益之和
  - $\sum L_i L_j$：所有兩兩不接觸迴路增益乘積之和
  - $\sum L_i L_j L_k$：所有三三不接觸迴路增益乘積之和
- $\Delta_k$：去掉與第 k 條前進路徑接觸的迴路後的 Δ

### 7.2 使用步驟

1. 找出所有**前進路徑**及其增益 $P_k$
2. 找出所有**迴路**及其增益 $L_i$
3. 找出所有**不接觸迴路對**
4. 計算 $\Delta$
5. 對每條前進路徑計算 $\Delta_k$
6. 代入公式

**【例題 4】Mason 增益公式**

信號流程圖：
```
R ─(1)→ x₁ ─(G₁)→ x₂ ─(G₂)→ x₃ ─(G₃)→ x₄ ─(1)→ Y
                ↑          |          ↑          |
                └──(-H₁)──┘          └──(-H₂)──┘
                ↑                                |
                └────────────(-H₃)───────────────┘
```

**解法**：

**前進路徑**：
- $P_1 = G_1 G_2 G_3$（唯一一條）

**迴路**：
- $L_1 = -G_2 H_1$
- $L_2 = -G_3 H_2$
- $L_3 = -G_1 G_2 G_3 H_3$（非原始迴路，大迴路）
- 嚴格來說 $L_3 = -G_2 G_3 H_3$（從 x₂ 經 G₂ → x₃ → G₃ → x₄ 經 -H₃ 回 x₁ → 經前面回 x₂...）

讓我重新整理。假設迴路為：
- $L_1 = -G_2 H_1$（x₂→x₃→x₂ 迴路）
- $L_2 = -G_3 H_2$（x₃→x₄→x₃ 迴路）
- $L_3 = -G_1 G_2 G_3 H_3$（x₁→x₂→x₃→x₄→x₁ 大迴路）

**不接觸迴路對**：
- $L_1$ 和 $L_2$ 不接觸（無共用節點）
- $L_1 L_2 = G_2 H_1 G_3 H_2$

**計算 Δ**：
$$\Delta = 1 - (L_1 + L_2 + L_3) + L_1 L_2$$
$$= 1 + G_2 H_1 + G_3 H_2 + G_1 G_2 G_3 H_3 + G_2 G_3 H_1 H_2$$

**計算 Δ₁**：
$P_1$ 路徑接觸所有迴路，所以 $\Delta_1 = 1$

**結果**：
$$T(s) = \frac{G_1 G_2 G_3}{1 + G_2 H_1 + G_3 H_2 + G_1 G_2 G_3 H_3 + G_2 G_3 H_1 H_2}$$

**【例題 5】簡單回授系統的 Mason 公式驗證**

經典負回授：R →(1)→ E →(G)→ Y，Y →(-H)→ E

- 前進路徑：$P_1 = G$
- 迴路：$L_1 = -GH$
- $\Delta = 1 - (-GH) = 1 + GH$
- $\Delta_1 = 1$（路徑接觸唯一迴路）

$$T = \frac{G \cdot 1}{1 + GH} = \frac{G}{1 + GH} \quad \checkmark$$

與方塊圖化簡結果一致！

---

## 八、關鍵術語表

| 中文 | 英文 | 白話解釋 | 例子 |
|------|------|----------|------|
| 轉移函數 | Transfer Function | 輸出與輸入在 s 域的比值 | G(s) = 1/(s+1) |
| 開迴路系統 | Open-Loop System | 不回饋，盲目控制 | 烤箱定時器 |
| 閉迴路系統 | Closed-Loop System | 有回饋，自動修正 | 冷氣溫控 |
| 受控體 | Plant | 被控制的對象 | 馬達、加熱器 |
| 極點 | Pole | 轉移函數分母 = 0 的根 | s = -2 |
| 零點 | Zero | 轉移函數分子 = 0 的根 | s = -1 |
| 方塊圖 | Block Diagram | 用方塊表示系統的圖形 | 串聯、回授連接 |
| 信號流程圖 | Signal Flow Graph | 用節點和分支表示系統 | Mason 公式用 |
| 拉普拉斯轉換 | Laplace Transform | 時域→頻域的數學工具 | L{e^(-at)} = 1/(s+a) |
| 加法器 | Summing Junction | 訊號相加減的節點 | ⊕ 符號 |

---

## 九、題型鑑別表

| 題目特徵 | 解題方法 |
|----------|----------|
| 給微分方程，求 G(s) | 取拉普拉斯轉換，整理成 Y(s)/X(s) |
| 給方塊圖，求閉迴路轉移函數 | 方塊圖化簡（由內而外） |
| 給信號流程圖，求轉移函數 | Mason 增益公式 |
| 給電路圖，求轉移函數 | 先寫 KVL/KCL 微分方程，再取拉普拉斯 |
| 給方塊圖，要求移動元件 | 分支點/加法器移動規則 |
| 求極點零點 | 分母=0→極點，分子=0→零點 |

---

## 十、數值例題精練

**【例題 6】求轉移函數並判斷極點位置**

已知系統微分方程：$\ddot{y} + 5\dot{y} + 6y = 2\dot{u} + u$

求轉移函數，並找出極點和零點。

**解**：
取拉普拉斯（零初始條件）：
$$s^2Y(s) + 5sY(s) + 6Y(s) = 2sU(s) + U(s)$$

$$G(s) = \frac{Y(s)}{U(s)} = \frac{2s + 1}{s^2 + 5s + 6} = \frac{2s + 1}{(s+2)(s+3)}$$

- **零點**：2s + 1 = 0 → s = -1/2
- **極點**：s = -2, s = -3
- 所有極點在左半平面 → **系統穩定**

**【例題 7】方塊圖化簡——單位回授**

```
R(s) → ⊕ → [10/(s+1)] → Y(s)
       ↑-                  |
       └───────────────────┘  （H=1，單位回授）
```

$$T(s) = \frac{G(s)}{1+G(s)} = \frac{10/(s+1)}{1 + 10/(s+1)} = \frac{10}{s+1+10} = \frac{10}{s+11}$$

閉迴路極點：s = -11（穩定，且比開迴路極點 s=-1 更「快」）。

---

## ✅ 自我檢測

<details>
<summary><strong>Q1：開迴路和閉迴路系統的最大差異是什麼？</strong></summary>

**答**：閉迴路系統有「回饋」——將輸出量測值送回與參考值比較，產生誤差來驅動控制器。開迴路沒有回饋，無法自動修正。
</details>

<details>
<summary><strong>Q2：G(s) = 5/(s²+3s+2) 的極點在哪裡？系統穩定嗎？</strong></summary>

**答**：分母 s²+3s+2 = (s+1)(s+2) = 0，極點為 s=-1, s=-2。兩個極點都在左半平面（實部<0），所以**系統穩定**。
</details>

<details>
<summary><strong>Q3：標準負回授閉迴路轉移函數公式為何？</strong></summary>

**答**：$T(s) = \frac{G(s)}{1 + G(s)H(s)}$

若為單位回授（H=1）：$T(s) = \frac{G(s)}{1 + G(s)}$
</details>

<details>
<summary><strong>Q4：Mason 增益公式中，Δ 的物理意義是什麼？</strong></summary>

**答**：Δ 是圖的「行列式」，反映所有迴路對系統的整體影響。$\Delta = 1 - \sum(\text{迴路增益}) + \sum(\text{不接觸迴路對之乘積}) - \cdots$
</details>

<details>
<summary><strong>Q5：把分支點往前移過方塊 G(s)，需要在分支後加什麼？</strong></summary>

**答**：加一個 1/G(s) 的方塊。因為原本分支點的訊號是 G(s) 的輸出，移到前面後訊號是 G(s) 的輸入，需要乘 1/G(s) 才能還原。
</details>

<details>
<summary><strong>Q6：請用 Mason 公式求下列系統的轉移函數：R→(1)→x₁→(a)→x₂→(b)→Y，且 x₂→(-c)→x₁ 為迴路。</strong></summary>

**答**：
- 前進路徑：$P_1 = ab$
- 迴路：$L_1 = -bc$（等等，需確認迴路方向）

重新看：x₂→(-c)→x₁，而 x₁→(a)→x₂，所以迴路增益 $L_1 = a \cdot (-c) = -ac$

- $\Delta = 1 - (-ac) = 1 + ac$
- $\Delta_1 = 1$（路徑接觸迴路）

$$T = \frac{ab}{1 + ac}$$
</details>

---

> **下一章預告**：學會了建模和轉移函數，接下來我們要分析系統的**時域響應**——當你給系統一個步階輸入，它多快反應？會不會震盪？這些問題在第二章揭曉！
