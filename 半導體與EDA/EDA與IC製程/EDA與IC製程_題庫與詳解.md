# EDA與IC製程 — 完整題庫與詳解

> **適用考試**：台大電機所博士班資格考、IC設計公司與晶圓代工面試
> **參考教科書**：
> - Kahng, Lienig, Markov & Hu, *VLSI Physical Design: From Graph Partitioning to Timing Closure*
> - Campbell, *The Science and Engineering of Microelectronic Fabrication*
> - Plummer, Deal & Griffin, *Silicon VLSI Technology: Fundamentals, Practice and Modeling*
> **題數**：60 題（6 大單元，每單元 10 題）
> **難度分級**：★（基礎）→ ★★★★★（博士級/業界前沿）

---
## Part 1：IC製程基礎（題目 1–10）

---
### 題目 1：柴氏長晶法（Czochralski Method）
**來源**：台大電機 / 經典題型
**難度**：★★
**主題**：晶圓製造

**題目**：
請說明柴氏長晶法（Czochralski Method, CZ法）生長單晶矽的原理與步驟。與浮區法（Float-Zone, FZ法）相比，CZ法生長的晶圓在氧含量與電阻率均勻度上有何差異？為何現代IC製造幾乎全採用CZ晶圓？

**詳解**：

**解題思路**：從CZ法的物理過程出發，比較兩種方法的晶體品質差異，再連結到IC製程的實際需求。

**步驟**：

1. **CZ法原理**：
   - 將高純度多晶矽（polysilicon）裝入石英坩堝（quartz crucible），加熱至矽的熔點（1414°C）以上使之完全熔融
   - 將一小片單晶矽「種晶（seed crystal）」浸入熔矽表面，種晶的晶向決定整根晶棒的晶向（常用 ⟨100⟩ 或 ⟨111⟩）
   - 緩慢提拉（pull）種晶並同時旋轉，熔矽在固液界面凝固並延續種晶的單晶結構
   - 先快速拉出細頸（necking）以消除差排（dislocation），再降低提拉速度使晶棒直徑逐漸增大至目標尺寸（現代為300mm）
   - 提拉速度與溫度梯度控制晶棒直徑與缺陷密度

2. **CZ法 vs FZ法比較**：

   | 特性 | CZ法 | FZ法 |
   |------|------|------|
   | 氧含量 | 較高（~10¹⁸ cm⁻³），因石英坩堝溶出 | 極低，無坩堝接觸 |
   | 碳含量 | 較高 | 較低 |
   | 電阻率均勻度 | 較差（因摻質偏析） | 較佳 |
   | 晶圓尺寸 | 可達 300mm 以上 | 通常 ≤ 200mm |
   | 成本 | 較低 | 較高 |
   | 機械強度 | 較高（氧析出強化） | 較低 |

3. **為何IC製造選用CZ晶圓**：
   - CZ法可生長大直徑晶棒（300mm/450mm），符合量產需求
   - 晶圓中的氧可在後續熱處理中形成內部微缺陷（Internal Gettering），吸附金屬雜質，改善元件區品質
   - 氧析出物增強晶圓機械強度，減少製程中翹曲（warpage）
   - 成本遠低於FZ法

**答案**：CZ法利用種晶從熔矽中提拉生長單晶，雖然氧含量較FZ法高、電阻率均勻度較差，但可生長大尺寸晶圓、成本低且氧含量反而有利於內部吸附（gettering），因此成為IC製造的主流選擇。

**延伸思考**：TSMC的300mm晶圓廠全部使用CZ晶圓。高電阻率RF應用（如SOI基板）則可能需要FZ晶圓。未來450mm晶圓的CZ長晶技術是關鍵挑戰之一。

---
### 題目 2：Deal-Grove氧化模型
**來源**：台大電機 / TSMC面試
**難度**：★★★
**主題**：氧化製程（Oxidation）

**題目**：
在Deal-Grove氧化模型中，氧化層厚度 x 與時間 t 的關係為：

$$x^2 + Ax = B(t + \tau)$$

其中 A、B 為與溫度相關的常數，τ 為初始氧化層的等效時間。

(a) 推導在氧化初期（薄氧化層）與後期（厚氧化層）的近似生長速率。
(b) 在1000°C乾式氧化中，B/A = 0.165 μm/hr，B = 0.0117 μm²/hr。若初始無氧化層，計算生長100nm SiO₂所需的時間。
(c) 解釋為何濕式氧化的速率遠高於乾式氧化。

**詳解**：

**解題思路**：從Deal-Grove方程的數學形式出發，分別取兩種極限情況；再代入實際參數進行計算。

**步驟**：

**(a) 近似速率推導**：

Deal-Grove方程：x² + Ax = B(t + τ)

對時間微分求生長速率 dx/dt：

2x(dx/dt) + A(dx/dt) = B

$$\frac{dx}{dt} = \frac{B}{2x + A}$$

- **初期（x << A/2，薄氧化層）**：
  - 2x + A ≈ A，因此 dx/dt ≈ B/A
  - 此為**線性生長區**，生長速率常數 = B/A（linear rate constant）
  - 速率由界面反應（Si表面的氧化反應）控制
  - 近似解：x ≈ (B/A)(t + τ)

- **後期（x >> A/2，厚氧化層）**：
  - 2x + A ≈ 2x，因此 dx/dt ≈ B/(2x)
  - 此為**拋物線生長區**，拋物線速率常數 = B（parabolic rate constant）
  - 速率由氧化劑穿過已生成的SiO₂擴散控制
  - 近似解：x² ≈ Bt

**(b) 計算生長100nm所需時間**：

已知：B/A = 0.165 μm/hr，B = 0.0117 μm²/hr
因此 A = B/(B/A) = 0.0117/0.165 = 0.0709 μm

目標：x = 0.1 μm，初始無氧化層故需考慮 τ。

對於乾式氧化的極薄區域，實驗上初始氧化存在快速氧化現象。在此假設 τ = 0（或根據題意初始無氧化層）。

代入 Deal-Grove 方程：
x² + Ax = B·t（τ = 0）

(0.1)² + (0.0709)(0.1) = 0.0117 × t

0.01 + 0.00709 = 0.0117 × t

0.01709 = 0.0117 × t

t = 0.01709 / 0.0117 = **1.46 hr ≈ 87.6 分鐘**

驗證：100nm 處仍在線性區附近（x = 0.1μm vs A/2 = 0.035μm），所以兩項都有貢獻，需用完整方程。

**(c) 濕式氧化速率較高的原因**：

- 濕式氧化的氧化劑為 H₂O，乾式氧化為 O₂
- H₂O 在 SiO₂ 中的**溶解度（solubility）**遠高於 O₂（約高出3個數量級）
- H₂O 在 SiO₂ 中的**擴散係數（diffusivity）**也較高
- 因為 B ∝ D·C*（D為擴散係數，C*為氧化劑在SiO₂中的平衡濃度），H₂O的B值遠大於O₂
- 因此濕式氧化速率遠高於乾式氧化（可快5-10倍）
- 代價：濕式氧化的膜質較疏鬆，介面態密度較高

**答案**：(a) 初期線性速率 dx/dt ≈ B/A（反應控制），後期拋物線速率 dx/dt ≈ B/(2x)（擴散控制）。(b) 約 1.46 小時（87.6 分鐘）。(c) H₂O在SiO₂中溶解度與擴散係數均遠高於O₂，使拋物線速率常數B大幅增加。

**延伸思考**：現代先進製程中，閘極氧化層厚度僅約1-2nm（等效氧化層厚度EOT），已超出Deal-Grove模型的適用範圍（<20nm有初始快速氧化效應）。High-k介電質（如HfO₂）取代傳統SiO₂已是必然趨勢。

---
### 題目 3：Fick擴散定律與恆定表面濃度擴散
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：擴散（Diffusion）

**題目**：
硼（Boron）在矽中的擴散遵循Fick定律。在恆定表面濃度擴散條件下：

(a) 寫出Fick第一與第二定律，並推導恆定表面濃度邊界條件下的濃度分佈解。
(b) 在1100°C下硼的擴散係數 D = 1.5 × 10⁻¹³ cm²/s。若表面濃度固定為 Cs = 5 × 10²⁰ cm⁻³，基底濃度 CB = 1 × 10¹⁶ cm⁻³（n型），求擴散30分鐘後的接面深度 xj。
(c) 若改為固定總劑量擴散（drive-in），初始劑量 Q = 1 × 10¹⁴ cm⁻²，同樣條件下的濃度分佈為何？

**詳解**：

**解題思路**：先建立擴散方程，再根據邊界條件選擇erfc或高斯解，最後代入數值計算。

**步驟**：

**(a) Fick定律與解**：

**Fick第一定律**（擴散通量）：
$$J = -D \frac{\partial C}{\partial x}$$

**Fick第二定律**（濃度隨時間變化）：
$$\frac{\partial C}{\partial t} = D \frac{\partial^2 C}{\partial x^2}$$

**恆定表面濃度邊界條件**：
- C(0, t) = Cs（表面濃度固定）
- C(x, 0) = 0（初始無摻質）
- C(∞, t) = 0

解為**互補誤差函數（complementary error function）**：

$$C(x, t) = C_s \cdot \text{erfc}\left(\frac{x}{2\sqrt{Dt}}\right)$$

其中 erfc(z) = 1 - erf(z) = 1 - (2/√π)∫₀ᶻ e^(-u²) du

**(b) 接面深度計算**：

接面深度 xj 定義為 C(xj, t) = CB

$$C_B = C_s \cdot \text{erfc}\left(\frac{x_j}{2\sqrt{Dt}}\right)$$

先計算 2√(Dt)：
- t = 30 min = 1800 s
- Dt = 1.5 × 10⁻¹³ × 1800 = 2.7 × 10⁻¹⁰ cm²
- √(Dt) = 1.643 × 10⁻⁵ cm
- 2√(Dt) = 3.286 × 10⁻⁵ cm = 0.3286 μm

求 erfc 的引數：
$$\text{erfc}\left(\frac{x_j}{2\sqrt{Dt}}\right) = \frac{C_B}{C_s} = \frac{10^{16}}{5 \times 10^{20}} = 2 \times 10^{-5}$$

查 erfc 表或反函數：erfc(z) = 2 × 10⁻⁵ → z ≈ 3.12

$$x_j = z \times 2\sqrt{Dt} = 3.12 \times 0.3286 \text{ μm} = 1.025 \text{ μm}$$

**xj ≈ 1.03 μm**

**(c) 固定總劑量擴散（Drive-in）**：

邊界條件：
- 總劑量守恆：∫₀^∞ C(x,t) dx = Q
- 表面無通量（或近似封閉邊界）

解為**高斯分佈**：

$$C(x, t) = \frac{Q}{\sqrt{\pi D t}} \exp\left(-\frac{x^2}{4Dt}\right)$$

表面濃度隨時間下降：C(0,t) = Q/√(πDt)

代入數值：
- C(0, t) = 10¹⁴ / √(π × 2.7 × 10⁻¹⁰) = 10¹⁴ / (2.913 × 10⁻⁵) = 3.43 × 10¹⁸ cm⁻³

**答案**：(a) 恆定表面濃度解為 C = Cs·erfc(x/2√Dt)。(b) xj ≈ 1.03 μm。(c) 固定劑量解為高斯分佈 C = (Q/√πDt)·exp(-x²/4Dt)，表面濃度約 3.43 × 10¹⁸ cm⁻³。

**延伸思考**：現代先進製程中，傳統熱擴散已被離子佈植取代用於精確摻雜控制。但擴散理論仍用於理解佈植後退火（annealing）的摻質重新分佈，以及超淺接面（USJ, Ultra-Shallow Junction）的設計。

---
### 題目 4：離子佈植參數計算
**來源**：台大電機 / TSMC面試
**難度**：★★★
**主題**：離子佈植（Ion Implantation）

**題目**：
將砷（As⁺）以100 keV能量佈植入矽中，已知投射範圍 Rp = 66 nm，標準差（橫向散佈）ΔRp = 25 nm。

(a) 寫出佈植後的濃度分佈函數。
(b) 若佈植劑量 Φ = 5 × 10¹⁵ cm⁻²，計算峰值濃度。
(c) 說明什麼是通道效應（Channeling Effect），以及如何避免。
(d) 比較離子佈植與熱擴散的優缺點。

**詳解**：

**解題思路**：離子佈植的濃度分佈近似高斯，從高斯分佈公式推導峰值濃度，再討論實務問題。

**步驟**：

**(a) 濃度分佈函數**：

佈植後的濃度分佈近似高斯分佈：

$$C(x) = \frac{\Phi}{\sqrt{2\pi} \Delta R_p} \exp\left(-\frac{(x - R_p)^2}{2(\Delta R_p)^2}\right)$$

其中：
- Φ = 佈植劑量（cm⁻²）
- Rp = 投射範圍（峰值位置）= 66 nm
- ΔRp = 標準差 = 25 nm

**(b) 峰值濃度計算**：

峰值出現在 x = Rp，此時指數項 = 1：

$$C_{peak} = C(R_p) = \frac{\Phi}{\sqrt{2\pi} \Delta R_p}$$

代入數值：
$$C_{peak} = \frac{5 \times 10^{15}}{\sqrt{2\pi} \times 25 \times 10^{-7}}$$

$$= \frac{5 \times 10^{15}}{2.507 \times 25 \times 10^{-7}}$$

$$= \frac{5 \times 10^{15}}{6.267 \times 10^{-6}}$$

$$= 7.98 \times 10^{20} \text{ cm}^{-3}$$

**Cpeak ≈ 8.0 × 10²⁰ cm⁻³**

常用近似公式：Cpeak ≈ 0.4 × Φ/ΔRp
= 0.4 × 5×10¹⁵ / (25×10⁻⁷) = 8.0 × 10²⁰ cm⁻³（吻合）

**(c) 通道效應（Channeling Effect）**：

- 當入射離子沿著晶體的主要晶軸或晶面方向行進時，離子會進入原子列之間的「通道」
- 在通道中，離子受到的核碰撞極少，主要靠電子阻擋力減速
- 結果：離子穿透深度遠超預期，分佈出現深處的長尾（tail）
- 嚴重影響接面深度控制

**避免方法**：
- **傾斜佈植（Tilt implant）**：將晶圓傾斜7°並旋轉22°，避開主要通道方向
- **表面非晶化（Pre-amorphization）**：先佈植Ge或Si破壞表面晶格
- **螢幕氧化層（Screen oxide）**：在表面生長薄氧化層，使離子入射前先散射
- **降低佈植能量**：減少通道效應的影響深度

**(d) 離子佈植 vs 熱擴散**：

| 特性 | 離子佈植 | 熱擴散 |
|------|----------|--------|
| 劑量控制 | 極精確（電流積分） | 較難精確控制 |
| 深度控制 | 可獨立調整（能量） | 與溫度/時間耦合 |
| 低溫製程 | 佈植本身為室溫 | 需高溫（900-1200°C） |
| 橫向擴展 | 極小 | 等向性擴散 |
| 晶格損傷 | 嚴重，需退火修復 | 無 |
| 超淺接面 | 可實現 < 20nm | 困難 |
| 選擇性 | 可用光阻定義區域 | 需氧化層遮罩 |

**答案**：(a) 高斯分佈如上式。(b) 峰值濃度約 8.0 × 10²⁰ cm⁻³。(c) 通道效應為離子沿晶軸穿透過深的現象，可用傾斜佈植或預非晶化避免。(d) 離子佈植在劑量/深度控制上遠優於熱擴散，但需退火修復損傷。

**延伸思考**：先進製程中，超低能量（< 1 keV）離子佈植用於形成超淺接面。電漿浸沒式離子佈植（PLAD）是另一替代技術。3nm以下節點中，摻雜的精確控制（每個鰭片只有幾百個摻質原子）成為統計漲落的重大挑戰。

---
### 題目 5：乾式氧化 vs 濕式氧化
**來源**：台大電機 / 經典題型
**難度**：★★
**主題**：氧化製程

**題目**：
(a) 寫出乾式氧化與濕式氧化的化學反應方程式。
(b) 比較兩者在氧化速率、膜質、應用場景上的差異。
(c) 在1000°C下，乾式氧化的拋物線速率常數 B_dry = 0.0117 μm²/hr，濕式氧化為 B_wet = 0.287 μm²/hr。若要生長500nm的場氧化層（field oxide），分別需要多少時間？（假設厚氧化層近似，忽略線性項）

**詳解**：

**解題思路**：先列出化學反應，再從Deal-Grove模型的物理意義比較兩者，最後用拋物線近似做計算。

**步驟**：

**(a) 化學反應方程式**：

**乾式氧化（Dry Oxidation）**：
$$\text{Si} + \text{O}_2 \rightarrow \text{SiO}_2$$

**濕式氧化（Wet Oxidation）**：
$$\text{Si} + 2\text{H}_2\text{O} \rightarrow \text{SiO}_2 + 2\text{H}_2$$

**(b) 比較**：

| 特性 | 乾式氧化 | 濕式氧化 |
|------|----------|----------|
| 氧化速率 | 慢 | 快（5-10倍） |
| 膜質（密度） | 緻密、高品質 | 較疏鬆 |
| 介面態密度 Dit | 低（~10¹⁰ cm⁻²eV⁻¹） | 較高 |
| 崩潰電場 | 高（~10 MV/cm） | 較低 |
| 典型應用 | 閘極氧化層（Gate Oxide） | 場氧化層（Field Oxide）、厚氧化層 |
| 含水量 | 極低 | 含有OH基 |

**(c) 生長500nm所需時間**：

在拋物線近似下（厚氧化層）：x² ≈ Bt

x = 0.5 μm

**乾式氧化**：
t_dry = x²/B_dry = (0.5)²/0.0117 = 0.25/0.0117 = **21.4 hr**

**濕式氧化**：
t_wet = x²/B_wet = (0.5)²/0.287 = 0.25/0.287 = **0.871 hr ≈ 52.3 min**

速率比：t_dry/t_wet = 21.4/0.871 ≈ 24.6 倍

**答案**：(a) 如上所列。(b) 乾式氧化慢但膜質佳，用於閘極；濕式氧化快但膜質較差，用於場氧化。(c) 乾式約21.4小時，濕式約52分鐘，相差約25倍。

**延伸思考**：實際製程常採用「乾-濕-乾」（Dry-Wet-Dry）三明治氧化法：先乾式氧化建立良好Si/SiO₂界面，中間用濕式氧化快速增厚，最後再以乾式氧化提升表面品質。這是工程折衷的典型範例。

---
### 題目 6：擴散的固定總劑量與兩步驟擴散
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：擴散（Diffusion）

**題目**：
磷（Phosphorus）的兩步驟擴散製程如下：
- **預沉積（Pre-deposition）**：900°C，30分鐘，D₁ = 3.0 × 10⁻¹⁵ cm²/s，表面濃度 Cs = 1 × 10²¹ cm⁻³
- **驅入（Drive-in）**：1100°C，60分鐘，D₂ = 6.5 × 10⁻¹³ cm²/s

(a) 計算預沉積後的總劑量 Q。
(b) 計算驅入後的表面濃度與接面深度（基底濃度 CB = 1 × 10¹⁵ cm⁻³）。
(c) 解釋為何採用兩步驟擴散而非單步驟。

**詳解**：

**解題思路**：預沉積為恆定表面濃度擴散（erfc解），驅入為固定總劑量擴散（高斯解），依序計算。

**步驟**：

**(a) 預沉積後的總劑量**：

恆定表面濃度擴散的總劑量：
$$Q = \frac{2C_s\sqrt{D_1 t_1}}{\sqrt{\pi}}$$

計算 D₁t₁：
- D₁t₁ = 3.0 × 10⁻¹⁵ × (30 × 60) = 3.0 × 10⁻¹⁵ × 1800 = 5.4 × 10⁻¹² cm²
- √(D₁t₁) = 2.324 × 10⁻⁶ cm

$$Q = \frac{2 \times 10^{21} \times 2.324 \times 10^{-6}}{\sqrt{\pi}} = \frac{4.648 \times 10^{15}}{1.7725} = 2.62 \times 10^{15} \text{ cm}^{-2}$$

**Q ≈ 2.62 × 10¹⁵ cm⁻²**

**(b) 驅入後的濃度分佈**：

假設驅入時間遠長於預沉積（D₂t₂ >> D₁t₁），預沉積分佈可視為δ函數：

D₂t₂ = 6.5 × 10⁻¹³ × 3600 = 2.34 × 10⁻⁹ cm²

確認：D₂t₂/D₁t₁ = 2.34 × 10⁻⁹ / 5.4 × 10⁻¹² = 433 >> 1 ✓

高斯分佈：
$$C(x) = \frac{Q}{\sqrt{\pi D_2 t_2}} \exp\left(-\frac{x^2}{4D_2 t_2}\right)$$

**表面濃度**：
$$C(0) = \frac{Q}{\sqrt{\pi D_2 t_2}} = \frac{2.62 \times 10^{15}}{\sqrt{\pi \times 2.34 \times 10^{-9}}}$$

$$= \frac{2.62 \times 10^{15}}{8.574 \times 10^{-5}} = 3.06 \times 10^{19} \text{ cm}^{-3}$$

**接面深度** xj（令 C(xj) = CB）：
$$C_B = C(0) \exp\left(-\frac{x_j^2}{4D_2 t_2}\right)$$

$$\frac{x_j^2}{4D_2 t_2} = \ln\left(\frac{C(0)}{C_B}\right) = \ln\left(\frac{3.06 \times 10^{19}}{10^{15}}\right) = \ln(3.06 \times 10^4) = 10.33$$

$$x_j = \sqrt{4 \times 2.34 \times 10^{-9} \times 10.33} = \sqrt{9.669 \times 10^{-8}} = 3.11 \times 10^{-4} \text{ cm}$$

**xj ≈ 3.11 μm**

**(c) 兩步驟擴散的優勢**：
- **預沉積**在低溫下進行，精確控制總劑量Q（表面濃度由固溶度決定，可重複性高）
- **驅入**在高溫下進行，獨立控制接面深度（調整溫度和時間）
- 將「劑量控制」與「深度控制」解耦，提高製程靈活性
- 單步驟擴散中，劑量和深度互相耦合，無法獨立調整

**答案**：(a) Q ≈ 2.62 × 10¹⁵ cm⁻²。(b) 表面濃度 ≈ 3.06 × 10¹⁹ cm⁻³，接面深度 xj ≈ 3.11 μm。(c) 兩步驟擴散將劑量與深度的控制解耦，提高製程可控性。

**延伸思考**：現代製程中離子佈植已取代預沉積步驟，但「佈植+退火」本質上仍是兩步驟概念：佈植控制劑量，退火控制活化與擴散。快速熱退火（RTA）與尖峰退火（Spike Anneal）可大幅減少驅入時的不必要擴散。

---
### 題目 7：CVD薄膜沉積
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：薄膜沉積（Thin Film Deposition）

**題目**：
(a) 比較CVD（Chemical Vapor Deposition）、PVD（Physical Vapor Deposition/Sputtering）與ALD（Atomic Layer Deposition）三種薄膜沉積技術的原理與特性。
(b) CVD的沉積速率可由兩個機制控制：質量傳輸控制（mass-transport limited）與表面反應控制（surface-reaction limited）。畫出沉積速率對溫度的Arrhenius圖，說明兩個區域的特徵。
(c) 對於先進製程中的高深寬比（high aspect ratio）結構填充，為何ALD是最佳選擇？

**詳解**：

**解題思路**：從物理/化學機制比較三種方法，再從動力學角度分析CVD速率，最後討論階梯覆蓋（step coverage）問題。

**步驟**：

**(a) 三種沉積技術比較**：

| 特性 | CVD | PVD（濺鍍） | ALD |
|------|-----|-------------|-----|
| 原理 | 氣相化學反應 | 物理轟擊靶材 | 自限性交替化學反應 |
| 溫度 | 中高（300-900°C） | 低（室溫-300°C） | 低中（100-400°C） |
| 階梯覆蓋 | 中等-良好 | 差（視線性沉積） | 極佳（近100%保形） |
| 厚度控制 | 中等 | 中等 | 極精確（原子層級） |
| 沉積速率 | 快 | 中等 | 慢 |
| 膜質 | 良好 | 緻密 | 極佳 |
| 典型應用 | SiO₂, Si₃N₄, poly-Si | 金屬（Al, Ti, TaN） | High-k（HfO₂）, 薄阻障層 |

**(b) CVD的Arrhenius圖**：

沉積速率 R vs 1/T 的關係圖呈現兩個區域：

```
ln(R)
  |        ___________
  |       /            表面反應控制區
  |      /             （低溫，Ea大）
  |     /              斜率 = -Ea/kB
  |    /
  |---/--------------- 質量傳輸控制區
  |  /                 （高溫，弱溫度依賴）
  |_/_________________
         1/T →
```

- **低溫區（表面反應控制）**：沉積速率由表面化學反應速率決定，呈現強Arrhenius溫度依賴（Ea通常0.5-2 eV），膜厚均勻度好
- **高溫區（質量傳輸控制）**：反應很快，速率由反應物從氣相傳輸到表面的擴散速率決定，溫度依賴弱（Ea約0.1-0.2 eV），膜厚均勻度由氣流決定
- LPCVD通常操作在表面反應控制區，以獲得良好的膜厚均勻度
- APCVD通常操作在質量傳輸控制區

**(c) ALD用於高深寬比結構**：

- ALD的每個循環（cycle）分為兩個自限性半反應：
  1. 前驅物A吸附至表面（飽和後停止）→ 清洗（purge）
  2. 前驅物B與表面反應 → 清洗
- **自限性（self-limiting）**特性確保每個循環僅沉積一個原子層（~0.1 nm/cycle）
- 不論結構深淺，只要前驅物分子能到達表面，就會沉積等厚薄膜
- 階梯覆蓋率（step coverage）接近100%，即使深寬比 > 100:1
- 這對先進FinFET/GAA的閘極介電層、金屬阻障層沉積至關重要

**答案**：(a) CVD靠化學反應、PVD靠物理轟擊、ALD靠自限性交替反應。(b) 低溫為表面反應控制（強溫度依賴），高溫為質量傳輸控制（弱溫度依賴）。(c) ALD的自限性反應確保在高深寬比結構中達到近乎完美的保形沉積。

**延伸思考**：TSMC在5nm以下節點大量使用ALD沉積HfO₂（high-k閘極介電層）、TiN（金屬閘極）、TaN（擴散阻障層）。新型前驅物的開發與ALD製程窗口的優化是先進製程的關鍵挑戰。

---
### 題目 8：離子佈植的損傷與退火
**來源**：TSMC面試 / 經典題型
**難度**：★★★
**主題**：離子佈植（Ion Implantation）

**題目**：
(a) 離子佈植會對矽晶格造成哪些損傷？描述損傷的類型與機制。
(b) 何謂非晶化臨界劑量（amorphization threshold dose）？重離子（如As、Sb）與輕離子（如B）在非晶化行為上有何差異？
(c) 比較以下退火方法的溫度、時間與效果：
   - 爐管退火（Furnace Anneal）
   - 快速熱退火（RTA, Rapid Thermal Anneal）
   - 尖峰退火（Spike Anneal）
   - 雷射退火（Laser Anneal）

**詳解**：

**解題思路**：從離子與晶格的交互作用出發，分析損傷產生機制，再討論修復方法的演進。

**步驟**：

**(a) 離子佈植損傷類型與機制**：

入射離子通過兩種機制與靶材原子交互作用：
1. **核阻擋（Nuclear Stopping）**：離子與靶原子核的庫侖碰撞，造成靶原子位移
2. **電子阻擋（Electronic Stopping）**：離子與電子的非彈性碰撞，損失能量但不造成位移

損傷類型：
- **Frenkel缺陷對**：矽原子被撞離晶格位置，形成空位（vacancy）+ 間隙原子（interstitial）
- **碰撞串列（Collision Cascade）**：一個入射離子可產生數百到數千個Frenkel對
- **非晶化區域（Amorphous Pocket）**：當局部損傷密度超過臨界值，晶格完全崩潰成非晶態
- **簇集缺陷（Cluster Defects）**：空位或間隙原子聚集形成延伸缺陷

**(b) 非晶化行為**：

非晶化臨界劑量：當損傷密度達到約10%的原子被位移時，局部區域轉變為非晶態。

| 離子 | 質量 | 非晶化臨界劑量 | 特徵 |
|------|------|----------------|------|
| B⁺ | 11 amu | ~10¹⁶ cm⁻² | 輕離子，損傷分散，難以非晶化 |
| Si⁺ | 28 amu | ~5×10¹⁴ cm⁻² | 中等 |
| As⁺ | 75 amu | ~10¹³-10¹⁴ cm⁻² | 重離子，損傷集中，容易非晶化 |
| Sb⁺ | 122 amu | ~10¹³ cm⁻² | 最重，非常容易非晶化 |

重離子的核阻擋力大，碰撞串列密集，在低劑量下就能形成連續的非晶層。非晶層的固態磊晶再結晶（SPER, Solid-Phase Epitaxial Regrowth）是修復此類損傷的有效方法。

**(c) 退火方法比較**：

| 方法 | 溫度 | 時間 | 摻質活化率 | 擴散量 | 應用節點 |
|------|------|------|-----------|--------|----------|
| 爐管退火 | 800-1000°C | 30-60 min | 高 | 大 | > 0.5 μm |
| RTA | 1000-1100°C | 10-60 s | 高 | 中等 | 180-65 nm |
| 尖峰退火 | 1050-1100°C | ~1 s（峰值） | 高 | 小 | 45-14 nm |
| 雷射退火 | 1200-1400°C | μs-ms | 極高 | 極小 | ≤ 10 nm |

關鍵趨勢：**提高溫度、縮短時間**，以最大化摻質活化同時最小化擴散。

雷射退火（LSA/DSA）可在不影響其他結構的情況下，在極短時間內將表面加熱到接近矽熔點，實現超高活化率與超淺接面。

**答案**：(a) 佈植造成Frenkel缺陷對、碰撞串列、非晶化區域等損傷。(b) 重離子損傷密集，非晶化臨界劑量低（As約10¹³-10¹⁴ cm⁻²），輕離子損傷分散，臨界劑量高（B約10¹⁶ cm⁻²）。(c) 退火技術演進：爐管→RTA→尖峰→雷射，溫度升高、時間縮短，兼顧活化與抑制擴散。

**延伸思考**：3nm以下節點採用GAA結構，通道厚度僅5-7nm，摻質在退火中的任何額外擴散都不可接受。毫秒退火（msec anneal）與雷射退火成為必要技術，且需精確控制熱預算（thermal budget）。

---
### 題目 9：氧化過程中的摻質再分佈
**來源**：台大電機 / 經典題型
**難度**：★★★★
**主題**：氧化與擴散的交互作用

**題目**：
在矽表面進行熱氧化時，原有的摻質會發生再分佈（dopant redistribution）。定義分凝係數（segregation coefficient）m = C_Si/C_oxide（摻質在矽中濃度與在氧化層中濃度的比值）。

(a) 畫出 m > 1 與 m < 1 兩種情況下，氧化後Si/SiO₂界面附近的摻質濃度剖面。
(b) 硼（B）的 m < 1（約0.3），磷（P）的 m > 10。解釋這對CMOS製程中閘極氧化的影響。
(c) 什麼是氧化增強擴散（OED, Oxidation-Enhanced Diffusion）？其物理機制為何？

**詳解**：

**解題思路**：從分凝係數的物理意義出發，結合氧化生長方向分析摻質的遷移方向，再討論對製程的影響。

**步驟**：

**(a) 摻質再分佈剖面**：

氧化時，Si被消耗形成SiO₂，Si/SiO₂界面向矽內部移動。摻質在界面處的平衡由分凝係數m決定：

**m > 1（如P, As）：摻質傾向留在矽中**
```
C(x)
  |   SiO₂  |    Si
  |          |  /\
  |          | /  \_____
  |  低濃度  |/堆積(pile-up)
  |__________|__________
           界面        x
```
- 摻質被「推」回矽中，界面處出現濃度堆積（pile-up）
- 氧化層中濃度極低

**m < 1（如B）：摻質傾向進入氧化層**
```
C(x)
  |   SiO₂  |    Si
  |          |
  |  /\      |
  | /  \     |   ___
  |/    \    |__/耗盡(depletion)
  |__________|__________
           界面        x
```
- 摻質被「吸」入氧化層，矽側界面出現濃度耗盡（depletion）
- 氧化層中濃度升高

**(b) 對CMOS閘極氧化的影響**：

- **硼（PMOS源/汲極，或基底摻質）**：m < 1，氧化時硼被吸入SiO₂
  - PMOS通道區表面硼濃度降低 → 臨界電壓|Vth|下降
  - 硼穿透閘極氧化層 → 影響閘極氧化層可靠度
  - 對策：使用氮化處理（N₂O或NO退火）形成氮氧化矽（SiON），阻擋硼擴散

- **磷/砷（NMOS源/汲極）**：m > 1，被推回矽中
  - 表面濃度增加，有利於歐姆接觸
  - 但可能導致通道濃度變化，影響Vth

**(c) 氧化增強擴散（OED）**：

**現象**：在氧化環境中，摻質（尤其是B和P）的擴散係數比在惰性氣氛中增大數倍。

**物理機制**：
1. Si被氧化時，Si/SiO₂界面產生過量的矽自間隙原子（self-interstitials）
2. 這些間隙原子向矽體內擴散
3. B和P主要通過與間隙原子交換的機制擴散（interstitialcy mechanism）
4. 過量間隙原子增加了交換機會，加速了擴散

$$D_{eff} = D_i \frac{C_I}{C_I^*} + D_v \frac{C_V}{C_V^*}$$

其中 CI/CI* > 1（間隙原子超飽和），使 Deff 增大。

相反地，砷（As）和銻（Sb）主要通過空位機制擴散。氧化時過量間隙原子會與空位複合，降低空位濃度，反而可能出現**氧化抑制擴散（ORD, Oxidation-Retarded Diffusion）**。

**答案**：(a) m>1：矽側堆積；m<1：矽側耗盡。(b) 硼被吸入氧化層導致Vth偏移和穿透問題，磷被推回矽中利於接觸但影響通道。(c) OED源於氧化產生的過量間隙原子加速了以間隙機制為主的摻質擴散。

**延伸思考**：OED效應在先進製程中需被精確模擬（TCAD），因為每一步氧化都會影響已有摻質分佈。這也是為何先進製程盡量減少高溫氧化步驟，改用沉積氧化層（如PECVD SiO₂）的原因之一。

---
### 題目 10：離子佈植的劑量與能量選擇
**來源**：TSMC面試 / 經典題型
**難度**：★★★
**主題**：離子佈植（Ion Implantation）

**題目**：
某NMOS電晶體的臨界電壓調整佈植（Vth adjust implant）需求如下：
- 目標為在閘極氧化層下方植入硼（B⁺），使表面濃度增加 ΔN = 5 × 10¹² cm⁻²
- 閘極氧化層厚度 tox = 5 nm
- 硼在SiO₂中的投射範圍與ΔRp的經驗值：佈植能量E = 10 keV時，Rp(SiO₂) ≈ 38 nm，ΔRp ≈ 17 nm；Rp(Si) ≈ 34 nm，ΔRp ≈ 15 nm

(a) 佈植穿過5nm氧化層後，硼在矽中的有效Rp為多少？
(b) 若需要將劑量的峰值放在矽表面附近（距Si/SiO₂界面10nm處），應選擇多少佈植能量？（提示：粗略估計即可）
(c) 為何Vth調整佈植通常使用極低劑量（~10¹²cm⁻²）？過高劑量會造成什麼問題？

**詳解**：

**解題思路**：考慮離子穿過氧化層後的剩餘射程，再根據目標深度反推能量，最後討論低劑量的物理原因。

**步驟**：

**(a) 穿過氧化層後的有效Rp**：

離子先穿過5nm的SiO₂，消耗部分能量和射程。

簡化計算：假設在SiO₂中的射程消耗比例 = tox/Rp(SiO₂) = 5/38 = 13.2%

近似方法 — 在SiO₂中走了5nm後，等效於「已消耗」了5nm的射程。剩餘射程換算到矽中：

有效Rp(Si) = Rp(Si) - tox × [Rp(Si)/Rp(SiO₂)]
= 34 - 5 × (34/38)
= 34 - 4.47
= **29.5 nm**（從Si/SiO₂界面算起）

更精確的做法需使用SRIM/TRIM模擬，但此近似在工程估計中可接受。

**(b) 能量選擇**：

目標：峰值位於距Si/SiO₂界面10nm處

需要在矽中的有效Rp = 10 nm

從(a)的關係：
有效Rp(Si) = Rp(Si, E) - tox × [Rp(Si, E)/Rp(SiO₂, E)]

需要 Rp(Si, E) 使得有效值 ≈ 10 nm

由10 keV數據外推（B在Si中的Rp粗略正比於E⁰·⁷⁻⁰·⁸）：

在10 keV時有效Rp ≈ 29.5 nm，目標10 nm ≈ 29.5 × (E/10)^0.75

10/29.5 = (E/10)^0.75
0.339 = (E/10)^0.75
(E/10) = 0.339^(1/0.75) = 0.339^1.333 = 0.236
E ≈ 2.4 keV

**佈植能量約 2-3 keV**（超低能量佈植）

**(c) 低劑量的原因**：

Vth調整佈植的目的是微調通道表面的摻質濃度以設定臨界電壓：

$$\Delta V_{th} \approx \frac{q \cdot \Delta N}{C_{ox}}$$

其中 Cox = εox/tox

若 tox = 5nm：Cox = 3.9 × 8.854 × 10⁻¹⁴ / (5 × 10⁻⁷) = 6.91 × 10⁻⁷ F/cm²

ΔVth = 1.6 × 10⁻¹⁹ × 5 × 10¹² / 6.91 × 10⁻⁷ = 1.16 V

即使僅 5 × 10¹² cm⁻² 的劑量就可調整約1V的Vth。

**過高劑量的問題**：
- 通道中過多的摻質散射（ionized impurity scattering）降低載子遷移率
- 隨機摻質漲落（Random Dopant Fluctuation, RDF）加劇，增加Vth變異
- 在先進節點中，每個電晶體通道中只有數十到數百個摻質原子，統計漲落本身就是重大挑戰

**答案**：(a) 有效Rp ≈ 29.5 nm。(b) 約2-3 keV超低能量佈植。(c) 極低劑量即可產生足夠的Vth偏移（~10¹²cm⁻²對應~1V），過高劑量會降低遷移率並增加RDF導致的Vth變異。

**延伸思考**：在FinFET和GAA結構中，由於通道為非平面結構，傳統的Vth調整佈植難以均勻控制。先進節點改用功函數金屬（work function metal）的種類與厚度來調整Vth，稱為「多功函數金屬閘極整合」（Multi-Vth by metal gate engineering）。

---
## Part 2：微影與蝕刻（題目 11–20）

---
### 題目 11：光學微影解析度與焦深
**來源**：台大電機 / TSMC面試
**難度**：★★★
**主題**：微影（Lithography）

**題目**：
光學微影的兩個關鍵方程式為：

$$R = k_1 \frac{\lambda}{NA}$$
$$DOF = k_2 \frac{\lambda}{NA^2}$$

其中 R 為最小解析度，DOF 為焦深（Depth of Focus），λ 為光源波長，NA 為數值孔徑，k₁ 和 k₂ 為製程相關係數。

(a) 解釋 NA 的物理意義及其與成像品質的關係。
(b) ArF準分子雷射（λ = 193nm），配合液浸式微影（Immersion Lithography, NA = 1.35），k₁ = 0.3，計算最小解析度。並解釋為何 k₁ 的理論下限為0.25。
(c) 討論提高解析度的三種策略（縮短波長、增大NA、降低k₁），各自的限制為何？

**詳解**：

**解題思路**：從光學繞射原理出發，理解 Rayleigh 方程的物理含義，再分析各參數的工程極限。

**步驟**：

**(a) NA的物理意義**：

$$NA = n \sin\theta$$

其中 n 為介質折射率（空氣 n=1，水 n=1.44），θ 為物鏡收光半角。

- NA 越大，收集到的繞射光越多，能重建越精細的圖案
- 在空氣中 NA < 1（因 sinθ < 1），液浸式中可超過1
- 提高 NA 可改善解析度，但 DOF 與 NA² 成反比，焦深急劇縮小

**(b) 計算最小解析度**：

$$R = k_1 \frac{\lambda}{NA} = 0.3 \times \frac{193}{1.35} = 0.3 \times 143 = 42.9 \text{ nm}$$

**R ≈ 43 nm**

k₁ 理論下限 = 0.25 的原因：
- 根據 Rayleigh 準則，兩個點要被解析，其繞射圖案的最小間距對應 k₁ = 0.61（古典Rayleigh）
- 在半導體微影中，利用部分相干照明和光阻非線性效應，k₁ 可降至0.5以下
- **k₁ = 0.25 是物理極限**：此時圖案的空間頻率恰好等於光學系統的截止頻率（cutoff frequency），只有一對繞射級（±1st order）能通過鏡頭
- 低於0.25，繞射光完全無法通過鏡頭，成像不可能

**(c) 提高解析度的策略與限制**：

| 策略 | 方法 | 限制 |
|------|------|------|
| 縮短 λ | 193nm → 13.5nm（EUV） | 光源功率不足、光罩缺陷、全反射光學系統昂貴 |
| 增大 NA | 液浸式（water, n=1.44）→ High-NA EUV（NA=0.55） | DOF急劇縮小、光學系統龐大、像差控制困難 |
| 降低 k₁ | OPC、PSM、OAI、多重曝光 | k₁ → 0.25物理極限、計算量巨大、製程複雜度增加 |

**答案**：(a) NA = n sinθ，決定收光能力與解析度。(b) R ≈ 43nm；k₁ = 0.25為截止頻率對應的物理極限。(c) 三種策略各有物理和工程極限，先進製程需三者同時推進。

**延伸思考**：TSMC的7nm以下節點採用EUV（λ=13.5nm）微影。即使EUV將波長縮短14倍，NA=0.33時的解析度也只能達到約13nm（k₁=0.3）。因此3nm/2nm節點仍需EUV多重曝光或High-NA EUV（NA=0.55）。

---
### 題目 12：光學增強技術（RET）
**來源**：台大電機 / 經典題型
**難度**：★★★★
**主題**：微影技術

**題目**：
當特徵尺寸接近光源波長時，繞射效應嚴重影響成像品質。解析增強技術（RET, Resolution Enhancement Techniques）是必要手段。

(a) 解釋光學鄰近校正（OPC, Optical Proximity Correction）的原理，並舉例說明 serif 與 hammerhead 的用途。
(b) 解釋相位移光罩（PSM, Phase Shift Mask）如何提升解析度。比較衰減型PSM（Attenuated PSM）與交替型PSM（Alternating PSM）。
(c) 離軸照明（OAI, Off-Axis Illumination）的原理為何？常見的照明模式有哪些？

**詳解**：

**解題思路**：從光學繞射造成的圖案失真出發，說明各RET如何修正或利用繞射效應。

**步驟**：

**(a) 光學鄰近校正（OPC）**：

**原理**：在光罩上的圖案預先加入「反向補償」結構，使得通過光學系統後的空間像（aerial image）更接近目標圖案。

**光學鄰近效應**：
- 密集線（dense lines）與孤立線（isolated lines）的線寬不同
- 線端（line-end）會因繞射而縮短
- 角落（corner）會圓化

**OPC修正結構**：
- **Serif（鋸齒/突出）**：在矩形圖案的角落加入小方塊，補償角落圓化
  ```
  目標圖案:     OPC修正後:
  ┌──┐          ┌┐┌──┐┌┐
  │  │          │ │  │ │
  │  │          │ │  │ │
  └──┘          └┘└──┘└┘
  ```
- **Hammerhead（錘頭）**：在線端加入T型突出，補償線端縮短
  ```
  目標:         OPC修正:
  ───           ┬─────┬
                ───────
                ┴─────┴
  ```
- **Scattering Bar（散射條）**：在孤立線旁加入次解析度（sub-resolution）輔助圖案，使孤立線的繞射環境類似密集線

現代OPC已從規則式（rule-based）演進為模型式（model-based），利用光學模型和光阻模型反覆優化光罩圖案。

**(b) 相位移光罩（PSM）**：

**原理**：在光罩上引入π（180°）的相位差，使相鄰透光區的電場反相，在交界處形成零強度暗區，顯著提升對比度。

**衰減型PSM（Attenuated / Half-tone PSM）**：
- 暗區不是完全不透光，而是透過約6-8%的光並帶有180°相移
- 優點：不需修改圖案設計，與傳統光罩設計流程相容
- 缺點：改善幅度有限
- 可將 k₁ 從 ~0.4 降至 ~0.3

**交替型PSM（Alternating / Strong PSM）**：
- 相鄰的透光區交替施加0°與180°相位
- 優點：對比度大幅提升，k₁ 可降至 ~0.25
- 缺點：相位衝突（phase conflict）問題——在奇數排列的圖案中無法自洽地分配相位；光罩製造複雜，需蝕刻石英以產生精確的180°相位差

**(c) 離軸照明（OAI）**：

**原理**：將照明光源從傳統的正向入射（on-axis）改為從特定角度斜向入射，使繞射的±1級光更對稱地進入鏡頭，改善密集圖案的成像對比度。

等效於在頻域中平移照明，使目標空間頻率更好地落在鏡頭的通帶內。

**常見照明模式**：
- **環形照明（Annular）**：環狀光源，適用於各方向的密集圖案
- **雙極照明（Dipole）**：兩個對稱點光源，最適合單方向密集線
- **四極照明（Quadrupole / Quasar）**：四個對稱點光源，適合X/Y方向的密集圖案
- **自由形式照明（Freeform / Source-Mask Optimization, SMO）**：利用演算法同時優化光源形狀與光罩圖案

**答案**：(a) OPC在光罩上加入補償結構修正繞射失真；serif修正角落，hammerhead修正線端。(b) PSM利用相位差提升對比度；衰減型簡單但改善有限，交替型效果好但有相位衝突。(c) OAI改變照明角度使繞射光更好地通過鏡頭，常見模式有環形、雙極、四極等。

**延伸思考**：現代微影已發展為光源-光罩協同優化（SMO, Source-Mask Optimization）和反向微影技術（ILT, Inverse Lithography Technology），利用大規模計算在光罩上產生自由形式的曲線圖案。ILT的計算量巨大，需借助GPU加速，是EDA公司（如Synopsys、Siemens EDA）的重要業務之一。

---
### 題目 13：EUV微影技術
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★
**主題**：微影技術（EUV Lithography）

**題目**：
極紫外光微影（EUV Lithography）使用 λ = 13.5 nm 的光源。

(a) 為何EUV必須使用反射式光學系統與反射式光罩，而非傳統的透射式？
(b) EUV光源（Sn plasma, LPP）的產生原理為何？目前功率的瓶頸在哪？
(c) 比較EUV與ArF液浸式微影在解析度、生產力（throughput）與成本上的差異。
(d) 什麼是隨機效應（Stochastic Effects）？為何在EUV中特別嚴重？

**詳解**：

**解題思路**：從EUV光子的物理特性出發，理解整個系統設計的必然邏輯。

**步驟**：

**(a) 反射式系統的必要性**：

13.5nm波長的光子能量為92eV，屬於軟X射線範圍：
- **所有材料在此波長下的折射率接近1**（n ≈ 1 - δ，δ ~ 10⁻²），無法製作透射式透鏡
- **所有材料都強烈吸收EUV光**，包括空氣、玻璃、水
- 因此：
  - 必須在**真空中**操作
  - 使用**多層膜反射鏡**（Mo/Si multilayer，反射率~67%/面）
  - 光罩為**反射式**（在多層膜上刻圖案的吸收層）
  - 整個光路約6面反射鏡，總效率 ≈ 0.67⁶ ≈ 9%

**(b) EUV光源**：

**雷射產生電漿（LPP, Laser-Produced Plasma）**：
1. CO₂雷射（~20 kW）聚焦在錫（Sn）液滴上
2. 液滴被加熱至 ~50萬K，形成高溫等離子體
3. 高度游離的 Sn¹⁰⁺-Sn¹⁴⁺ 離子輻射出13.5nm特徵波長的光
4. 收集鏡收集光並導向照明系統

**功率瓶頸**：
- 從CO₂雷射到晶圓面的轉換效率僅 ~1-2%
- 需 >20 kW 雷射才能達到 250W 的中間焦點功率（250 wafers/hr的throughput需求）
- 錫污染（tin debris）對收集鏡的損傷需頻繁清洗
- ASML的EXE:5000系列已達到約600W光源功率（用於High-NA EUV）

**(c) EUV vs ArF Immersion 比較**：

| 特性 | ArF 液浸（193i） | EUV（13.5nm） |
|------|------------------|---------------|
| 波長 | 193 nm | 13.5 nm |
| NA | 1.35 | 0.33（標準）/ 0.55（High-NA） |
| 單次曝光解析度 | ~38nm（k₁=0.27） | ~13nm（k₁=0.3）|
| 光罩數（7nm節點） | 需4重曝光（~80層光罩） | 單次曝光（~50層光罩） |
| 每層曝光時間 | 快（>200 wph） | 較慢（~170-200 wph） |
| 設備成本 | ~$50M | ~$180M（標準）/ ~$380M（High-NA） |
| 光罩成本 | ~$30K/片 | ~$300K/片 |
| 疊對精度需求 | 極嚴格（多重曝光） | 較寬鬆（單次曝光） |

**(d) 隨機效應（Stochastic Effects）**：

EUV光子能量（92eV）遠高於DUV（6.4eV），因此**相同曝光能量下的光子數量少得多**：

$$N_{photon} \propto \frac{E_{dose}}{E_{photon}} = \frac{E_{dose} \cdot \lambda}{hc}$$

EUV的光子數僅為DUV的約1/14。

**隨機效應的表現**：
- **光子散粒雜訊（Shot Noise）**：光子數的統計漲落（∝√N）導致曝光量不均勻
- **光阻化學隨機性**：光酸產生劑（PAG）的分佈不均、酸催化反應的隨機擴散
- **線寬粗糙度（LWR/LER, Line Width/Edge Roughness）**增大
- **隨機缺陷**：局部光子數不足導致圖案缺失或橋接

在7nm以下節點，隨機效應是EUV良率的主要限制因素之一。對策包括提高光源功率（增加光子數）、開發高效率光阻（低曝光劑量需求）、以及利用機器學習進行缺陷預測。

**答案**：(a) 所有材料在13.5nm下都強烈吸收光，只能用多層膜反射式光學。(b) CO₂雷射轟擊Sn液滴產生高溫電漿輻射，功率瓶頸在轉換效率低和錫污染。(c) EUV解析度高且減少多重曝光，但設備和光罩成本極高。(d) EUV光子能量高、數量少，導致散粒雜訊和光阻化學隨機性增大。

**延伸思考**：ASML的High-NA EUV（NA=0.55）設備已於2025年量產導入。但anamorphic光學帶來新挑戰：光罩需4x/8x混合倍率，光場面積減半，影響throughput。2nm及以下節點可能需要High-NA EUV配合多重曝光。

---
### 題目 14：蝕刻技術與選擇比
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：蝕刻（Etching）

**題目**：
(a) 比較濕式蝕刻（Wet Etching）與乾式蝕刻（Dry Etching/RIE）在等向性、選擇比、精確度上的差異。
(b) 定義蝕刻選擇比（Selectivity）與非等向性（Anisotropy）。若使用RIE蝕刻100nm厚的SiO₂，蝕刻停止層為Si₃N₄，選擇比為SiO₂:Si₃N₄ = 30:1，則在蝕刻完SiO₂後，Si₃N₄會被蝕刻掉多少？
(c) 在RIE中，為何可以達到非等向性蝕刻？解釋側壁鈍化（sidewall passivation）機制。

**詳解**：

**解題思路**：從蝕刻的物理/化學機制出發，比較兩大類蝕刻技術，再深入RIE的非等向性機制。

**步驟**：

**(a) 濕式蝕刻 vs 乾式蝕刻**：

| 特性 | 濕式蝕刻 | 乾式蝕刻（RIE） |
|------|----------|-----------------|
| 機制 | 純化學反應 | 化學+物理（離子轟擊） |
| 等向性 | 等向性（各方向速率相同） | 可達高度非等向性 |
| 選擇比 | 高（>100:1可能） | 中等（10-50:1） |
| 圖案精確度 | 差（底切undercut） | 佳（垂直側壁） |
| 損傷 | 無 | 有（離子損傷） |
| 適用尺寸 | > 1μm | 奈米級 |
| 均勻度 | 良好 | 依設備而定 |
| 環保 | 大量化學廢液 | 廢氣處理 |

**(b) 選擇比與消耗量計算**：

**選擇比（Selectivity）**定義：
$$S = \frac{\text{目標材料蝕刻速率}}{\text{停止層蝕刻速率}} = \frac{R_{SiO_2}}{R_{Si_3N_4}} = 30$$

**非等向性（Anisotropy）**定義：
$$A = 1 - \frac{R_{lateral}}{R_{vertical}}$$
A = 1 為完全非等向性（只有垂直蝕刻），A = 0 為等向性

蝕刻100nm SiO₂（假設10%過蝕刻 overetch）：
- 過蝕刻時間等效於多蝕刻 10nm SiO₂
- 在此期間Si₃N₄的蝕刻量 = 110nm / 30 = **3.67 nm**

若僅計算剛好蝕刻完的瞬間：
- Si₃N₄消耗 = 100nm / 30 = **3.33 nm**

**實際上考慮過蝕刻（通常20-50%），Si₃N₄損耗約 4-5 nm。這就是為何高選擇比非常重要。**

**(c) RIE的非等向性機制**：

RIE結合了化學蝕刻與物理離子轟擊：

1. **離子增強反應（Ion-Enhanced Etching）**：
   - 反應性離子（如CF₄產生的F⁺和CFₓ⁺）被電場加速垂直撞擊基板
   - 離子轟擊打斷表面化學鍵，加速化學反應
   - 水平面受離子轟擊 → 高蝕刻速率
   - 垂直側壁幾乎不受離子轟擊 → 低蝕刻速率

2. **側壁鈍化（Sidewall Passivation）**：
   - 蝕刻氣體中的聚合物前驅物（如CHF₃中的CFₓ自由基）在所有表面沉積薄膜
   - 水平面上的鈍化膜被離子轟擊不斷去除 → 繼續蝕刻
   - 側壁上的鈍化膜不被轟擊 → 保護側壁不被化學蝕刻
   - 形成「蝕刻-鈍化」的競爭平衡

3. **Bosch製程**（深矽蝕刻）：
   - 交替進行SF₆（蝕刻步驟）和C₄F₈（鈍化步驟）
   - 可達到極高深寬比（>50:1）的矽蝕刻
   - 側壁有明顯的scalloping波紋

**答案**：(a) 濕式等向性高選擇比，乾式非等向性但選擇比較低。(b) 選擇比30:1下，蝕刻100nm SiO₂僅損耗約3.3nm Si₃N₄。(c) RIE的非等向性來自垂直離子轟擊與側壁鈍化膜的保護。

**延伸思考**：先進FinFET/GAA製程中，原子層蝕刻（ALE, Atomic Layer Etching）是新興技術，與ALD類似，通過自限性的改質-去除循環實現原子級精確的蝕刻控制。在3nm GAA的nanosheet釋放製程中，需要極高選擇比地去除SiGe而不損傷Si通道。

---
### 題目 15：CMP化學機械研磨
**來源**：台大電機 / TSMC面試
**難度**：★★★
**主題**：CMP（Chemical Mechanical Polishing/Planarization）

**題目**：
CMP是現代IC製程中實現全域平坦化的關鍵技術。

(a) 說明CMP的基本原理，為何同時需要「化學」與「機械」作用？
(b) Preston方程描述CMP的材料移除速率：MRR = Kp × P × V，解釋各參數的意義與此方程的適用限制。
(c) CMP中的碟型凹陷（dishing）與侵蝕（erosion）現象為何？對電路效能有何影響？如何改善？

**詳解**：

**解題思路**：從CMP的物理化學機制出發，理解Preston方程的工程意義，再討論非理想效應。

**步驟**：

**(a) CMP基本原理**：

CMP將晶圓面朝下壓在旋轉的研磨墊（polishing pad）上，同時供應研磨液（slurry）：

- **化學作用**：研磨液中的化學成分（如氧化劑H₂O₂、pH調節劑、螯合劑）軟化或改質表面材料
  - 例如：Cu表面被氧化為CuO軟層
  - SiO₂表面被鹼性溶液水解
- **機械作用**：研磨液中的磨粒（如SiO₂或CeO₂奈米顆粒，20-200nm）在壓力下研磨表面
  - 去除被化學改質的軟化層

**為何需要兩者結合**：
- 純機械研磨速率低、表面粗糙度大、且刮傷嚴重
- 純化學蝕刻為等向性，無法實現平坦化（凸處和凹處等速蝕刻）
- CMP中，凸起處壓力大 → 化學改質+機械去除都快；凹處壓力小 → 去除慢
- 這個壓力差異是CMP能實現平坦化的關鍵

**(b) Preston方程**：

$$MRR = K_p \times P \times V$$

- **MRR（Material Removal Rate）**：材料移除速率（nm/min 或 Å/min）
- **Kp（Preston係數）**：與材料、研磨液、墊材等相關的比例常數
- **P（Pressure）**：施加壓力（下壓力/晶圓面積）
- **V（Velocity）**：晶圓與研磨墊的相對速度

**適用限制**：
- Preston方程是經驗性的線性模型，不包含化學反應動力學
- 在極低壓力或極高壓力下偏離線性
- 不考慮圖案密度效應（pattern density effect）
- 不同材料（Cu, SiO₂, Si₃N₄, Ta）的Kp差異巨大
- 溫度效應（化學反應的Arrhenius依賴）未包含

**(c) Dishing與Erosion**：

**碟型凹陷（Dishing）**：
- 寬金屬線（或大面積金屬區）的中央部分被過度研磨，呈碟型下凹
- 原因：寬金屬區上方的研磨墊變形深入溝槽，繼續研磨已低於表面的金屬
- 影響：金屬厚度減薄 → 電阻增加 → RC延遲增大

**侵蝕（Erosion）**：
- 密集金屬線區域的介電質表面整體下降
- 原因：密集區金屬佔比高，整體移除量大，且金屬與介電質的研磨速率不同
- 影響：介電層變薄 → 層間絕緣能力下降 → 可靠度問題

**改善方法**：
- **虛擬金屬填充（Dummy Metal Fill）**：在金屬密度低的區域加入虛擬圖案，使全域密度均勻化
- **多步驟CMP**：先快速研磨（高壓），再精密研磨（低壓）
- **研磨液優化**：調整對不同材料的選擇比
- **終點偵測（Endpoint Detection）**：光學或電學方法精確控制研磨量

**答案**：(a) 化學軟化+機械去除的協同效應，壓力差異實現選擇性平坦化。(b) MRR = Kp·P·V，為經驗線性模型，不適用極端條件和圖案密度效應。(c) Dishing為寬金屬凹陷，Erosion為密集區整體下降，可用dummy fill和多步驟CMP改善。

**延伸思考**：CMP的dummy fill設計是EDA工具（如Calibre, IC Validator）的重要功能，需在滿足密度規則的同時避免影響電路效能（耦合電容、天線效應等）。在先進節點中，CMP均勻度直接影響後續微影的焦深容限。

---
### 題目 16：雙大馬士革製程（Dual Damascene）
**來源**：台大電機 / TSMC面試
**難度**：★★★
**主題**：BEOL（Back-End-Of-Line）製程

**題目**：
(a) 說明為何銅互連必須使用大馬士革（Damascene）製程，而不能像鋁一樣直接蝕刻。
(b) 畫出雙大馬士革製程的主要步驟（Via-first approach）。
(c) 銅的擴散阻障層（Diffusion Barrier）為何必要？常用材料與其發展趨勢。

**詳解**：

**解題思路**：從銅的化學特性出發，理解製程整合方案的設計邏輯。

**步驟**：

**(a) 銅必須用大馬士革製程的原因**：

- 銅無法被傳統RIE有效蝕刻：
  - 銅的鹵化物（CuCl₂, CuF₂）在室溫下蒸氣壓極低（不揮發）
  - 蝕刻產物無法從表面帶走，蝕刻停止
  - 需加熱至 >200°C 才有足夠揮發性，但此溫度下光阻無法承受
- 大馬士革製程是「反向」做法：
  - 先在介電層中蝕刻溝槽（trench）和通孔（via）
  - 再填入銅
  - 最後用CMP去除多餘的銅
  - 只需蝕刻介電層（SiO₂/low-k），技術成熟

**(b) 雙大馬士革製程步驟（Via-first）**：

```
步驟1：沉積介電層        步驟2：蝕刻通孔（via）
┌──────────────┐      ┌──────────────┐
│   介電層      │      │   介電層  │  │
│              │ →    │          │  │
│              │      │    via   │  │
├──下層金屬────┤      ├──下層金屬─┤──┤
└──────────────┘      └──────────────┘

步驟3：蝕刻溝槽（trench） 步驟4：沉積阻障層+種子層
┌──────────────┐      ┌──────────────┐
│  trench │    │      │ ║trench║    │
│─────────│    │ →    │ ║      ║    │
│    via  │    │      │ ║ via  ║    │
├──下層金屬┤────┤      ├═║下層金屬║════┤
└──────────────┘      └──────────────┘

步驟5：電鍍填銅（ECP）    步驟6：CMP平坦化
┌══════════════┐      ┌──────────────┐
│▓▓▓▓▓▓▓▓▓▓▓▓▓│      │ ▓▓▓▓▓▓▓│    │
│▓▓▓▓▓▓▓▓▓▓▓▓▓│ →    │ ▓▓▓▓▓▓▓│    │
│▓▓▓▓▓▓▓▓▓▓▓▓▓│      │ ▓▓ via▓│    │
├▓▓下層金屬▓▓▓▓┤      ├──下層金屬┤────┤
└══════════════┘      └──────────────┘
```

關鍵步驟：
1. 沉積低介電常數（low-k）介電層
2. 微影+蝕刻通孔圖案
3. 微影+蝕刻溝槽圖案（需精確控制深度停在通孔頂部）
4. PVD沉積擴散阻障層（Ta/TaN）和銅種子層（Cu seed）
5. 電化學鍍銅（ECP, Electrochemical Plating）填滿溝槽和通孔
6. CMP去除多餘銅和阻障層，完成平坦化

**(c) 擴散阻障層**：

**必要性**：
- 銅在矽和SiO₂中擴散極快（即使在200°C）
- 銅進入矽中形成深能階陷阱（deep-level trap），嚴重降低載子壽命
- 銅在介電層中遷移導致短路和可靠度失效
- 必須用阻障層將銅完全包覆

**常用材料與趨勢**：

| 世代 | 材料 | 厚度 | 特點 |
|------|------|------|------|
| 早期（130-65nm） | TaN/Ta 雙層 | 8-15 nm | PVD沉積，黏附性好 |
| 中期（45-14nm） | TaN/Ta + Ru liner | 3-8 nm | Ru改善銅填充能力 |
| 先進（7nm-） | TaN（ALD）+ Co/Ru liner | 1.5-3 nm | ALD保形沉積，極薄化 |
| 未來 | 自成形阻障層（Self-Forming Barrier）| < 1 nm | CuMn合金退火自形成MnSiO₃ |

趨勢：隨著金屬線寬縮小，阻障層佔比增大（「佔位效應」），有效銅截面積減小，電阻急劇上升。因此阻障層必須極薄化，且未來可能改用不需阻障層的金屬（如Ru、Mo）。

**答案**：(a) 銅鹵化物不揮發，無法RIE蝕刻，故用先蝕刻介電層再填銅的大馬士革製程。(b) Via-first雙大馬士革包含介電層蝕刻、阻障層/種子層沉積、電鍍、CMP等步驟。(c) 阻障層防止銅擴散至矽和介電層，從Ta/TaN演進至ALD超薄膜。

**延伸思考**：在TSMC 3nm以下節點，最底層金屬層（M1/M2）的線寬僅12-16nm，銅電阻率因電子散射（grain boundary + surface scattering）急劇上升。鈷（Co）和釕（Ru）因晶粒較大且不需厚阻障層，正在取代銅用於最底層互連。

---
### 題目 17：液浸式微影（Immersion Lithography）
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：微影技術

**題目**：
液浸式微影（Immersion Lithography）在鏡頭與晶圓之間填入高折射率液體（水，n = 1.44）。

(a) 液浸式如何提升NA？若乾式最大NA = 0.93，液浸式最大NA為多少？
(b) 液浸式對焦深（DOF）的影響為何？
(c) 液浸式的工程挑戰有哪些？（至少列舉三項）

**詳解**：

**解題思路**：從NA的定義出發，分析液浸對解析度和焦深的雙重效應。

**步驟**：

**(a) 液浸式提升NA**：

$$NA = n \sin\theta$$

乾式（空氣 n=1）：NA_dry = sinθ < 1，實際最大約 0.93

液浸式（水 n=1.44）：NA_imm = 1.44 × sinθ

若保持相同的收光角θ：NA_imm = 1.44 × NA_dry / 1 = 1.44 × 0.93 = 1.34

**最大 NA ≈ 1.35**（受限於光阻表面的全反射角）

解析度改善：R_imm/R_dry = NA_dry/NA_imm = 0.93/1.35 = 0.69，提升約31%

**(b) 對焦深的影響**：

在液浸式中，焦深的表達式需修正：

$$DOF_{imm} = k_2 \frac{\lambda}{n \cdot (NA/n)^2} = k_2 \frac{n\lambda}{NA^2}$$

更嚴謹的推導顯示：

$$DOF_{imm} = n \times DOF_{dry}$$（在相同的成像條件k₁下）

因此液浸式的焦深比乾式增大 n = 1.44 倍。

這是液浸式的一大優勢：在提升解析度的同時，焦深也有改善（至少比等效NA的乾式好）。

**(c) 工程挑戰**：

1. **氣泡（Bubble）控制**：水中的微氣泡會散射光線造成成像缺陷，需脫氣處理和流場設計
2. **液體汙染**：水中微粒和溶出物（從光阻中溶出的光酸）會汙染鏡頭，需保護層（top coat）
3. **水痕缺陷（Watermark Defect）**：晶圓邊緣和高速移動時液滴殘留造成的缺陷
4. **熱效應**：水吸收曝光光子的熱量，局部溫度變化影響折射率和成像品質
5. **光阻相容性**：光阻表面需疏水處理以確保液體控制良好

**答案**：(a) 液浸式將NA從0.93提升至1.35，利用水的折射率n=1.44。(b) 焦深增大約n倍，是液浸式的額外優勢。(c) 氣泡控制、液體汙染、水痕缺陷、熱效應、光阻相容性等。

**延伸思考**：ArF液浸式微影是目前最成熟的量產微影技術，在配合多重曝光（multi-patterning）下可用於7nm節點。曾有研究高折射率液體（n>1.6）以進一步提升NA，但因材料限制未被採用，業界轉向EUV路線。

---
### 題目 18：多重曝光技術（Multiple Patterning）
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★
**主題**：微影技術

**題目**：
在EUV量產前，多重曝光（Multiple Patterning）是延續193nm液浸式微影至10nm/7nm節點的關鍵技術。

(a) 解釋LELE（Litho-Etch-Litho-Etch）雙重曝光的原理與限制。
(b) 說明SADP（Self-Aligned Double Patterning）的製程步驟，並解釋為何稱為「自對準」。
(c) SAQP（Self-Aligned Quadruple Patterning）如何將間距再縮小一半？簡述其流程。

**詳解**：

**解題思路**：從間距倍增（pitch splitting）的概念出發，比較不同方法的機制和精度。

**步驟**：

**(a) LELE雙重曝光**：

原理：將一層密集圖案拆成兩次曝光，每次只曝光一半的圖案，間距加倍。

```
目標圖案（pitch = P）：  |  |  |  |  |  |

第一次曝光（pitch = 2P）：|     |     |     |
蝕刻第一組圖案

第二次曝光（pitch = 2P）：   |     |     |
蝕刻第二組圖案

合併結果：               |  |  |  |  |  |
```

**限制**：
- **疊對誤差（Overlay Error）**：兩次曝光之間的對準精度直接影響線距均勻性
  - 若overlay = 2nm，則相鄰線的間距誤差為 ±2nm（佔10nm間距的20%）
- **成本加倍**：兩次微影+兩次蝕刻
- **設計複雜度**：需將圖案分割為兩組（coloring problem），並非所有圖案都能合法分割

**(b) SADP（自對準雙重圖案化）**：

製程步驟：

```
步驟1：形成犧牲心軸（Mandrel）
    █    █    █        （pitch = 2P）

步驟2：保形沉積間隔物（Spacer），如SiO₂ 或 SiN
   ▓█▓  ▓█▓  ▓█▓      （間隔物厚度 = P/2）

步驟3：去除心軸（選擇性蝕刻）
   ▓ ▓  ▓ ▓  ▓ ▓      （只剩間隔物）

步驟4：以間隔物為遮罩蝕刻下層
   |  |  |  |  |  |    （pitch = P，密度加倍）
```

**稱為「自對準」的原因**：
- 間隔物（spacer）是通過保形沉積均勻地形成在心軸兩側
- 間隔物之間的相對位置由沉積厚度決定，**不依賴微影對準精度**
- 因此避免了LELE中的疊對誤差問題
- 間距精度由薄膜沉積厚度控制（可達亞奈米精度），遠優於微影對準

**(c) SAQP（自對準四重圖案化）**：

SAQP在SADP的基礎上再做一次間隔物生成：

```
步驟1-3：SADP流程得到第一組間隔物（pitch = P）
   ▓ ▓  ▓ ▓  ▓ ▓

步驟4：以第一組間隔物為新的心軸，沉積第二層間隔物
  ░▓░▓  ░▓░▓  ░▓░▓

步驟5：去除第一組間隔物
  ░  ░  ░  ░  ░  ░    （只剩第二層間隔物，pitch = P/2）

步驟6：以第二組間隔物為遮罩蝕刻
  ||||||||||||||||      （pitch = P/2，密度四倍）
```

最終間距 = 原始心軸間距/4

例如：原始193i微影間距80nm → SADP得40nm → SAQP得20nm

**答案**：(a) LELE拆分圖案兩次曝光，受限於疊對誤差和成本。(b) SADP用心軸+間隔物自對準倍增密度，精度由沉積厚度決定。(c) SAQP在SADP基礎上再做一次間隔物生成，間距縮小為原始的1/4。

**延伸思考**：TSMC在10nm/7nm節點大量使用SADP和SAQP。進入5nm後EUV取代了大部分多重曝光層，但部分關鍵層仍需EUV+SADP的組合。多重曝光的設計規則限制（如cut placement、tip-to-tip spacing）深刻影響EDA的佈局繞線演算法。

---
### 題目 19：蝕刻製程中的微負載效應與ARDE
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：蝕刻（Etching）

**題目**：
(a) 解釋微負載效應（Microloading Effect）與深寬比相依蝕刻（ARDE, Aspect Ratio Dependent Etching）的差異。
(b) 在蝕刻深溝槽（deep trench）結構時，ARDE會如何影響蝕刻結果？其物理機制為何？
(c) 在先進FinFET的鰭片（fin）蝕刻中，如何確保不同間距（pitch）的鰭片具有一致的高度？

**詳解**：

**解題思路**：從反應物傳輸與消耗的角度分析局部蝕刻速率差異。

**步驟**：

**(a) 微負載效應 vs ARDE**：

**微負載效應（Microloading）**：
- 在同一晶圓上，暴露面積大的區域蝕刻速率較慢，暴露面積小的區域蝕刻速率較快
- 原因：密集圖案區消耗較多反應物，造成局部反應物不足
- 尺度：mm級（圖案密度差異）

**ARDE（深寬比相依蝕刻）**：
- 深寬比（aspect ratio = depth/width）越大的特徵，蝕刻速率越慢
- 原因：在高深寬比結構中，反應物難以到達底部，產物難以排出
- 尺度：μm級（個別特徵的幾何形狀）

**(b) ARDE對深溝槽蝕刻的影響**：

在蝕刻具有不同寬度的溝槽時：
- 寬溝槽蝕刻速率快，窄溝槽蝕刻速率慢
- 結果：相同蝕刻時間下，不同寬度的溝槽深度不同

**物理機制**：
1. **Knudsen傳輸**：在窄溝槽中，反應物分子的平均自由程大於溝槽寬度，分子以Knudsen擴散方式移動，進入速率與寬度成正比
2. **反應物耗盡**：反應物在沿溝槽側壁向下移動時不斷被消耗
3. **產物再沉積**：蝕刻產物在狹窄空間中難以逸出，可能重新沉積在底部
4. **離子角度效應**：在深溝槽中，只有接近垂直入射的離子才能到達底部

ARDE的蝕刻速率與深寬比的關係近似：
$$R(AR) \approx R_0 \times \frac{1}{1 + k \cdot AR}$$

**(c) FinFET鰭片蝕刻的一致性控制**：

挑戰：不同間距的鰭片在蝕刻後高度不同（微負載+ARDE）

解決方案：
- **蝕刻停止層（Etch Stop Layer）**：在目標深度預先沉積蝕刻選擇比高的材料，使蝕刻自動停止
- **時間控制+原位監測**：光學發射光譜（OES）或干涉法即時監控蝕刻深度
- **虛擬圖案（Dummy Fin）**：在稀疏區域加入虛擬鰭片，使局部圖案密度均勻
- **多步驟蝕刻**：先快蝕刻接近目標，再慢蝕刻精確控制
- **電漿脈衝調制**：脈衝式電漿可改善離子/自由基比例，減少ARDE

**答案**：(a) 微負載是mm級密度效應，ARDE是μm級深寬比效應。(b) ARDE使窄溝槽蝕刻慢，源於Knudsen傳輸和反應物耗盡。(c) 使用蝕刻停止層、虛擬圖案、多步驟蝕刻等方法確保鰭片高度一致。

**延伸思考**：在GAA nanosheet製程中，需要精確蝕刻Si/SiGe超晶格並釋放通道，蝕刻的選擇性和ARDE控制變得更加關鍵。原子層蝕刻（ALE）可提供最佳的精確度，但throughput仍是挑戰。

---
### 題目 20：BEOL低介電常數（Low-k）介電材料
**來源**：台大電機 / TSMC面試
**難度**：★★★
**主題**：BEOL製程

**題目**：
(a) 解釋為何後段互連（BEOL）需要低介電常數（low-k）介電材料。從RC延遲的角度推導其重要性。
(b) 列出不同世代的介電材料及其介電常數（k值）。
(c) 低k材料在製程整合上面臨哪些挑戰？為何業界卡在 k ≈ 2.5-3.0 多年？

**詳解**：

**解題思路**：從互連RC延遲模型出發，說明降低k的動機，再討論材料與製程的工程挑戰。

**步驟**：

**(a) Low-k的必要性**：

互連線的訊號延遲由RC時間常數決定：

$$\tau_{RC} = R \times C = \frac{\rho L}{W H} \times \frac{k \epsilon_0 W L}{T_{ILD}}$$

其中：ρ 為金屬電阻率，L 為線長，W 為線寬，H 為線高，k 為介電常數，T_ILD 為介電層厚度

簡化為：
$$\tau_{RC} \propto \rho \cdot k \cdot \frac{L^2}{H \cdot T_{ILD}}$$

隨著特徵尺寸縮小（W, H, T_ILD 等比例縮小），而 L 不一定等比例縮短：
- 互連密度增加，線長反而可能增加
- R 隨 W·H 縮小而急劇增加
- C 隨線距縮小而增加

因此必須同時降低 ρ（Cu取代Al）和 k（low-k取代SiO₂），以控制RC延遲。

在65nm以下節點，互連RC延遲已超過閘極延遲，成為效能瓶頸。

**(b) 不同世代的介電材料**：

| 世代 | 材料 | k值 | 節點 |
|------|------|------|------|
| 傳統 | SiO₂ | 3.9-4.2 | > 180nm |
| FSG | 氟摻矽玻璃 F-SiO₂ | 3.3-3.7 | 130-90nm |
| CDO/SiCOH | 碳摻氧化矽 | 2.7-3.0 | 65-28nm |
| Porous SiCOH | 多孔碳摻氧化矽 | 2.2-2.5 | 20-7nm |
| Air Gap | 空氣隙（k≈1） | 1.5-2.0（等效） | ≤ 5nm（局部） |
| 理想 | 真空 | 1.0 | 理論極限 |

**(c) Low-k材料的整合挑戰**：

1. **機械強度低**：
   - low-k材料（尤其多孔型）的楊氏模量遠低於SiO₂
   - CMP時容易碎裂或剝離
   - 封裝時的熱應力可能導致裂紋
   - E(SiO₂) ≈ 70 GPa vs E(porous SiCOH) ≈ 3-8 GPa

2. **熱穩定性差**：
   - 多孔結構在高溫製程中可能塌陷
   - 有機成分在 >400°C 時分解
   - 限制了後續製程的熱預算

3. **化學穩定性差**：
   - 蝕刻和清洗過程中容易吸收水分
   - 水分增加k值（水的k=80）
   - 需要使用超臨界CO₂清洗等特殊製程

4. **與銅製程的相容性**：
   - 多孔結構可能讓銅擴散
   - 需要更可靠的阻障層
   - CMP slurry可能滲入孔洞

5. **蝕刻和微影困難**：
   - 多孔材料蝕刻後側壁粗糙
   - 電漿損傷導致表面k值升高（形成SiO₂損傷層）

**為何卡在 k ≈ 2.5-3.0**：上述所有問題在k值低於2.5時急劇惡化。業界在可靠度和良率之間做了折衷，選擇在k ≈ 2.5-3.0 的材料上使用局部air gap來進一步降低等效k值，而非全面使用超低k材料。

**答案**：(a) 互連RC延遲∝ρ·k，low-k降低線間電容以減少延遲和串擾。(b) 從SiO₂(k=4)演進至porous SiCOH(k=2.2)再到局部air gap。(c) 機械強度低、化學穩定性差、與CMP/蝕刻相容性差，k<2.5時問題急劇惡化。

**延伸思考**：TSMC在3nm/2nm節點的最底層互連採用air gap技術，在關鍵金屬層之間建立空氣間隙以降低電容。這需要犧牲部分機械強度，並對CMP和可靠度提出更高要求。未來的BEOL 3D堆疊（如nanoTSV）將引入全新的介電需求。

---
## Part 3：EDA 邏輯合成與最佳化（題目 21–30）

---
### 題目 21：RTL到GDS的IC設計流程
**來源**：台大電機 / IC設計公司面試
**難度**：★★
**主題**：IC設計流程

**題目**：
請完整描述從RTL設計到GDS-II檔案輸出的數位IC設計流程（前端+後端），列出每個主要步驟使用的EDA工具（以Synopsys/Cadence為例），並說明每個步驟的輸入與輸出。

**詳解**：

**解題思路**：以標準數位IC設計流程為框架，依序列出各步驟及其對應的EDA工具。

**步驟**：

**完整設計流程**：

| 步驟 | 說明 | EDA工具 | 輸入 | 輸出 |
|------|------|---------|------|------|
| 1. RTL設計 | 用Verilog/VHDL描述硬體行為 | 文字編輯器 | 規格書 | RTL code |
| 2. RTL模擬驗證 | 功能驗證（functional simulation） | VCS / Xcelium | RTL + Testbench | 波形/覆蓋率 |
| 3. 邏輯合成 | RTL → Gate-level netlist | Design Compiler / Genus | RTL + 時序約束(SDC) + 元件庫(Liberty) | 閘級網表 |
| 4. 等效性檢查 | 確認合成結果功能等效 | Formality / Conformal | RTL + 閘級網表 | Pass/Fail |
| 5. DFT插入 | 加入掃描鏈、BIST等測試結構 | DFT Compiler / Modus | 閘級網表 | DFT網表 |
| 6. 晶片規劃 | 定義模組位置與IO位置 | IC Compiler II / Innovus | 網表 + 約束 | Floorplan DEF |
| 7. 電源規劃 | 電源網格（Power Grid）設計 | IC Compiler II / Innovus | Floorplan | Power mesh |
| 8. 佈局 | 標準元件放置 | IC Compiler II / Innovus | 網表 + Floorplan | Placed DEF |
| 9. 時脈樹合成 | Clock tree建構 | IC Compiler II / Innovus | Placed DEF + CTS約束 | CTS DEF |
| 10. 繞線 | 金屬連線 | IC Compiler II / Innovus | CTS DEF | Routed DEF |
| 11. 寄生參數提取 | 提取RC寄生參數 | StarRC / Quantus | Routed DEF + Tech file | SPEF/DSPF |
| 12. 靜態時序分析 | 驗證時序是否滿足 | PrimeTime / Tempus | 網表 + SPEF + SDC | Timing Report |
| 13. 物理驗證 | DRC/LVS/ERC檢查 | Calibre / IC Validator | GDS + Schematic | Error Report |
| 14. GDS輸出 | 最終版圖輸出 | IC Compiler II / Innovus | Routed DEF | GDS-II |

**關鍵迴圈**：
- 若時序不滿足 → 回到佈局或合成調整
- 若DRC/LVS錯誤 → 回到繞線修正
- ECO（Engineering Change Order）流程處理小規模修改

**答案**：IC設計流程包含前端（RTL→合成→DFT）和後端（佈局→CTS→繞線→驗證），每步驟有對應的EDA工具，核心是不斷迭代直到時序和物理規則同時滿足。

**延伸思考**：現代設計流程越來越強調「Shift Left」—— 在設計早期就考慮物理實現的限制。例如在RTL階段就做功率估計、在合成階段就做佈局感知（placement-aware synthesis）。這需要EDA工具鏈的深度整合。

---
### 題目 22：BDD（Binary Decision Diagram）
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：布林函數表示

**題目**：
(a) 何謂ROBDD（Reduced Ordered Binary Decision Diagram）？說明從BDD化簡為ROBDD的兩個規則。
(b) 對於函數 f(a, b, c) = a'b + ac + bc，以變數順序 a < b < c 建構ROBDD。
(c) 說明變數順序對ROBDD大小的影響。舉例一個函數，其最佳變數順序的ROBDD大小為O(n)，最差變數順序為O(2ⁿ)。

**詳解**：

**解題思路**：先理解BDD的Shannon展開基礎，再套用化簡規則建構ROBDD。

**步驟**：

**(a) ROBDD定義與化簡規則**：

**BDD（Binary Decision Diagram）**：布林函數的有向無環圖（DAG）表示。每個內部節點對應一個變數，有兩條邊（0-邊和1-邊），基於Shannon展開：

$$f = x \cdot f_{x=1} + x' \cdot f_{x=0}$$

**Ordered BDD（OBDD）**：從根到任何終端節點的路徑上，變數按固定順序出現。

**Reduced OBDD（ROBDD）**：對OBDD進行兩個化簡規則直到不能再化簡：

1. **合併規則（Merging / Sharing）**：若兩個節點的變數相同且0-邊和1-邊分別指向相同的子節點，則合併為一個節點
2. **消除規則（Deletion / Redundancy Removal）**：若某節點的0-邊和1-邊指向相同的子節點，則刪除此節點（此變數對函數值無影響）

**ROBDD的重要性質**：在給定變數順序下，ROBDD是布林函數的**唯一正規表示（canonical representation）**。兩個函數相等 ⟺ 其ROBDD完全相同。

**(b) 建構 f = a'b + ac + bc 的ROBDD**：

順序 a < b < c：

對 a 做Shannon展開：
- f(a=0) = b + 0 + bc = b（因 a=0 時，a'b = b，ac = 0）
- f(a=1) = 0 + c + bc = c + bc = c（因 a=1 時，a'b = 0，ac = c）

等等，重新計算：f = a'b + ac + bc

- f(a=0) = 0'·b + 0·c + bc = b + bc = b（吸收律）
- f(a=1) = 1'·b + 1·c + bc = 0 + c + bc = c

對 f(a=0) = b 再展開（對 b）：
- f(a=0, b=0) = 0
- f(a=0, b=1) = 1

對 f(a=1) = c 再展開（對 b）：
- f(a=1, b=0) = c
- f(a=1, b=1) = c

注意 f(a=1) 不依賴 b，所以 b 節點可消除（消除規則）。

ROBDD結構：
```
        [a]
       /   \
     0/     \1
     /       \
   [b]       [c]
   / \       / \
  0/  \1   0/   \1
  /    \   /     \
 (0)   (1)(0)   (1)
```

共3個內部節點（a, b, c）和2個終端節點（0, 1）。

**(c) 變數順序的影響**：

經典範例：**n位元交錯相等函數**

$$f(x_1, y_1, x_2, y_2, \ldots, x_n, y_n) = (x_1 \oplus y_1)' \cdot (x_2 \oplus y_2)' \cdots (x_n \oplus y_n)'$$

即 f = 1 當且僅當 xᵢ = yᵢ 對所有 i 成立。

- **最佳順序** x₁, y₁, x₂, y₂, ..., xₙ, yₙ（交錯排列）：
  - ROBDD大小為 **O(n)**（3n+2個節點）
  - 因為每對 (xᵢ, yᵢ) 可獨立判斷

- **最差順序** x₁, x₂, ..., xₙ, y₁, y₂, ..., yₙ（分開排列）：
  - ROBDD大小為 **O(2ⁿ)**
  - 因為在看完所有x之後、看y之前，必須記住所有x的值

這說明變數順序的選擇至關重要。找最佳順序是NP完全問題，實務上使用啟發式方法（如sifting algorithm）。

**答案**：(a) ROBDD通過合併相同子圖和消除冗餘節點化簡BDD，是布林函數的正規表示。(b) f = a'b + ac + bc 的ROBDD有3個內部節點。(c) 交錯相等函數在最佳序O(n)，最差序O(2ⁿ)。

**延伸思考**：BDD在EDA中廣泛用於形式驗證（formal verification）和符號模型檢查（symbolic model checking）。然而對於某些函數（如乘法器），任何變數順序的BDD都是指數大小，需要改用SAT求解器。

---
### 題目 23：兩階邏輯化簡與Espresso
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：邏輯最佳化

**題目**：
(a) 說明質蘊涵項（Prime Implicant）與必要質蘊涵項（Essential Prime Implicant）的定義。
(b) 對函數 f(A, B, C, D) = Σm(0, 2, 5, 6, 7, 8, 10, 12, 13, 14, 15)，用卡諾圖（Karnaugh Map）找出所有質蘊涵項和最小SOP表示。
(c) Quine-McCluskey方法的局限性為何？Espresso演算法如何改進？

**詳解**：

**解題思路**：用卡諾圖視覺化找出所有質蘊涵項，再確定必要項和覆蓋。

**步驟**：

**(a) 定義**：

**蘊涵項（Implicant）**：函數的一個乘積項（product term），使得該項為1時，函數必為1。

**質蘊涵項（Prime Implicant, PI）**：不能再與其他蘊涵項合併（刪除變數）的蘊涵項。即去掉任何一個文字（literal）後就不再是蘊涵項。

**必要質蘊涵項（Essential Prime Implicant, EPI）**：某個最小項（minterm）只被唯一一個質蘊涵項覆蓋，則該質蘊涵項為必要的，必須出現在最小表示中。

**(b) 卡諾圖化簡**：

```
        CD
AB  | 00  01  11  10
----+------------------
00  |  1   0   0   1
01  |  0   1   1   1
11  |  1   1   1   1
10  |  1   0   0   1
```

最小項：0(0000), 2(0010), 5(0101), 6(0110), 7(0111), 8(1000), 10(1010), 12(1100), 13(1101), 14(1110), 15(1111)

找質蘊涵項（最大的矩形分組）：

1. **C'D'**（覆蓋 0,4→不行，4不在。覆蓋 0,2,8,10）→ 等一下，讓我重新列：
   - m0=0000, m2=0010, m8=1000, m10=1010：共同點是 B'D'，即 **B'D'**

2. m5=0101, m7=0111, m13=1101, m15=1111：共同點是 BD，即 **BD**

3. m6=0110, m7=0111, m14=1110, m15=1111：共同點是 BC，即 **BC**

4. m12=1100, m13=1101, m14=1110, m15=1111：共同點是 AB，即 **AB**

5. m0=0000, m2=0010, m8=1000, m10=1010 已被 B'D' 覆蓋

6. m6=0110, m14=1110, m2=0010, m10=1010：共同點是 C, D'... 即 m2,m6,m10,m14 → **CD'**...
   - 0010, 0110, 1010, 1110 → 共同點是 D'，第二位(C)=1?  不，0010的C=1(bit1=1)?

   讓我用ABCD位元重新標記（A=MSB）：
   - m0 = 0000: A=0,B=0,C=0,D=0
   - m2 = 0010: A=0,B=0,C=1,D=0
   - m5 = 0101: A=0,B=1,C=0,D=1
   - m6 = 0110: A=0,B=1,C=1,D=0
   - m7 = 0111: A=0,B=1,C=1,D=1
   - m8 = 1000: A=1,B=0,C=0,D=0
   - m10 = 1010: A=1,B=0,C=1,D=0
   - m12 = 1100: A=1,B=1,C=0,D=0
   - m13 = 1101: A=1,B=1,C=0,D=1
   - m14 = 1110: A=1,B=1,C=1,D=0
   - m15 = 1111: A=1,B=1,C=1,D=1

質蘊涵項：
- **B'D'**：{0,2,8,10}（B=0, D=0 → 不論A,C）
- **BD**：{5,7,13,15}（B=1, D=1 → 不論A,C）
- **BC**：{6,7,14,15}（B=1, C=1 → 不論A,D）
- **AB**：{12,13,14,15}（A=1, B=1 → 不論C,D）
- **CD'**：{2,6,10,14}（C=1, D=0 → 不論A,B）

檢查覆蓋：
- m0: 只被 B'D' 覆蓋 → B'D' 是**必要**的(EPI)
- m5: 只被 BD 覆蓋 → BD 是**必要**的(EPI)
- m12: 被 AB 覆蓋 → 檢查是否唯一：m12只在AB中 → AB 是**必要**的(EPI)

EPI：B'D', BD, AB

EPI覆蓋的最小項：{0,2,8,10} ∪ {5,7,13,15} ∪ {12,13,14,15} = {0,2,5,7,8,10,12,13,14,15}

未覆蓋：m6

m6 可被 BC 或 CD' 覆蓋。選擇任一即可。

**最小SOP表示**：
$$f = B'D' + BD + AB + BC$$
或
$$f = B'D' + BD + AB + CD'$$

文字數均為 8 個，乘積項 4 個。

**(c) Quine-McCluskey的局限與Espresso改進**：

**Quine-McCluskey局限**：
- 需列舉所有質蘊涵項，數量可達指數級（2ⁿ/n 級別）
- 最小覆蓋問題（Minimum Cover Problem）為NP完全
- 計算複雜度隨變數增加指數成長
- 實務上超過20個變數就不可行

**Espresso演算法改進**：
- 不列舉所有質蘊涵項，而是從一個初始覆蓋開始迭代改善
- 三個核心操作迴圈：
  1. **EXPAND**：盡量擴大每個乘積項（刪除文字）
  2. **IRREDUNDANT**：移除冗餘的乘積項
  3. **REDUCE**：縮小乘積項以創造新的擴展機會
- 結果不保證全域最優，但幾乎總是達到或接近最優
- 時間複雜度為多項式級別，可處理數百個變數
- 是業界標準的兩階邏輯化簡工具

**答案**：(a) PI為不可再合併的蘊涵項，EPI為覆蓋某最小項的唯一PI。(b) f = B'D' + BD + AB + BC（或CD'替代BC），4個乘積項。(c) QM列舉質蘊涵項為指數複雜度；Espresso用迭代啟發式方法在多項式時間內達到近似最優。

**延伸思考**：現代邏輯合成已不限於兩階化簡，多階邏輯優化（multi-level optimization）更為重要。但Espresso的思想（iterative improvement）影響了許多EDA演算法的設計哲學。

---
### 題目 24：多階邏輯最佳化與技術映射
**來源**：台大電機 / 經典題型
**難度**：★★★★
**主題**：邏輯合成

**題目**：
(a) 解釋多階邏輯網路（multi-level logic network）相較於兩階邏輯的優勢。
(b) 什麼是因式分解（factoring）？對表達式 f = ace + bce + de + g 進行因式分解以減少文字數。
(c) 說明技術映射（technology mapping）的概念，DAG covering問題如何用樹形覆蓋（tree covering）近似求解？

**詳解**：

**解題思路**：從面積/延遲的折衷出發，理解多階邏輯的動機，再說明如何將布林網路映射到實際元件庫。

**步驟**：

**(a) 多階邏輯的優勢**：

兩階邏輯（SOP/POS）：
- 最多兩層邏輯（AND-OR 或 OR-AND）
- 延遲固定（2層），但面積可能極大
- 許多函數的SOP形式有指數多個乘積項

多階邏輯：
- 允許多層邏輯閘級聯
- 通過因式分解共享子表達式，大幅減少面積
- 以增加少量延遲（層數）換取顯著的面積縮減

範例：f = ac + ad + bc + bd + e
- 兩階（SOP）：5個乘積項，10個文字
- 多階（因式分解）：f = (a+b)(c+d) + e，只需3個閘，5個文字

面積減少50%，延遲從2層增加到3層 — 在大多數設計中這是很好的折衷。

**(b) 因式分解**：

原式：f = ace + bce + de + g

第一步 — 提取公因子 ce：
f = ce(a + b) + de + g

第二步 — 提取公因子 e：
f = e[c(a + b) + d] + g

統計文字數：
- 原式：ace + bce + de + g → 3+3+2+1 = 9 個文字
- 因式分解後：e, c, a, b, d, g → 6 個文字，且共享子表達式

令 p = a + b，q = cp + d = c(a+b) + d，則 f = eq + g

閘級實現：
1. p = a + b（OR閘）
2. t = c · p（AND閘）
3. q = t + d（OR閘）
4. s = e · q（AND閘）
5. f = s + g（OR閘）

共5個閘，6個文字輸入。

**(c) 技術映射（Technology Mapping）**：

**概念**：
- 邏輯合成產生的是與技術無關（technology-independent）的布林網路
- 技術映射將此網路轉換為使用特定元件庫（standard cell library）中的閘級網表
- 目標：在滿足時序約束的前提下最小化面積（或其他指標）

**DAG覆蓋問題**：
- 布林網路是DAG（有向無環圖），技術映射等價於用元件庫中的模式（pattern）覆蓋整個DAG
- DAG覆蓋（DAG covering）是NP困難問題

**樹形覆蓋近似**：
1. 將DAG分解為若干棵樹（在多扇出節點處切割）
2. 對每棵樹使用動態規劃（dynamic programming）進行最優覆蓋
3. 從葉節點向根節點，對每個節點計算使用各種元件庫中匹配模式的最佳成本

動態規劃遞推：
$$cost(v) = \min_{pattern\;p\;matching\;at\;v} \left[cost(p) + \sum_{leaf\;u\;of\;p} cost(u)\right]$$

4. 回溯選擇最佳匹配模式

此方法在每棵樹上為最優，但因DAG切割的近似性，全域不一定最優。

**答案**：(a) 多階邏輯通過共享子表達式大幅減少面積。(b) f = e[c(a+b)+d]+g，從9個文字減為6個。(c) 技術映射用元件庫模式覆蓋布林網路，DAG切割為樹後用動態規劃求解。

**延伸思考**：現代邏輯合成工具（如Synopsys Design Compiler）已整合邏輯優化與技術映射，且考慮時序、面積、功率的多目標優化。ABC（Berkeley的學術EDA工具）使用AIG（And-Inverter Graph）作為內部表示，支援高效的邏輯操作。

---
### 題目 25：靜態時序分析（STA）基礎
**來源**：台大電機 / IC設計公司面試
**難度**：★★★★
**主題**：靜態時序分析（Static Timing Analysis）

**題目**：
一個同步數位電路中，兩個暫存器之間的組合邏輯路徑如下：

- 時脈頻率 f = 1 GHz（T = 1 ns）
- 發射端暫存器 CLK-to-Q 延遲 tCQ = 80 ps
- 組合邏輯延遲 tlogic = 750 ps
- 繞線延遲 twire = 50 ps
- 接收端暫存器 setup time tsetup = 60 ps
- 接收端暫存器 hold time thold = 30 ps
- 時脈偏移（clock skew）tskew = ±20 ps
- 時脈不確定性（clock uncertainty/jitter）tjitter = 15 ps

(a) 計算 setup time slack。電路能否在1GHz下正確運作？
(b) 計算 hold time slack。是否有hold violation？
(c) 若要將頻率提升到1.2GHz，需要將組合邏輯延遲縮減多少？

**詳解**：

**解題思路**：套用setup和hold的時序方程式，注意skew的方向對兩者的影響相反。

**步驟**：

**(a) Setup Time分析**：

Setup約束要求資料在時脈邊緣前穩定：

$$t_{CQ} + t_{logic} + t_{wire} + t_{setup} \leq T + t_{skew(favorable)} - t_{jitter}$$

最壞情況（skew不利於setup）：capture clock比launch clock早到

$$t_{data\;arrival} = t_{CQ} + t_{logic} + t_{wire} = 80 + 750 + 50 = 880 \text{ ps}$$

$$t_{data\;required} = T - t_{setup} - t_{skew(unfavorable)} - t_{jitter}$$
$$= 1000 - 60 - 20 - 15 = 905 \text{ ps}$$

$$\text{Setup Slack} = t_{data\;required} - t_{data\;arrival} = 905 - 880 = +25 \text{ ps}$$

**Setup slack = +25 ps > 0，電路可在1GHz下正確運作。** 但餘裕很小。

**(b) Hold Time分析**：

Hold約束要求資料在時脈邊緣後維持穩定：

$$t_{CQ} + t_{logic(min)} + t_{wire(min)} \geq t_{hold} + t_{skew(unfavorable)}$$

最壞情況（skew不利於hold）：capture clock比launch clock晚到

假設最小路徑延遲也是此路徑（單一路徑分析）：

$$t_{data\;arrival(min)} = t_{CQ} + t_{logic(min)} + t_{wire(min)}$$

在此題中假設最小延遲 ≈ 最大延遲（單一路徑），取：
$$t_{data\;arrival(min)} = 880 \text{ ps}$$

$$t_{data\;required(hold)} = t_{hold} + t_{skew(unfavorable)} = 30 + 20 = 50 \text{ ps}$$

$$\text{Hold Slack} = t_{data\;arrival(min)} - t_{data\;required(hold)} = 880 - 50 = +830 \text{ ps}$$

**Hold slack = +830 ps >> 0，無hold violation。**

（注：hold通常在最短路徑上最容易違反，此處的長路徑不會有hold問題。真正需要檢查的是同一對暫存器之間的最短路徑。）

**(c) 頻率提升到1.2GHz**：

新週期 T_new = 1/1.2GHz = 833.3 ps

新的setup約束：
$$t_{CQ} + t_{logic(new)} + t_{wire} + t_{setup} \leq T_{new} - t_{skew} - t_{jitter}$$

$$80 + t_{logic(new)} + 50 \leq 833.3 - 20 - 15 - 60$$

$$t_{logic(new)} \leq 833.3 - 20 - 15 - 60 - 80 - 50 = 608.3 \text{ ps}$$

需要縮減：750 - 608.3 = **141.7 ps（約19%）**

**答案**：(a) Setup slack = +25 ps，可在1GHz運作。(b) Hold slack = +830 ps，無violation。(c) 需將邏輯延遲從750ps縮減約142ps（19%）至608ps。

**延伸思考**：實務上STA需考慮OCV（On-Chip Variation）、PVT corner（Process-Voltage-Temperature）、AOCV/POCV等統計變異模型。Setup通常在slow corner（高溫、低電壓、慢製程）最嚴格，hold在fast corner（低溫、高電壓、快製程）最嚴格。

---
### 題目 26：時脈偏移與有用偏移
**來源**：台大電機 / IC設計公司面試
**難度**：★★★★
**主題**：時序分析

**題目**：
(a) 定義正時脈偏移（positive skew）與負時脈偏移（negative skew），以及各自對setup和hold的影響。
(b) 什麼是「有用偏移（useful skew）」？如何利用時脈偏移來改善電路效能？
(c) 考慮一條三級管線（pipeline），各級的組合邏輯延遲為：Stage1 = 1.2ns, Stage2 = 0.6ns, Stage3 = 0.9ns。在零偏移下最高頻率為多少？若允許有用偏移（忽略CQ和setup），理論上最高頻率為多少？

**詳解**：

**解題思路**：從skew對時序約束的影響出發，理解如何「借用」鄰級的時間餘裕。

**步驟**：

**(a) 正/負時脈偏移**：

定義：時脈偏移 δ = t_capture - t_launch（接收端時脈到達時間 - 發射端時脈到達時間）

**正偏移（δ > 0）**：capture clock晚於launch clock到達
- 對setup有利：資料有更多時間到達（等效增加一個週期的餘裕）
- 對hold不利：資料必須維持更久

**負偏移（δ < 0）**：capture clock早於launch clock到達
- 對setup不利：資料到達時間被壓縮
- 對hold有利：資料維持需求降低

時序方程：
- Setup：t_CQ + t_logic ≤ T + δ - t_setup
- Hold：t_CQ + t_logic(min) ≥ t_hold - δ

**(b) 有用偏移（Useful Skew）**：

當某級管線的邏輯延遲較長（接近或超過T），而相鄰級的邏輯延遲較短時，可以故意在兩級之間引入正偏移：
- 讓capture clock稍晚到達，「借用」下一級的時間餘裕
- 等效於將時間從鬆的路徑「轉移」到緊的路徑

限制：
- 借用的時間不能超過下一級的slack
- 有用偏移改善setup，但惡化hold（需確認hold仍滿足）
- 不能改變整體的管線吞吐量上限（受限於所有級延遲的平均值）

**(c) 管線頻率計算**：

**零偏移下**：
最高頻率由最慢的級決定（忽略CQ和setup簡化計算）：
$$T_{min} = \max(1.2, 0.6, 0.9) = 1.2 \text{ ns}$$
$$f_{max} = 1/1.2 = 833 \text{ MHz}$$

**有用偏移下**：
理論最高頻率由所有級延遲的**平均值**決定：
$$T_{min} = \frac{1.2 + 0.6 + 0.9}{3} = \frac{2.7}{3} = 0.9 \text{ ns}$$
$$f_{max} = 1/0.9 = 1.111 \text{ GHz}$$

偏移分配：
- Stage1→Stage2的偏移：δ₁₂ = 1.2 - 0.9 = +0.3 ns（向Stage1借0.3ns）
- Stage2→Stage3的偏移：δ₂₃ = 0.6 - 0.9 = -0.3 ns（Stage2歸還0.3ns給Stage3）

驗證：
- Stage1：1.2 ≤ 0.9 + 0.3 = 1.2 ✓
- Stage2：0.6 ≤ 0.9 - 0.3 = 0.6 ✓（但剛好沒有餘裕）
- 更精確地需要檢查Stage3→Stage1（環路）

**答案**：(a) 正偏移利setup害hold，負偏移反之。(b) 有用偏移將鬆路徑的時間餘裕轉移給緊路徑。(c) 零偏移833MHz，有用偏移理論上可達1.11GHz（提升33%）。

**延伸思考**：現代CTS（Clock Tree Synthesis）工具如CTS-opt可自動引入有用偏移來改善時序。但需要精確控制，因為hold修正（通常需插入delay buffer）會增加面積和功耗。在TSMC先進節點中，時脈樹通常佔晶片面積的5-10%和動態功耗的30-40%。

---
### 題目 27：功率分析與最佳化
**來源**：台大電機 / IC設計公司面試
**難度**：★★★
**主題**：功率分析

**題目**：
CMOS數位電路的功耗由三個主要成分組成：

$$P_{total} = P_{dynamic} + P_{short-circuit} + P_{leakage}$$

(a) 推導動態功耗 P_dynamic = αCVdd²f 中各參數的意義。
(b) 漏電功耗在先進節點中的重要性。列出主要的漏電機制並比較其在不同製程節點的相對重要性。
(c) 列舉至少五種在EDA設計流程中降低功耗的技術（從RTL到實體設計）。

**詳解**：

**解題思路**：從電路層面推導功耗公式，再從EDA設計流程的各層級討論降功耗策略。

**步驟**：

**(a) 動態功耗推導**：

$$P_{dynamic} = \alpha \cdot C_L \cdot V_{dd}^2 \cdot f$$

- **α（Activity Factor / Switching Activity）**：每個時脈週期中節點發生0→1轉態的機率（0到1之間）。α = 0.5 表示每隔一個週期切換一次。
- **C_L（Load Capacitance）**：節點的負載電容，包括閘極電容、連線電容和接面電容
- **V_dd（Supply Voltage）**：電源電壓
- **f（Clock Frequency）**：時脈頻率

推導：每次 0→1 轉態，電源向 CL 充電，能量 E = CL·Vdd²（其中一半存在電容中，一半在PMOS上耗散為熱）。1→0 轉態時，電容中的能量在NMOS上耗散。

每次完整切換消耗 E = CL·Vdd²
單位時間內切換次數 = α·f

故 P_dynamic = α·CL·Vdd²·f

**V_dd²的依賴意味著降壓是最有效的降功耗手段。**

**(b) 漏電功耗與機制**：

主要漏電機制：

| 機制 | 說明 | 主導節點 |
|------|------|----------|
| 次臨界漏電（Subthreshold Leakage） | Vgs < Vth 時的弱反轉電流，∝ exp(-Vth/nVT) | 65nm以下（Vth降低） |
| 閘極漏電（Gate Leakage） | 載子穿隧通過極薄閘極氧化層 | 65-45nm（SiO₂ < 2nm），High-k後大幅降低 |
| GIDL（Gate-Induced Drain Leakage） | 閘極-汲極重疊區的帶對帶穿隧 | 所有節點 |
| 接面漏電（Junction Leakage） | pn接面的反向偏壓漏電 | 較早節點 |
| BTBT（Band-to-Band Tunneling） | 在高電場區域的帶對帶穿隧 | 先進FinFET/GAA |

**趨勢**：在28nm以上節點，動態功耗主導；在14nm以下節點，漏電功耗可佔總功耗的30-50%（尤其在低活動率的待機模式）。FinFET通過更好的閘極控制顯著降低次臨界漏電。

**(c) EDA中的降功耗技術**：

| 層級 | 技術 | 說明 |
|------|------|------|
| 架構/RTL | Clock Gating | 關閉不活動模組的時脈，降低α |
| RTL | Power Gating（電源關斷） | 切斷不使用模組的電源（header/footer switch） |
| RTL | Multi-Vdd（多電壓域） | 關鍵路徑用高電壓，其他用低電壓 |
| 合成 | Multi-Vth元件選用 | 關鍵路徑用Low-Vth（快但漏電大），非關鍵路徑用High-Vth（慢但漏電小） |
| 合成 | Operand Isolation | 避免不需要運算的數據路徑切換 |
| 佈局 | 動態電壓頻率調節（DVFS） | 根據工作負載調整Vdd和f |
| CTS | Clock Tree最佳化 | 減少時脈樹的電容和切換 |
| 繞線 | Wire sizing/spacing | 最佳化連線寬度以減少電容 |
| 物理 | Decap cell配置 | 降低電源雜訊，間接改善功率完整性 |
| 驗證 | Power-aware simulation | 使用VCD/SAIF做精確功率估計 |

**答案**：(a) P = αCVdd²f，α為切換率，C為負載電容，Vdd為電壓，f為頻率。(b) 漏電主要來自次臨界和閘極穿隧，在14nm以下佔比可達30-50%。(c) Clock gating、power gating、multi-Vdd、multi-Vth、DVFS等。

**延伸思考**：在行動晶片（如Apple A系列、Qualcomm Snapdragon）中，功率管理是最關鍵的設計挑戰。EDA工具需要在設計的每個階段提供精確的功率估計和最佳化。Synopsys的PrimePower和Cadence的Voltus是業界主流的功率分析工具。

---
### 題目 28：時序約束文件（SDC）
**來源**：IC設計公司面試 / 經典題型
**難度**：★★★
**主題**：時序分析

**題目**：
SDC（Synopsys Design Constraints）是EDA工具鏈中最重要的時序約束格式。

(a) 寫出以下約束的SDC命令：
   - 100MHz的時脈，名為clk，連接到port CLK
   - 輸入延遲：相對於clk，最大3ns，施加在所有輸入port（除CLK和RESET外）
   - 輸出延遲：相對於clk，最大2ns，施加在所有輸出port
   - RESET信號為非同步，設為false path

(b) 什麼是多週期路徑（multicycle path）？舉例說明何時需要使用。
(c) 什麼是false path？列舉常見的false path類型。

**詳解**：

**解題思路**：將設計意圖轉換為精確的SDC語法，理解每條約束的時序含義。

**步驟**：

**(a) SDC命令**：

```tcl
# 定義時脈：100MHz，週期10ns
create_clock -name clk -period 10 [get_ports CLK]

# 輸入延遲約束
set_input_delay -max 3.0 -clock clk [remove_from_collection [all_inputs] [get_ports {CLK RESET}]]

# 輸出延遲約束
set_output_delay -max 2.0 -clock clk [all_outputs]

# RESET設為false path（非同步信號，不需時序檢查）
set_false_path -from [get_ports RESET]
```

各命令解釋：
- `create_clock`：定義理想時脈源，週期10ns（100MHz）
- `set_input_delay -max 3.0`：外部輸入信號在時脈邊緣後最晚3ns到達晶片邊界，等效於壓縮內部可用時間為 10 - 3 = 7ns
- `set_output_delay -max 2.0`：輸出信號需在時脈邊緣前2ns穩定在晶片邊界，等效於內部可用時間為 10 - 2 = 8ns
- `set_false_path`：告訴STA工具不要檢查此路徑的時序

**(b) 多週期路徑（Multicycle Path）**：

定義：某些路徑的資料不需要在一個時脈週期內到達，而是允許多個週期。

SDC語法：
```tcl
set_multicycle_path -setup 3 -from [get_pins reg_A/Q] -to [get_pins reg_B/D]
set_multicycle_path -hold 2 -from [get_pins reg_A/Q] -to [get_pins reg_B/D]
```

常見使用場景：
- **乘法器/除法器**：多週期運算，結果在N個週期後才有效
- **跨頻域路徑**：快時脈域到慢時脈域（但通常用false path更安全）
- **數據路徑的使能控制**：某些路徑每N個週期才更新一次
- **慢速控制暫存器**：配置暫存器不需要每週期更新

注意：設定multicycle setup為N時，通常需同時設定multicycle hold為N-1，以維持hold檢查在正確的時脈邊緣。

**(c) False Path**：

定義：在電路拓撲上存在但在功能上永遠不會被啟動的路徑，STA不應檢查其時序。

常見類型：
1. **非同步信號**：reset、async control（如上例）
2. **跨非同步時脈域**：兩個不相關時脈域之間的路徑（應用同步器處理）
3. **互斥的MUX路徑**：兩條MUX輸入不可能同時啟動
4. **測試模式路徑**：DFT scan path在正常模式下不啟動
5. **靜態配置路徑**：eFuse或配置暫存器在運行時不變化

```tcl
# 跨時脈域
set_false_path -from [get_clocks clkA] -to [get_clocks clkB]

# 互斥MUX（使用set_case_analysis更精確）
set_false_path -through [get_pins mux/A] -through [get_pins mux/B]
```

**誤用false path的風險**：若將真正的功能路徑設為false path，STA不會檢查，可能導致矽片時序失敗（silicon failure）。這是設計驗證中的常見錯誤。

**答案**：(a) SDC命令如上，包含create_clock、set_input_delay、set_output_delay、set_false_path。(b) 多週期路徑允許資料在N個週期到達，用於乘法器等慢速運算。(c) False path為功能上不啟動的路徑，包括非同步信號、跨時脈域、互斥MUX等。

**延伸思考**：SDC約束的品質直接決定合成和後端結果的品質。業界常說「Garbage in, garbage out」—— 錯誤的SDC會導致過度設計（over-design）或設計失敗。資深IC設計工程師花大量時間審查和維護SDC。

---
### 題目 29：邏輯等效性檢查（LEC）
**來源**：台大電機 / IC設計公司面試
**難度**：★★★
**主題**：形式驗證

**題目**：
(a) 什麼是邏輯等效性檢查（LEC, Logic Equivalence Checking）？在IC設計流程中哪些步驟需要執行LEC？
(b) LEC工具如何比較兩個設計？簡述key-point mapping的概念。
(c) 什麼情況下LEC會報告Non-Equivalent？如何debug？

**詳解**：

**解題思路**：從形式驗證的角度理解LEC的原理和應用場景。

**步驟**：

**(a) LEC的定義與應用場景**：

**LEC**驗證兩個設計在所有可能輸入下的邏輯功能完全等價，不需要測試向量（與模擬驗證不同）。

需要LEC的步驟：
1. **RTL vs Gate-level Netlist**：驗證邏輯合成結果與RTL功能一致
2. **Pre-layout vs Post-layout Netlist**：驗證佈局繞線過程中的ECO未改變功能
3. **每次ECO修改後**：確認ECO只改變預期的邏輯
4. **DFT插入後**：確認測試結構的加入未影響原始功能
5. **Clock tree synthesis後**：確認CTS未改變邏輯

業界工具：Synopsys Formality、Cadence Conformal LEC

**(b) Key-point Mapping**：

LEC工具將兩個設計（reference和implementation）的比較分解為：

1. **辨識key points**：兩個設計中的對應點，通常為：
   - 主要輸入/輸出（Primary I/O）
   - 暫存器（Registers / Flip-flops）
   - 黑盒子（Black Box）的端口

2. **Key-point mapping**：建立reference和implementation之間key points的一對一對應關係
   - 名稱對應（name-based mapping）：同名信號自動對應
   - 自動對應（auto-mapping）：工具根據邏輯結構推斷

3. **組合等價檢查**：對每對對應的key points，檢查從其輸入key points到輸出key points的組合邏輯是否等價
   - 使用BDD或SAT求解器進行等價檢查
   - SAT方法：若 f_ref ⊕ f_impl 可滿足（SAT），則不等價；若不可滿足（UNSAT），則等價

**(c) Non-Equivalent的常見原因與debug**：

**常見原因**：
1. **合成優化導致的結構變化**：常數傳播、冗餘邏輯消除（需確認是否為合法優化）
2. **ECO錯誤**：手動修改引入的功能錯誤
3. **時脈門控（clock gating）插入**：改變了暫存器的使能邏輯
4. **多週期路徑或false path導致的優化**：合成工具根據約束做了過激優化
5. **Key-point mapping錯誤**：名稱變更導致對應關係錯誤
6. **不可比較的邏輯**：一端有X（不確定值）傳播

**Debug方法**：
- 檢查failing points的fanin cone，追蹤差異的根源
- 使用工具的diagnose功能找出最小反例（counter-example）
- 檢查mapping report，確認key points正確對應
- 對不期望的優化，使用`set_dont_touch`或`set_size_only`約束
- 使用hierarchical LEC縮小比較範圍

**答案**：(a) LEC驗證兩個設計邏輯等價，用於合成後、ECO後、DFT後等步驟。(b) 透過key-point mapping建立對應關係，再用BDD/SAT檢查組合邏輯等價性。(c) 常見原因包括合成優化、ECO錯誤、mapping問題等，用fanin追蹤和反例分析debug。

**延伸思考**：隨著設計複雜度增加，Sequential Equivalence Checking（SEC）變得重要，它可以驗證經過retiming等時序變換後的等價性。但SEC的計算複雜度遠高於組合LEC，仍是研究熱點。

---
### 題目 30：功率域與UPF
**來源**：IC設計公司面試 / 業界實務
**難度**：★★★★
**主題**：低功耗設計

**題目**：
(a) 什麼是UPF（Unified Power Format）？它在低功耗設計中扮演什麼角色？
(b) 解釋以下低功耗結構的實現方式：
   - Power Switch（電源開關）
   - Isolation Cell（隔離單元）
   - Level Shifter（電平轉換器）
   - Retention Register（保持暫存器）
(c) 設計一個有兩個電源域的系統：always-on域（1.0V）和可關斷域（0.8V），寫出關鍵的UPF命令。

**詳解**：

**解題思路**：從多電壓域設計的需求出發，理解每個低功耗元件的功能及其在UPF中的描述。

**步驟**：

**(a) UPF的角色**：

**UPF（Unified Power Format，IEEE 1801）**是描述設計中功率意圖（power intent）的標準格式，獨立於RTL和實體設計之外：

- 定義電源域（Power Domain）
- 指定電源網路（Power/Ground Net）
- 描述電源狀態轉換（Power State Table）
- 指定需要的低功耗元件（isolation, level shifter, retention等）

UPF讓功率意圖「一次描述，全流程使用」—— 從模擬驗證、合成、到後端實現都使用同一份UPF。

**(b) 低功耗結構**：

**Power Switch（電源開關）**：
- PMOS header switch（在Vdd和虛擬Vdd之間）或NMOS footer switch（在VSS和虛擬VSS之間）
- 控制信號將可關斷域的電源切斷以消除漏電
- 需要足夠大的開關管以降低IR-drop
- 開啟時需要rush current控制（daisy-chain啟動）

**Isolation Cell（隔離單元）**：
- 放在可關斷域的輸出端，連接到always-on域
- 當可關斷域關電時，輸出為未知值（X/floating）
- Isolation cell將輸出鉗位到已知值（0或1）
- 通常為AND gate（clamp to 0）或OR gate（clamp to 1）加上控制信號

**Level Shifter（電平轉換器）**：
- 在不同電壓域之間轉換信號電平
- 低→高（Low-to-High）：確保高電壓域能正確判讀低擺幅信號
- 高→低（High-to-Low）：防止高電壓損壞低電壓域電晶體
- 通常使用交叉耦合反相器結構

**Retention Register（保持暫存器）**：
- 在電源關斷前保存暫存器狀態，恢復電源後可快速還原
- 結構：主暫存器 + always-on的shadow latch
- SAVE信號：將資料從主暫存器複製到shadow latch
- RESTORE信號：將shadow latch的值恢復到主暫存器
- 面積約為普通暫存器的1.3-1.5倍

**(c) UPF命令**：

```tcl
# 建立電源域
create_power_domain PD_AON -include_scope    ;# always-on域
create_power_domain PD_SW -elements {block_sw} ;# 可關斷域

# 建立電源網路
create_supply_net VDD_AON -domain PD_AON
create_supply_net VDD_SW  -domain PD_SW
create_supply_net VSS     -domain PD_AON

# 定義電源埠與連接
create_supply_port VDD_AON -direction in
create_supply_port VDD_SW  -direction in
create_supply_port VSS     -direction in

connect_supply_net VDD_AON -ports {VDD_AON}
connect_supply_net VDD_SW  -ports {VDD_SW}
connect_supply_net VSS     -ports {VSS}

# 設定電源開關
create_power_switch SW1 \
    -domain PD_SW \
    -input_supply_port {vin VDD_AON} \
    -output_supply_port {vout VDD_SW} \
    -control_port {sw_en power_controller/sw_en} \
    -on_state {on_s vin {sw_en}} \
    -off_state {off_s {!sw_en}}

# 設定隔離單元（可關斷域 → always-on域）
set_isolation iso_sw \
    -domain PD_SW \
    -isolation_power_net VDD_AON \
    -isolation_ground_net VSS \
    -clamp_value 0 \
    -applies_to outputs

set_isolation_control iso_sw \
    -domain PD_SW \
    -isolation_signal power_controller/iso_en \
    -isolation_sense high \
    -location parent

# 設定電平轉換器（0.8V ↔ 1.0V）
set_level_shifter ls_sw \
    -domain PD_SW \
    -applies_to both \
    -rule both

# 設定保持暫存器
set_retention ret_sw \
    -domain PD_SW \
    -retention_power_net VDD_AON \
    -retention_ground_net VSS

set_retention_control ret_sw \
    -domain PD_SW \
    -save_signal {power_controller/save high} \
    -restore_signal {power_controller/restore high}
```

**答案**：(a) UPF是IEEE 1801標準，統一描述設計的功率意圖，貫穿全設計流程。(b) Power switch切斷電源，isolation cell鉗位輸出，level shifter轉換電平，retention register保存狀態。(c) UPF命令如上。

**延伸思考**：多電壓域設計是現代SoC的標準做法。Apple的A/M系列晶片有數十個電源域，精細控制不同功能模組的電壓和開關狀態。UPF的正確性驗證（power-aware simulation和formal verification）是確保晶片功能正確的關鍵。

---
## Part 4：EDA 實體設計（題目 31–40）

---
### 題目 31：晶片規劃（Floorplanning）
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：晶片規劃

**題目**：
(a) 晶片規劃的主要目標是什麼？列出需要決定的關鍵項目。
(b) 使用B*-tree表示法描述以下五個模組的佈局結果：

```
    ┌──────┬──────┐
    │  C   │  D   │
    ├──────┤      │
    │  B   ├──────┤
    ├──────┤  E   │
    │  A   │      │
    └──────┴──────┘
```

(c) 什麼是半周長線長估計（HPWL, Half-Perimeter Wire Length）？為何在晶片規劃階段使用HPWL而非精確繞線？

**詳解**：

**解題思路**：從實體設計的第一步出發，理解floorplanning的目標與表示法。

**步驟**：

**(a) 晶片規劃的目標與決策**：

**目標**：
- 最小化晶片面積（或在固定面積下最大化利用率）
- 最小化總線長（改善時序和功耗）
- 滿足I/O pad位置約束
- 確保電源分配的可行性
- 為繞線提供足夠空間（congestion管理）

**需決定的項目**：
1. **硬模組（Hard Macro）的位置與方向**：SRAM、PLL、ADC等
2. **軟模組（Soft Module）的形狀與位置**：標準元件區域
3. **I/O Pad的位置**：依據封裝和PCB走線需求
4. **電源規劃（Power Plan）**：Power ring和power stripe的佈局
5. **通道空間（Channel）**：模組間的繞線通道寬度
6. **阻擋區域（Blockage）**：限制元件放置的區域

**(b) B*-tree表示法**：

B*-tree是一種緊湊的非等長（non-slicing）佈局表示法。以二元樹表示模組的相對位置關係：

- 左子節點：在父節點的**右方**（水平相鄰）
- 右子節點：在父節點的**上方**（垂直相鄰，位於同一x範圍內左側對齊）

觀察佈局中的鄰接關係：
- A 在最左下
- B 在 A 的上方
- C 在 B 的上方
- D 在 C 的右方
- E 在 B 的右方（也在D的下方）

B*-tree結構（以A為根）：
```
        A
       / \
      E    B
          / \
         D   C
```

注意：B*-tree的表示不唯一，取決於遍歷順序的定義。上述為一種合理的表示。

實際上更精確的B*-tree應是：
- A的左子（右方）= E
- A的右子（上方）= B
- B的右子（上方）= C
- C的左子（右方）= D

```
        A
       / \
      E    B
            \
             C
            /
           D
```

**(c) HPWL（Half-Perimeter Wire Length）**：

**定義**：一個信號網（net）所有引腳的最小外接矩形（bounding box）的半周長：

$$HPWL = (x_{max} - x_{min}) + (y_{max} - y_{min})$$

**使用HPWL的原因**：
1. **計算速度快**：只需找出引腳座標的最大最小值，O(n)複雜度
2. **精確度足夠**：對2-3 pin的net，HPWL是Steiner tree線長的精確下界
3. **相關性高**：HPWL與實際繞線長度有良好的線性相關（相關係數~0.85-0.95）
4. **適合早期評估**：晶片規劃階段不需要精確繞線，只需比較不同方案的相對優劣

在多pin net中，HPWL低估實際線長。可用修正係數：HPWL_corrected = HPWL × (1 + (p-2)×c)，其中p為pin數。

**答案**：(a) 目標為最小化面積和線長，決定模組位置、I/O、電源規劃等。(b) B*-tree如上所示。(c) HPWL為外接矩形半周長，計算快且與實際線長高度相關。

**延伸思考**：現代SoC的floorplanning需考慮多物理域的交互作用：時序、功耗、熱分佈、電磁干擾等。自動化floorplanning仍是EDA的挑戰，許多公司仍依賴有經驗的工程師手動或半自動完成。

---
### 題目 32：分割式佈局（Min-cut Placement）
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：佈局（Placement）

**題目**：
(a) 解釋Kernighan-Lin（KL）圖分割演算法的原理和步驟。
(b) 以下超圖（hypergraph）有6個節點{a,b,c,d,e,f}和4條超邊：
   - e1 = {a, b, c}
   - e2 = {b, d}
   - e3 = {c, d, e}
   - e4 = {e, f}

   初始分割為 A = {a, b, c}, B = {d, e, f}。使用FM（Fiduccia-Mattheyses）演算法的概念，計算各節點的初始增益（gain），並找出第一步應移動哪個節點。

(c) 說明Min-cut placement如何用遞迴分割實現佈局。

**詳解**：

**解題思路**：從KL/FM的核心概念出發，理解圖分割如何應用於佈局。

**步驟**：

**(a) Kernighan-Lin演算法**：

**目標**：將圖的節點分成大小相等的兩部分，使切割邊（crossing edges）數量最小。

**步驟**：
1. 隨機初始分割為 A, B（|A| = |B|）
2. 計算每對跨分割的節點對 (a, b)（a∈A, b∈B）交換後的增益：
   - gain(a,b) = D(a) + D(b) - 2·c(a,b)
   - 其中 D(v) = 外部邊數 - 內部邊數，c(a,b)為a,b之間的邊數
3. 選擇增益最大的節點對交換，鎖定這對節點
4. 重複步驟2-3直到所有節點被鎖定
5. 找出累積增益最大的前k步交換，執行這些交換
6. 若有改善，回到步驟2；否則結束

**時間複雜度**：O(n²·log n) per pass

**FM改進**：
- 一次移動一個節點（而非交換一對），允許不平衡分割
- 使用bucket list資料結構（O(1)找最大增益節點）
- 時間複雜度降為 O(n) per pass

**(b) FM增益計算**：

初始分割：A = {a, b, c}, B = {d, e, f}

對於超圖的FM增益，定義：
- 移動節點v從其所在分割到另一分割後，切割超邊數量的減少量

**切割超邊**（跨兩個分割的超邊）分析：
- e1 = {a, b, c}：全在A，不被切割
- e2 = {b, d}：b∈A, d∈B，被切割
- e3 = {c, d, e}：c∈A, d,e∈B，被切割
- e4 = {e, f}：全在B，不被切割

初始切割數 = 2（e2和e3）

**各節點增益計算**：

移動一個節點後切割數的變化 = -(新增切割邊數 - 消除的切割邊數)

- **a（A→B）**：
  - e1: {a,b,c}中a移走 → e1變成{b,c}在A, {a}在B → e1被切割（+1）
  - 增益 = -1

- **b（A→B）**：
  - e1: b移走 → {a,c}在A, {b}在B → e1被切割（+1）
  - e2: {b,d}都在B → e2不再切割（-1）
  - 增益 = -1 + 1 = 0

- **c（A→B）**：
  - e1: c移走 → {a,b}在A, {c}在B → e1被切割（+1）
  - e3: {c,d,e}都在B → e3不再切割（-1）
  - 增益 = -1 + 1 = 0

- **d（B→A）**：
  - e2: {b,d}都在A → e2不再切割（-1）
  - e3: d移走 → {c,d}在A, {e}在B → e3仍切割（0）
  - 增益 = 1

- **e（B→A）**：
  - e3: e移到A → {c,e}在A, {d}在B → e3仍切割（0）
  - e4: {e,f}中e移走 → e4被切割（+1）
  - 增益 = -1

- **f（B→A）**：
  - e4: f移走 → {e}在B, {f}在A → e4被切割（+1）
  - 增益 = -1

**增益排序**：d(+1) > b(0) = c(0) > a(-1) = e(-1) = f(-1)

**第一步應移動節點 d**（增益最大 = +1），切割數從2降為1。

**(c) Min-cut Placement**：

**遞迴分割方法**：
1. 將整個晶片區域水平（或垂直）二等分
2. 用FM/KL演算法將電路網表分成兩組，使跨分割線的信號數最小
3. 將兩組元件分別放入對應的半區域
4. 對每個半區域遞迴地進行垂直（或水平）分割
5. 重複直到每個區域只包含少量元件

這就是**遞迴二分割佈局（Recursive Bisection Placement）**，是min-cut placement的核心思想。

優點：通過最小化切割（跨區域的信號），自然地最小化了總線長。

經典工具：Capo（UCLA）使用此方法。

**答案**：(a) KL通過迭代交換節點對來最小化切割邊。(b) 節點d增益最大(+1)，應第一個被移動。(c) 遞迴二分割將晶片逐步細分，每步用FM最小化切割。

**延伸思考**：現代佈局工具（如Cadence Innovus、Synopsys ICC2）主要使用分析式佈局（analytical placement），如二次函數最小化（quadratic placement），結合合法化（legalization）步驟。分析式方法在大規模設計中比遞迴分割更有效率。

---
### 題目 33：分析式佈局（Analytical Placement）
**來源**：台大電機 / 經典題型
**難度**：★★★★
**主題**：佈局（Placement）

**題目**：
(a) 解釋二次線長模型（Quadratic Wirelength Model）的數學形式，以及為何它比HPWL更適合用於分析式佈局。
(b) 考慮3個元件 {1, 2, 3} 和2個固定端（pad）{P, Q}，連接關係為：
   - Net A: {1, 2}，權重 w=1
   - Net B: {2, 3}，權重 w=2
   - Net C: {1, P}，權重 w=1，P固定在 x=0
   - Net D: {3, Q}，權重 w=1，Q固定在 x=10

   建立x方向的二次目標函數，用矩陣方程求解最佳位置。

(c) 純二次佈局的結果有什麼問題？如何解決？

**詳解**：

**解題思路**：將線長問題轉化為二次函數最小化，利用線性代數求解。

**步驟**：

**(a) 二次線長模型**：

對一條連接節點 i 和 j 的邊（權重 w），定義其二次線長代價為：

$$\phi_{ij} = w_{ij} \left[(x_i - x_j)^2 + (y_i - y_j)^2\right]$$

x 和 y 方向可分離，分別求解。

**為何適合分析式佈局**：
- 二次函數是**凸函數**，有唯一全域最小值
- 對各 xi 取偏導並令為零，得到**線性方程組** → 可用高效的稀疏矩陣求解器
- HPWL包含 max/min 函數，不可微分，無法直接用梯度法
- 二次模型是HPWL的平滑近似，且可用clique model將多pin net轉換為兩pin net

**(b) 建立方程並求解**：

x方向的二次目標函數：

$$\Phi(x_1, x_2, x_3) = 1 \cdot (x_1 - x_2)^2 + 2 \cdot (x_2 - x_3)^2 + 1 \cdot (x_1 - 0)^2 + 1 \cdot (x_3 - 10)^2$$

展開：
$$= (x_1^2 - 2x_1 x_2 + x_2^2) + 2(x_2^2 - 2x_2 x_3 + x_3^2) + x_1^2 + (x_3^2 - 20x_3 + 100)$$

$$= 2x_1^2 + 3x_2^2 + 3x_3^2 - 2x_1 x_2 - 4x_2 x_3 - 20x_3 + 100$$

對每個變數取偏導並令為零：

$$\frac{\partial \Phi}{\partial x_1} = 4x_1 - 2x_2 = 0 \quad \Rightarrow \quad 2x_1 - x_2 = 0$$

$$\frac{\partial \Phi}{\partial x_2} = 6x_2 - 2x_1 - 4x_3 = 0 \quad \Rightarrow \quad -x_1 + 3x_2 - 2x_3 = 0$$

$$\frac{\partial \Phi}{\partial x_3} = 6x_3 - 4x_2 - 20 = 0 \quad \Rightarrow \quad -2x_2 + 3x_3 = 10$$

矩陣形式 **Qx = b**：

$$\begin{pmatrix} 2 & -1 & 0 \\ -1 & 3 & -2 \\ 0 & -2 & 3 \end{pmatrix} \begin{pmatrix} x_1 \\ x_2 \\ x_3 \end{pmatrix} = \begin{pmatrix} 0 \\ 0 \\ 10 \end{pmatrix}$$

求解：
從第一式：x₂ = 2x₁
代入第二式：-x₁ + 6x₁ - 2x₃ = 0 → 5x₁ = 2x₃ → x₃ = 2.5x₁
代入第三式：-4x₁ + 7.5x₁ = 10 → 3.5x₁ = 10 → x₁ = 20/7 ≈ 2.857

x₂ = 2 × 20/7 = 40/7 ≈ 5.714
x₃ = 2.5 × 20/7 = 50/7 ≈ 7.143

**最佳位置：x₁ ≈ 2.86, x₂ ≈ 5.71, x₃ ≈ 7.14**

**(c) 純二次佈局的問題與解決**：

**問題**：
- 所有元件傾向聚集在晶片中央（因為二次函數的最小值會將所有節點拉向其連接節點的重心）
- 沒有考慮元件不能重疊的約束
- 結果不合法（illegal）：大量元件堆疊

**解決方法**：
1. **力導向擴散（Force-directed Spreading）**：加入排斥力將重疊的元件推開
2. **增加虛擬錨點（Anchor / Pseudonet）**：對聚集的元件加入連接到分散位置的虛擬網路
3. **合法化（Legalization）**：將連續位置的元件「捕捉」到離散的標準元件列位置
   - Tetris-like legalization
   - Abacus legalization
4. **詳細佈局（Detailed Placement）**：在合法化後進行局部優化（cell swapping, cell sliding）

現代工具（如ePlace、RePlAce）使用密度函數結合二次線長模型，在優化過程中自動控制密度分佈。

**答案**：(a) 二次模型為凸函數且可分離求解線性方程組。(b) x₁≈2.86, x₂≈5.71, x₃≈7.14。(c) 純二次佈局導致元件聚集，需用擴散力和合法化解決。

**延伸思考**：2023年DAC論文中，基於深度學習的佈局方法（如DREAMPlace）使用GPU加速密度函數和梯度計算，將百萬閘設計的佈局時間從小時級降到分鐘級。

---
### 題目 34：模擬退火法（Simulated Annealing）
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：佈局最佳化

**題目**：
模擬退火法（SA, Simulated Annealing）是IC實體設計中常用的啟發式最佳化方法。

(a) 說明SA的基本原理與步驟，並解釋Metropolis接受準則。
(b) SA中的冷卻計劃（cooling schedule）如何影響結果品質和計算時間？
(c) 在晶片規劃中使用SA時，如何定義「移動（move）」操作？列舉至少三種常用的move。

**詳解**：

**解題思路**：從統計力學的類比出發，理解SA如何在解空間中搜索全域最優。

**步驟**：

**(a) SA基本原理**：

SA類比固體退火過程：高溫時原子自由移動（探索解空間），低溫時逐漸凝結到低能態（收斂到最優解）。

**步驟**：
1. 初始化：生成初始解 S₀，設定初始溫度 T₀
2. 在當前溫度T下重複：
   a. 生成鄰近解 S_new（透過隨機move操作）
   b. 計算成本變化 ΔC = C(S_new) - C(S_current)
   c. **Metropolis接受準則**：
      - 若 ΔC < 0（新解更好）：無條件接受
      - 若 ΔC ≥ 0（新解更差）：以機率 exp(-ΔC/T) 接受
   d. 若接受，S_current = S_new
3. 降溫：T = α × T（α為冷卻因子，通常0.9-0.999）
4. 若 T < T_min 或達到終止條件，結束

**Metropolis準則的物理意義**：
- 高溫時，exp(-ΔC/T) ≈ 1，幾乎接受所有move → 廣泛探索
- 低溫時，exp(-ΔC/T) ≈ 0，幾乎只接受改善的move → 精細收斂
- 接受差解的能力讓SA能跳出局部最優（local minimum）

**(b) 冷卻計劃的影響**：

| 冷卻策略 | α值 | 特點 |
|---------|------|------|
| 快速冷卻 | 0.8-0.9 | 速度快，容易陷入局部最優 |
| 中速冷卻 | 0.95-0.99 | 平衡品質與速度 |
| 慢速冷卻 | 0.999-0.9999 | 品質最佳，但極慢 |

其他重要參數：
- **初始溫度T₀**：應設定為使初始接受率約80-90%
- **每溫度步的迭代次數**：應足夠讓系統在每個溫度「平衡」
- **終止溫度T_min**：通常為T₀的1/1000-1/10000

理論上，若冷卻「足夠慢」（T(k) ≥ C/log(k)），SA保證收斂到全域最優。但實務上這太慢，必須用更快的冷卻計劃並接受近似最優。

**(c) 晶片規劃中的Move操作**：

1. **模組移動（Module Move）**：將一個模組移動到新位置
2. **模組交換（Module Swap）**：交換兩個模組的位置
3. **模組旋轉（Module Rotation）**：將模組旋轉90°/180°/270°
4. **模組鏡像（Module Mirror）**：水平或垂直翻轉模組
5. **改變形狀（Reshape）**：改變軟模組的寬高比（在面積不變下）
6. **改變表示結構**：在B*-tree或Sequence Pair中交換/旋轉節點

成本函數通常為多目標加權：
$$Cost = w_1 \cdot Area + w_2 \cdot Wirelength + w_3 \cdot Timing$$

**答案**：(a) SA模擬退火過程，Metropolis準則以exp(-ΔC/T)接受差解以跳出局部最優。(b) 慢冷卻品質好但耗時，需平衡品質與速度。(c) 常用move包括移動、交換、旋轉、鏡像、改形狀等。

**延伸思考**：SA在EDA中的應用不限於佈局，也用於繞線、時脈樹合成等。現代工具結合SA與分析式方法：先用分析式方法快速得到初始解，再用SA進行局部優化。

---
### 題目 35：整體繞線（Global Routing）
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：繞線（Routing）

**題目**：
(a) 解釋整體繞線（Global Routing）與詳細繞線（Detailed Routing）的差異和各自的目標。
(b) 在整體繞線中，如何將繞線問題建模為圖論問題？解釋GCell和繞線圖（routing graph）的概念。
(c) 一個兩端網路需要從GCell (2,1) 繞到 GCell (5,4)。若每個GCell的邊界容量（capacity）為3，且部分邊界已有使用量如下圖，使用最短路徑演算法找到一條可行的繞線路徑。

```
    1    2    3    4    5
  ┌────┬────┬────┬────┬────┐
4 │    │    │    │    │    │
  ├─2──┼─1──┼─0──┼─2──┼────┤
3 │    │    │    │    │    │
  ├─1──┼─2──┼─1──┼─0──┼────┤
2 │    │    │    │    │    │
  ├─0──┼─1──┼─2──┼─1──┼────┤
1 │    │    │    │    │    │
  └────┴────┴────┴────┴────┘
（數字為已使用的容量）
```

**詳解**：

**解題思路**：理解兩階段繞線的抽象層級，建立繞線圖模型，再在此圖上搜尋最佳路徑。

**步驟**：

**(a) 整體繞線 vs 詳細繞線**：

| 特性 | 整體繞線（Global Routing） | 詳細繞線（Detailed Routing） |
|------|--------------------------|---------------------------|
| 抽象層級 | GCell級（粗略） | 金屬軌跡級（精確） |
| 目標 | 決定每條網路經過哪些GCell | 分配精確的金屬層和軌道位置 |
| 考慮因素 | 擁塞度（congestion）、線長 | DRC、通孔（via）、金屬寬度/間距 |
| 輸出 | 每條net的GCell序列 | 精確的幾何形狀（GDS） |
| 計算複雜度 | 較低 | 較高 |

兩階段的好處：分而治之，降低複雜度。整體繞線先做全域的資源分配和擁塞管理，詳細繞線再處理局部的幾何約束。

**(b) 繞線圖建模**：

**GCell（Global Cell）**：將晶片劃分為均勻的網格（grid），每個格子為一個GCell。

**繞線圖（Routing Graph）**：
- 每個GCell為一個節點
- 相鄰GCell之間有邊（edge），代表可跨越的邊界
- 每條邊有容量（capacity）= 該邊界上可容納的繞線軌數
- 已使用量（usage）= 已分配的繞線數
- 溢出（overflow）= max(0, usage - capacity)
- 繞線目標：最小化總溢出和總線長

**(c) 路徑搜尋**：

從 (2,1) 到 (5,4)。容量 = 3，殘餘容量 = 3 - 已使用量。

可用邊的殘餘容量計算（水平邊 — 上方數字為已使用量）：

行1到行2之間（y=1-2邊界）：
- (1,1)-(1,2): 殘餘=3-0=3
- (2,1)-(2,2): 殘餘=3-1=2
- (3,1)-(3,2): 殘餘=3-2=1
- (4,1)-(4,2): 殘餘=3-1=2
- (5,1)-(5,2): 殘餘=3（未標示，假設0）

行2到行3之間：
- (1,2)-(1,3): 殘餘=3-1=2
- (2,2)-(2,3): 殘餘=3-2=1
- (3,2)-(3,3): 殘餘=3-1=2
- (4,2)-(4,3): 殘餘=3-0=3
- (5,2)-(5,3): 殘餘=3

行3到行4之間：
- (1,3)-(1,4): 殘餘=3-2=1
- (2,3)-(2,4): 殘餘=3-1=2
- (3,3)-(3,4): 殘餘=3-0=3
- (4,3)-(4,4): 殘餘=3-2=1
- (5,3)-(5,4): 殘餘=3

所有邊都有殘餘容量 > 0，因此選擇最短路徑（Manhattan距離）：

**路徑1**（L型）：(2,1) → (3,1) → (4,1) → (5,1) → (5,2) → (5,3) → (5,4)
長度 = 6 GCells

**路徑2**（先上再右）：(2,1) → (2,2) → (2,3) → (2,4) → (3,4) → (4,4) → (5,4)
長度 = 6 GCells

兩者都是最短路徑。若考慮擁塞度，路徑2中(2,2)→(2,3)的殘餘=1（較擠），路徑1的邊殘餘容量都≥2，因此**路徑1較佳**。

**答案**：(a) 整體繞線在GCell級分配路徑，詳細繞線分配精確幾何。(b) GCell為節點，邊界為帶容量的邊。(c) 推薦路徑 (2,1)→(3,1)→(4,1)→(5,1)→(5,2)→(5,3)→(5,4)。

**延伸思考**：現代整體繞線器（如FastRoute、CUGR）使用協商式擁塞演算法（negotiation-based congestion）：所有net同時競爭資源，擁塞的邊會增加成本，迫使部分net繞道。這個迭代過程收斂到全域擁塞最小的解。

---
### 題目 36：Lee迷宮演算法
**來源**：台大電機 / 經典題型
**難度**：★★★
**主題**：詳細繞線

**題目**：
(a) 描述Lee迷宮演算法（Lee's Maze Router）的原理和步驟。
(b) 在以下5×5的網格中，從S（源點）繞到T（目標點），黑色格子為障礙物。展示Lee演算法的波前擴展過程。

```
┌───┬───┬───┬───┬───┐
│ S │   │   │   │   │
├───┼───┼───┼───┼───┤
│   │ ██│ ██│   │   │
├───┼───┼───┼───┼───┤
│   │ ██│   │   │   │
├───┼───┼───┼───┼───┤
│   │   │   │ ██│   │
├───┼───┼───┼───┼───┤
│   │   │   │ ██│ T │
└───┴───┴───┴───┴───┘
```

(c) Lee演算法的時間和空間複雜度為何？有哪些改進方法？

**詳解**：

**解題思路**：Lee演算法本質上是BFS（廣度優先搜索），保證找到最短路徑。

**步驟**：

**(a) Lee演算法原理**：

**兩階段**：

**第一階段 — 波前擴展（Wave Expansion）**：
1. 從源點S開始，標記為0
2. 對所有未標記且可到達的鄰居（上下左右），標記為1
3. 對標記為1的格子的未標記鄰居，標記為2
4. 重複直到到達目標T或所有可達格子都已標記
5. T的標記值即為最短路徑長度

**第二階段 — 回溯（Backtrace）**：
1. 從目標T開始
2. 向標記值遞減的鄰居移動
3. 重複直到回到源點S
4. 回溯路徑即為最短路徑

**(b) 波前擴展過程**：

用座標(列,行)，S在(0,0)，T在(4,4)：

```
波前擴展結果：
┌───┬───┬───┬───┬───┐
│ 0 │ 1 │ 2 │ 3 │ 4 │
├───┼───┼───┼───┼───┤
│ 1 │ ██│ ██│ 4 │ 5 │
├───┼───┼───┼───┼───┤
│ 2 │ ██│ 5 │ 5 │ 6 │
├───┼───┼───┼───┼───┤
│ 3 │ 4 │ 5 │ ██│ 7 │
├───┼───┼───┼───┼───┤
│ 4 │ 5 │ 6 │ ██│ 8 │
└───┴───┴───┴───┴───┘
```

最短路徑長度 = 8

**回溯路徑**（從T=8回到S=0）：
(4,4)←(3,4)←(2,4)←(2,3)←(2,2)←(1,3)←(0,3)←(0,2)←(0,1)←(0,0)

等一下，讓我修正。(2,2)的值是5，但(1,3)的值是4，不是遞減。讓我重新擴展：

重新標記（行從上到下0-4，列從左到右0-4）：
- (0,0)=0 [S]
- (0,1)=1, (1,0)=1
- (0,2)=2, (2,0)=2
- (0,3)=3, (3,0)=3
- (0,4)=4, (3,1)=4, (1,3)=4（從(0,3)往下）
- (1,4)=5, (3,2)=5, (2,2)=5（從(1,3)往下或(3,1)往右）, (4,0)=4
- (2,3)=5（從(1,3)往下）... 等一下

讓我更仔細地做BFS：

障礙物位置：(1,1), (1,2), (2,1), (3,3), (4,3)

BFS from (0,0)=0:

Step 0: (0,0)=0
Step 1: (0,1)=1, (1,0)=1
Step 2: (0,2)=2, (2,0)=2
Step 3: (0,3)=3, (3,0)=3
Step 4: (0,4)=4, (1,3)=4, (4,0)=4, (3,1)=4
Step 5: (1,4)=5, (2,3)=5, (2,2)=5, (3,2)=5, (4,1)=5
Step 6: (2,4)=6, (4,2)=6
Step 7: (3,4)=7
Step 8: (4,4)=8 [T]

```
┌───┬───┬───┬───┬───┐
│ 0 │ 1 │ 2 │ 3 │ 4 │
├───┼───┼───┼───┼───┤
│ 1 │ ██│ ██│ 4 │ 5 │
├───┼───┼───┼───┼───┤
│ 2 │ ██│ 5 │ 5 │ 6 │
├───┼───┼───┼───┼───┤
│ 3 │ 4 │ 5 │ ██│ 7 │
├───┼───┼───┼───┼───┤
│ 4 │ 5 │ 6 │ ██│ 8 │
└───┴───┴───┴───┴───┘
```

回溯：T(4,4)=8 → (3,4)=7 → (2,4)=6 → (2,3)=5 → (1,3)=4 → (0,3)=3 → (0,2)=2 → (0,1)=1 → (0,0)=0

**路徑**：S → 右 → 右 → 右 → 下 → 下 → 右 → 下 → 下 → T（8步）

**(c) 複雜度與改進**：

**時間複雜度**：O(W × H)，W和H為網格的寬和高。需訪問每個格子一次。
**空間複雜度**：O(W × H)，需儲存每個格子的標記值。

**改進方法**：
1. **A*搜索**：用目標方向的啟發式函數（Manhattan距離）引導擴展方向，減少不必要的擴展
2. **雙向BFS（Bidirectional Search）**：同時從S和T擴展，在中間相遇，減少搜索空間
3. **Soukup's Algorithm**：先嘗試直線到達目標，失敗時再BFS
4. **Hadlock's Algorithm**：優先擴展朝向目標的格子（detour number最小的）
5. **Line-probe Algorithm**：用線段而非格子擴展，減少計算量

**答案**：(a) Lee算法用BFS波前擴展找最短路徑，再回溯確定路線。(b) 最短路徑長度8，如上所示。(c) 時空複雜度O(WH)，可用A*、雙向搜索等改進。

**延伸思考**：Lee算法是詳細繞線的基礎，但逐網路繞線（net-by-net）的順序依賴性很強。Negotiation-based routing（如PathFinder）讓所有net同時繞線並迭代解決衝突，是現代繞線器的核心思想。

---
### 題目 37：通道繞線（Channel Routing）
**來源**：台大電機 / 經典題型
**難度**：★★★★
**主題**：繞線

**題目**：
(a) 定義通道繞線問題。解釋通道密度（channel density）和垂直約束圖（VCG, Vertical Constraint Graph）。
(b) 使用Left-Edge Algorithm繞以下通道：

上邊界 pin：1 2 3 4 5 6 7 8
           N: A B C D A B C D

下邊界 pin：1 2 3 4 5 6 7 8
           N: C D A B D C B A

每個信號（A, B, C, D）連接上邊界和下邊界的同名pin。

(c) Left-Edge Algorithm何時無法得到最優解？Dogleg方法如何改善？

**詳解**：

**解題思路**：Left-Edge Algorithm是經典的通道繞線方法，基於區間圖著色（interval graph coloring）。

**步驟**：

**(a) 通道繞線定義**：

**通道（Channel）**：兩列平行端子之間的矩形繞線區域。目標是用最少的水平軌道（track）將上下邊界的同名端子連接起來。

- 水平線段在軌道（track）上走
- 垂直線段通過通孔（via）連接不同軌道
- 每條信號由水平線段+垂直連接構成

**通道密度（Channel Density, d_max）**：
- 在通道的每個垂直截面上，統計跨越該截面的信號數
- 密度 = 所有截面中的最大值
- 密度是所需軌道數的**下界**

**垂直約束圖（VCG）**：
- 節點 = 信號
- 有向邊 A→B 表示在某列上，A的pin在上方，B的pin在下方
- A必須被分配到比B更上面的軌道
- 若VCG有環（cycle），則無法在不拆分信號的情況下完成繞線

**(b) Left-Edge Algorithm繞線**：

首先確定每個信號的水平跨距（interval）：

| 信號 | 上邊界位置 | 下邊界位置 | 左端 | 右端 |
|------|-----------|-----------|------|------|
| A | 1, 5 | 3, 8 | 1 | 8 |
| B | 2, 6 | 4, 7 | 2 | 7 |
| C | 3, 7 | 1, 6 | 1 | 7 |
| D | 4, 8 | 2, 5 | 2 | 8 |

注意：每個信號有多個pin，需連接所有同名pin。水平跨距從最左pin到最右pin。

Left-Edge Algorithm步驟：
1. 將所有信號的水平區間按左端排序
2. 分配軌道：從第一個軌道開始，選擇左端最小且不與已分配信號重疊的信號

排序後：A[1,8], C[1,7], B[2,7], D[2,8]

軌道分配：
- Track 1: A[1,8]（第一個信號）
- Track 2: C[1,7]（與A重疊，新軌道）
- Track 3: B[2,7]（與A和C重疊，新軌道）
- Track 4: D[2,8]（與所有都重疊，新軌道）

所需軌道數 = 4

但需檢查垂直約束：
- 列1: 上=A, 下=C → A在C上面
- 列2: 上=B, 下=D → B在D上面
- 列3: 上=C, 下=A → C在A上面
- 列4: 上=D, 下=B → D在B上面

VCG: A→C, B→D, C→A, D→B
存在環：A→C→A 和 B→D→B！

**有環的VCG意味著基本Left-Edge無法直接求解**，需要拆分信號（dogleg）。

**(c) Left-Edge的限制與Dogleg改善**：

**Left-Edge Algorithm的限制**：
- 假設每個信號只用一條水平軌道，不允許信號跨越多條軌道
- 當VCG有環時，不可能滿足所有垂直約束
- 只考慮水平約束（區間重疊），不考慮垂直約束

**Dogleg方法**：
- 允許一個信號在不同的列使用不同的軌道
- 在信號的中間某列插入垂直連接（via），分成左右兩段在不同軌道
- 打破VCG中的環

以本題為例，對信號A：
- A在列1-4使用Track 1（上方）
- A在列5-8使用Track 3（下方）
- 在列4-5之間用via換軌道

這樣列3的約束「C在A上面」可以在A的右半段（Track 3）上方的Track 2放C來滿足。

**答案**：(a) 通道繞線用最少軌道連接兩列端子；密度為截面信號數最大值；VCG描述垂直約束。(b) 此例VCG有環，基本Left-Edge需4軌道但無法滿足垂直約束。(c) Left-Edge不處理VCG環，Dogleg通過拆分信號到多軌道來打破環。

**延伸思考**：現代IC設計中，通道繞線的概念仍用於標準元件行之間的局部繞線。但先進節點的繞線更複雜：多重金屬層、方向性限制（偶數層水平/奇數層垂直）、通孔對齊限制等。

---
### 題目 38：時脈樹合成（CTS）
**來源**：台大電機 / IC設計公司面試
**難度**：★★★★
**主題**：時脈樹合成（Clock Tree Synthesis）

**題目**：
(a) 解釋時脈樹合成的目標，以及為何時脈偏移（clock skew）必須被控制。
(b) 描述H-tree的結構與如何實現零偏移（zero-skew）。
(c) 什麼是DME（Deferred Merge Embedding）演算法？簡述其兩階段流程。
(d) 在先進節點中，CTS面臨哪些新挑戰？

**詳解**：

**解題思路**：從時脈信號的特殊性出發，理解為何需要專門的合成方法。

**步驟**：

**(a) CTS目標**：

時脈信號驅動所有暫存器，是晶片中最關鍵的信號。CTS的目標：

1. **最小化時脈偏移（Clock Skew）**：所有暫存器的時脈到達時間盡量一致
2. **最小化時脈延遲（Clock Latency）**：從源到sink的總延遲盡量小
3. **最小化時脈功耗**：時脈樹佔動態功耗的30-50%
4. **滿足轉換率（Slew Rate / Transition Time）**約束：每個sink的信號邊緣不能太慢
5. **最小化面積**：減少buffer和連線的使用

**為何控制偏移**：
- Skew直接影響setup和hold時序餘裕
- 過大的skew ≡ 等效降低時脈頻率
- Hold violation難以修復（需插入delay，增加面積和功耗）

**(b) H-tree結構**：

H-tree是一種對稱的時脈分配結構：

```
         ┌─────────────────────┐
         │    ┌──────┐         │
         │    │      │         │
    ┌────┤    │      │    ┌────┤
    │    │    │  CLK │    │    │
    │    └────┤  SRC │────┤    │
    │         │      │    │    │
    │         │      │    │    │
    │         └──────┘    │    │
    │    ┌────┐      ┌────┤    │
    └────┤    │      │    └────┘
         │    │      │
         └────┘      └────┘
```

- 從中心時脈源出發，先分為左右兩支
- 每支再分為上下兩支，形成「H」形
- 繼續遞迴分支直到達到所有sink
- **對稱結構保證所有路徑等長 → 零偏移**

限制：只適用於均勻分佈的sink，不適用於不規則佈局。

**(c) DME演算法**：

DME（Deferred Merge Embedding）是建構零偏移時脈樹的經典演算法：

**第一階段 — 自底而上（Bottom-up）**：
1. 從葉節點（暫存器）開始
2. 對每對相鄰sink，計算使兩者延遲相等的合併點（merge point）的可行區域
3. 合併點位於兩sink的「延遲等高線」的交集
4. 使用Tilted Rectangular Region（TRR）表示可行區域
5. 遞迴合併直到根節點

**第二階段 — 自頂而下（Top-down）**：
1. 從根節點開始，在可行區域中選擇具體位置
2. 沿樹向下，在每個合併點的可行區域中選擇最佳位置
3. 優化目標：最小化總線長（在保持零偏移的前提下）

DME保證：在Elmore延遲模型下，所有sink的延遲完全相等（零偏移），且總線長最小。

**(d) 先進節點的CTS挑戰**：

1. **製程變異（Process Variation）**：
   - 線寬、通孔電阻、金屬厚度的統計變異導致延遲不確定性
   - OCV（On-Chip Variation）使名義上的零偏移在實際晶片上有顯著偏移

2. **時脈功耗**：
   - 時脈網路驅動大量電容，功耗佔比高
   - 需要clock gating和clock mesh等技術降低功耗

3. **多角落/多模式（MCMM, Multi-Corner Multi-Mode）**：
   - CTS需在所有PVT角落和功能模式下同時滿足偏移約束

4. **有用偏移（Useful Skew）**：
   - 現代CTS工具整合useful skew，故意引入偏移以改善關鍵路徑時序

5. **互連變異**：
   - 先進節點金屬線寬 < 30nm，線電阻急劇增加且變異大
   - 需使用粗金屬層（thicker metal layers）做時脈幹線

**答案**：(a) CTS目標為最小化偏移、延遲和功耗；偏移直接影響時序餘裕。(b) H-tree利用對稱結構保證等路徑長度。(c) DME分自底而上計算可行區域和自頂而下選擇位置兩階段。(d) 製程變異、功耗、MCMM和有用偏移是先進節點挑戰。

**延伸思考**：現代CTS工具（如Innovus的CTS engine）已從純零偏移轉向「有用偏移+OCV感知」的策略。同時，mesh-based clock distribution（時脈網格）在高性能處理器中使用，以犧牲面積和功耗換取更小的變異偏移。

---
### 題目 39：寄生參數提取與延遲模型
**來源**：台大電機 / IC設計公司面試
**難度**：★★★★
**主題**：寄生參數提取

**題目**：
(a) 比較Elmore延遲模型與AWE（Asymptotic Waveform Evaluation）在精確度和計算速度上的差異。
(b) 一個RC π-模型如下：

```
           R
  o──┬──/\/\/──┬──o
     │          │
    C₁/2      C₂/2
     │          │
    GND        GND
```

若 R = 1kΩ, C_total = C₁ + C₂ = 100 fF（對稱分佈），計算Elmore延遲。

(c) 在先進節點中，互連延遲的主要挑戰是什麼？為何電阻比電容更成為瓶頸？

**詳解**：

**解題思路**：從RC互連模型出發，比較不同精確度的延遲模型。

**步驟**：

**(a) Elmore vs AWE**：

| 特性 | Elmore Delay | AWE |
|------|-------------|-----|
| 精確度 | 低（上界估計，誤差可達20-50%） | 中高（可匹配多個時域矩） |
| 計算速度 | 極快（O(n)） | 中等（需矩計算和Padé近似） |
| 模型 | 一階RC矩（均值延遲） | q階近似（q個極點） |
| 適用場景 | 早期估計、佈局優化 | 精確時序分析 |
| 處理電感 | 不能 | 可以（RLC） |

Elmore延遲公式：
$$t_d = \sum_{i} R_i \cdot C_i^{downstream}$$

其中 Ri 為路徑上每個電阻，Ci^downstream 為該電阻下游的所有電容之和。

**(b) π-模型的Elmore延遲**：

C₁ = C₂ = C_total/2 = 50 fF（對稱π模型）

Elmore延遲 = R × (C₁/2 + C₂/2) ... 不對，讓我用嚴格定義。

對於π-模型，從輸入到輸出：
- 電阻R連接節點A和節點B
- C₁/2接在節點A到地
- C₂/2接在節點B到地

不對，π-模型中：
- 節點A：C₁/2 = 50fF 到地
- 電阻R = 1kΩ 從A到B
- 節點B：C₂/2 = 50fF 到地

但原題寫 C_total = C₁ + C₂ = 100fF，分成兩半：

所以 C_near = 50fF（靠近驅動端），C_far = 50fF（靠近負載端）

Elmore延遲（從輸入到輸出節點B）：

$$t_{Elmore} = R \times C_{far} + R \times C_{near}$$

等一下，正確的Elmore延遲：

路徑上的電阻對每個電容的貢獻：
- C_near (50fF)：在R之前的路徑電阻 = 0（直接接在輸入端）...

讓我重新定義。如果信號從左端輸入：

```
  IN o──┬──R=1kΩ──┬──o OUT
        │          │
       C1=50fF   C2=50fF
        │          │
       GND        GND
```

Elmore延遲到OUT節點：
- C1的上游電阻 = 0（C1直接在輸入端）→ 貢獻 = 0 × C1 = 0
- C2的上游電阻 = R = 1kΩ → 貢獻 = R × C2 = 1kΩ × 50fF

$$t_{Elmore} = 0 \times 50\text{fF} + 1\text{k}\Omega \times 50\text{fF} = 50 \text{ ps}$$

但更常見的Elmore公式對於分佈RC線：

$$t_{Elmore} = RC/2 \text{（對於均勻分佈RC線）}$$

= 1kΩ × 100fF / 2 = 50 ps

對於集中式（lumped）模型直接使用 τ = RC = 1kΩ × 50fF = 50 ps（只計算末端電容通過R的延遲）。

**t_Elmore = 50 ps**

若將互連視為均勻分佈RC線：t = RC/2 = 1000 × 100×10⁻¹⁵ / 2 = 50 ps（一致）。

**(c) 先進節點的互連挑戰**：

**為何電阻成為主要瓶頸**：

1. **金屬線寬縮小**：電阻 R ∝ ρL/(W×H)，W和H縮小使R急劇增加
2. **電子散射效應**：
   - **晶界散射（Grain Boundary Scattering）**：金屬線寬接近晶粒大小時，電子在晶界被散射
   - **表面散射（Surface Scattering）**：線寬接近電子平均自由程（Cu約39nm@室溫）時，表面散射顯著
   - 有效電阻率 ρ_eff >> ρ_bulk（銅的體電阻率1.7μΩ·cm在10nm線寬下可增至5-10μΩ·cm）

3. **阻障層佔位效應**：
   - 阻障層（TaN/Ta，~2-3nm厚）佔據了金屬線截面的顯著比例
   - 有效銅截面積大幅減小
   - 例如：16nm線寬 - 2×3nm阻障層 = 10nm有效銅寬度

4. **RC延遲隨尺度的變化**：
   - 電阻R ∝ 1/W²（假設等比例縮小W和H）
   - 電容C因fringing field效應不等比例縮小
   - RC延遲反而隨特徵尺寸縮小而**增大**

**答案**：(a) Elmore快但精度低（上界），AWE精度高但需更多計算。(b) Elmore延遲 = 50 ps。(c) 金屬線寬縮小導致電阻率急增（散射效應+阻障層佔位），電阻已超過電容成為互連延遲的主要瓶頸。

**延伸思考**：TSMC和Intel在最底層金屬採用釕（Ru）和鉬（Mo）替代銅，因為這些金屬的平均自由程更短（~5nm），電子散射效應較小，在極窄線寬下有效電阻率可能低於銅。這是材料科學與EDA共同面對的挑戰。

---
### 題目 40：設計規則檢查（DRC）與佈局對電路圖檢查（LVS）
**來源**：台大電機 / IC設計公司面試
**難度**：★★★
**主題**：物理驗證

**題目**：
(a) 解釋DRC（Design Rule Check）和LVS（Layout vs Schematic）各自檢查什麼。
(b) 列舉至少五種常見的DRC規則，並說明每種規則的物理意義。
(c) LVS中常見的錯誤類型有哪些？如何有效debug LVS錯誤？

**詳解**：

**解題思路**：從物理驗證在設計流程中的角色出發，理解每種檢查的目的和方法。

**步驟**：

**(a) DRC vs LVS**：

**DRC（設計規則檢查）**：
- 檢查版圖（layout）是否符合晶圓廠（foundry）定義的**製造規則**
- 只看幾何形狀，不看電路連接關係
- 確保版圖可被製造出來（可製造性）
- 工具：Mentor Calibre、Synopsys IC Validator

**LVS（佈局對電路圖檢查）**：
- 比較版圖（layout）萃取出的網表（netlist）與原始電路圖（schematic）是否**邏輯等價**
- 檢查連接關係、元件參數（W/L、電容值等）
- 確保版圖實現了設計意圖
- 工具：Mentor Calibre LVS、Synopsys IC Validator LVS

**(b) 常見DRC規則**：

| 規則 | 說明 | 物理意義 |
|------|------|----------|
| **Minimum Width（最小寬度）** | 金屬線/多晶矽的最小寬度 | 太窄的線在蝕刻中可能斷線或電阻過高 |
| **Minimum Spacing（最小間距）** | 同層兩圖案之間的最小距離 | 太近可能導致短路（蝕刻不完全或電遷移） |
| **Minimum Enclosure（最小包覆）** | 上層圖案對下層圖案的最小覆蓋量 | 確保通孔（via）與金屬的良好接觸 |
| **Minimum Area（最小面積）** | 圖案的最小面積 | 太小的金屬塊可能在CMP中被剝離 |
| **Minimum Density（最小密度）** | 某層在局部區域的最小填充率 | CMP均勻性需求（密度太低導致dishing） |
| **Maximum Density（最大密度）** | 某層在局部區域的最大填充率 | 防止金屬密度過高導致蝕刻困難 |
| **Antenna Rule（天線效應規則）** | 金屬面積與閘極面積的比值上限 | 電漿蝕刻時累積電荷可能損壞閘極氧化層 |

**(c) 常見LVS錯誤與debug**：

**常見錯誤類型**：
1. **Short（短路）**：不應連接的兩個網路在版圖中連在一起
2. **Open（斷路）**：應連接的網路在版圖中未連通
3. **元件參數不匹配**：W/L值、電阻值、電容值與schematic不同
4. **缺少元件**：版圖中缺少schematic中的某些元件
5. **多餘元件**：版圖中存在schematic中沒有的浮接元件
6. **Port不匹配**：I/O pin的名稱或數量不一致

**有效Debug方法**：
1. **分層比較（Hierarchical Comparison）**：先在模組級找出問題模組，再深入
2. **使用LVS debug工具**：Calibre RVE、IC Validator GUI可圖形化顯示錯誤位置
3. **Cross-probing**：在schematic和layout之間交叉高亮，定位差異
4. **簡化問題**：將大設計拆分為子模組，逐個通過LVS
5. **檢查文字標記（Label）**：許多LVS錯誤源於label缺失或錯誤
6. **注意well和substrate的連接**：PMOS/NMOS的基底連接常被遺漏

**答案**：(a) DRC檢查幾何製造規則，LVS檢查版圖與電路圖的功能一致性。(b) 最小寬度、間距、包覆、面積、密度、天線規則等。(c) Short、Open、參數不匹配是常見錯誤，使用分層debug和cross-probing工具定位。

**延伸思考**：先進節點的DRC規則數量呈指數增長（7nm約有數千條規則），且引入了複雜的情境規則（context-dependent rules）。例如，金屬線的最小間距取決於其長度（長線需要更大間距以降低電容耦合）。這使得DRC運行時間大幅增加，需要分佈式計算和雲端EDA。

---
## Part 5：先進製程與DFM（題目 41–50）

---
### 題目 41：FinFET結構與原理
**來源**：台大電機 / TSMC面試
**難度**：★★★★
**主題**：FinFET製程

**題目**：
(a) 畫出FinFET（鰭式場效電晶體）的三維結構圖，標示鰭片（fin）、閘極（gate）、源極（source）、汲極（drain）的位置。
(b) 與傳統平面MOSFET相比，FinFET在閘極控制力和短通道效應（SCE）抑制上有何優勢？用物理公式說明。
(c) FinFET的電流大小如何調整？為何說FinFET的驅動電流是「量子化」的？
(d) 比較Intel、TSMC、Samsung在FinFET技術上的主要差異（14/16nm世代）。

**詳解**：

**解題思路**：從FinFET的結構出發，分析其物理優勢，再討論設計和製造的影響。

**步驟**：

**(a) FinFET三維結構**：

```
        閘極(Gate)
        ┌───────┐
        │///////│
        │/Gate /│
     ┌──┤/Oxide/├──┐
     │  │///////│  │
     │  └───┬───┘  │
     │      │      │
   ┌─┤─┐  ┌─┤─┐  ┌─┤─┐
   │ │ │  │ │ │  │ │ │
   │Fin│  │Fin│  │Fin│   ← 鰭片(Silicon Fin)
   │ │ │  │ │ │  │ │ │
   └─┤─┘  └─┤─┘  └─┤─┘
     │      │      │
   Source  Gate   Drain
   (前方)  (頂部)  (後方)

俯視圖：
  S ──[Fin]── D
        ↑
      Gate 從三面包覆 Fin
```

鰭片是從矽基板蝕刻出的窄條狀結構，閘極從三面（左、右、頂）包覆鰭片。

**(b) FinFET的閘極控制力優勢**：

**短通道效應的定量指標 — 自然長度（natural length）λ**：

平面MOSFET：
$$\lambda_{planar} = \sqrt{\frac{\epsilon_{Si}}{\epsilon_{ox}} t_{ox} \cdot t_{Si}}$$

FinFET（三面閘極）：
$$\lambda_{FinFET} \approx \sqrt{\frac{\epsilon_{Si}}{2\epsilon_{ox}} t_{ox} \cdot W_{fin}}$$

其中 t_Si 為平面MOSFET的通道厚度，W_fin 為鰭片寬度。

關鍵差異：
- FinFET中，**W_fin可做到非常窄（5-7nm）**，遠小於平面MOSFET的通道厚度
- 三面閘極包覆增加了閘極對通道電位的控制
- λ更小 → 閘極電場更好地穿透通道 → DIBL和次臨界擺幅更小

**定量比較**（14nm FinFET vs 28nm Planar）：
- 次臨界擺幅SS：FinFET ~65 mV/dec vs Planar ~85 mV/dec
- DIBL：FinFET ~30 mV/V vs Planar ~80 mV/V
- Ion/Ioff 比：FinFET 提升 5-10 倍

**(c) FinFET電流的量子化**：

FinFET的有效通道寬度 W_eff 由鰭片的幾何尺寸決定：

$$W_{eff} = 2 \times H_{fin} + W_{fin}$$

（兩個側面 + 頂部）

總驅動電流：
$$I_{total} = N_{fin} \times I_{single\_fin}$$

其中 N_fin 為鰭片數量（正整數）。

**「量子化」的意義**：
- 平面MOSFET的W可連續調整（任意寬度）
- FinFET的W只能以一個鰭片為單位增減
- W_eff = 1 fin, 2 fins, 3 fins ...（離散值）
- 無法設計「半個鰭片」的電晶體
- 對類比電路設計影響大（精細的電流比例需要大量鰭片）

例如：TSMC N7，H_fin ≈ 46nm, W_fin ≈ 7nm
W_eff per fin = 2×46 + 7 = 99nm ≈ 100nm

**(d) Intel/TSMC/Samsung比較**（14/16nm世代）：

| 特性 | Intel 14nm | TSMC 16nm | Samsung 14nm |
|------|-----------|-----------|-------------|
| 鰭片高度 | 42 nm | 37 nm | 32 nm |
| 鰭片間距（Fin Pitch） | 42 nm | 48 nm | 48 nm |
| 閘極間距（Gate Pitch） | 70 nm | 90 nm | 78 nm |
| 金屬間距（M1 Pitch） | 52 nm | 64 nm | 64 nm |
| 通道長度 | ~20 nm | ~25 nm | ~22 nm |
| 密度 | 最高 | 中等 | 中等 |

Intel在14nm世代密度領先，但TSMC在16nm後期通過良率和成本優勢贏得更多客戶。

**答案**：(a) FinFET為三面閘極包覆窄鰭片的3D結構。(b) 窄鰭片+三面閘極減小自然長度λ，大幅抑制SCE。(c) 電流以鰭片數為單位離散調整，稱為量子化。(d) Intel密度領先，TSMC/Samsung間距較寬但良率佳。

**延伸思考**：FinFET技術從2011年Intel 22nm首次量產，歷經10年以上的演進，在TSMC 3nm（N3）達到極限。3nm以下節點轉向GAA（Gate-All-Around）結構，即TSMC的N2。FinFET到GAA的轉換是半導體史上最重要的架構變革之一。

---
### 題目 42：GAA/Nanosheet電晶體
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★★
**主題**：先進電晶體結構

**題目**：
(a) 說明GAA（Gate-All-Around）/ Nanosheet電晶體的結構，與FinFET相比有何優勢？
(b) 描述Nanosheet的製程流程關鍵步驟（特別是通道釋放 channel release）。
(c) 什麼是CFET（Complementary FET）？其結構與潛在優勢為何？
(d) 從TSMC N2開始採用GAA，比較N2和N3的關鍵參數。

**詳解**：

**解題思路**：從FinFET的限制出發，理解GAA的必然性，再展望CFET的未來。

**步驟**：

**(a) GAA/Nanosheet結構與優勢**：

**結構**：
```
側面截面圖：
     ┌─────Gate─────┐
     │ ┌───────────┐ │
     │ │ nanosheet │ │    ← 通道（Si薄片）
     │ └───────────┘ │
     │ ┌───────────┐ │
     │ │ nanosheet │ │    ← 通道（Si薄片）
     │ └───────────┘ │
     │ ┌───────────┐ │
     │ │ nanosheet │ │    ← 通道（Si薄片）
     │ └───────────┘ │
     └───────────────┘
   Gate從四面完全包覆每個nanosheet
```

**與FinFET的比較**：

| 特性 | FinFET（三面閘極） | GAA/Nanosheet（四面閘極） |
|------|-------------------|------------------------|
| 閘極控制 | 三面包覆 | 四面完全包覆 |
| 靜電控制 | 良好 | 最佳 |
| 有效寬度調整 | 離散（fin數） | 可調（sheet寬度） |
| SS（次臨界擺幅） | ~65 mV/dec | ~62 mV/dec |
| DIBL | ~30 mV/V | ~15 mV/V |
| 驅動電流密度 | 受fin高度限制 | 可通過增加sheet數和寬度提升 |

**關鍵優勢**：
1. 四面閘極提供最佳的靜電控制
2. Nanosheet寬度可連續調整（不像fin必須固定寬度），恢復設計靈活性
3. 在相同footprint下可提供更高的驅動電流（多層堆疊）

**(b) Nanosheet製程關鍵步驟**：

1. **磊晶Si/SiGe超晶格（Superlattice Epitaxy）**：
   - 交替生長Si和SiGe薄層（各~5-7nm厚）
   - 通常3-4對Si/SiGe層
   - SiGe為犧牲層，Si為通道層

2. **鰭片蝕刻**：
   - 將超晶格蝕刻成鰭片形狀

3. **虛擬閘極形成（Dummy Gate）**：
   - 沉積虛擬多晶矽閘極和硬遮罩

4. **內部間隔物（Inner Spacer）形成**：
   - 選擇性蝕刻SiGe犧牲層的邊緣（lateral recess）
   - 沉積介電材料填入凹陷處
   - 此步驟定義了源/汲極與閘極之間的寄生電容

5. **源/汲極磊晶**：
   - 在鰭片兩端磊晶生長源/汲極

6. **通道釋放（Channel Release）**：⭐ 最關鍵步驟
   - 去除虛擬閘極後，選擇性蝕刻去除SiGe犧牲層
   - 釋放出懸浮的Si nanosheet通道
   - 需要極高的SiGe/Si蝕刻選擇比（>100:1）
   - 不能損傷Si通道的表面品質

7. **High-k/Metal Gate（HKMG）形成**：
   - 在釋放的nanosheet四面沉積high-k介電層和金屬閘極
   - 需要ALD在高深寬比結構中均勻沉積

**(c) CFET結構與優勢**：

**CFET（Complementary FET）**：將NMOS和PMOS**垂直堆疊**在同一位置：

```
     ┌─────────────┐
     │  PMOS Gate   │
     │ ┌─────────┐ │
     │ │P-channel│ │   ← PMOS nanosheet
     │ └─────────┘ │
     └──────┬──────┘
            │ 絕緣層
     ┌──────┴──────┐
     │  NMOS Gate   │
     │ ┌─────────┐ │
     │ │N-channel│ │   ← NMOS nanosheet
     │ └─────────┘ │
     └─────────────┘
```

**優勢**：
- **面積減半**：NMOS和PMOS不再水平排列，垂直堆疊減少50%面積
- **更短的互連**：N/P之間的連接可在垂直方向完成
- **繼續延續摩爾定律**：在GAA之後提供進一步的密度提升

**挑戰**：
- 上下層的獨立閘極控制極其複雜
- 熱管理：下層散熱困難
- 製程複雜度大幅增加（上層不能破壞下層）
- 預計2030年後才可能量產（TSMC A14可能採用）

**(d) TSMC N2 vs N3比較**：

| 參數 | TSMC N3 | TSMC N2 |
|------|---------|---------|
| 電晶體架構 | FinFET | GAA Nanosheet |
| 閘極長度 | ~12 nm | ~12 nm |
| 閘極間距 | 48 nm | 48 nm |
| 金屬間距（M1） | 23-24 nm | 22 nm |
| nanosheet/fin數 | 3 fins | 3 sheets |
| 速度提升 | 基準 | +10-15% |
| 功耗改善 | 基準 | -25-30% |
| 密度提升 | 基準 | +15% |
| 量產時間 | 2022 | 2025 |

**答案**：(a) GAA四面閘極包覆提供最佳靜電控制，寬度可調。(b) 通道釋放為最關鍵步驟，需高選擇比去除SiGe。(c) CFET將N/PMOS垂直堆疊，面積減半。(d) N2採用GAA，較N3提升10-15%速度、降低25-30%功耗。

**延伸思考**：GAA轉換不僅是製程變化，也深刻影響EDA工具。標準元件庫需重新設計以利用nanosheet寬度調整能力。SPICE模型從BSIM-CMG（FinFET）更新為BSIM-CMG-GAA。EDA的寄生參數提取需處理3D堆疊結構。

---
### 題目 43：先進微影——多重曝光與High-NA EUV
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★★
**主題**：先進微影技術

**題目**：
(a) TSMC在不同節點使用的微影技術組合為何？從7nm到2nm各節點列出。
(b) 什麼是High-NA EUV？其NA從0.33提升到0.55帶來了哪些好處和挑戰？
(c) 比較EUV單次曝光、EUV雙重曝光（EUVL Double Patterning）和High-NA EUV在2nm節點金屬層的適用性。

**詳解**：

**解題思路**：追蹤微影技術在各節點的演進，理解High-NA EUV的物理和工程影響。

**步驟**：

**(a) 各節點微影技術**：

| 節點 | 關鍵層微影 | EUV層數 | 說明 |
|------|-----------|---------|------|
| TSMC 7nm（N7） | 193i + SADP/SAQP | 0 | 純DUV多重曝光 |
| TSMC 7nm+（N7+） | EUV + 193i | ~4 | 首次引入EUV |
| TSMC 5nm（N5） | EUV + 193i | ~14 | EUV大幅擴展 |
| TSMC 3nm（N3） | EUV + 193i | ~20+ | 部分層需EUV雙重曝光 |
| TSMC 2nm（N2） | EUV + EUVDP + 193i | ~25+ | 更多EUV雙重曝光 |
| TSMC A14/1.4nm | High-NA EUV（預期） | ~30+ | 首次引入High-NA |

**(b) High-NA EUV**：

**NA提升：0.33 → 0.55**

解析度改善：
$$R = k_1 \frac{\lambda}{NA} = k_1 \frac{13.5}{0.55} \approx k_1 \times 24.5 \text{ nm}$$

比標準EUV（k₁×13.5/0.33 = k₁×40.9nm）改善約40%。

**好處**：
1. 單次曝光可達到 ~8nm 解析度（k₁=0.33）
2. 可能取代EUV雙重曝光，降低成本和提升throughput
3. 減少隨機效應（更大NA收集更多光子）

**挑戰**：
1. **焦深縮小**：DOF ∝ λ/NA²，從標準EUV的~90nm降至~45nm
   - 晶圓平坦度和對焦精度要求極高
2. **Anamorphic光學**：
   - 0.55 NA需在掃描方向使用8x縮小（而非傳統4x），另一方向保持4x
   - 光場面積減半（從26×33mm減為26×16.5mm）
   - 需要新的光罩和更多stitching
3. **設備成本極高**：每台約$350-400M
4. **光罩3D效應**：高NA使光罩上的吸收層厚度產生更嚴重的陰影效應

**(c) 2nm節點金屬層方案比較**：

假設目標金屬間距（Metal Pitch）= 20nm：

| 方案 | 解析度能力 | 優勢 | 劣勢 |
|------|-----------|------|------|
| EUV單次曝光（NA=0.33） | ~13nm（k₁=0.32） | 簡單、成本低 | 20nm pitch困難（需k₁<0.25） |
| EUV雙重曝光（EUVDP） | ~8nm（等效） | 可行性已驗證 | 成本×2、疊對誤差、throughput減半 |
| High-NA EUV（NA=0.55） | ~8nm（k₁=0.33） | 單次曝光、高throughput | 焦深小、設備貴、光場小 |

**結論**：20nm pitch是標準EUV的極限。TSMC N2可能在關鍵金屬層使用EUVDP，而A14可能導入High-NA EUV。

**答案**：(a) 從N7的純DUV到N2的EUV+EUVDP，EUV層數逐節點增加。(b) High-NA(0.55)改善40%解析度但焦深減半、光場減半。(c) 20nm pitch需EUVDP或High-NA EUV，前者成本高、後者設備貴。

**延伸思考**：超越High-NA EUV的下一代微影仍不明朗。可能的方向包括更高NA（>0.7？需要反射鏡上的新材料）、超短波長（如BEUV ~6.7nm）、或基於奈米壓印（NIL）和定向自組裝（DSA）的無光罩技術。

---
### 題目 44：先進互連技術
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★
**主題**：先進互連

**題目**：
(a) 為何先進節點需要從銅（Cu）互連轉換到鈷（Co）和釕（Ru）？從物理角度解釋。
(b) 什麼是Air Gap技術？如何在BEOL中實現？其對EDA工具有何影響？
(c) 描述BEOL 3D整合（如nanoTSV）的概念與潛在應用。

**詳解**：

**解題思路**：從金屬互連在尺寸微縮下的物理限制出發，分析替代材料和新架構的必要性。

**步驟**：

**(a) 從Cu到Co/Ru的必要性**：

**銅在極細線寬下的問題**：

銅的電子平均自由程（electron mean free path, MFP）≈ 39nm（室溫）。

當金屬線寬 W 接近或小於 MFP 時：

$$\rho_{eff} = \rho_{bulk} \left[1 + \frac{3}{4}(1-p)\frac{\lambda_{mfp}}{W} + \frac{R_g}{1-R_g}\frac{\lambda_{mfp}}{d_g}\right]$$

其中：
- 第二項：表面散射（Fuchs-Sondheimer model），p為鏡面反射係數
- 第三項：晶界散射（Mayadas-Shatzkes model），Rg為晶界反射係數，dg為晶粒大小

**Cu在10nm線寬下的有效電阻率可達 ~10μΩ·cm（6倍體電阻率）**。

**替代金屬的優勢**：

| 金屬 | 體電阻率(μΩ·cm) | MFP(nm) | 優勢 |
|------|-----------------|---------|------|
| Cu | 1.7 | 39 | 體電阻率最低 |
| Co | 5.6 | 10 | MFP短，尺寸效應小 |
| Ru | 5.2 | 6.6 | MFP最短，不需阻障層 |
| Mo | 4.8 | 11 | MFP短，與CMOS相容 |
| W | 5.5 | 15 | 已用於接觸孔 |

在W < 15nm時：
- Co/Ru的有效電阻率可能**低於Cu**（因為MFP短，尺寸效應小）
- Ru不需要阻障層（自身就是良好的擴散阻擋材料），有效導電截面積更大

**TSMC在N3的底層金屬已開始使用Ru。**

**(b) Air Gap技術**：

**原理**：在金屬線之間的介電材料中建立空氣間隙，利用空氣的超低介電常數（k=1.0）降低線間電容。

**實現方法**：
1. 正常完成金屬互連填充和CMP
2. 選擇性蝕刻去除金屬線之間的部分介電材料
3. 沉積不保形的材料（如PECVD SiO₂），使其在溝槽頂部封口而不填滿底部
4. 頂部封口下方形成空氣間隙

```
  封口後截面：
  ┌──SiO₂────────SiO₂──┐
  │ Cu │ Air Gap │ Cu  │
  │    │         │     │
  └────┴─────────┴─────┘
```

**等效介電常數**：k_eff = 1.5-2.0（比low-k SiCOH的2.5-3.0顯著降低）

**對EDA工具的影響**：
- 寄生電容提取模型需更新（非均勻介電材料）
- Air gap的位置和大小取決於佈局，需在提取中考慮
- 機械強度降低 → 可靠度模型需更新
- 某些區域不適合air gap（如電源線、關鍵信號線需要機械支撐）

**(c) BEOL 3D整合（nanoTSV）**：

**概念**：在後段互連（BEOL）中建立垂直的通孔結構（nanoTSV），實現：
- 金屬層之間的直接3D連接
- 在BEOL中堆疊額外的功能層（如SRAM、邏輯等）
- 不同於傳統TSV（μm級），nanoTSV為nm級

**潛在應用**：
1. **BEOL中嵌入SRAM**：在金屬互連層中整合記憶體，縮短處理器到快取的距離
2. **3D堆疊邏輯**：在一個die中垂直堆疊多層電晶體
3. **背面電源分配網路（Backside PDN）**：將電源線路移到晶圓背面，釋放正面的繞線資源

TSMC的N2已導入背面電源（Backside Power Rail），是BEOL 3D化的第一步。

**答案**：(a) Cu的長MFP在極細線寬下導致嚴重尺寸效應，Co/Ru的短MFP使其在<15nm線寬下有效電阻率可能更低。(b) Air gap在金屬線間建立空氣間隙降低k至~1.5，EDA需更新電容提取模型。(c) nanoTSV實現BEOL中的3D互連，應用於嵌入式記憶體和背面電源。

**延伸思考**：背面電源分配（Backside PDN / BSPDN）是繼FinFET到GAA之後最重要的架構創新。它將IR-drop降低50%以上，同時釋放正面5-10%的繞線資源。Intel已在Intel 20A（2024）和Intel 18A中採用PowerVia背面供電技術。

---
### 題目 45：DFM——可製造性設計
**來源**：台大電機 / TSMC面試
**難度**：★★★★
**主題**：DFM（Design for Manufacturability）

**題目**：
(a) 什麼是DFM？為何在先進節點中DFM的重要性急劇增加？
(b) 解釋以下DFM技術：
   - 虛擬圖案填充（Dummy Fill）
   - OPC（光學鄰近校正）
   - 冗餘通孔（Redundant Via）
(c) 什麼是Lithography-Aware Design？它如何影響EDA的佈局繞線演算法？

**詳解**：

**解題思路**：從製程變異對良率的影響出發，理解DFM技術如何在設計階段預防製造問題。

**步驟**：

**(a) DFM定義與重要性**：

**DFM**是在IC設計階段就考慮製造限制和變異的設計方法論，目標是提高良率（yield）和可靠度。

**在先進節點中重要性增加的原因**：
1. **製程變異佔比增大**：特徵尺寸縮小，但製程變異（3σ）的絕對值不等比例縮小
   - 例：28nm的線寬變異±3nm，佔10.7%；7nm的線寬變異±2nm，佔28.6%
2. **圖案複雜度增加**：多重曝光、EUV的圖案相關缺陷
3. **良率損失成本高**：先進節點的晶圓成本極高（3nm約$20,000/wafer），良率每降1%就是巨大損失
4. **可靠度要求嚴格**：汽車和資料中心晶片需>10年壽命

**(b) DFM技術詳解**：

**虛擬圖案填充（Dummy Fill）**：
- **目的**：使金屬/多晶矽的圖案密度在局部和全域都均勻
- **原因**：CMP的研磨速率與圖案密度相關（Preston方程），密度不均導致dishing和erosion
- **方法**：在密度低的區域插入不連接到任何電路的虛擬金屬塊
- **約束**：
  - 不能與信號線太近（增加耦合電容）
  - 不能在敏感區域（如RF電路）放置
  - 需滿足密度規則（通常20-80%的局部密度目標）
- **EDA實現**：Calibre SmartFill、IC Validator Fill

**OPC（Optical Proximity Correction）**：
- **目的**：預補償光學繞射造成的圖案失真
- **方法**：
  - Rule-based OPC：根據預定義的規則調整圖案（早期）
  - Model-based OPC：使用光學+光阻模型模擬空間像，反覆調整光罩圖案直到模擬結果匹配目標
  - ILT（Inverse Lithography Technology）：直接求解光罩的最佳形狀
- **EDA工具**：Synopsys Proteus、Siemens Calibre OPC
- **計算量巨大**：一個先進節點的full-chip OPC需數千CPU·小時

**冗餘通孔（Redundant Via）**：
- **目的**：提高通孔（via）的可靠度
- **原因**：單一通孔可能因製程缺陷（未完全蝕刻、填充不良）而開路
- **方法**：在空間允許的地方，將單一通孔替換為雙通孔或多通孔
- **效果**：顯著降低開路風險（單via開路率~10⁻⁴，雙via降至~10⁻⁸）
- **EDA實現**：在詳細繞線後進行redundant via insertion

**(c) Lithography-Aware Design**：

**概念**：在設計的佈局和繞線階段，就考慮微影製程的可印刷性（printability），而非等到tapeout後才做OPC修正。

**對EDA的影響**：

1. **佈局規則限制**：
   - 限制金屬線只能在「優選方向」（preferred direction）上走
   - 限制線端（line-end）的最小延伸長度
   - 禁止某些幾何形狀（如銳角彎折）

2. **繞線友好規則（Routing-Friendly Rules）**：
   - 限制相鄰線的最小間距取決於run length
   - Color-aware routing（多重曝光的顏色分配）

3. **佈局優化**：
   - 在佈局階段就評估圖案的可印刷性（lithography hotspot detection）
   - 自動調整元件位置避開微影熱點

4. **設計規則的爆炸**：
   - 先進節點的設計規則從數百條增至數千條
   - 許多規則是context-dependent（取決於周圍環境）
   - EDA工具需在短時間內處理全部規則

**答案**：(a) DFM在設計階段考慮製造限制，因先進節點變異佔比大且良率成本高。(b) Dummy fill均勻化密度，OPC補償光學失真，冗餘via提高連接可靠度。(c) Lithography-aware design在佈局繞線時就考慮可印刷性，影響設計規則和優化算法。

**延伸思考**：機器學習正在革新DFM：用CNN（卷積神經網路）預測lithography hotspot比傳統模擬快1000倍；用GAN（生成對抗網路）生成OPC修正。這是EDA與AI交叉的前沿研究領域。

---
### 題目 46：先進節點的設計規則與標準元件
**來源**：TSMC面試 / IC設計公司面試
**難度**：★★★★
**主題**：先進設計規則

**題目**：
(a) 解釋CPP（Contacted Poly Pitch）和MMP（Minimum Metal Pitch）的定義，以及它們如何決定標準元件的面積。
(b) 什麼是track height（軌道高度）？為何先進節點從9T降到6T甚至5T？其影響為何？
(c) 在FinFET/GAA節點中，標準元件設計面臨哪些獨特挑戰？

**詳解**：

**解題思路**：從標準元件的基本幾何參數出發，分析微縮趨勢對設計的影響。

**步驟**：

**(a) CPP和MMP**：

**CPP（Contacted Poly Pitch）**：
- 兩個相鄰閘極（poly gate）之間的中心距
- 決定元件在水平方向的密度
- CPP = 閘極長度 + 閘極間距（gate length + gate spacing）
- 例：TSMC N5 CPP ≈ 48nm

**MMP（Minimum Metal Pitch）**：
- 最小金屬互連層（通常M1/M2）的線距（wire pitch = width + spacing）
- 決定繞線密度
- 例：TSMC N5 M1 pitch ≈ 28nm

**標準元件面積**：
$$A_{cell} \propto CPP \times n_{tracks} \times MMP$$

其中 n_tracks 為元件的軌道高度。面積微縮需同時降低CPP、MMP和track數。

**(b) Track Height（軌道高度）**：

**定義**：標準元件的高度以M2金屬軌道數表示。

$$Cell\_Height = n_{tracks} \times M2\_pitch$$

例如：N5的6T元件高度 = 6 × 28nm = 168nm

**從9T降到5T的趨勢**：

| 節點 | 典型Track Height | Cell Height | 面積影響 |
|------|-----------------|-------------|----------|
| 28nm | 9T | ~504nm | 基準 |
| 14nm | 7.5T-9T | ~360-432nm | -25% |
| 7nm | 6T-7.5T | ~240-270nm | -40% |
| 5nm | 6T | ~168nm | -55% |
| 3nm | 5T-6T | ~120-144nm | -65% |

**降低Track Height的影響**：
- **面積縮減**：直接降低元件面積，提升密度
- **繞線資源減少**：更少的軌道意味著更少的元件內繞線空間
- **Pin accessibility降低**：元件的輸入/輸出pin更難被上層金屬連接
- **效能折衷**：低track元件通常犧牲一些驅動力

現代設計混用不同track height：
- 6T/5T用於高密度區域（SRAM、邏輯核心）
- 7.5T/9T用於高速關鍵路徑或I/O

**(c) FinFET/GAA標準元件設計挑戰**：

1. **離散化的驅動強度**：
   - FinFET：電流以fin數為單位調整
   - 在5T元件中，每side可能只放1-2個fin
   - 驅動力選項有限，影響library characterization

2. **Pin accessibility問題**：
   - 低track元件中，M1 pin的位置極度受限
   - 需要更多的金屬層（M0-M1）來完成元件內部連接
   - Buried Power Rail（BPR）可釋放一條M1軌道

3. **PODE（Poly-On-Diffusion-Edge）效應**：
   - 邊緣的dummy poly閘極需要特殊處理
   - 影響相鄰元件的性能

4. **局部互連（Local Interconnect）**：
   - 使用M0（或MINT, Middle-of-Line interconnect）連接閘極到源/汲極
   - M0的電阻高，影響時序

5. **EDA對策**：
   - Pin-aware placement：佈局時考慮pin的可連接性
   - Pin access optimization：在legalization時確保所有pin可被繞線到達
   - Multi-height cell mixing：混用不同高度元件

**答案**：(a) CPP為閘極間距，MMP為金屬間距，面積∝CPP×tracks×MMP。(b) Track height從9T降至5T以縮小面積，但犧牲繞線資源和pin可及性。(c) 離散驅動力、pin accessibility、PODE效應和局部互連電阻是主要挑戰。

**延伸思考**：TSMC N2引入背面電源軌（Backside Power Rail），將VDD/VSS從正面移到背面，可釋放1-2條M1軌道。這讓5T或甚至4T元件成為可能，同時改善pin accessibility。這是製程-設計-EDA三方協同創新的典範。

---
### 題目 47：SADP/SAQP的顏色分配問題
**來源**：台大電機 / EDA研究
**難度**：★★★★★
**主題**：DFM / EDA

**題目**：
在SADP（Self-Aligned Double Patterning）中，某些金屬圖案需要被分配到不同的「顏色」（即不同的光罩）。

(a) 將SADP的顏色分配問題建模為圖論問題。何時會產生顏色衝突（coloring conflict）？
(b) 如何利用圖著色（Graph Coloring）來判斷一個佈局是否可用SADP實現？若不行，有哪些EDA解決方案？
(c) 在SAQP中，顏色分配的約束有何不同？

**詳解**：

**解題思路**：將微影約束轉化為圖論問題，分析其複雜度和解法。

**步驟**：

**(a) 圖論建模**：

**建模方法**：
- **節點**：每個金屬圖案（pattern/feature）
- **邊**：若兩個圖案之間的距離 < 最小可解析間距（minimum resolvable pitch），則加一條「衝突邊」
  - 這兩個圖案不能放在同一個光罩上
- **目標**：用2種顏色（2-coloring）對所有節點著色，使得相連節點顏色不同

**顏色衝突（Coloring Conflict）**：
- 當圖中存在**奇數長度環（odd cycle）**時，無法進行合法的2-著色
- 最簡單的情況：三角形（3個互相太近的圖案）

```
衝突範例（三個圖案互相太近）：
   A ── B
    \  /
     C
三角形：A-B-C-A 為奇數環(3)
無法用2色著色使相鄰不同色
```

**(b) 圖著色判斷與解決方案**：

**判斷方法**：
- 2-著色問題等價於判斷圖是否為**二部圖（bipartite graph）**
- 可用BFS/DFS在O(V+E)時間內判斷
- 若圖是二部的 → 可用SADP實現
- 若存在奇數環 → 有衝突，需要處理

**EDA解決方案**：

1. **Stitch Insertion（接縫插入）**：
   - 將一個圖案在某位置切斷（stitching point），分成兩段
   - 兩段可分配到不同顏色
   - 代價：接縫處的overlay誤差可能造成線寬不均

2. **Layout Modification（佈局修改）**：
   - 調整有衝突的圖案位置，增大間距使其不再衝突
   - 可能導致面積增加或繞線困難

3. **最小衝突著色（Min-conflict Coloring）**：
   - 允許少量衝突，但最小化衝突總數
   - 可建模為Integer Linear Programming（ILP）問題

4. **Color-aware Routing（著色感知繞線）**：
   - 在繞線階段就考慮顏色約束
   - 繞線器在選擇走線軌道時同時做顏色分配
   - 預防衝突而非事後修正

**(c) SAQP的顏色約束**：

SAQP生成4組圖案，但其約束與SADP不同：

在SAQP中：
- 最終圖案的位置由心軸圖案和間隔物沉積厚度**共同決定**
- 4組圖案中，只有2組是由微影定義（第一次心軸和cut mask），另2組是自對準生成
- 顏色分配的自由度更受限：相鄰圖案的顏色已被製程順序固定

```
SAQP的4種圖案（A, B, C, D）：
A  B  C  D  A  B  C  D  A  B  C  D
│  │  │  │  │  │  │  │  │  │  │  │
A和D來自第一次心軸
B和C來自第一次間隔物
二者的相對順序固定
```

SAQP的設計規則更嚴格：
- 只有特定的圖案組合是合法的
- Cut mask的位置約束更複雜
- EDA需要根據SAQP的製程規則來分解圖案

**答案**：(a) 距離過近的圖案建邊，2-著色判斷；奇數環造成衝突。(b) 用二部圖判斷，衝突可用stitch insertion或佈局修改解決。(c) SAQP的顏色由製程順序固定，設計規則更嚴格。

**延伸思考**：Multi-patterning的設計規則複雜度是驅動EDA創新的重要力量。TSMC和EDA公司的密切合作（如TSMC OIP生態系統）確保設計規則能被工具有效處理。隨著EUV取代部分多重曝光層，著色問題有所緩解，但EUV自身的隨機缺陷問題帶來了新的DFM挑戰。

---
### 題目 48：電遷移與互連可靠度
**來源**：台大電機 / TSMC面試
**難度**：★★★★
**主題**：互連可靠度

**題目**：
(a) 解釋電遷移（Electromigration, EM）的物理機制和Black方程。
(b) 在銅互連中，EM的主要擴散路徑為何？與鋁互連有何不同？
(c) 先進節點中EM問題如何加劇？有哪些應對策略？

**詳解**：

**解題思路**：從原子級的擴散機制出發，理解EM的物理本質和工程影響。

**步驟**：

**(a) 電遷移機制與Black方程**：

**物理機制**：
- 高密度電流通過金屬導線時，導電電子與金屬原子碰撞
- 電子的「電子風力（electron wind force）」驅動金屬原子沿電流方向移動
- 原子淨移動造成：
  - **上游**形成空洞（void）→ 開路（open circuit）
  - **下游**形成突出（hillock）→ 可能短路

**Black方程**（平均失效時間 MTTF）：

$$MTTF = \frac{A}{j^n} \exp\left(\frac{E_a}{k_B T}\right)$$

其中：
- A：與金屬結構相關的常數
- j：電流密度（A/cm²）
- n：電流密度指數（通常 n = 1-2）
- Ea：活化能，取決於擴散路徑（0.7-1.0 eV for Cu）
- kB：波茲曼常數
- T：絕對溫度

**關鍵觀察**：
- MTTF ∝ 1/j²（n=2時），電流密度加倍，壽命降為1/4
- MTTF隨溫度指數下降，升溫10°C可使壽命減半

**(b) Cu vs Al的EM擴散路徑**：

| 擴散路徑 | 鋁互連 | 銅互連 |
|---------|--------|--------|
| 晶界擴散（Grain Boundary） | 主要路徑 | 次要 |
| 表面/界面擴散（Interface） | 次要 | **主要路徑** |
| 體擴散（Bulk） | 可忽略 | 可忽略 |
| 活化能 | 0.5-0.7 eV | 0.7-1.0 eV |

銅互連的EM主要發生在：
- Cu與擴散阻障層（TaN/Ta）的界面
- Cu與蝕刻停止層（SiCN/SiN cap layer）的界面
- 這是因為銅的晶粒通常很大（跨越整個線寬），晶界擴散不重要

**改善方法**：
- 使用CuMn合金或Co cap layer改善Cu/cap界面黏附力
- 優化退火條件促進大晶粒竹節結構（bamboo structure）

**(c) 先進節點的EM挑戰**：

**問題加劇**：
1. 線寬縮小 → 截面積縮小 → 相同電流下j增大
   - 例：28nm M1寬度~60nm，3nm M1寬度~12nm，截面積縮小25倍
2. 電阻增加 → 需要更大電流來驅動信號
3. 溫度升高 → EM加速

**定量估計**：
- 28nm節點：允許電流密度 ~2 MA/cm²
- 3nm節點：金屬截面積縮小 → 需要將允許電流密度提高到 ~10 MA/cm²
- 但物理上EM可靠度已接近極限

**應對策略**：
1. **材料創新**：
   - 使用Co/Ru替代Cu（更好的EM抗性）
   - Co cap layer改善Cu/cap界面
   - 自成形阻障層（self-forming barrier）

2. **設計規則（EDA）**：
   - 嚴格的EM設計規則檢查（EM-aware DRC）
   - 線寬放寬（wider wires for power/clock）
   - 最大電流密度限制（per layer, per direction）

3. **電路技術**：
   - 功率網格優化（redundant power stripes）
   - 電流分散（多條並聯路徑）

4. **EDA工具**：
   - PrimeRail / Voltus IR-drop和EM分析
   - 在STA中加入EM-aware時序降級（aging model）

**答案**：(a) EM為電子風力驅動金屬原子遷移，MTTF = A/jⁿ·exp(Ea/kT)。(b) Cu互連以界面擴散為主，Al以晶界擴散為主。(c) 線寬縮小使j增大，需材料創新（Co/Ru）和嚴格的EDA EM規則。

**延伸思考**：EM可靠度分析正從確定性模型（single MTTF value）轉向統計模型（failure probability distribution），需要蒙地卡羅模擬。這對EDA的計算效率提出更高要求。

---
### 題目 49：製程變異與統計時序分析
**來源**：台大電機 / IC設計公司面試
**難度**：★★★★★
**主題**：DFM / 統計分析

**題目**：
(a) 解釋製程變異的分類：Die-to-Die（D2D）、Within-Die（WID / Intra-die）、Random（隨機）與Systematic（系統性）。
(b) 什麼是SSTA（Statistical Static Timing Analysis）？與傳統的Corner-based STA有何區別？
(c) 在OCV（On-Chip Variation）分析中，什麼是AOCV（Advanced OCV）和POCV（Parametric OCV）？為何比固定OCV derating更精確？

**詳解**：

**解題思路**：從變異的來源和統計特性出發，理解不同時序分析方法的精確度差異。

**步驟**：

**(a) 製程變異分類**：

**按空間範圍**：
| 類型 | 說明 | 來源 |
|------|------|------|
| Lot-to-Lot | 不同批次的晶圓間差異 | 機台狀態、材料批次 |
| Wafer-to-Wafer | 同批次不同晶圓間差異 | 晶圓位置、溫度均勻度 |
| Die-to-Die (D2D) | 同晶圓不同晶片間差異（全域變異） | 光罩均勻度、CMP |
| Within-Die (WID) | 同晶片內不同位置差異（局域變異） | 隨機摻質漲落(RDF)、LER |

**按特性分類**：
| 類型 | 說明 | 範例 |
|------|------|------|
| Systematic | 可預測、與佈局相關 | CMP密度效應、proximity效應 |
| Random | 不可預測、統計性質 | RDF、LER/LWR、隨機缺陷 |

**隨機變異的統計行為**：
- 單一元件的參數（如Vth）呈常態分佈
- σ(Vth) ∝ 1/√(W×L)（Pelgrom定律），元件越小變異越大
- 在先進FinFET中：σ(Vth) ∝ 1/√(N_fin × L_gate)

**(b) SSTA vs Corner-based STA**：

**Corner-based STA（傳統方法）**：
- 在預定義的PVT角落（corner）運行確定性STA
- 常用corners：SS/FF/TT/SF/FS（Slow/Fast NMOS, Slow/Fast PMOS）
- 每個corner代表一個極端情況
- 問題：
  - 所有元件同時取最壞值（過度悲觀）
  - 不考慮WID隨機變異的統計獨立性
  - 導致過度設計（over-design）10-20%

**SSTA（統計靜態時序分析）**：
- 將延遲表示為隨機變數（而非固定值）
- 考慮變異的空間相關性（correlation）
- 路徑延遲 = Σ各級延遲（隨機變數的和）
- 利用SSTA可得到：
  - 時序指標的機率分佈（而非單一值）
  - 良率預測：P(slack > 0) = ?
- 結果更精確，減少過度設計

**SSTA的挑戰**：
- 計算複雜度高（需處理隨機變數的max/min運算）
- 變異模型的建立需大量矽片數據
- 業界接受度逐漸提高，但尚未完全取代corner-based方法

**(c) AOCV和POCV**：

**固定OCV Derating**：
- 對所有元件施加相同的延遲裕度（如 ±5%）
- 過度悲觀：一條由100個閘組成的路徑不太可能100個閘都慢5%

**AOCV（Advanced OCV）**：
- 根據路徑的**邏輯深度（depth）**和**物理距離（distance）**調整OCV derating
- 邏輯深度越大 → 隨機變異傾向平均化（統計效應）→ derating減小
- 物理距離越近 → 系統變異相關性越高 → 也可減小derating
- 使用查表法（table-based）：derating = f(depth, distance)

**POCV（Parametric OCV）**：
- 更精確的統計模型
- 將延遲分解為名義值（nominal）+ 隨機分量（random component）
- 隨機分量用σ表示，路徑的總σ = √(Σσᵢ²)（假設獨立）
- 時序裕度 = N × σ_path（N為信心水準對應的標準差倍數，通常3σ）

$$t_{delay\_path} = \sum_{i} \mu_i + N \sqrt{\sum_{i} \sigma_i^2}$$

**精確度比較**：
- 固定OCV：所有路徑相同derating → 最悲觀
- AOCV：考慮depth/distance → 較精確
- POCV：統計模型 → 最精確，接近SSTA

**答案**：(a) 變異分為D2D/WID/Random/Systematic，隨機變異隨元件縮小增大。(b) SSTA用機率分佈表示延遲，比corner-based STA更精確、少過度設計。(c) AOCV按depth/distance調整derating，POCV用統計模型√Σσ²計算路徑變異，都比固定OCV精確。

**延伸思考**：在3nm及以下節點，隨機變異（RDF、LER）對時序的影響已超過系統變異。POCV/SSTA的採用已成為必然。同時，machine-learning-based timing prediction正在成為新的研究方向，用訓練模型取代部分SPICE模擬。

---
### 題目 50：先進製程節點對比（TSMC/Intel/Samsung）
**來源**：TSMC面試 / 業界常識
**難度**：★★★★
**主題**：製程對比

**題目**：
比較TSMC、Intel、Samsung在先進節點的製程技術，涵蓋7nm到2nm世代。

(a) 列出三家公司在「7nm」、「5nm」、「3nm」和「2nm」節點的實際閘極長度、金屬間距、電晶體密度等關鍵參數。
(b) 為何同樣標稱「3nm」的製程，三家公司的實際規格差異很大？「nm」標稱已失去物理意義？
(c) 在2nm世代，三家公司各自的技術路線（FinFET/GAA/Backside Power）有何異同？

**詳解**：

**解題思路**：綜合比較三家公司的公開數據，分析「nm」標稱與實際製程的脫節。

**步驟**：

**(a) 關鍵參數對比**：

**「7nm」世代（2018-2020量產）**：

| 參數 | TSMC N7 | Intel 7 (10nm ESF) | Samsung 7nm |
|------|---------|---------------------|-------------|
| 閘極長度 | ~17 nm | ~18 nm | ~16 nm |
| Fin Pitch | 30 nm | 34 nm | 27 nm |
| Gate Pitch | 54 nm | 54 nm | 54 nm |
| M1 Pitch | 40 nm | 36 nm | 36 nm |
| 密度(MTr/mm²) | ~91 | ~101 | ~95 |
| 電晶體類型 | FinFET | FinFET | FinFET |

**「5nm」世代（2020-2022）**：

| 參數 | TSMC N5 | Intel 4 | Samsung 5nm |
|------|---------|---------|-------------|
| Gate Pitch | 48 nm | 50 nm | 48 nm |
| M1 Pitch | 28 nm | 30 nm | 28 nm |
| 密度(MTr/mm²) | ~171 | ~160 | ~127 |

**「3nm」世代（2022-2024）**：

| 參數 | TSMC N3 | Intel 3 | Samsung 3nm |
|------|---------|---------|-------------|
| Gate Pitch | 48 nm | 48 nm | 45 nm |
| M1 Pitch | 23 nm | 24 nm | 25 nm |
| 密度(MTr/mm²) | ~292 | ~260 | ~230 |
| 電晶體類型 | FinFET | FinFET | **GAA（首家）** |

**「2nm」世代（2025-2026預期）**：

| 參數 | TSMC N2 | Intel 20A/18A | Samsung 2nm |
|------|---------|---------------|-------------|
| Gate Pitch | 48 nm | 44 nm | ~45 nm |
| M1 Pitch | 22 nm | 22 nm | ~22 nm |
| 密度(MTr/mm²) | ~340+ | ~350+ | ~300+ |
| 電晶體類型 | GAA | GAA | GAA |
| 背面供電 | N2P版本 | PowerVia(18A) | 待定 |

**(b) 「nm」標稱的意義**：

**「nm」已不代表任何物理尺寸**：
- 早期（0.5μm-90nm）：節點名稱 ≈ 閘極長度（half-pitch of DRAM或polysilicon gate length）
- 中期（65nm-28nm）：節點名稱 ≈ 半間距（half-pitch of M1 or gate）
- 現代（14nm以下）：節點名稱純為**行銷標稱**，與任何物理尺寸無直接對應

例如：TSMC「3nm」的閘極長度約12nm，金屬間距23nm，沒有任何3nm的尺寸。

**為何各公司數據不同**：
- 命名策略不同：Intel曾堅持較保守的命名（Intel 10nm ≈ TSMC 7nm），後改為Intel 7/4/3
- 密度計算方法不同：
  - TSMC/Samsung：使用業界標準公式（60% NAND + 40% scan flip-flop 的加權平均密度）
  - Intel：曾使用自家公式，後統一
- 同一標稱下的實際性能/功耗/密度差異顯著

**(c) 2nm世代的技術路線比較**：

| 技術 | TSMC N2 | Intel 18A | Samsung 2nm |
|------|---------|-----------|-------------|
| 電晶體 | GAA Nanosheet | GAA RibbonFET | GAA MBCFET |
| Nanosheet數 | 3 | 3-4 | 3 |
| 背面供電 | N2P（選配） | PowerVia（標配） | 開發中 |
| EUV層數 | ~25+ | ~20+ | ~25+ |
| High-NA EUV | A14（下一代） | Intel 14A（下一代） | 評估中 |
| 量產時間 | 2025 H2 | 2025 H1（預期） | 2025-2026 |

**差異重點**：
- Intel的PowerVia（背面供電）在18A節點即為標準配置，技術上領先
- TSMC將背面供電作為N2的可選升級版（N2P），為客戶提供靈活性
- Samsung在3nm首家量產GAA，但良率挑戰大
- 三家都在2nm採用GAA，但製程細節和良率差異大

**答案**：(a) 參數如上表。(b) 「nm」已是行銷標稱，與物理尺寸無關；各公司命名和密度計算方法不同。(c) 三家都在2nm轉向GAA，Intel率先標配背面供電，TSMC選配，Samsung追趕。

**延伸思考**：半導體製程的競爭已不僅限於電晶體微縮。TSMC的勝出很大程度靠先進封裝（CoWoS、SoIC）和穩定的大量產良率。未來的競爭維度包括：3D堆疊、光子互連（Photonic Interconnect）、以及與新型記憶體（如MRAM、RRAM）的異質整合。

---
## Part 6：封裝、測試與系統整合（題目 51–60）

---
### 題目 51：IC封裝技術比較
**來源**：台大電機 / TSMC面試
**難度**：★★★
**主題**：IC封裝

**題目**：
(a) 比較打線接合（Wire Bonding）與覆晶（Flip Chip）封裝的原理、優缺點與適用場景。
(b) 什麼是扇出型晶圓級封裝（Fan-Out WLP）？與傳統BGA封裝相比有何優勢？
(c) 解釋TSMC的InFO（Integrated Fan-Out）技術，並說明Apple的A系列晶片為何採用此技術。

**詳解**：

**解題思路**：從封裝的基本功能出發，比較不同技術的能力和適用範圍。

**步驟**：

**(a) Wire Bonding vs Flip Chip**：

| 特性 | Wire Bonding（打線接合） | Flip Chip（覆晶） |
|------|------------------------|-------------------|
| 連接方式 | 金屬細線（Au/Cu）從晶片pad連到基板 | 晶片翻轉，用焊球（solder bump）直接對接基板 |
| I/O分佈 | 只能從晶片邊緣引出（周邊排列） | 全面積陣列排列（area array） |
| I/O數量 | < 1000 | > 10,000 |
| 電氣性能 | 較差（長引線帶來電感） | 較佳（短連接、低電感） |
| 散熱 | 晶片正面朝上，背面可貼散熱片 | 晶片正面朝下，需底部填充（underfill） |
| 成本 | 低 | 高 |
| 適用場景 | 低成本IC、記憶體、低I/O | 高效能處理器、GPU、FPGA |
| 間距 | ≥35μm pad pitch | ≥100μm bump pitch（標準）/ ~40μm（micro-bump） |

**(b) Fan-Out WLP**：

**傳統WLP（Fan-In）**：重佈局線路（RDL）侷限在晶片面積內，I/O數受晶片面積限制。

**Fan-Out WLP**：
```
傳統Fan-In:          Fan-Out:
┌─────────┐       ┌───────────────┐
│ ┌─────┐ │       │   ┌─────┐     │
│ │ Die │ │       │   │ Die │     │
│ └─────┘ │       │   └─────┘     │
│ ○ ○ ○ ○ │       │ ○ ○ ○ ○ ○ ○  │
└─────────┘       │ ○ ○ ○ ○ ○ ○  │
                  └───────────────┘
                  ← RDL扇出到die外部 →
```

- 晶片被重新塑模（molding），在晶片周圍形成更大的面積
- RDL可扇出到晶片外部，不受晶片面積限制
- 不需要傳統基板（substrate-less），降低封裝厚度

**與BGA的比較**：

| 特性 | 傳統BGA | Fan-Out WLP |
|------|---------|-------------|
| 基板 | 需要有機基板 | 無基板（substrate-less） |
| 封裝厚度 | ~1.0-1.5 mm | ~0.4-0.6 mm |
| 電氣性能 | 有基板引入的寄生效應 | 更短的互連、更低寄生 |
| 成本 | 中等 | 中大量時有優勢 |
| 熱性能 | 中等 | 晶片直接暴露，散熱佳 |

**(c) TSMC InFO技術**：

TSMC的InFO（Integrated Fan-Out）是Fan-Out WLP的量產實現：

**InFO-PoP（Package on Package）**：
- 下層：邏輯晶片（SoC）使用InFO封裝
- 上層：DRAM堆疊封裝
- 兩層通過TMV（Through Mold Via）連接

**Apple A系列採用InFO的原因**：
1. **輕薄化**：比傳統FCBGA薄約20%，適合iPhone的空間限制
2. **電氣性能**：短RDL降低電感，改善電源完整性（power integrity）
3. **散熱**：晶片直接暴露在封裝表面，散熱效率高
4. **成本**：去除基板降低材料成本（大量生產下）
5. **整合度**：PoP結構可直接堆疊DRAM，縮小模組面積

**答案**：(a) Wire bonding低成本但I/O有限，Flip chip高性能但貴。(b) Fan-Out WLP無基板、更薄、RDL可扇出到die外。(c) InFO為TSMC的Fan-Out技術，Apple採用因薄型化、散熱和電氣性能優勢。

**延伸思考**：InFO技術已演進出多種變體：InFO-SoW（System on Wafer）、InFO-oS（on Substrate）等。TSMC的先進封裝已成為其業務的重要成長引擎，佔收入比例逐年增加。

---
### 題目 52：2.5D/3D封裝——CoWoS與TSV
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★
**主題**：先進封裝

**題目**：
(a) 解釋TSMC CoWoS（Chip on Wafer on Substrate）技術的結構與工作原理。
(b) 什麼是TSV（Through Silicon Via）？描述TSV的製程流程和關鍵參數。
(c) 比較2.5D（矽中介層 interposer）和3D IC（晶片堆疊）封裝的優缺點。
(d) CoWoS的最新演進（CoWoS-S, CoWoS-R, CoWoS-L）有何差異？

**詳解**：

**解題思路**：從多晶片整合的需求出發，理解2.5D/3D封裝的架構和製程挑戰。

**步驟**：

**(a) CoWoS結構**：

```
        ┌──────┐ ┌──────┐ ┌──────┐
        │ HBM  │ │ SoC  │ │ HBM  │  ← 多個晶片
        └──┬───┘ └──┬───┘ └──┬───┘
           │        │        │
  ═════════╪════════╪════════╪═════  ← micro-bump
  ┌────────┴────────┴────────┴────┐
  │         矽中介層(Si Interposer)│  ← 含TSV和RDL
  │         with TSV & RDL        │
  └───────────────┬───────────────┘
                  │                   ← C4 bump
  ┌───────────────┴───────────────┐
  │         有機基板(Substrate)     │
  └───────────────┬───────────────┘
                  │                   ← BGA球
              PCB主板
```

**工作原理**：
1. 多個晶片（如SoC + HBM DRAM）通過micro-bump接合到矽中介層上
2. 矽中介層上有精密的RDL互連，連接各晶片之間的信號
3. 矽中介層通過TSV將信號從正面傳到背面
4. 中介層背面通過C4 bump連接到有機基板
5. 基板再通過BGA球連到PCB

**優勢**：矽中介層可提供比有機基板更精細的互連（~1μm RDL pitch vs ~10μm）

**(b) TSV製程與參數**：

**TSV製程（via-middle approach）**：
1. 深反應離子蝕刻（DRIE/Bosch process）在矽中鑽孔
2. 沉積SiO₂絕緣層（PECVD或熱氧化）
3. 沉積擴散阻障層（TaN/Ta, PVD）
4. 沉積銅種子層（Cu seed, PVD）
5. 電鍍填銅（Cu ECP）
6. CMP平坦化
7. 晶圓薄化（背面研磨至TSV露出）
8. 背面RDL和bump形成

**關鍵參數**：

| 參數 | 典型值 | 影響 |
|------|--------|------|
| 直徑 | 5-10 μm | 越小→密度越高，但填充困難 |
| 深度 | 50-100 μm | 決定中介層/晶圓薄化厚度 |
| 深寬比 | 5:1 到 10:1 | 越高→蝕刻和填充越難 |
| 間距 | 20-50 μm | 決定I/O密度 |
| 電阻 | ~10-50 mΩ | 影響電壓降和信號品質 |
| 電容 | ~50-100 fF | 影響信號延遲和功耗 |

**(c) 2.5D vs 3D IC比較**：

| 特性 | 2.5D（矽中介層） | 3D IC（晶片堆疊） |
|------|------------------|-------------------|
| 結構 | 晶片並排放在中介層上 | 晶片上下堆疊，用TSV連接 |
| 互連密度 | 高（RDL精度高） | 極高（面對面TSV） |
| 散熱 | 較好（並排，熱不累積） | 較差（底層散熱困難） |
| 已知良好晶粒(KGD) | 各晶片可獨立測試 | 堆疊前需確認KGD |
| 製程複雜度 | 中等 | 極高（對準、薄化、堆疊） |
| 異質整合 | 容易（不同製程節點並排） | 較難（堆疊製程相容性） |
| 成本 | 中（中介層面積大） | 高（良率和製程風險） |
| 應用 | HPC（GPU+HBM）、AI | 3D NAND、DRAM堆疊 |

**(d) CoWoS演進**：

| 版本 | 中介層材料 | 特色 | 應用 |
|------|-----------|------|------|
| CoWoS-S | 矽（Si） | 原始版本，最精細互連，最大中介層面積~2500mm² | NVIDIA H100/H200 |
| CoWoS-R | RDL-based（有機中介層+矽橋） | 使用矽橋（Si bridge）連接晶片，成本較低 | 中階HPC |
| CoWoS-L | 局部矽中介層（Local Silicon Interconnect, LSI） | 矽橋嵌入有機RDL，兼顧精度和尺寸 | 超大尺寸設計 |

CoWoS-L是TSMC應對超大封裝尺寸（>3000mm²）需求的方案，用於NVIDIA的B100/B200等次世代GPU。

**答案**：(a) CoWoS將多晶片透過micro-bump接合到矽中介層，中介層有TSV和精細RDL。(b) TSV通過DRIE+絕緣+填銅製程，典型直徑5-10μm。(c) 2.5D散熱好且異質整合容易，3D密度高但散熱難。(d) CoWoS從純矽(S)演進到RDL-based(R)和局部矽橋(L)。

**延伸思考**：CoWoS的產能已成為限制AI晶片供應的瓶頸。TSMC正大幅擴建CoWoS產能（2024年月產能從~15K翻倍），但仍難以滿足NVIDIA、AMD、Google等客戶的需求。先進封裝的重要性已與先進製程比肩。

---
### 題目 53：Chiplet小晶片架構
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★
**主題**：系統整合

**題目**：
(a) 什麼是Chiplet架構？與傳統的單晶片SoC相比有何優勢？
(b) Chiplet之間的互連標準（Die-to-Die Interface）有哪些？比較UCIe與其他方案。
(c) 列舉採用Chiplet架構的商業產品，分析其設計取捨。

**詳解**：

**解題思路**：從摩爾定律放緩和晶片面積經濟學出發，理解Chiplet的必然趨勢。

**步驟**：

**(a) Chiplet架構與優勢**：

**Chiplet**：將傳統的大型SoC拆分為多個小晶片（chiplet），各chiplet可使用不同製程節點製造，再通過先進封裝（如CoWoS、EMIB、Foveros）整合為一個系統。

```
傳統SoC（單一晶片）：         Chiplet架構：
┌──────────────────┐       ┌────┐ ┌────┐ ┌────┐
│   CPU  GPU       │       │CPU │ │GPU │ │I/O │
│   I/O  Memory    │       │3nm │ │3nm │ │7nm │
│   Interface      │       └────┘ └────┘ └────┘
│   （全部同一製程）  │       ← 封裝在同一基板上 →
└──────────────────┘
```

**優勢**：

1. **良率提升**：
   - 大晶片（>600mm²）的良率極低（良率與面積呈指數遞減）
   - Y(大晶片) << Y(小chiplet)^n
   - 例：800mm² die在3nm的良率可能<30%，拆成4個200mm² chiplet良率可達>70%

2. **異質整合**：
   - CPU核心用最先進的3nm/2nm（速度/功耗）
   - I/O用成熟的7nm/12nm（成本/面積不敏感）
   - 記憶體用特殊製程（DRAM/HBM）
   - 不需要所有功能都用最貴的製程

3. **設計復用**：
   - 一個I/O chiplet可用在不同產品線
   - 減少設計和驗證時間

4. **可擴展性（Scalability）**：
   - 通過增減chiplet數量構建不同規模的產品
   - AMD EPYC的CCD(CPU)數量：8/12/16

**(b) Die-to-Die互連標準**：

| 標準 | 提出者 | 帶寬密度 | 延遲 | 間距 | 特點 |
|------|--------|---------|------|------|------|
| UCIe 1.0/2.0 | UCIe聯盟 | ~170 Gbps/mm | <2 ns | 25-55 μm | 開放標準，支持多封裝 |
| AMD Infinity Fabric | AMD | 高 | ~1-2 ns | 自定 | AMD EPYC/MI系列 |
| Intel EMIB | Intel | ~160 Gbps/mm | ~1 ns | 55 μm | 矽橋方案 |
| TSMC LIPINCON | TSMC | ~400 Gbps/mm | <1 ns | ~10 μm | 超高密度，CoWoS-S |
| BoW(Bunch of Wires) | OCP | 可變 | ~1 ns | 可變 | 開放標準，簡單 |

**UCIe（Universal Chiplet Interconnect Express）**：
- 由Intel、AMD、ARM、TSMC等共同制定的開放標準
- 支援2D（有機基板）和2.5D/3D（矽中介層）兩種模式
- 包含完整的協議棧：Physical Layer → Die-to-Die Adapter → Protocol Layer
- 支援PCIe和CXL協議的映射
- 目標：讓不同公司設計的chiplet可以互操作（interoperable）

**(c) 商業Chiplet產品**：

| 產品 | 公司 | 架構 | 設計取捨 |
|------|------|------|----------|
| EPYC / Ryzen | AMD | CCD(7nm/5nm) + IOD(14nm/6nm) | I/O用成熟製程降成本，CCD復用 |
| Ponte Vecchio | Intel | 47個chiplet，5種製程 | 極致異質整合但良率挑戰大 |
| M1 Ultra | Apple | 2個M1 Max透過UltraFusion連接 | 封裝級擴展性，帶寬高達2.5TB/s |
| MI300X | AMD | 3nm XCD + 5nm IOD + HBM3 | AI GPU的異質整合典範 |
| Meteor Lake | Intel | CPU(Intel 4)+GPU(TSMC N5)+SoC(TSMC N6)+IOE(TSMC N6) | 首次大規模採用Foveros 3D |

**設計取捨**：
- **帶寬 vs 功耗**：chiplet間互連需要大量I/O電路，增加功耗（~1-5 pJ/bit）
- **延遲**：chiplet間延遲 > 單晶片內延遲（~1-5ns vs ~0.1ns），需軟體/架構配合
- **成本**：封裝成本增加，但整體（製造+封裝）成本可能更低
- **測試複雜度**：需要KGD（Known Good Die）測試，增加測試成本

**答案**：(a) Chiplet拆分SoC為多小晶片，優勢為良率提升、異質整合、設計復用。(b) UCIe是開放互連標準，支持多封裝類型。(c) AMD EPYC和Apple M1 Ultra是成功案例，取捨在於帶寬/延遲/成本的平衡。

**延伸思考**：Chiplet架構正從高性能計算擴展到邊緣運算和物聯網。DARPA的CHIPS計畫推動了美國國防用的chiplet生態系統。未來，chiplet的「IP商店」可能像軟體的App Store一樣，不同公司設計的chiplet可以自由組合。

---
### 題目 54：掃描鏈設計與DFT
**來源**：台大電機 / IC設計公司面試
**難度**：★★★
**主題**：可測試性設計（DFT）

**題目**：
(a) 解釋掃描鏈（Scan Chain）設計的原理。普通暫存器如何改為掃描暫存器（Scan Flip-Flop）？
(b) 一個設計有10,000個掃描暫存器，分成20條掃描鏈。測試向量的載入和卸載需要多少時脈週期？
(c) 什麼是壓縮掃描（Compressed Scan / CODEC）？如何減少測試時間？

**詳解**：

**解題思路**：從測試的基本問題出發，理解掃描設計如何將時序電路問題轉化為組合電路問題。

**步驟**：

**(a) 掃描鏈原理**：

**問題**：時序電路的內部狀態（暫存器值）無法直接從外部控制和觀察，使得測試非常困難。

**解決方案**：掃描設計在每個暫存器前加入多工器（MUX），使暫存器可在兩個模式間切換：

```
普通D Flip-Flop：          掃描Flip-Flop (SFF)：
                              SE ─┐
     D ──┤DFF├── Q              ┌─┤MUX├─┤DFF├── Q
          │                      │ │    │
         CLK                   D ─┘SI──┘
                                      CLK
                           SE=0: 正常模式 (D→Q)
                           SE=1: 掃描模式 (SI→Q)
```

**掃描模式操作**：
1. **掃描載入（Scan Shift-In）**：SE=1，所有掃描暫存器串聯成移位暫存器（shift register），從外部依序載入測試值
2. **捕捉（Capture）**：SE=0，施加一個時脈脈衝，組合邏輯的輸出被正常暫存器捕捉
3. **掃描卸載（Scan Shift-Out）**：SE=1，將暫存器中的值依序移出到外部比對

**核心概念**：掃描設計將時序電路的測試問題轉化為組合電路的測試問題——所有暫存器的值都可控制和觀察。

**(b) 測試時間計算**：

10,000個掃描暫存器，20條掃描鏈：
- 每條鏈長度 = 10,000 / 20 = 500個暫存器
- 載入一個測試向量需要 500 個shift時脈
- 捕捉需要 1 個時脈
- 卸載（同時載入下一個向量）需要 500 個shift時脈

**一個測試向量的時脈數 = 500（shift）+ 1（capture）= 501 個週期**

（注：卸載當前結果可與載入下一向量同時進行，因此不需額外500個週期）

若有N_patterns個測試向量，總時脈數 ≈ 500 + N_patterns × 501

**(c) 壓縮掃描（Compressed Scan）**：

**問題**：掃描鏈越長，shift時間越長，測試成本越高。現代SoC有數百萬個暫存器。

**壓縮掃描原理（如Synopsys DFTMAX / Cadence Modus）**：

```
                  ┌─── Chain 1（500 FF）───┐
Test Input ──→ 解壓縮器 ├─── Chain 2（500 FF）───┤ 壓縮器 ──→ Test Output
(少量pin)    (Decompressor) ├─── Chain 3（500 FF）───┤ (Compactor)  (少量pin)
                  ├─── Chain 4（500 FF）───┤
                  └─── ...（200條鏈）  ───┘
```

- **解壓縮器（Decompressor）**：用少量外部輸入（如4-8個pin）生成大量內部掃描鏈的輸入
  - 通常使用LFSR（線性回饋移位暫存器）或異或網路
  - 利用測試向量中大量的don't-care位元（通常>95%）

- **壓縮器（Compactor）**：將大量掃描鏈的輸出壓縮為少量外部輸出
  - 通常使用空間壓縮器（XOR tree）或時間壓縮器（MISR）
  - 少量資訊損失可接受（aliasing機率極低）

**壓縮比**：通常10x-100x
- 例：200條內部鏈，但只用4個外部輸入和4個外部輸出
- 每條鏈長度 = 10,000/200 = 50
- Shift時間 = 50（vs 壓縮前的500），**測試時間縮短10倍**

**答案**：(a) 在FF前加MUX實現正常/掃描模式切換，串成移位暫存器以控制和觀察內部狀態。(b) 每向量501個週期（500 shift + 1 capture）。(c) 壓縮掃描用解壓縮器/壓縮器增加內部鏈數、縮短鏈長，測試時間可縮短10-100倍。

**延伸思考**：現代SoC的DFT設計極其複雜，需要處理多時脈域、多電壓域、嵌入式記憶體BIST、JTAG整合等。DFT工程師在IC設計公司中是不可或缺的角色。自動化DFT插入工具（如Synopsys DFT Compiler）大幅簡化了流程。

---
### 題目 55：ATPG自動測試向量產生
**來源**：台大電機 / 經典題型
**難度**：★★★★
**主題**：測試

**題目**：
(a) 解釋D演算法（D-Algorithm）的基本概念：D表示法、敏化路徑（sensitized path）、正向推進（forward drive）與反向追溯（backward justification）。
(b) 對以下電路，使用PODEM或D演算法產生偵測「線f stuck-at-0（f s-a-0）」故障的測試向量。

```
   A ─┐
      ├─ AND ── e ─┐
   B ─┘              ├─ OR ── g（輸出）
   C ─┐              │
      ├─ AND ── f ──┘
   D ─┘
```

(c) 什麼是故障覆蓋率（Fault Coverage）？業界通常要求多少？不可測故障（untestable fault）有哪些類型？

**詳解**：

**解題思路**：用ATPG的系統化方法，先激活故障，再將故障效應傳播到輸出。

**步驟**：

**(a) D演算法基本概念**：

**D表示法**：
- 正常值 / 故障值
- D = 1/0（正常為1，故障為0）
- D' = 0/1（正常為0，故障為1）
- 0 = 0/0（兩者都是0）
- 1 = 1/1（兩者都是1）
- X = 未確定

**ATPG兩個主要任務**：

1. **故障激活（Fault Activation / Excitation）**：
   - 使故障點在正常電路和故障電路中產生不同值
   - 對s-a-0故障：需使該線在正常情況下為1（產生D）
   - 對s-a-1故障：需使該線在正常情況下為0（產生D'）

2. **故障傳播（Fault Propagation）**：
   - 將故障效應（D或D'）從故障點傳播到至少一個主要輸出（Primary Output）
   - 需要建立敏化路徑（sensitized path）
   - 沿路徑上的每個閘，設定非故障輸入為「非控制值」（non-controlling value）

**正向推進（Forward Drive / Implication）**：
- 從已確定的輸入值推算輸出值

**反向追溯（Backward Justification）**：
- 從需要的輸出值反推需要的輸入值

**(b) 產生 f s-a-0 的測試向量**：

```
   A ─┐
      ├─ AND ── e ─┐
   B ─┘              ├─ OR ── g
   C ─┐              │
      ├─ AND ── f ──┘
   D ─┘
```

**步驟**：

1. **激活故障**：f s-a-0 → 需使正常f = 1 → 產生 D 在 f 點
   - f = C AND D = 1 → **C = 1, D = 1**

2. **傳播故障到輸出g**：
   - g = e OR f
   - f 上有 D，需傳播到 g
   - OR閘中，f 的 D 要傳播到 g，需 e 為非控制值（OR的控制值是1，非控制值是0）
   - 因此 **e = 0**

3. **反向追溯e**：
   - e = A AND B = 0 → A = 0 或 B = 0（任一為0即可）
   - 選擇 **A = 0**（B 為 don't care）

**測試向量**：**A = 0, B = X(任意), C = 1, D = 1**

**驗證**：
- 正常電路：f = 1∧1 = 1, e = 0∧B = 0, g = 0∨1 = **1**
- 故障電路：f = 0（s-a-0）, e = 0, g = 0∨0 = **0**
- g 正常=1，故障=0 → 可偵測！ ✓

**(c) 故障覆蓋率**：

**定義**：
$$FC = \frac{\text{可偵測的故障數}}{\text{總故障數} - \text{不可測故障數}} \times 100\%$$

**業界要求**：
- 一般數位IC：> 95%
- 高可靠度產品（汽車、醫療）：> 99%
- 最高要求：> 99.5%

**不可測故障類型**：

1. **冗餘故障（Redundant Fault）**：電路設計中存在冗餘邏輯，即使有此故障，輸出功能不變
2. **不可控故障（Uncontrollable）**：無法將故障點設定為激活值
3. **不可觀察故障（Unobservable）**：故障效應無法傳播到任何輸出
4. **被遮罩故障（Masked Fault）**：其他邏輯遮罩了故障效應
5. **不可達故障（Unreachable）**：在正常操作模式下不可能到達的邏輯狀態

**答案**：(a) D表示法區分正常/故障值，ATPG通過激活故障和敏化傳播路徑產生測試。(b) A=0, C=1, D=1（B任意）可偵測f s-a-0。(c) 覆蓋率通常要求>95-99%，不可測故障包括冗餘、不可控、不可觀察等。

**延伸思考**：現代ATPG工具（如Synopsys TetraMAX、Cadence Modus）不僅處理stuck-at故障，還處理transition fault（延遲故障）、bridging fault（橋接故障）、cell-aware fault等多種故障模型。在先進節點中，defect-oriented testing成為重要趨勢。

---
### 題目 56：BIST與JTAG
**來源**：台大電機 / IC設計公司面試
**難度**：★★★
**主題**：測試

**題目**：
(a) 什麼是BIST（Built-In Self-Test）？描述LFSR（Linear Feedback Shift Register）和MISR（Multiple Input Signature Register）在BIST中的角色。
(b) 什麼是JTAG（IEEE 1149.1 / Boundary Scan）？畫出TAP（Test Access Port）控制器的架構。
(c) 在先進SoC中，如何整合多種DFT技術（scan、BIST、JTAG、memory BIST）？

**詳解**：

**解題思路**：從內建測試的動機出發，理解各種測試結構的角色和整合方式。

**步驟**：

**(a) BIST原理**：

**BIST動機**：將測試功能內建到晶片中，減少對外部ATE（自動測試設備）的依賴。

```
BIST架構：
┌─────────────────────────────────────┐
│  ┌──────┐     ┌─────────┐    ┌──────┐│
│  │ LFSR │──→  │ CUT     │──→│ MISR ││
│  │(TPG) │     │(Circuit │    │(ORA) ││
│  └──────┘     │Under    │    └──────┘│
│               │Test)    │            │
│               └─────────┘    ┌──────┐│
│                              │比較器 ││
│                              └──────┘│
│                 BIST Controller      │
└─────────────────────────────────────┘
```

**LFSR（線性回饋移位暫存器）— 測試向量產生器（TPG）**：
- 用少量的硬體（n位暫存器 + XOR閘）產生偽隨機測試向量序列
- n位LFSR可產生長度為2ⁿ-1的最大長度序列
- 特徵多項式決定序列的統計特性
- 優點：硬體簡單、高速、向量多
- 缺點：偽隨機向量的故障覆蓋率通常只有90-95%（需加入確定性向量補充）

**MISR（多輸入簽章暫存器）— 輸出響應分析器（ORA）**：
- 將CUT的多個輸出壓縮為一個「簽章（signature）」
- 本質上是多輸入LFSR
- 測試結束後，比較最終簽章與預期的黃金簽章（golden signature）
- 若不同 → 有故障
- 別名率（aliasing probability）= 2⁻ⁿ（n位MISR），通常可忽略

**(b) JTAG（IEEE 1149.1 / Boundary Scan）**：

**目的**：提供標準化的測試存取介面，用於板級測試（board-level test）和晶片級debug。

**TAP（Test Access Port）介面**：
- **TCK**：測試時脈
- **TMS**：測試模式選擇（控制TAP狀態機）
- **TDI**：測試資料輸入
- **TDO**：測試資料輸出
- **TRST*（可選）**：測試重置

**TAP控制器狀態機**：16個狀態，由TMS控制：
```
                Test-Logic-Reset
                      │
                 Run-Test/Idle
                    /     \
          Select-DR-Scan  Select-IR-Scan
               │               │
          Capture-DR       Capture-IR
               │               │
           Shift-DR         Shift-IR
               │               │
           Exit1-DR         Exit1-IR
               │               │
           Pause-DR         Pause-IR
               │               │
           Exit2-DR         Exit2-IR
               │               │
           Update-DR        Update-IR
```

**Boundary Scan Cell**：在每個I/O pad和核心邏輯之間插入測試單元
- 正常模式：信號直通
- 測試模式：可控制I/O值（驅動）或觀察I/O值（捕捉）
- 所有Boundary Scan Cell串成一條移位暫存器（通過TDI→TDO）

**(c) DFT整合（DFT Architecture）**：

現代SoC的DFT整合：

```
┌─────────────────────────────────────────┐
│  JTAG TAP Controller                     │
│     │                                    │
│     ├── Boundary Scan Chain              │
│     │                                    │
│     ├── Instruction Register             │
│     │                                    │
│     ├── DFT Access Controller            │
│     │    │                               │
│     │    ├── Scan Chains (Compressed)    │
│     │    │    ├── Core 1 scan            │
│     │    │    ├── Core 2 scan            │
│     │    │    └── I/O scan               │
│     │    │                               │
│     │    ├── Memory BIST Controllers     │
│     │    │    ├── SRAM BIST              │
│     │    │    ├── ROM BIST               │
│     │    │    └── CAM BIST              │
│     │    │                               │
│     │    ├── Logic BIST                  │
│     │    │                               │
│     │    └── At-Speed Test Controller    │
│     │                                    │
│     └── Debug Access (e.g., ARM CoreSight)│
└─────────────────────────────────────────┘
```

**整合要點**：
- JTAG作為統一的測試存取入口
- 壓縮掃描處理邏輯測試
- Memory BIST獨立測試各嵌入式記憶體（SRAM March test）
- At-speed test controller實現高速捕捉（launch-on-shift / launch-on-capture）
- Debug功能（如ARM CoreSight）也通過JTAG存取

**答案**：(a) BIST用LFSR產生測試向量、MISR壓縮輸出為簽章。(b) JTAG提供標準4/5線測試介面，TAP控制器管理boundary scan和資料暫存器。(c) 現代SoC通過JTAG統一存取scan、BIST、debug等多種DFT結構。

**延伸思考**：IEEE 1687（IJTAG）是JTAG的擴展，提供更靈活的嵌入式儀器（embedded instrument）存取架構。在汽車IC（ISO 26262功能安全標準）中，online BIST和runtime testing已成為強制要求。

---
### 題目 57：良率分析與缺陷模型
**來源**：台大電機 / TSMC面試
**難度**：★★★★
**主題**：良率（Yield）

**題目**：
(a) 推導Poisson良率模型 Y = exp(-AD₀) 和負二項良率模型 Y = (1 + AD₀/α)^(-α)。解釋α參數的物理意義。
(b) 某晶片面積 A = 100 mm²，缺陷密度 D₀ = 0.1 defects/cm²，α = 2。分別用Poisson和負二項模型計算良率。
(c) 在先進節點中，良率損失的主要來源有哪些？如何從晶圓圖（Wafer Map）分析缺陷類型？

**詳解**：

**解題思路**：從缺陷的統計分佈出發，比較不同良率模型的假設和精確度。

**步驟**：

**(a) 良率模型推導**：

**Poisson模型**：
- 假設缺陷在晶圓上**均勻分佈**
- 平均缺陷數 λ = AD₀
- 晶片良好 ⟺ 晶片上零缺陷
- P(k=0) = e^(-λ)

$$Y_{Poisson} = e^{-AD_0}$$

**負二項模型（Murphy/Seeds）**：
- 缺陷密度**不均勻**，在晶圓的不同區域不同
- 假設D₀在不同位置服從Gamma分佈
- Gamma分佈的參數α（clustering parameter）反映缺陷的聚集程度

$$Y_{NB} = \left(1 + \frac{AD_0}{\alpha}\right)^{-\alpha}$$

**α的物理意義**：
- α → ∞：缺陷完全均勻分佈 → 退化為Poisson模型
- α → 0：缺陷高度聚集（少數晶片有大量缺陷，多數晶片無缺陷）→ 良率較高
- α = 1：缺陷分佈為指數分佈（Seeds模型）
- 典型值：α = 1-5（先進製程通常 α = 2-3）
- 較大的α表示更均勻的缺陷分佈（良率較低）

**(b) 良率計算**：

A = 100 mm² = 1 cm², D₀ = 0.1/cm², α = 2

**Poisson模型**：
$$Y_P = e^{-1 \times 0.1} = e^{-0.1} = 0.905 = 90.5\%$$

**負二項模型**：
$$Y_{NB} = \left(1 + \frac{1 \times 0.1}{2}\right)^{-2} = (1 + 0.05)^{-2} = (1.05)^{-2} = 0.907 = 90.7\%$$

兩者差異不大（因AD₀ = 0.1很小）。

若AD₀ = 1（大面積或高缺陷密度）：
- Poisson：Y = e⁻¹ = 36.8%
- 負二項（α=2）：Y = (1+0.5)⁻² = (1.5)⁻² = 44.4%

**AD₀越大，兩模型差異越大**。負二項模型因考慮缺陷聚集，預測的良率**高於**Poisson模型。這是因為缺陷聚集意味著部分晶片集中了大量缺陷（反正已壞），而其他區域的晶片缺陷少（更可能良好）。

**(c) 先進節點良率損失來源與晶圓圖分析**：

**良率損失主要來源**：

| 來源 | 說明 | 典型影響 |
|------|------|----------|
| 隨機粒子缺陷（Particle） | 空氣中或化學品中的微粒落在晶圓上 | 開路/短路 |
| 微影缺陷（Litho） | 光阻殘留、圖案缺失、橋接 | EUV隨機缺陷加劇 |
| CMP缺陷 | 刮傷（scratch）、殘留物 | 短路 |
| 蝕刻缺陷 | 蝕刻不完全或過蝕刻 | 短路/開路 |
| 參數偏移 | Vth、Idsat超出規格 | 功能正常但速度/功耗不達標 |
| 系統性缺陷 | 光罩缺陷、設備異常 | 重複性pattern |

**晶圓圖分析（Wafer Map Analysis）**：

```
良好的晶圓圖：           有問題的晶圓圖：
  ○○○○○○                 ○○○○○○
 ○○○○○○○○               ○○●●○○○○
○○○○○○○○○○             ○○●●●○○○○○
○○○○○○○○○○             ○○●●○○○○○○
 ○○○○○○○○               ○○○○○○○○
  ○○○○○○                 ○○○○○○
（均勻分散）              （聚集 → 系統性問題）

○ = 良好, ● = 不良
```

**Wafer Map Pattern分類**：
- **隨機散佈（Random）**：正常的隨機缺陷
- **環狀（Ring）**：CMP邊緣效應或CVD不均勻
- **扇形（Sector）**：光罩缺陷或特定reticle field問題
- **直線（Line）**：設備刮傷
- **聚集（Cluster）**：局部污染或特定設備問題
- **邊緣（Edge）**：晶圓邊緣製程不良

現代晶圓廠使用機器學習自動分類wafer map pattern，快速定位根因（root cause）。

**答案**：(a) Poisson假設均勻缺陷，負二項考慮聚集效應；α越小缺陷越聚集、良率越高。(b) Poisson: 90.5%, 負二項: 90.7%（AD₀小時差異不大）。(c) 主要損失來自微粒、微影、CMP缺陷等，wafer map pattern可定位系統性問題。

**延伸思考**：TSMC的良率管理系統（yield management system）整合了海量的製程數據、測試數據和wafer map，利用大數據分析和機器學習進行即時良率預測和根因分析。這是TSMC的核心競爭力之一。

---
### 題目 58：記憶體測試與March演算法
**來源**：台大電機 / IC設計公司面試
**難度**：★★★
**主題**：記憶體測試

**題目**：
(a) 列舉SRAM的主要故障類型（fault model）。
(b) 寫出March C-演算法的操作序列，並分析其能偵測哪些故障。
(c) 一個1MB的SRAM，使用March C-測試，時脈頻率為100MHz，需要多少測試時間？

**詳解**：

**解題思路**：從記憶體的故障分類出發，理解March測試的系統化方法。

**步驟**：

**(a) SRAM主要故障類型**：

| 故障類型 | 英文 | 說明 |
|---------|------|------|
| 固定故障 | Stuck-At Fault (SAF) | 記憶體格固定為0或1，不能寫入 |
| 轉態故障 | Transition Fault (TF) | 不能從0→1或1→0轉態 |
| 耦合故障 | Coupling Fault (CF) | 寫入某格會影響另一格的值 |
| 位址解碼故障 | Address Decoder Fault (AF) | 位址解碼錯誤，讀寫到錯誤位置 |
| 讀破壞故障 | Read Destructive Fault (RDF) | 讀取操作改變了該格的值 |
| 保持故障 | Data Retention Fault (DRF) | 資料在一段時間後消失 |
| 鄰域圖案敏感故障 | Neighborhood Pattern Sensitive Fault (NPSF) | 特定鄰居圖案才觸發的故障 |

**(b) March C- 演算法**：

March C- 是最常用的SRAM測試演算法之一：

```
March C-: {⇕(w0); ⇑(r0,w1); ⇑(r1,w0); ⇓(r0,w1); ⇓(r1,w0); ⇕(r0)}
```

符號說明：
- ⇑：地址遞增順序（ascending）
- ⇓：地址遞減順序（descending）
- ⇕：任意順序
- w0/w1：寫入0/1
- r0/r1：讀出並期望為0/1

**6個March元素**：
1. **⇕(w0)**：初始化所有位元為0
2. **⇑(r0,w1)**：遞增讀0、寫1 → 偵測SAF-0和TF(0→1)
3. **⇑(r1,w0)**：遞增讀1、寫0 → 偵測SAF-1和TF(1→0)
4. **⇓(r0,w1)**：遞減讀0、寫1 → 偵測CF（反方向耦合）
5. **⇓(r1,w0)**：遞減讀1、寫0 → 偵測CF（反方向耦合）
6. **⇕(r0)**：確認所有位元為0 → 最終驗證

**可偵測的故障**：
- ✓ Stuck-At Fault（SAF-0, SAF-1）
- ✓ Transition Fault（TF ↑, TF ↓）
- ✓ Idempotent Coupling Fault（CFid）
- ✓ Inversion Coupling Fault（CFinv）
- ✓ Address Decoder Fault（部分）
- ✗ Neighborhood Pattern Sensitive Fault（需更複雜的March）

**複雜度**：10n（n為記憶體大小，即位元數）

**(c) 測試時間計算**：

1MB = 2²⁰ bytes = 2²⁰ × 8 = 8,388,608 bits

March C- 操作數 = 10n = 10 × 8,388,608 = 83,886,080 次操作

時脈頻率 = 100 MHz → 每次操作1個時脈週期（10 ns）

$$t_{test} = \frac{83,886,080}{100 \times 10^6} = 0.839 \text{ s} \approx 0.84 \text{ s}$$

**測試時間 ≈ 0.84 秒**

（注：實際memory BIST可能以字（word）為單位操作而非位元，且可能有並行度，時間可能更短。）

**答案**：(a) SAF、TF、CF、AF、RDF等。(b) March C-有6個元素，複雜度10n，可偵測SAF/TF/CF。(c) 約0.84秒。

**延伸思考**：現代SoC可能包含數百個嵌入式SRAM，每個都需要獨立的memory BIST controller。TSMC提供的memory compiler會自動生成相應的BIST電路。在先進節點中，SRAM的variability增大（fin和nanosheet數量少），需要更嚴格的測試和更多的修復冗餘（repair redundancy）。

---
### 題目 59：信號完整性與電源完整性
**來源**：IC設計公司面試 / 經典題型
**難度**：★★★★
**主題**：封裝與系統整合

**題目**：
(a) 解釋信號完整性（Signal Integrity, SI）的三大問題：串擾（Crosstalk）、反射（Reflection）、同步切換雜訊（SSN, Simultaneous Switching Noise）。
(b) 在STA中，串擾如何影響時序？什麼是crosstalk delta delay和crosstalk glitch？
(c) 電源完整性（Power Integrity, PI）分析中，IR-drop的靜態和動態成分有何差異？如何用EDA工具分析？

**詳解**：

**解題思路**：從電磁學的角度理解信號和電源雜訊的來源，再討論EDA的分析方法。

**步驟**：

**(a) 信號完整性三大問題**：

**1. 串擾（Crosstalk）**：
- 相鄰平行走線之間的電容/電感耦合
- **耦合電容Cc**造成的影響：
  - 攻擊線（aggressor）切換時，在受害線（victim）上感應出雜訊
  - 同向切換：受害線延遲減少（加速效應）
  - 反向切換：受害線延遲增加（減速效應）
- Miller效應：反向切換時等效Cc加倍
- 隨著線間距縮小，串擾佔比增大

**2. 反射（Reflection）**：
- 當信號線的阻抗不連續時（如驅動端/負載端阻抗不匹配），信號波發生反射
- 反射係數 Γ = (ZL - Z0)/(ZL + Z0)
- 在高速信號（>GHz）中尤為嚴重
- 需要源端或終端的阻抗匹配（termination）

**3. 同步切換雜訊（SSN / Ground Bounce）**：
- 大量I/O或內部閘同時切換時，通過封裝引腳和鍵合線的電感L產生電壓降
- ΔV = L × di/dt
- 造成地面彈跳（ground bounce）或電源下垂（VDD droop）
- 嚴重時可導致邏輯錯誤

**(b) 串擾對時序的影響**：

**Crosstalk Delta Delay（串擾延遲變化）**：
- 攻擊線切換使受害線的信號變慢或變快
- **變慢（Slow-down）**：攻擊線反向切換 → 增加受害線延遲 → Setup violation風險
- **變快（Speed-up）**：攻擊線同向切換 → 減少受害線延遲 → Hold violation風險
- STA中需加入 crosstalk delta delay 修正

$$t_{delay,actual} = t_{delay,nominal} + \Delta t_{crosstalk}$$

**Crosstalk Glitch（串擾毛刺）**：
- 受害線處於穩態時，攻擊線的切換在受害線上感應出脈衝雜訊
- 若glitch幅度和寬度超過下游閘的切換閾值 → 邏輯錯誤
- 若glitch被暫存器捕捉 → 功能錯誤

EDA工具（如PrimeTime SI、Tempus SI）在STA中考慮串擾：
- 識別潛在的aggressor-victim對
- 分析最壞情況的delta delay
- 報告可能的glitch violation

**(c) IR-Drop分析**：

**靜態IR-Drop**：
- 所有元件以平均電流運行時的穩態電壓降
- V_drop = I_avg × R_network
- 主要取決於電源網格的電阻（R）和平均電流分佈
- 分析工具：RedHawk（Ansys）、Voltus（Cadence）

**動態IR-Drop**：
- 大量元件同時切換瞬間的暫態電壓降
- V_drop(t) = I(t) × R + L × dI/dt + 電荷分享效應
- 遠比靜態IR-drop嚴重（可達靜態的3-5倍）
- 取決於切換活動率（activity）、時脈邊緣的時間對齊
- 需要向量驅動（vector-based）的時域模擬

**EDA分析方法**：
| 方法 | 精度 | 速度 | 應用 |
|------|------|------|------|
| 靜態分析 | 低（平均電流） | 快 | 早期評估 |
| VCD-based動態分析 | 高（真實向量） | 慢 | Sign-off |
| 統計動態分析 | 中等 | 中等 | 全域評估 |

**IR-Drop的影響**：
- 電壓降低 → 閘極延遲增加（∝ Vdd/(Vdd-Vth)²）
- 10% Vdd降低可能導致15-20%的延遲增加
- 嚴重的動態IR-drop可能導致暫存器的setup violation

**答案**：(a) 串擾（鄰線耦合）、反射（阻抗不匹配）、SSN（同時切換引起的電感雜訊）。(b) 串擾影響延遲（delta delay）和產生毛刺（glitch），STA需加入串擾修正。(c) 靜態IR-drop為穩態電阻降，動態IR-drop為暫態切換引起的電壓降，需VCD-based模擬分析。

**延伸思考**：在先進節點中，EM（電遷移）和IR-drop的分析需要與時序分析緊密結合。Voltage-aware STA考慮每個元件實際看到的電壓（而非理想Vdd），提供更精確的時序結果。這需要SI/PI和STA工具的深度整合。

---
### 題目 60：先進封裝的EDA挑戰與系統整合
**來源**：TSMC面試 / 業界前沿
**難度**：★★★★★
**主題**：系統整合與未來趨勢

**題目**：
(a) 2.5D/3D封裝對EDA工具帶來了哪些新挑戰？列出至少五個需要重大更新的EDA功能。
(b) 什麼是System Technology Co-Optimization（STCO）？它與傳統的DTCO（Design-Technology Co-Optimization）有何不同？
(c) 展望2030年的IC設計：從電晶體、互連、封裝到EDA，各方面最可能的技術路線為何？

**詳解**：

**解題思路**：從先進封裝的系統複雜度出發，分析EDA工具鏈需要的根本性變革，再展望未來趨勢。

**步驟**：

**(a) 2.5D/3D封裝的EDA挑戰**：

1. **多晶片協同設計（Multi-die Co-design）**：
   - 傳統EDA假設單晶片設計
   - 2.5D/3D需要跨晶片的時序分析、功率分析、信號完整性分析
   - 需要統一的設計資料庫和跨晶片網表

2. **熱分析與管理（Thermal Analysis）**：
   - 3D堆疊的下層晶片散熱困難
   - 需要精確的3D熱模擬（考慮TSV的散熱路徑）
   - 熱-電耦合分析：溫度影響電阻和元件性能
   - 工具需從2D擴展到真正的3D

3. **應力與翹曲分析（Stress & Warpage）**：
   - 不同材料的熱膨脹係數不同（CTE mismatch）
   - TSV周圍的應力影響附近的電晶體性能（mobility change）
   - 需要應力感知的SPICE模型和寄生提取

4. **跨晶片信號完整性（Cross-die SI/PI）**：
   - micro-bump和TSV的寄生參數建模
   - Die-to-die interface的信號品質驗證
   - 跨晶片的電源完整性（IR-drop through TSV/RDL）

5. **物理驗證的擴展（Physical Verification）**：
   - DRC/LVS需要跨晶片驗證
   - 新的設計規則（TSV keep-out zone、micro-bump placement rules）
   - Interposer的繞線DRC

6. **Chiplet互操作性驗證**：
   - 不同來源chiplet的介面相容性
   - 協議層和電氣層的共同驗證
   - 良率和可靠度的系統級分析

7. **設計空間探索（Architecture Exploration）**：
   - 如何劃分SoC為多個chiplet？
   - 哪些功能放在哪個製程節點？
   - 封裝方案選擇（2.5D vs 3D vs chiplet）

**(b) STCO vs DTCO**：

**DTCO（Design-Technology Co-Optimization）**：
- 在**電晶體和互連層面**協同優化設計規則和製程
- 例如：根據標準元件的佈局需求，調整fin pitch和metal pitch
- 參與者：製程工程師 + 標準元件設計師 + EDA工具開發者
- 範圍：單晶片內的前段（FEOL）和後段（BEOL）

**STCO（System Technology Co-Optimization）**：
- 在**系統和封裝層面**協同優化
- 將封裝技術（CoWoS、3D IC）、晶片劃分（chiplet partitioning）、互連技術（Die-to-die interface）納入最佳化範圍
- 考慮的因素：
  - 性能（頻寬、延遲）
  - 功耗（die-to-die I/O功耗）
  - 成本（不同製程節點的成本、封裝成本、測試成本）
  - 良率（各chiplet的良率、封裝良率）
  - 散熱（系統級熱設計功耗TDP）

```
DTCO範圍：            STCO範圍：
┌────────────┐       ┌──────────────────────┐
│ 電晶體      │       │ ┌────────────┐ ┌────┐│
│ 互連        │  ←→   │ │ Die 1(3nm) │ │HBM ││
│ 標準元件     │       │ └────────────┘ └────┘│
│ 設計規則     │       │    封裝(CoWoS)       │
└────────────┘       │    系統(PCB+散熱)    │
                     └──────────────────────┘
```

STCO是DTCO在系統層面的延伸，反映了先進節點中「系統級思維」的必要性。

**(c) 2030年IC技術展望**：

| 領域 | 2025年現狀 | 2030年預期 |
|------|-----------|-----------|
| **電晶體** | GAA Nanosheet（TSMC N2） | CFET（N/P垂直堆疊）、2D材料通道（MoS₂） |
| **閘極長度** | ~12 nm | ~8-10 nm |
| **互連** | Cu + Co/Ru（底層） | Ru/Mo全面取代Cu（底層）、光子互連（晶片間） |
| **BEOL** | ~15層金屬 | 背面互連 + 正面互連 ~20+層 |
| **微影** | EUV（NA=0.33） + EUVDP | High-NA EUV（NA=0.55）普及 |
| **封裝** | CoWoS-S/L、Foveros | 晶圓級3D堆疊、光子I/O |
| **設計方法** | RTL → GDS | AI驅動的自動設計、自然語言到電路 |
| **EDA** | 確定性工具 + ML輔助 | ML-native EDA、雲端原生設計 |
| **記憶體** | HBM3E、DDR5 | HBM4、CXL記憶體池、近記憶體計算 |
| **功率** | DVFS、power gating | 近閾值計算、能量收集 |

**EDA的未來方向**：
1. **ML-native工具**：機器學習不是輔助而是核心引擎（佈局、OPC、時序預測）
2. **雲端原生**：EDA工具原生運行在雲端，彈性計算資源
3. **自動化設計**：從規格到版圖的高度自動化（PPA目標→自動探索→最優設計）
4. **異質整合設計環境**：統一的多晶片、多製程、多封裝設計平台
5. **安全和隱私**：在雲端環境中保護設計智慧財產（IP）

**答案**：(a) 多晶片協同設計、3D熱分析、應力分析、跨晶片SI/PI、物理驗證擴展等。(b) DTCO在電晶體/互連級協同優化，STCO擴展到系統/封裝級。(c) 2030年預期CFET、High-NA EUV、3D堆疊封裝、ML-native EDA等技術成熟。

**延伸思考**：半導體產業正從「摩爾定律驅動的微縮」轉向「系統級整合驅動的創新」。TSMC的3DFabric（包含CoWoS、InFO、SoIC等）、Intel的Foveros和EMIB、以及開放標準UCIe，代表了這一轉變。EDA公司（Synopsys、Cadence、Siemens EDA）正在進行根本性的工具架構重新設計，以支援這個新時代的設計挑戰。未來的IC工程師需要同時具備電晶體、電路、封裝和系統的跨領域知識。

---

> **題庫完成**
> 本題庫涵蓋IC製程基礎（氧化、擴散、佈植、薄膜沉積）、微影與蝕刻、EDA邏輯合成與最佳化、EDA實體設計、先進製程與DFM、封裝測試與系統整合等六大領域共60題，從基礎到博士級難度，適用於台大電機所博士班資格考與IC設計公司/晶圓代工面試準備。
