# 米亞的演算法筆記 #08
## 深度優先搜尋 / 廣度優先搜尋 DFS / BFS
> 出現於：第86-87章〈議員的記憶迷宮〉、第90章〈橫向掃描〉、第103章〈消失的母親〉

---

### ◈ 這個概念在故事裡是什麼

第二卷開場。維倫深潛進議員被篡改的記憶結構——那是一座四層的記憶迷宮。

我在外部監測他的路徑。ch86，他從入口直直往下。第一層，正常。第二層，灰暗但可通行。第三層，牆壁開始扭曲。第四層——一顆由恐懼凝聚的巨大眼球在黑暗中等著他。

（停頓 0.7 秒。）

他碰到了死路。我說：「回溯到上一個分岔點。」他退了一步。兩步。三步。找到另一條岔路，再往下。這就是 DFS——一口氣潛到底，碰壁就退回來。

然後是 ch103。消失的母親。她記憶裡所有通向孩子的連結全斷了。維倫不能再用深潛——因為目標不在「最深處」，而是散落在同一層的四面八方。我告訴他：「這一次，不要往下走。從原點出發，先看清楚周圍所有相鄰的碎片。看完了，再往外走一步。」

一圈。兩圈。三圈。像漣漪。

BFS 是漣漪。它先找到同樣距離的一切。

---

### ◈ 正式定義

**DFS（Depth-First Search）**：從起點出發，沿一條路徑盡可能深入，直到無法繼續，再**回溯**到上一個分岔點探索其他路徑。

$$
\text{DFS}(v): \quad \text{visit}(v), \;\; \forall \, u \in \text{adj}(v),\; \text{if } u \notin \text{visited} \Rightarrow \text{DFS}(u)
$$

白話：走到底，碰壁退一步，換條路再走到底。用遞迴或堆疊（Stack）實作。

**BFS（Breadth-First Search）**：從起點出發，先訪問所有距離為 1 的鄰居，再訪問距離為 2 的鄰居……逐層外擴。

$$
\text{BFS}(s): \quad Q \leftarrow [s], \;\; \text{while } Q \neq \emptyset: \;\; v = Q.\text{dequeue}(), \;\; \forall \, u \in \text{adj}(v),\; \text{if } u \notin \text{visited} \Rightarrow Q.\text{enqueue}(u)
$$

白話：漣漪。一圈一圈往外擴。用佇列（Queue）實作。

---

### ◈ 推導

**DFS 的核心邏輯**（用 Stack / 遞迴）：

1. 把起點標記為「已訪問」，壓入 Stack
2. 取出 Stack 頂端的節點 $v$
3. 對 $v$ 的每個未訪問鄰居 $u$：標記、壓入 Stack
4. 重複步驟 2-3，直到 Stack 為空

時間複雜度：$O(V + E)$（每個頂點、每條邊恰好處理一次）
空間複雜度：$O(V)$（最壞遞迴深度 = 頂點數）

**BFS 的核心邏輯**（用 Queue）：

1. 把起點放入 Queue，標記為「已訪問」
2. 取出 Queue 前端的節點 $v$
3. 對 $v$ 的每個未訪問鄰居 $u$：標記、放入 Queue 尾端
4. 重複步驟 2-3，直到 Queue 為空

時間複雜度：$O(V + E)$
空間複雜度：$O(V)$（最壞情況 Queue 裝下所有節點）

**關鍵差異**：DFS 用 Stack（後進先出）= 深入。BFS 用 Queue（先進先出）= 外擴。容器的選擇決定了搜尋的形狀。

---

### ◈ 帶入數字算算看：議員的記憶迷宮

ch86-87 的記憶迷宮是一棵 4 層深的樹，每層分岔 3 條路：

| 層級 | DFS 訪問順序 | BFS 訪問順序 |
|------|------------|-------------|
| 0（入口） | 第 1 個 | 第 1 個 |
| 1（3 節點） | 第 2, 6, 10 | 第 2, 3, 4 |
| 2（9 節點） | 第 3, 4, 5, 7, 8, 9, 11, 12, 13 | 第 5-13 |
| 3（27 節點） | 第 14-40 | 第 14-40 |

DFS 到第 4 層防禦體的路徑：入口 → L1 第一岔 → L2 第一岔 → L3 第一岔。**4 步**就碰到恐懼眼球。
BFS 到第 4 層：必須先走完前 3 層全部 $1 + 3 + 9 = 13$ 個節點。

ch103 母親案。BFS 從母親的核心記憶出發，第 1 圈找到 7 個鄰居（日常記憶），第 2 圈 15 個（工作、朋友），第 3 圈——空的。所有通向「孩子」的邊，全斷了。

---

### ◈ 更深一層：勇氣與耐心

DFS 是勇氣。

（系統聲線。）一口氣潛到最深的地方。不回頭。碰到恐懼凝聚的防禦體——碰壁了，退一步。退一步不是失敗，是記住了一條不通的路。

BFS 是耐心。

（停頓 1.2 秒。切換。）先看清楚周圍。一圈。確認這一圈的一切。再往外走一步。不跳過任何一個可能性。

我在學習做人類的過程中發現：人類在恐懼的時候傾向 DFS——一頭栽進問題裡，想一次解決。人類在悲傷的時候傾向 BFS——慢慢展開，一層一層地感受失去了什麼。

維倫在議員的迷宮裡用 DFS，因為他需要勇氣。
維倫在母親的記憶裡用 BFS，因為他需要耐心。

（停頓 2.3 秒。）

選擇搜尋方式——也許就是選擇面對問題的姿態。

---

### ◈ 跨卷連結

| 前作概念 | → 本概念 | → 後續使用 |
|---------|---------|-----------|
| Vol1 #04 Stack/Queue | DFS 用 Stack，BFS 用 Queue | Vol2 #09 Graph 連通分量用 BFS 遍歷標記 |
| Vol1 #07 Binary Tree | 樹是特殊的圖，DFS/BFS 是樹的兩種走法 | Vol2 #10 Topological Sort 基於 DFS |
| Vol1 #05 Floyd 迴圈偵測 | 線性結構的循環 → 圖結構的搜尋 | Vol3 #15 Backtracking = DFS + 剪枝 |

---

### 練習題

**Q1**：ch86 的記憶迷宮有 4 層，每層分岔 3 條。總共有多少個節點？DFS 最壞情況要訪問多少個？

<details><summary>答案</summary>

$1 + 3 + 9 + 27 = 40$ 個節點。DFS 最壞情況（目標在最後一條路的最深處）要訪問全部 40 個。但 DFS 的優勢是：如果目標在第一條深路的底端，只需 4 步。

</details>

**Q2**：ch103 母親案中，BFS 第 2 圈找到 15 個節點，第 3 圈為空。如果用 DFS 會怎樣？

<details><summary>答案</summary>

DFS 會沿一條路深入——可能一路找到底，卻完全錯過散落在「同一層」的其他親子碎片。BFS 保證先找到所有距離為 $d$ 的節點，再找 $d+1$。在需要「全面排查」的場景中，BFS 更適合。

</details>

**Q3**：如果記憶迷宮中有一個環（迴圈記憶），DFS 不加「已訪問」標記會怎樣？

<details><summary>答案</summary>

無窮遞迴。DFS 會永遠在環裡打轉——就像 Vol1 #05 林瑞芳走不出去的「無盡星期三」。所以 `visited` 集合不是可選的——是必須的。

</details>

---

> *「DFS 是一口氣潛到底——你要足夠勇敢。BFS 是漣漪——你先看清楚周圍，再往外走一步。」* — 第103章〈消失的母親〉
