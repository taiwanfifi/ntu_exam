# 第一章：基礎機率與計數方法

> 台大機率統計教學講義
> 本章目標：打好機率論的地基——從樣本空間到計數原理，再到容斥原理。

---

## 1. 樣本空間、事件與機率公設

### 1.1 樣本空間（Sample Space）

**定義：** 一個隨機實驗所有可能結果的集合，記為 $\Omega$（或 $S$）。

口語來說，樣本空間就是「所有可能發生的事情列出來的清單」。

**例子：**
- 擲一顆骰子：$\Omega = \{1, 2, 3, 4, 5, 6\}$
- 擲一枚硬幣兩次：$\Omega = \{HH, HT, TH, TT\}$
- 測量燈泡壽命：$\Omega = [0, \infty)$（連續的樣本空間）

**重點：** 樣本空間的元素必須是**互斥**且**窮舉**的。也就是說，每次實驗恰好會發生其中一個結果，不會同時發生兩個，也不會發生不在清單上的事。

### 1.2 事件（Event）

**定義：** 樣本空間的一個子集合，記為 $A, B, C, \ldots$

口語來說，事件就是「我們關心的某些結果的集合」。

**例子（擲一顆骰子）：**
- 事件 $A$ = 「出現偶數」= $\{2, 4, 6\}$
- 事件 $B$ = 「出現大於 4 的數」= $\{5, 6\}$
- $A \cap B$ = 「出現偶數且大於 4」= $\{6\}$
- $A \cup B$ = 「出現偶數或大於 4」= $\{2, 4, 5, 6\}$
- $A^c$ = 「出現奇數」= $\{1, 3, 5\}$

**事件的運算：**

| 符號 | 意義 | 口語 |
|------|------|------|
| $A \cup B$ | A 或 B（聯集） | 至少有一個發生 |
| $A \cap B$ | A 且 B（交集） | 兩個同時發生 |
| $A^c$ | A 的補集 | A 沒有發生 |
| $A - B = A \cap B^c$ | 差集 | A 發生但 B 沒發生 |
| $A \subseteq B$ | A 是 B 的子集 | A 發生必然 B 也發生 |

### 1.3 σ-代數（σ-algebra）與事件空間

在嚴謹的機率論中，我們不是對所有子集都能定義機率的。我們需要一個「好的」事件集合，稱為 σ-代數 $\mathcal{F}$。

**定義：** $\mathcal{F}$ 是 $\Omega$ 的子集所構成的集合，滿足：
1. $\Omega \in \mathcal{F}$（全集在裡面）
2. 若 $A \in \mathcal{F}$，則 $A^c \in \mathcal{F}$（對補集封閉）
3. 若 $A_1, A_2, \ldots \in \mathcal{F}$，則 $\bigcup_{i=1}^{\infty} A_i \in \mathcal{F}$（對可數聯集封閉）

**為什麼需要 σ-代數？** 在有限或可數的樣本空間中，我們通常取 $\mathcal{F}$ = 所有子集的集合（冪集 $2^\Omega$），不會有問題。但在不可數（連續）的情況下，不是所有子集都能好好地定義機率（這和 Banach-Tarski 悖論有關），所以需要限制可測的事件。

對於考試來說，知道這個概念即可，重要的是下面的公設。

### 1.4 Kolmogorov 機率公設（Axioms of Probability）

**定義：** 機率是一個函數 $P: \mathcal{F} \to \mathbb{R}$，滿足以下三條公設：

**公設一（非負性）：** 對任意事件 $A \in \mathcal{F}$，
$$P(A) \geq 0$$

**公設二（正規化）：**
$$P(\Omega) = 1$$

**公設三（可數可加性）：** 若 $A_1, A_2, \ldots$ 是兩兩互斥的事件（即 $A_i \cap A_j = \emptyset$，$\forall i \neq j$），則
$$P\left(\bigcup_{i=1}^{\infty} A_i\right) = \sum_{i=1}^{\infty} P(A_i)$$

就這三條，整個機率論的大廈就建起來了。我們來看看能推導出什麼。

### 1.5 從公設推導重要性質

**性質 1：** $P(\emptyset) = 0$

**推導：**
令 $A_1 = \Omega$，$A_i = \emptyset$（$i \geq 2$）。
這些事件兩兩互斥（因為空集和任何集合的交集都是空集）。
而且 $\bigcup_{i=1}^{\infty} A_i = \Omega$。

由公設三：
$$P(\Omega) = P(A_1) + \sum_{i=2}^{\infty} P(A_i) = P(\Omega) + \sum_{i=2}^{\infty} P(\emptyset)$$

兩邊消去 $P(\Omega)$，得 $\sum_{i=2}^{\infty} P(\emptyset) = 0$。

因為 $P(\emptyset) \geq 0$（公設一），所以 $P(\emptyset) = 0$。$\blacksquare$

---

**性質 2（補集規則）：** $P(A^c) = 1 - P(A)$

**推導：**
$A$ 和 $A^c$ 互斥，且 $A \cup A^c = \Omega$。

由公設三：$P(\Omega) = P(A) + P(A^c)$。

由公設二：$1 = P(A) + P(A^c)$。

因此 $P(A^c) = 1 - P(A)$。$\blacksquare$

**直接推論：** $0 \leq P(A) \leq 1$（因為 $P(A^c) \geq 0$ 推出 $P(A) \leq 1$，加上公設一的 $P(A) \geq 0$）。

---

**性質 3（加法規則）：** $P(A \cup B) = P(A) + P(B) - P(A \cap B)$

**推導：**
注意到 $A \cup B$ 可以分解成三個互斥的部分：
$$A \cup B = (A \cap B^c) \cup (A \cap B) \cup (A^c \cap B)$$

同樣地：
- $A = (A \cap B^c) \cup (A \cap B)$，所以 $P(A) = P(A \cap B^c) + P(A \cap B)$
- $B = (A^c \cap B) \cup (A \cap B)$，所以 $P(B) = P(A^c \cap B) + P(A \cap B)$

因此：
$$P(A) + P(B) = P(A \cap B^c) + P(A^c \cap B) + 2P(A \cap B)$$

而：
$$P(A \cup B) = P(A \cap B^c) + P(A^c \cap B) + P(A \cap B)$$

兩式相減：
$$P(A) + P(B) - P(A \cup B) = P(A \cap B)$$

移項得：
$$P(A \cup B) = P(A) + P(B) - P(A \cap B) \quad \blacksquare$$

---

**性質 4（單調性）：** 若 $A \subseteq B$，則 $P(A) \leq P(B)$

**推導：**
$B = A \cup (B \cap A^c)$，且 $A$ 和 $B \cap A^c$ 互斥。

所以 $P(B) = P(A) + P(B \cap A^c) \geq P(A)$（因為 $P(B \cap A^c) \geq 0$）。$\blacksquare$

---

**性質 5（Boole 不等式 / 聯合上界）：**
$$P\left(\bigcup_{i=1}^{n} A_i\right) \leq \sum_{i=1}^{n} P(A_i)$$

這在事件不互斥時很好用，作為一個快速的上界估計。

---

## 2. 計數方法

計數方法是計算古典機率的核心工具。很多同學在這裡犯錯，主要原因是分不清楚「有序/無序」和「可重複/不可重複」。

### 2.1 基本計數原理

**加法原理（Rule of Sum）：**

> 如果任務可以用方法 A 完成（有 $m$ 種方式）**或者**用方法 B 完成（有 $n$ 種方式），而且兩種方法**不會重疊**（沒有同時算到的），那麼總共有 $m + n$ 種方式。

**關鍵字：** 「或」、「分類」、「選其中一種」。

**例子：** 從台北到高雄，可以搭高鐵（3 班次）或搭飛機（2 班次），共 $3 + 2 = 5$ 種方式。

---

**乘法原理（Rule of Product）：**

> 如果一個任務需要先做步驟 1（有 $m$ 種方式）**然後**做步驟 2（有 $n$ 種方式），那麼總共有 $m \times n$ 種方式。

**關鍵字：** 「且」、「先...再...」、「連續步驟」。

**例子：** 密碼有兩位，第一位是英文字母（26 種），第二位是數字（10 種），共 $26 \times 10 = 260$ 種密碼。

---

**何時用加法？何時用乘法？**

| 情境 | 用哪個 | 理由 |
|------|--------|------|
| 兩個不同方法「擇一」完成任務 | 加法 | 分類 |
| 多個步驟「依序」完成任務 | 乘法 | 分步 |
| 「至少一個」的情境 | 通常補集法 | $P(\text{至少一個}) = 1 - P(\text{一個都沒有})$ |

### 2.2 排列（Permutation）

**定義：** 從 $n$ 個不同物件中，選出 $k$ 個排成一列（有序），方式數記為：
$$P(n, k) = \frac{n!}{(n-k)!}$$

**推導（用乘法原理）：**
- 第一個位置：$n$ 種選擇
- 第二個位置：$n - 1$ 種選擇（已選了一個）
- 第三個位置：$n - 2$ 種選擇
- ...
- 第 $k$ 個位置：$n - k + 1$ 種選擇

所以：
$$P(n, k) = n \cdot (n-1) \cdot (n-2) \cdots (n-k+1) = \frac{n!}{(n-k)!}$$

**特殊情況：**
- $P(n, n) = n!$（全排列）
- $P(n, 0) = 1$（什麼都不選，只有一種方式——「什麼都沒做」）
- $P(n, 1) = n$（只選一個，就是選哪個）

**有重複元素的排列：**

若 $n$ 個物件中，有 $n_1$ 個相同的 type 1、$n_2$ 個相同的 type 2、...、$n_r$ 個相同的 type r（$n_1 + n_2 + \cdots + n_r = n$），則全排列數為：
$$\frac{n!}{n_1! \cdot n_2! \cdots n_r!}$$

**例子：** MISSISSIPPI 有幾種排法？
- 共 11 個字母：M(1), I(4), S(4), P(2)
- 排法數 = $\frac{11!}{1! \cdot 4! \cdot 4! \cdot 2!} = \frac{39916800}{1 \cdot 24 \cdot 24 \cdot 2} = 34650$

### 2.3 組合（Combination）

**定義：** 從 $n$ 個不同物件中，選出 $k$ 個（不考慮順序），方式數記為：
$$\binom{n}{k} = C(n, k) = \frac{n!}{k!(n-k)!}$$

**推導（從排列出發）：**

排列 = 「先選出 $k$ 個（不管順序）」$\times$「再把選出的 $k$ 個排列」

$$P(n, k) = \binom{n}{k} \times k!$$

因此：
$$\binom{n}{k} = \frac{P(n, k)}{k!} = \frac{n!}{k!(n-k)!}$$

**重要性質：**

1. **對稱性：** $\binom{n}{k} = \binom{n}{n-k}$
   - 直觀：選 $k$ 個拿走 $\iff$ 選 $n-k$ 個留下

2. **Pascal 恆等式：** $\binom{n}{k} = \binom{n-1}{k-1} + \binom{n-1}{k}$
   - 直觀：考慮第 $n$ 個物件「選」或「不選」
   - 「選」：剩下 $n-1$ 個中再選 $k-1$ 個 → $\binom{n-1}{k-1}$
   - 「不選」：剩下 $n-1$ 個中選 $k$ 個 → $\binom{n-1}{k}$

3. **求和：** $\sum_{k=0}^{n} \binom{n}{k} = 2^n$
   - 直觀：每個物件「選」或「不選」，共 $2^n$ 種子集

4. **Vandermonde 恆等式：** $\binom{m+n}{k} = \sum_{j=0}^{k} \binom{m}{j}\binom{n}{k-j}$
   - 直觀：從 $m$ 男 $n$ 女中選 $k$ 人，枚舉選了 $j$ 個男生

### 2.4 多項式係數（Multinomial Coefficient）

**定義：** 將 $n$ 個物件分成 $r$ 組，各組大小為 $n_1, n_2, \ldots, n_r$（$\sum n_i = n$），分法數為：
$$\binom{n}{n_1, n_2, \ldots, n_r} = \frac{n!}{n_1! n_2! \cdots n_r!}$$

**推導：**
- 先從 $n$ 個中選 $n_1$ 個放第一組：$\binom{n}{n_1}$ 種
- 再從剩下 $n - n_1$ 個中選 $n_2$ 個放第二組：$\binom{n-n_1}{n_2}$ 種
- ...以此類推

$$\binom{n}{n_1} \cdot \binom{n-n_1}{n_2} \cdot \binom{n-n_1-n_2}{n_3} \cdots = \frac{n!}{n_1!(n-n_1)!} \cdot \frac{(n-n_1)!}{n_2!(n-n_1-n_2)!} \cdots$$

分子分母消一消，最後就得到 $\frac{n!}{n_1! n_2! \cdots n_r!}$。

**注意：** 組合是多項式係數的特殊情況（$r = 2$，分成「選的」和「沒選的」兩組）：
$$\binom{n}{k} = \binom{n}{k, n-k} = \frac{n!}{k!(n-k)!}$$

### 2.5 排列 vs 組合 速查比較

| | 排列 $P(n,k)$ | 組合 $\binom{n}{k}$ |
|---|---|---|
| 在意順序？ | **是** | **否** |
| 公式 | $\frac{n!}{(n-k)!}$ | $\frac{n!}{k!(n-k)!}$ |
| 數值大小 | 較大（差 $k!$ 倍） | 較小 |
| 典型問題 | 排名次、密碼、座位安排 | 委員會、抽樣、子集 |
| 關係 | $P(n,k) = \binom{n}{k} \cdot k!$ | $\binom{n}{k} = P(n,k) / k!$ |

**判斷口訣：** 問自己「交換兩個人的位置，算不算不同的結果？」
- 算 → 排列
- 不算 → 組合

---

## 3. 容斥原理（Inclusion-Exclusion Principle）

### 3.1 兩個事件的容斥

我們已經在性質 3 推導過：
$$P(A \cup B) = P(A) + P(B) - P(A \cap B)$$

直觀：$P(A) + P(B)$ 會把 $A \cap B$ 的部分算了兩次，所以要減掉一次。

### 3.2 三個事件的容斥

$$P(A \cup B \cup C) = P(A) + P(B) + P(C) - P(A \cap B) - P(A \cap C) - P(B \cap C) + P(A \cap B \cap C)$$

**推導：**

令 $D = B \cup C$，對 $A$ 和 $D$ 用兩事件容斥：
$$P(A \cup D) = P(A) + P(D) - P(A \cap D)$$

其中：
$$P(D) = P(B \cup C) = P(B) + P(C) - P(B \cap C)$$

$$P(A \cap D) = P(A \cap (B \cup C)) = P((A \cap B) \cup (A \cap C))$$
$$= P(A \cap B) + P(A \cap C) - P(A \cap B \cap A \cap C)$$
$$= P(A \cap B) + P(A \cap C) - P(A \cap B \cap C)$$

代入得：
$$P(A \cup B \cup C) = P(A) + [P(B) + P(C) - P(B \cap C)] - [P(A \cap B) + P(A \cap C) - P(A \cap B \cap C)]$$
$$= P(A) + P(B) + P(C) - P(A \cap B) - P(A \cap C) - P(B \cap C) + P(A \cap B \cap C) \quad \blacksquare$$

### 3.3 一般情況（n 個事件）

$$P\left(\bigcup_{i=1}^{n} A_i\right) = \sum_{i} P(A_i) - \sum_{i<j} P(A_i \cap A_j) + \sum_{i<j<k} P(A_i \cap A_j \cap A_k) - \cdots + (-1)^{n+1} P(A_1 \cap A_2 \cap \cdots \cap A_n)$$

也可以寫成：
$$P\left(\bigcup_{i=1}^{n} A_i\right) = \sum_{k=1}^{n} (-1)^{k+1} \sum_{1 \leq i_1 < i_2 < \cdots < i_k \leq n} P(A_{i_1} \cap A_{i_2} \cap \cdots \cap A_{i_k})$$

**符號加減的規律：** 加（1個的）、減（2個交集的）、加（3個交集的）、減（4個交集的）...交替進行。

### 3.4 經典應用：錯排問題（Derangement）

**問題：** $n$ 封信隨機放入 $n$ 個信封，至少有一封放對（信放到對應的信封）的機率是多少？

**設定：**
- 令 $A_i$ = 「第 $i$ 封信放對了」
- 要求 $P(A_1 \cup A_2 \cup \cdots \cup A_n)$

**關鍵計算：**

首先，$P(A_i) = \frac{(n-1)!}{n!} = \frac{1}{n}$
（第 $i$ 封固定對了，剩下 $n-1$ 封隨意排列，方法數 $(n-1)!$，全部排法 $n!$）

$P(A_i \cap A_j) = \frac{(n-2)!}{n!} = \frac{1}{n(n-1)}$
（第 $i, j$ 兩封都對了，剩下 $n-2$ 封隨意排列）

一般地，$k$ 封信都放對的機率：
$$P(A_{i_1} \cap A_{i_2} \cap \cdots \cap A_{i_k}) = \frac{(n-k)!}{n!}$$

而在 $k$ 個交集的求和中，有 $\binom{n}{k}$ 項（選哪 $k$ 封信放對），每項值相同。

所以：
$$\sum_{1 \leq i_1 < \cdots < i_k \leq n} P(A_{i_1} \cap \cdots \cap A_{i_k}) = \binom{n}{k} \cdot \frac{(n-k)!}{n!} = \frac{n!}{k!(n-k)!} \cdot \frac{(n-k)!}{n!} = \frac{1}{k!}$$

**代入容斥公式：**
$$P\left(\bigcup_{i=1}^{n} A_i\right) = \frac{1}{1!} - \frac{1}{2!} + \frac{1}{3!} - \cdots + (-1)^{n+1}\frac{1}{n!}$$
$$= \sum_{k=1}^{n} \frac{(-1)^{k+1}}{k!} = 1 - \sum_{k=0}^{n} \frac{(-1)^{k}}{k!}$$

等一下，讓我整理一下。我們知道 $e^{-1} = \sum_{k=0}^{\infty} \frac{(-1)^k}{k!}$，所以當 $n$ 大時：

$$P(\text{至少一封對}) \approx 1 - e^{-1} \approx 1 - 0.3679 = 0.6321$$

**「全部都沒放對」的機率（錯排的機率）：**
$$P(\text{全錯}) = 1 - P(\text{至少一封對}) = \sum_{k=0}^{n} \frac{(-1)^k}{k!} \approx e^{-1} \approx 0.3679$$

**錯排數：** $D_n = n! \sum_{k=0}^{n} \frac{(-1)^k}{k!}$

**驚人的事實：** 不管 $n$ 多大，全部放錯的機率都大約是 $1/e \approx 36.8\%$。這個結果收斂得非常快，$n = 5$ 時就已經非常接近了。

---

## 4. 古典機率模型

### 4.1 定義

當樣本空間是有限的，且每個樣本點發生的機率相等時（等可能性假設）：
$$P(A) = \frac{|A|}{|\Omega|} = \frac{\text{事件 A 包含的樣本點數}}{\text{樣本空間的總樣本點數}}$$

### 4.2 計算步驟

**Step 1：** 明確定義「實驗」是什麼，以及樣本空間 $\Omega$ 是什麼。

**Step 2：** 確認等可能性假設成立（每個樣本點等機率）。

**Step 3：** 計算 $|\Omega|$（用計數方法）。

**Step 4：** 定義事件 $A$，計算 $|A|$（用計數方法）。

**Step 5：** $P(A) = |A| / |\Omega|$。

**注意：** 很多時候最困難的是 Step 1——如何定義樣本空間使得等可能性成立。

---

## 5. 完整計算範例

### 範例 1：撲克牌問題

**問題：** 從一副 52 張撲克牌中隨機抽出 5 張，求抽到「恰好一對」（Full house 不算，只算 one pair）的機率。

**Step 1：** 樣本空間 = 從 52 張中選 5 張的所有組合。
$$|\Omega| = \binom{52}{5} = \frac{52!}{5! \cdot 47!} = 2598960$$

**Step 2：** 等可能性成立（隨機抽取）。

**Step 3：** 計算「恰好一對」的方法數。

「恰好一對」意思是：5 張牌中恰好有一個面值出現 2 次，其餘 3 張面值各不相同，且和那一對也不同。

分步計數：
- 選哪個面值成對：$\binom{13}{1} = 13$ 種
- 從該面值的 4 張中選 2 張：$\binom{4}{2} = 6$ 種
- 剩下 3 張來自其餘 12 個面值中的 3 個（且各取 1 張）：
  - 選 3 個面值：$\binom{12}{3} = 220$ 種
  - 每個面值選 1 張花色：$\binom{4}{1}^3 = 64$ 種

所以：
$$|A| = 13 \times 6 \times 220 \times 64 = 1098240$$

**Step 4：**
$$P(\text{恰好一對}) = \frac{1098240}{2598960} = \frac{1098240}{2598960} \approx 0.4226$$

大約 42.3%，差不多是最常見的牌型。

---

### 範例 2：生日問題

**問題：** 一個房間裡有 $k$ 個人，至少兩個人同一天生日的機率是多少？（假設一年 365 天，每天等可能）

**Step 1：** 樣本空間 = 每個人的生日可以是 1 到 365 的任意一天。
$$|\Omega| = 365^k$$

**Step 2：** 用補集法。先算「所有人生日都不同」的機率。

$$P(\text{全不同}) = \frac{365 \times 364 \times 363 \times \cdots \times (365 - k + 1)}{365^k} = \frac{P(365, k)}{365^k}$$

**Step 3：**
$$P(\text{至少兩人同天}) = 1 - P(\text{全不同}) = 1 - \frac{365!}{(365-k)! \cdot 365^k}$$

**數值計算（幾個有趣的值）：**

| $k$（人數） | $P(\text{至少兩人同天})$ |
|---|---|
| 10 | 0.1169 |
| 23 | 0.5073 |
| 30 | 0.7063 |
| 50 | 0.9704 |
| 70 | 0.9992 |

23 個人就超過 50%！這就是著名的「生日悖論」（Birthday Paradox）。

**為什麼 23 人就夠了？** 因為要比較的「配對數」是 $\binom{23}{2} = 253$，有 253 對要比較，而不是只有 23 次比較。

---

### 範例 3：隔板法（Stars and Bars）

**問題：** 將 10 個相同的球放入 4 個不同的箱子，每個箱子至少 1 個球，有幾種放法？

**方法：** 先每個箱子放 1 個球（保證至少 1 個），剩下 $10 - 4 = 6$ 個球自由分配到 4 個箱子。

等價問題：將 6 個相同球放入 4 個不同箱子（可以為空）。

想像 6 個球排成一列：○○○○○○

我們要插入 3 個隔板（因為 4 個箱子需要 3 個隔板）來分組。

球和隔板共 $6 + 3 = 9$ 個位置，選 3 個放隔板：
$$\binom{6 + 4 - 1}{4 - 1} = \binom{9}{3} = 84 \text{ 種}$$

**一般公式：**
- $n$ 個相同球放入 $k$ 個不同箱子，每箱至少 1 個：$\binom{n-1}{k-1}$
- $n$ 個相同球放入 $k$ 個不同箱子，可以為空：$\binom{n+k-1}{k-1}$

**原始問題的答案：** $\binom{10-1}{4-1} = \binom{9}{3} = 84$ 種。

---

### 範例 4：容斥原理的應用

**問題：** 1 到 1000 的正整數中，能被 3 或 5 或 7 整除的有多少個？

**設定：**
- $A$ = 被 3 整除的數，$|A| = \lfloor 1000/3 \rfloor = 333$
- $B$ = 被 5 整除的數，$|B| = \lfloor 1000/5 \rfloor = 200$
- $C$ = 被 7 整除的數，$|C| = \lfloor 1000/7 \rfloor = 142$
- $A \cap B$ = 被 15 整除的，$|A \cap B| = \lfloor 1000/15 \rfloor = 66$
- $A \cap C$ = 被 21 整除的，$|A \cap C| = \lfloor 1000/21 \rfloor = 47$
- $B \cap C$ = 被 35 整除的，$|B \cap C| = \lfloor 1000/35 \rfloor = 28$
- $A \cap B \cap C$ = 被 105 整除的，$|A \cap B \cap C| = \lfloor 1000/105 \rfloor = 9$

**容斥公式：**
$$|A \cup B \cup C| = 333 + 200 + 142 - 66 - 47 - 28 + 9 = 543$$

所以 1 到 1000 中，能被 3 或 5 或 7 整除的正整數有 **543** 個。

隨機選一個 1 到 1000 的數，被 3 或 5 或 7 整除的機率是 $543/1000 = 0.543$。

---

### 範例 5：分組問題

**問題：** 12 個學生分成 3 組，每組 4 人。

**情況 A：** 三組有標籤（A 組、B 組、C 組）
$$\frac{12!}{4! \cdot 4! \cdot 4!} = \binom{12}{4}\binom{8}{4}\binom{4}{4} = 495 \times 70 \times 1 = 34650$$

**情況 B：** 三組沒有標籤（只是分成三堆）
$$\frac{12!}{4! \cdot 4! \cdot 4! \cdot 3!} = \frac{34650}{6} = 5775$$

除以 $3!$ 是因為三組大小一樣、又沒有標籤，交換三組的順序不算不同。

**注意：** 如果組的大小不全相同（例如 5, 4, 3），就不需要除以 $3!$，因為大小不同的組本身就可以區分。但如果有兩組大小相同（例如 4, 4, 4 或 5, 5, 2），就要除以相同大小的組的排列數。

---

## 6. 常見陷阱與錯誤

### 陷阱 1：重複計算

**錯誤：** 「從 5 男 3 女中選 3 人的委員會，至少有 1 女的選法」

**錯誤解法：** 先選 1 女（3 種），再從剩下 7 人選 2 人 = $3 \times \binom{7}{2} = 63$。

**為什麼錯？** 如果選了女 A，再從剩下 7 人中選了女 B 和男 C，得到 {A, B, C}。但如果先選女 B，再從剩下 7 人中選了女 A 和男 C，也得到 {A, B, C}。同一個結果被算了兩次！

**正確解法（補集法）：**
$$\binom{8}{3} - \binom{5}{3} = 56 - 10 = 46$$

### 陷阱 2：忘記區分有序/無序

**問題：** 擲 2 顆骰子，點數和為 4 的機率。

**錯誤解法：** 和為 4 的組合是 (1,3) 和 (2,2)，共 2 種。全部組合是... ？

這裡的問題是：(1,3) 和 (3,1) 是同一個還是不同的？

**正確做法：** 要保持一致。最安全的方式是把兩顆骰子當成可區分的（比如一紅一藍）。

$$|\Omega| = 6 \times 6 = 36$$

和為 4 的結果：(1,3), (3,1), (2,2)，共 3 個。

$$P(\text{和為 4}) = \frac{3}{36} = \frac{1}{12}$$

### 陷阱 3：等可能性假設不成立

**問題：** 擲 2 顆骰子，樣本空間是什麼？

**錯誤：** $\Omega = \{2, 3, 4, \ldots, 12\}$，共 11 個結果。
→ 這 11 個結果不是等可能的！（和為 7 比和為 2 常見得多）

**正確：** $\Omega = \{(i, j) : i, j \in \{1,2,3,4,5,6\}\}$，共 36 個等可能結果。

### 陷阱 4：「至少」問題直接算

遇到「至少」的問題，直接正面算通常很麻煩。

**推薦策略：**
$$P(\text{至少一個}) = 1 - P(\text{一個都沒有})$$

**例子：** 擲 3 顆骰子，至少有 1 顆是 6 的機率。

- 直接算：恰好 1 顆 6 + 恰好 2 顆 6 + 3 顆都是 6 = $\binom{3}{1}\cdot 5^2 + \binom{3}{2}\cdot 5 + \binom{3}{3}$ ... 很囉嗦
- 補集法：$1 - P(\text{沒有 6}) = 1 - (5/6)^3 = 1 - 125/216 = 91/216 \approx 0.4213$

乾淨多了！

### 陷阱 5：分組問題忘記除以組的排列數

12 人分成 3 組（每組 4 人，無標籤）：
- **錯：** $\binom{12}{4}\binom{8}{4}\binom{4}{4} = 34650$（這是有標籤的答案）
- **對：** $34650 / 3! = 5775$

---

## 7. 概念整理與速查表

### 計數方法總結

| 情境 | 公式 | 有序？ | 可重複？ |
|------|------|--------|----------|
| $n$ 取 $k$ 排列 | $P(n,k) = \frac{n!}{(n-k)!}$ | 有序 | 不重複 |
| $n$ 取 $k$ 組合 | $\binom{n}{k} = \frac{n!}{k!(n-k)!}$ | 無序 | 不重複 |
| $n$ 取 $k$ 重複排列 | $n^k$ | 有序 | 可重複 |
| $n$ 取 $k$ 重複組合 | $\binom{n+k-1}{k}$ | 無序 | 可重複 |
| 有重複元素的全排列 | $\frac{n!}{n_1! n_2! \cdots n_r!}$ | 有序 | — |
| 多項式分組 | $\binom{n}{n_1, \ldots, n_r}$ | — | — |

### 容斥原理的項數

| 事件數 | 容斥公式的項數 |
|--------|--------------|
| 2 | $2 + 1 = 3$ 項 |
| 3 | $3 + 3 + 1 = 7$ 項 |
| $n$ | $\sum_{k=1}^{n}\binom{n}{k} = 2^n - 1$ 項 |

---

## 8. 練習建議

1. **先判斷有序/無序、可重複/不可重複**，再選擇計數方法。
2. **遇到「至少」就想補集法。**
3. **容斥原理在「至少一個滿足」的問題特別好用。**
4. **寫出樣本空間時，確認等可能性。**
5. **分組問題注意有沒有標籤。**

---

> 下一章：條件機率與貝氏定理
