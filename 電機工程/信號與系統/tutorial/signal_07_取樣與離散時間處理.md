# 信號與系統 第七章：取樣與離散時間處理

---

## 🔰 本章基礎觀念（零基礎必讀）

### 為什麼要取樣？

在現實世界中，聲音、溫度、電壓都是**連續時間信號**。但電腦只能處理**數字**（離散的數值），不能直接處理連續波形。

> **取樣（Sampling）= 在固定間隔「拍照」，把連續信號變成一串數字。**

例如：CD 音質以每秒 44,100 次的速率取樣聲音（取樣率 44.1 kHz），每次取一個數字記錄當下的聲音振幅。

### 核心問題

取樣會丟掉「兩個取樣點之間」的資訊。那麼：

> **取樣後還能完美還原原始信號嗎？**

答案是：**可以，但有條件！** 這就是本章的主角——**取樣定理**。

### 日常比喻

想像一部電影是每秒 24 格畫面（取樣率 24 fps）。如果一個輪子轉得夠慢（低頻），24 fps 足以捕捉它的運動。但如果輪子轉得太快（高頻），24 fps 可能讓它看起來「往反方向轉」——這就是**混疊（Aliasing）**。

---

## 關鍵術語表

| 中文 | 英文 | 白話解釋 | 例子 |
|------|------|----------|------|
| 取樣 | Sampling | 以固定間隔取值 | 每秒取 44100 個樣本 |
| 取樣率 | Sampling rate (fs) | 每秒取幾個樣本 | fs = 44100 Hz |
| 取樣週期 | Sampling period (T) | 兩次取樣的時間間隔 | T = 1/fs |
| 奈奎斯特頻率 | Nyquist frequency | 取樣率的一半 fs/2 | 22050 Hz |
| 奈奎斯特率 | Nyquist rate | 信號最高頻率的兩倍 2fmax | 最低需要的取樣率 |
| 混疊 | Aliasing | 取樣不足造成高頻被誤認為低頻 | 車輪反轉效應 |
| 信號重建 | Reconstruction | 從離散樣本恢復連續信號 | D/A 轉換 |
| 過取樣 | Oversampling | 用比奈奎斯特率更高的速率取樣 | 降低混疊風險 |
| 降取樣 | Downsampling | 減少取樣點數 | 降低資料量 |
| A/D 轉換 | Analog-to-Digital | 連續→離散 | 麥克風收音 |
| D/A 轉換 | Digital-to-Analog | 離散→連續 | 喇叭播放 |
| ZOH | Zero-Order Hold | 零階保持，用階梯波近似 | 最簡單的重建方法 |
| DFT | Discrete Fourier Transform | 離散傅立葉轉換 | |
| FFT | Fast Fourier Transform | 快速傅立葉轉換（DFT 的快速算法）| |
| 抗混疊濾波器 | Anti-aliasing filter | 取樣前的低通濾波器 | |

---

## 一、取樣定理（Nyquist-Shannon Sampling Theorem）

### 1.1 理想取樣

用脈衝串 p(t) = Σ δ(t - nT) 對連續信號取樣：

$$x_s(t) = x(t) \cdot p(t) = \sum_{n=-\infty}^{\infty} x(nT) \, \delta(t - nT)$$

取樣後的信號 x_s(t) 是一串加權脈衝，權重就是原信號的取樣值 x(nT)。

### 1.2 取樣在頻域的效果

$$X_s(j\omega) = \frac{1}{T} \sum_{k=-\infty}^{\infty} X(j(\omega - k\omega_s))$$

其中 ω_s = 2π/T = 2πf_s 是取樣角頻率。

> **白話**：取樣後的頻譜 = 原頻譜每隔 ωs 複製一份，然後全部疊加。

```
原頻譜：       ___
           ___/ X \___
          /           \
    ──────────────────────→ ω
         -ωmax    ωmax

取樣後頻譜：
    ___       ___       ___       ___
___/ X \___  / X \___  / X \___  / X \___
   |       ||       ||       ||       |
───────────────────────────────────────→ ω
  -ωs     -ωmax   ωmax    ωs    2ωs
           ← 間隔 ωs →
```

### 1.3 取樣定理

> **定理（Nyquist-Shannon）**：
>
> 如果 x(t) 是**帶限信號**（最高頻率為 fmax），那麼當取樣率滿足：
>
> $$f_s \geq 2f_{max}$$
>
> 時，x(t) 可以從取樣值 {x(nT)} **完美重建**。

等價表述：取樣角頻率 ω_s ≥ 2ω_max。

- 2f_max 稱為**奈奎斯特率（Nyquist Rate）**：重建所需的最低取樣率
- f_s/2 稱為**奈奎斯特頻率（Nyquist Frequency）**：能正確表達的最高頻率

### 1.4 為什麼是 2 倍？（直覺解釋）

取樣後頻譜以 fs 為週期重複。如果 fs < 2fmax，相鄰的頻譜副本會**重疊**，造成混疊。

- fs ≥ 2fmax：副本之間有間隙，可以用低通濾波器分離出原始頻譜
- fs < 2fmax：副本重疊，無法分離 → **資訊永久丟失**

### 數值例題 1.1：取樣率決定

> **問題**：人類語音頻率範圍約 300 Hz ~ 3400 Hz。電話系統需要多高的取樣率？

**解答**：

最高頻率 fmax = 3400 Hz。

奈奎斯特率 = 2 × 3400 = 6800 Hz。

實際上電話系統使用 **fs = 8000 Hz**（略高於奈奎斯特率，留一些餘量）。

> 這就是為什麼電話的音質比 CD（44100 Hz）差——它只取樣了語音頻段。

### 數值例題 1.2：判斷是否會混疊

> **問題**：x(t) = cos(2π·1000·t) + cos(2π·6000·t)，以 fs = 8000 Hz 取樣。會有混疊嗎？

**解答**：

信號最高頻率 fmax = 6000 Hz。

奈奎斯特率 = 2 × 6000 = 12000 Hz。

但 fs = 8000 Hz < 12000 Hz → **會混疊！**

具體分析：
- 1000 Hz 分量：1000 < fs/2 = 4000 → 不受影響 ✓
- 6000 Hz 分量：6000 > 4000 → 混疊！
  - 混疊後的頻率 = |6000 - 8000| = **2000 Hz**
  - 原本的 6000 Hz 會被「偽裝」成 2000 Hz

取樣後「聽到」的是 cos(2π·1000·t) + cos(2π·2000·t)，跟原信號不同！

---

## 二、混疊（Aliasing）

### 2.1 混疊公式

取樣率 fs 下，頻率 f 的分量混疊後的表觀頻率：

$$f_{alias} = |f - k \cdot f_s|, \quad k \text{ 取使 } f_{alias} \leq f_s/2 \text{ 的最近整數}$$

### 2.2 如何防止混疊？

**方法 1：提高取樣率** → 成本增加

**方法 2：取樣前用「抗混疊濾波器」（Anti-Aliasing Filter）** → 實際上最常用

> 在 A/D 轉換之前，先用一個低通濾波器把高於 fs/2 的頻率濾掉，這樣取樣後就不會有混疊。

### 數值例題 2.1：混疊頻率計算

> **問題**：以 fs = 10 kHz 取樣 f = 13 kHz 的正弦波。取樣後看起來像幾 kHz 的正弦波？

**解答**：

f = 13 kHz，fs = 10 kHz。

f_alias = |13 - 10| = 3 kHz。再檢查：3 < fs/2 = 5 ✓

**答：看起來像 3 kHz 的正弦波。**

> 也可以用公式：13 kHz 在取樣後折疊到 |13 - 1×10| = 3 kHz。

---

## 三、信號重建（Reconstruction）

### 3.1 理想重建：sinc 內插

如果取樣定理被滿足，可以用理想低通濾波器完美重建：

$$x(t) = \sum_{n=-\infty}^{\infty} x[n] \cdot \text{sinc}\left(\frac{t - nT}{T}\right)$$

其中 sinc(x) = sin(πx)/(πx)。

> **每個取樣點「發射」一個 sinc 函數，所有 sinc 函數的加權和就是原始信號。**

在頻域，這等價於用截止頻率 ωs/2 的理想低通濾波器。

### 3.2 為什麼理想重建不可實現？

sinc 函數是**雙邊無限長**的（t 從 -∞ 到 ∞ 都有值），而且是**非因果**的。

所以理想重建只是理論上的完美方案，實際上需要用近似方法。

### 3.3 零階保持（Zero-Order Hold, ZOH）

$$x_{ZOH}(t) = x[n], \quad nT \leq t < (n+1)T$$

> 每個取樣值保持不變，直到下一個取樣點到來。產生的是**階梯波**。

ZOH 的頻率響應：

$$H_{ZOH}(j\omega) = T \cdot \text{sinc}\left(\frac{\omega T}{2\pi}\right) \cdot e^{-j\omega T/2}$$

> ZOH 是最簡單的重建方法，但會引入高頻失真（不是理想低通）。

### 3.4 一階保持（First-Order Hold）

在相鄰取樣點之間做**線性內插**，比 ZOH 更平滑。

### 數值例題 3.1：sinc 內插

> **問題**：x(t) = cos(2π·100·t) 以 fs = 400 Hz 取樣。寫出理想重建公式中前幾個取樣值。

**解答**：

T = 1/400 s = 0.0025 s。

取樣值：x[n] = x(nT) = cos(2π·100·n/400) = cos(πn/2)

- x[0] = cos(0) = 1
- x[1] = cos(π/2) = 0
- x[2] = cos(π) = -1
- x[3] = cos(3π/2) = 0
- x[4] = cos(2π) = 1（週期 = 4 個樣本）

重建：
$$x(t) = \sum_{n} x[n] \cdot \text{sinc}\left(\frac{t - nT}{T}\right)$$

$$= \cdots + 1 \cdot \text{sinc}(400t) + 0 + (-1) \cdot \text{sinc}(400t - 2) + 0 + 1 \cdot \text{sinc}(400t - 4) + \cdots$$

這些 sinc 函數的疊加最終會精確還原 cos(200πt)。

---

## 四、過取樣與降取樣

### 4.1 過取樣（Oversampling）

取樣率遠高於奈奎斯特率：fs >> 2fmax。

**好處**：
- 頻譜副本之間間隔更大，抗混疊濾波器更容易設計
- 提高信噪比（SNR）
- 用在音訊領域（如 192 kHz 取樣）

### 4.2 降取樣（Downsampling）

保留每第 M 個樣本，其餘丟棄。

$$y[n] = x[Mn]$$

> 降取樣會把有效取樣率降為 fs/M，可能造成混疊。所以降取樣前通常需要**先做低通濾波**（抗混疊濾波器又稱為 Decimation Filter）。

### 4.3 升取樣（Upsampling）

在原有樣本之間插入 L-1 個零值。

$$y[n] = \begin{cases} x[n/L], & n = 0, \pm L, \pm 2L, \ldots \\ 0, & \text{otherwise} \end{cases}$$

升取樣後需要接一個低通濾波器來「填補」零值（稱為 Interpolation Filter）。

### 數值例題 4.1：降取樣

> **問題**：x(t) 的最高頻率為 5 kHz，以 fs = 20 kHz 取樣得到 x[n]。如果對 x[n] 做 M=4 的降取樣，會有問題嗎？

**解答**：

降取樣後有效取樣率 = 20/4 = 5 kHz。

奈奎斯特率 = 2 × 5 = 10 kHz > 5 kHz → **會混疊！**

需要先把 x[n] 通過截止頻率 π/4（歸一化）的低通濾波器，把 5 kHz 以下但超過 fs/(2M) = 2.5 kHz 的分量濾掉，才能安全降取樣。

---

## 五、A/D 與 D/A 轉換流程

### 5.1 完整的數位信號處理流程

```
連續信號 x(t)
    ↓
[抗混疊低通濾波器] → 限制帶寬到 fs/2 以下
    ↓
[取樣器 (Sample)] → 以 T = 1/fs 間隔取值
    ↓
[量化器 (Quantizer)] → 把連續振幅映射到有限位元 (如 16 bit)
    ↓
離散數位信號 x[n]
    ↓
[數位信號處理 DSP] → 濾波、壓縮、加密等
    ↓
[D/A 轉換器] → 零階保持或內插
    ↓
[重建低通濾波器] → 平滑化
    ↓
連續信號 y(t)
```

### 5.2 量化（Quantization）

取樣只是離散了**時間**，量化是離散了**振幅**。

B 位元的量化器可以表示 2^B 個不同的電壓準位。

- CD 品質：16 bit → 2^16 = 65536 個準位 → 動態範圍約 96 dB
- 高解析音訊：24 bit → 2^24 ≈ 1600 萬個準位 → 動態範圍約 144 dB

量化誤差近似為均勻分布的雜訊，功率與位元數的關係：

$$\text{SNR} \approx 6.02B + 1.76 \text{ dB}$$

---

## 六、DFT 與 FFT 簡介

### 6.1 離散傅立葉轉換（DFT）

對長度為 N 的有限序列 x[n]（n = 0, 1, ..., N-1）：

$$X[k] = \sum_{n=0}^{N-1} x[n] \, e^{-j2\pi kn/N}, \quad k = 0, 1, \ldots, N-1$$

$$x[n] = \frac{1}{N} \sum_{k=0}^{N-1} X[k] \, e^{j2\pi kn/N}, \quad n = 0, 1, \ldots, N-1$$

> DFT 就是把 DTFS 應用在**有限長序列**上（把它當成週期 N 的週期延拓）。

### 6.2 DFT 的頻率解析度

$$\Delta f = \frac{f_s}{N}$$

- fs：取樣率
- N：DFT 的點數
- Δf：能分辨的最小頻率差

> **想看得更「細」？** 增加 N（更多取樣點）或降低 fs（前提是不混疊）。

### 6.3 快速傅立葉轉換（FFT）

FFT 不是新的轉換，而是 DFT 的**快速計算算法**。

| | DFT（直接計算）| FFT |
|--|---------------|-----|
| 運算量 | O(N²) | O(N log N) |
| N = 1024 | ~100 萬次運算 | ~1 萬次運算 |
| N = 1,000,000 | ~10¹² 次 | ~2×10⁷ 次 |

> FFT 讓即時頻譜分析成為可能，是數位信號處理的基石之一。

### 數值例題 6.1：DFT 計算

> **問題**：x[n] = {1, 2, 3, 4}（N = 4），求 X[0] 和 X[1]。

**解答**：

W = e^(-j2π/4) = e^(-jπ/2) = -j

**X[0]**：
$$X[0] = \sum_{n=0}^{3} x[n] \cdot W^{0} = 1 + 2 + 3 + 4 = 10$$

（k=0 就是所有值的和，即「直流分量」× N。）

**X[1]**：
$$X[1] = \sum_{n=0}^{3} x[n] \cdot W^{n} = 1 \cdot 1 + 2 \cdot(-j) + 3 \cdot(-1) + 4 \cdot(j)$$

$$= 1 - 2j - 3 + 4j = -2 + 2j$$

---

## 七、題型鑑別

| 看到什麼 | 用什麼方法 |
|----------|-----------|
| 「最低取樣率」 | 奈奎斯特率 = 2fmax |
| 「是否會混疊」 | 檢查 fs ≥ 2fmax |
| 「混疊後的頻率」 | f_alias = \|f - k·fs\|，取最近使 f_alias ≤ fs/2 的 k |
| 「畫取樣後頻譜」 | 原頻譜以 ωs 為週期重複 |
| 「重建信號」 | sinc 內插公式 |
| 「降取樣安全嗎？」 | 檢查降取樣後有效取樣率是否 ≥ 2fmax |
| 「DFT 頻率解析度」 | Δf = fs/N |
| 「量化位元 → SNR」 | SNR ≈ 6.02B + 1.76 dB |

---

## ✅ 自我檢測

### 問題 1
一個信號的頻率成分包含 100 Hz、500 Hz 和 2000 Hz。最低取樣率是多少？

<details>
<summary>點擊查看答案</summary>

最高頻率 fmax = 2000 Hz。

最低取樣率 = 奈奎斯特率 = 2 × 2000 = **4000 Hz**。

</details>

### 問題 2
以 fs = 1000 Hz 取樣 f = 1300 Hz 的正弦波。取樣後看起來像什麼頻率？

<details>
<summary>點擊查看答案</summary>

1300 Hz > fs/2 = 500 Hz → 會混疊。

f_alias = |1300 - 1000| = 300 Hz。

300 < 500 ✓

**看起來像 300 Hz 的正弦波。**

</details>

### 問題 3
CD 的取樣率 44100 Hz 是怎麼決定的？

<details>
<summary>點擊查看答案</summary>

人耳可聽範圍約 20 Hz ~ 20000 Hz。

最低取樣率 = 2 × 20000 = 40000 Hz。

44100 Hz > 40000 Hz，多出的部分是留給抗混疊濾波器的過渡帶（因為現實的濾波器不可能在 20000 Hz 突然完全截止）。

44100 這個具體數字的歷史原因：它可以整除 PAL(25 fps) 和 NTSC(30 fps) 視訊格式的相關參數，方便同步。

</details>

### 問題 4
如果 DFT 使用 N = 1024 點，取樣率 fs = 8000 Hz，頻率解析度是多少？

<details>
<summary>點擊查看答案</summary>

$$\Delta f = \frac{f_s}{N} = \frac{8000}{1024} \approx 7.81 \text{ Hz}$$

如果需要 1 Hz 的解析度，需要 N = 8000 點。

</details>

---

> **下一章預告**：最後一章將把前七章的知識融會貫通，介紹調變、濾波器設計等**實際應用**，並提供跨章節的綜合複習。
