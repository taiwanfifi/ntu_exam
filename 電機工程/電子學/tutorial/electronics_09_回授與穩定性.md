# 電子學（九）：回授與穩定性

## 🔰 本章基礎觀念（零基礎必讀）

### 什麼是回授？

**回授（Feedback）**就是把輸出的一部分「餵回」到輸入。

> **白話比喻**：想像你在洗澡調水溫。你先打開熱水（輸入），感覺水溫（輸出），如果太燙就轉小一點，太冷就轉大一點。你的手不斷根據水溫調整——這就是**負回授**。

### 正回授 vs 負回授

- **負回授（Negative Feedback）**：回授信號與輸入**相減** → 讓系統更穩定
- **正回授（Positive Feedback）**：回授信號與輸入**相加** → 讓系統不穩定（振盪器就是用正回授）

> **本章重點全部在負回授。** 負回授是類比電路設計的基石。

### 回授的基本方塊圖

```
         +    ε       ┌─────┐    vo
xs ──→ (Σ)────→│  A   │────→ 輸出
         -↑    └─────┘
          │    ┌─────┐
          └────│  β  │←───
               └─────┘
               回授網路
```

- A：開迴路增益（Open-loop Gain）
- β：回授因子（Feedback Factor）
- ε = xs - βvo：誤差信號
- Af = vo/xs = A/(1+Aβ)：**閉迴路增益**

---

## 一、負回授的基本公式

### 1.1 閉迴路增益

$$A_f = \frac{A}{1 + A\beta}$$

其中 **T = Aβ** 稱為**迴路增益（Loop Gain）**。

當 Aβ >> 1 時：

$$A_f \approx \frac{1}{\beta}$$

> **超級重要的結論**：在大迴路增益下，閉迴路增益只由回授網路 β 決定，與放大器增益 A 幾乎無關！

### 1.2 為什麼 β 更可靠？

β 通常由**精確的被動元件**（電阻）構成，而 A 取決於電晶體參數（gm, β等），受溫度和製程影響很大。

### 數值例題 9.1：閉迴路增益計算

> **題目**：放大器 A = 10000，回授因子 β = 0.01。求閉迴路增益 Af。
>
> **解答**：
> Af = A/(1 + Aβ) = 10000/(1 + 10000 × 0.01)
> = 10000/(1 + 100) = 10000/101 = **99.01**
>
> 若 A 變成 20000（翻倍）：
> Af = 20000/(1 + 200) = 20000/201 = **99.50**
>
> **A 翻倍，Af 只變了 0.5%！** 這就是負回授的穩定作用。
>
> 理想值：1/β = 1/0.01 = 100（非常接近 99.01）

---

## 二、負回授的四大好處

### 2.1 降低增益敏感度（Desensitization）

$$\frac{dA_f/A_f}{dA/A} = \frac{1}{1 + A\beta}$$

增益對 A 的變化敏感度降低了 (1+Aβ) 倍。

### 2.2 擴展頻寬（Bandwidth Extension）

若開迴路頻寬為 BW，閉迴路頻寬為：

$$BW_f = BW \times (1 + A\beta)$$

**頻寬擴大了 (1+Aβ) 倍！**

但增益從 A 降為 A/(1+Aβ)，所以：

$$A_f \times BW_f = A \times BW = GBW$$

**增益頻寬積不變！**

### 數值例題 9.2：頻寬擴展

> **題目**：開迴路增益 A = 1000，頻寬 BW = 100 kHz，β = 0.01。
> 求閉迴路增益和頻寬。
>
> **解答**：
> 1 + Aβ = 1 + 1000 × 0.01 = 11
> Af = 1000/11 = **90.9**
> BWf = 100k × 11 = **1.1 MHz**
>
> 驗證 GBW：
> 開迴路：1000 × 100k = 100 MHz
> 閉迴路：90.9 × 1.1M = 100 MHz ✓

### 2.3 降低非線性失真（Distortion Reduction）

失真降低為原來的 **1/(1+Aβ)** 倍。

### 2.4 改善輸入/輸出阻抗

根據回授類型不同，可以：
- **提高**或**降低**輸入阻抗
- **提高**或**降低**輸出阻抗

具體取決於回授架構（下一節詳述）。

### 數值例題 9.3：失真降低

> **題目**：放大器的開迴路 THD = 5%，A = 500，β = 0.02。求閉迴路 THD。
>
> **解答**：
> 1 + Aβ = 1 + 500 × 0.02 = 11
> THDf = THD/(1+Aβ) = 5%/11 = **0.45%**

---

## 三、四種回授架構

回授的分類取決於**取樣方式**（在輸出端取電壓還是電流）和**混合方式**（在輸入端用串聯還是並聯）。

### 3.1 分類表

| 架構名稱 | 取樣(輸出) | 混合(輸入) | 回授量 | 放大量 |
|---------|-----------|-----------|--------|--------|
| 串聯-並聯 | 電壓 | 串聯 | 電壓→電壓 | 電壓增益 Av |
| 並聯-串聯 | 電流 | 並聯 | 電流→電流 | 電流增益 Ai |
| 串聯-串聯 | 電流 | 串聯 | 電流→電壓 | 轉阻 Rm |
| 並聯-並聯 | 電壓 | 並聯 | 電壓→電流 | 轉導 Gm |

### 3.2 如何判斷回授類型？

**輸出端（取樣方式）**：
- 回授信號取自**輸出電壓**（與負載並聯）→ 電壓取樣（並聯取樣，Shunt）
- 回授信號取自**輸出電流**（與負載串聯）→ 電流取樣（串聯取樣，Series）

**輸入端（混合方式）**：
- 回授信號與輸入以**電壓方式串聯** → 串聯混合（Series）
- 回授信號與輸入以**電流方式並聯** → 並聯混合（Shunt）

> **簡記口訣**：
> - 輸入端看：回授信號接在**同一個節點**（電流加總）→ 並聯；接在**不同節點**（電壓加總）→ 串聯
> - 輸出端看：回授網路接在**輸出節點**（感測電壓）→ 電壓；回授網路串在**輸出迴路**（感測電流）→ 電流

### 3.3 對阻抗的影響

| 架構 | 輸入阻抗 | 輸出阻抗 |
|------|---------|---------|
| 串聯-並聯（電壓-電壓） | **增大** ×(1+Aβ) | **減小** /(1+Aβ) |
| 並聯-串聯（電流-電流） | **減小** /(1+Aβ) | **增大** ×(1+Aβ) |
| 串聯-串聯（電流-電壓） | **增大** ×(1+Aβ) | **增大** ×(1+Aβ) |
| 並聯-並聯（電壓-電流） | **減小** /(1+Aβ) | **減小** /(1+Aβ) |

> **記憶口訣**：
> - **串聯**混合 → 輸入阻抗**增大**
> - **並聯**混合 → 輸入阻抗**減小**
> - **電壓**取樣 → 輸出阻抗**減小**（穩壓）
> - **電流**取樣 → 輸出阻抗**增大**（穩流）

### 3.4 串聯-並聯回授的經典範例：反相放大器

**電路**：運算放大器 + R1（輸入）和 R2（回授）

$$\beta = \frac{R_1}{R_1 + R_2}$$

$$A_f = -\frac{R_2}{R_1} \quad (\text{當} \; A \to \infty)$$

### 數值例題 9.4：反相放大器的回授分析

> **題目**：運算放大器反相放大器，R1 = 1kΩ，R2 = 10kΩ，開迴路增益 A = 10⁵。
> 求 β、T、Af。
>
> **解答**：
> β = R1/(R1+R2) = 1k/11k = 0.0909
> T = Aβ = 10⁵ × 0.0909 = 9090
> Af = A/(1+Aβ) = 10⁵/9091 ≈ 11.0
>
> 理想值：1/β = 11.0（反相增益 = R2/R1 = 10，加上非反相的 1+R2/R1 = 11）
>
> **實際反相增益** = -(R2/R1) × [A/(1+Aβ)] × (1/A) × ... 精確分析較複雜
> 簡化：Af(反相) ≈ -R2/R1 = **-10**

### 數值例題 9.5：不同回授類型的阻抗影響

> **題目**：放大器的開迴路輸入阻抗 Ri = 10kΩ，輸出阻抗 Ro = 1kΩ。
> 迴路增益 T = Aβ = 100。
> 分別計算串聯-並聯回授和並聯-串聯回授的閉迴路阻抗。
>
> **解答**：
>
> **串聯-並聯**：
> Rif = Ri × (1+T) = 10k × 101 = **1.01 MΩ**（輸入阻抗增大）
> Rof = Ro/(1+T) = 1k/101 = **9.9 Ω**（輸出阻抗減小）
>
> **並聯-串聯**：
> Rif = Ri/(1+T) = 10k/101 = **99 Ω**（輸入阻抗減小）
> Rof = Ro × (1+T) = 1k × 101 = **101 kΩ**（輸出阻抗增大）

---

## 四、迴路增益的求法

### 4.1 直接法

斷開回授迴路，注入測試信號，量測回傳的信號：

$$T = A\beta$$

### 4.2 回傳比法（Return Ratio）

1. 將回授網路中受控源設為零
2. 在受控源的位置注入測試信號
3. 量測回傳到受控源控制端的信號
4. 回傳比 = 回傳信號/注入信號

---

## 五、穩定性分析

### 5.1 穩定性問題的來源

負回授在中頻是好的，但在高頻時放大器的相位移動可能使**負回授變成正回授**，導致振盪！

### 5.2 振盪的條件（Barkhausen 準則）

系統振盪的條件：

$$|A\beta| \geq 1 \quad \text{且} \quad \angle A\beta = -180°$$

也就是說：如果在某個頻率下，迴路增益的大小 ≥ 1 且相位 = -180°，系統就會振盪。

### 5.3 奈奎斯特穩定性準則（Nyquist Criterion）

在 Nyquist 圖（複數平面上 T(jω) 的軌跡）中：

**如果 T(jω) 的軌跡包圍 (-1, 0) 點，系統不穩定。**

### 5.4 相位邊限（Phase Margin, PM）

$$PM = 180° + \angle T(j\omega_{gc})$$

其中 ωgc 是**增益交越頻率**（|T| = 1 = 0dB 的頻率）。

**PM > 0° → 穩定**
**PM = 0° → 臨界穩定（振盪）**
**PM < 0° → 不穩定**

**工程設計目標**：PM ≥ 45°（一般），PM ≥ 60°（保守/高品質）

### 5.5 增益邊限（Gain Margin, GM）

$$GM = -20\log|T(j\omega_{pc})|$$

其中 ωpc 是**相位交越頻率**（∠T = -180° 的頻率）。

**GM > 0dB → 穩定**

**工程設計目標**：GM ≥ 10 dB

### 數值例題 9.6：穩定性判斷

> **題目**：回授放大器，在增益交越頻率 ωgc 處，∠T = -120°。
> 在相位交越頻率 ωpc 處，|T| = 0.1 = -20dB。
> 判斷穩定性。
>
> **解答**：
> PM = 180° + (-120°) = **60°** > 0° → 穩定 ✓
> GM = -20log(0.1) = **20 dB** > 0 → 穩定 ✓
>
> 這是一個相當穩定的系統（PM = 60° 很好）。

### 數值例題 9.7：不穩定的例子

> **題目**：三極點系統，每個極點在 fp1 = 1MHz，fp2 = 10MHz，fp3 = 100MHz。
> 直流迴路增益 T0 = 60dB = 1000。判斷穩定性。
>
> **解答**：
> 每個極點貢獻 -90° 的相位移和 -20dB/dec 的增益下降。
>
> 在 fp2 = 10MHz：
> |T| = 60 - 20log(10M/1M) - 0 = 60 - 20 = 40dB（因為 fp2 剛開始生效）
> 更精確：|T(f)| ≈ T0/(f/fp1) 在 fp1 和 fp2 之間
> |T(10M)| ≈ 1000/(10) = 100 → 40dB
>
> 相位在 10MHz：≈ -90°(fp1) - 45°(fp2) - 6°(fp3) ≈ -141°
>
> 增益交越（|T|=0dB）：大約在 fp1×T0^(1/2) ≈ 1M × 31.6 = 31.6MHz
>（因為兩個極點作用，增益以-40dB/dec下降）
>
> 在 31.6MHz 的相位：≈ -90° - arctan(31.6/10) - arctan(31.6/100)
> = -90° - 72.4° - 17.5° = **-179.9°**
>
> PM ≈ 180° - 179.9° = **0.1°** ← 幾乎不穩定！

---

## 六、補償技術（Compensation）

### 6.1 為什麼需要補償？

當放大器有多個極點時，高頻相位快速下降，可能導致 PM 不足而振盪。**補償就是人為修改頻率響應，確保穩定性。**

### 6.2 主極點補償（Dominant Pole Compensation）

**方法**：加一個低頻極點（例如加一個大電容），使第一個極點遠低於其他極點。

**效果**：在增益交越時只有一個極點起作用，相位移約 -90°，PM ≈ 90°。

**代價**：頻寬大幅降低。

### 6.3 米勒補償（Miller Compensation）

在放大器的**第二級跨接一個小電容 Cc**（利用米勒效應）。

**效果**：
1. 第一級的等效輸入電容增大 → 主極點頻率降低
2. 同時產生一個**右半平面零點**（需要處理）
3. 第二級極點被推高（pole splitting）

**處理右半平面零點**：
- 在 Cc 上串聯一個電阻 Rz
- 選擇 Rz ≈ 1/gm2 可以消除零點

### 數值例題 9.8：米勒補償設計

> **題目**：兩級放大器，gm1 = 1mS，gm2 = 5mS，
> 第一級輸出電阻 R1 = 100kΩ，寄生電容 C1 = 0.5pF。
> 第二級輸出電阻 R2 = 50kΩ，負載電容 CL = 5pF。
> 直流增益 = gm1R1 × gm2R2 = 100 × 250 = 25000。
>
> 不補償時兩個極點：
> fp1 = 1/(2πR1C1) = 3.18 MHz
> fp2 = 1/(2πR2CL) = 636 kHz
>
> 這不穩定（fp2 < fp1，兩個極點靠得太近）。
> 加入 Cc = 2pF 做米勒補償，求新的極點位置。
>
> **解答**：
> 米勒補償後（極點分離）：
>
> 新的主極點：
> fp1' = 1/(2π × R1 × gm2 × R2 × Cc)
> = 1/(2π × 100k × 250 × 2p)
> = 1/(2π × 50μ)
> = **3.18 kHz**
>
> 新的第二極點：
> fp2' = gm2Cc/(2π × C1 × CL)（近似）
> = 5m × 2p/(2π × 0.5p × 5p)
> = 10 × 10⁻¹⁵/(2π × 2.5 × 10⁻²⁴)
>
> 這個數值不太對，讓我用更標準的公式：
> fp2' ≈ gm2/(2πCL) = 5m/(2π × 5p) = **159 MHz**
>
> 極點分離：主極點從 636kHz 降到 3.18kHz，第二極點從 3.18MHz 推到 159MHz。
> 增益交越頻率 ≈ gm1/(2πCc) = 1m/(2π×2p) = **79.6 MHz**
>
> PM ≈ 90° - arctan(79.6/159) = 90° - 26.6° = **63.4°** ✓ 穩定

---

## 七、常見回授電路範例

### 7.1 射極/源極退化（串聯-串聯回授）

RE（或 RS）提供電流取樣、串聯混合的回授。

β = RE（或 RS），回授的是電壓，取樣的是電流。

$$A_f = \frac{R_m}{1 + R_m \beta} \approx \frac{1}{\beta} = \frac{1}{R_E}$$

### 7.2 集極/汲極到基極/閘極回授（並聯-並聯回授）

RF 從輸出接回輸入。

$$\beta = \frac{1}{R_F}$$

$$R_{in,f} = \frac{R_{in}}{1+T}, \quad R_{out,f} = \frac{R_{out}}{1+T}$$

### 數值例題 9.9：射極退化回授分析

> **題目**：CE 放大器，gm = 40mS，rπ = 2.5kΩ（β=100），RC = 5kΩ，RE = 200Ω。
> 用回授的觀點分析增益。
>
> **解答**：
> 開迴路轉阻：A = -gm × RC / (由回授類型決定)
>
> 這是串聯-串聯回授（電流取樣、串聯混合）。
> 開迴路：把 RE 設為 0（短路），求電壓增益
> Av(open) = -gm × RC = -40m × 5k = -200
>
> 但更正確的回授分析是用轉阻：
> β = RE = 200Ω
> 增益 Av ≈ -RC/RE = -5k/200 = **-25**
>
> 直接法驗證：
> Av = -gmRC/(1 + gmRE) = -200/(1+8) = **-22.2**
>（接近，差異來自簡化假設）

---

## 關鍵術語表

| 中文 | 英文 | 白話解釋 | 例子 |
|------|------|---------|------|
| 回授 | Feedback | 將輸出的部分送回輸入 | 恆溫器、OPA電路 |
| 負回授 | Negative Feedback | 回授信號與輸入相減 | 降低增益但更穩定 |
| 正回授 | Positive Feedback | 回授信號與輸入相加 | 振盪器 |
| 開迴路增益 | Open-loop Gain (A) | 無回授時的增益 | 通常很大 |
| 閉迴路增益 | Closed-loop Gain (Af) | 有回授時的增益 | ≈ 1/β |
| 回授因子 | Feedback Factor (β) | 從輸出取樣送回的比例 | 由電阻決定 |
| 迴路增益 | Loop Gain (T=Aβ) | 信號繞迴路一圈的增益 | 越大越穩定 |
| 相位邊限 | Phase Margin (PM) | 離振盪還有多少相位裕度 | PM > 45° 安全 |
| 增益邊限 | Gain Margin (GM) | 離振盪還有多少增益裕度 | GM > 10dB 安全 |
| 補償 | Compensation | 確保回授穩定性的技術 | 米勒補償 |
| 主極點 | Dominant Pole | 頻率最低的極點 | 決定頻寬 |
| 極點分離 | Pole Splitting | 米勒補償使兩極點分開 | 提高穩定性 |
| 串聯混合 | Series Mixing | 回授以電壓加在輸入端 | 提高 Rin |
| 並聯混合 | Shunt Mixing | 回授以電流加在輸入端 | 降低 Rin |

---

## 題型鑑別

| 看到什麼條件 | 用什麼方法 |
|-------------|-----------|
| 「求閉迴路增益」、已知 A 和 β | Af = A/(1+Aβ) |
| 「回授後的頻寬」 | BWf = BW × (1+Aβ) |
| 「判斷回授類型」 | 看輸出端取樣方式 + 輸入端混合方式 |
| 「求閉迴路的阻抗」 | 根據回授類型，乘或除 (1+Aβ) |
| 「判斷穩定性」 | 求 PM 和 GM，看是否足夠 |
| 「需要補償」 | 加主極點或米勒補償電容 |
| 「有 RE/RS 且問回授」 | 串聯-串聯回授，β = RE 或 RS |
| 「有 RF 從輸出接到輸入」 | 並聯-並聯回授，β = 1/RF |

---

## ✅ 自我檢測

### 概念題

1. 負回授的四大好處分別是什麼？
2. 為什麼閉迴路增益 Af ≈ 1/β 幾乎與 A 無關？
3. 什麼是相位邊限？工程上一般要求多少？
4. 串聯混合和並聯混合分別對輸入阻抗有什麼影響？
5. 米勒補償的原理是什麼？

<details>
<summary>點擊查看答案</summary>

1. **(1) 降低增益敏感度**（增益更穩定）、**(2) 擴展頻寬**（BW × (1+Aβ)）、**(3) 降低非線性失真**（失真 ÷ (1+Aβ)）、**(4) 改善輸入/輸出阻抗**（取決於回授類型）。

2. **因為 Af = A/(1+Aβ)，當 Aβ >> 1 時，Af ≈ A/(Aβ) = 1/β。** 分子分母都有 A，約掉了。而 β 由精確的被動元件決定，非常穩定。

3. **相位邊限 = 180° + ∠T(jωgc)，是在增益交越頻率時距離 -180° 還有多少度。** PM > 0° 表示穩定。工程上一般要求 **PM ≥ 45°**，高品質設計要 **PM ≥ 60°**。

4. **串聯混合使輸入阻抗增大 (1+Aβ) 倍（因為回授電壓抵消了部分輸入電壓）。並聯混合使輸入阻抗減小 (1+Aβ) 倍（因為回授電流分流了部分輸入電流）。**

5. **在兩級放大器的第二級跨接小電容 Cc。** 利用米勒效應使第一級的等效電容大幅增加，把主極點推到很低的頻率；同時第二極點被推高（極點分離），確保在增益交越時只有一個極點起作用，相位邊限充足。

</details>

### 計算題

6. A = 5000，β = 0.02。求 Af 和迴路增益 T。若 A 下降 20%，Af 變化多少百分比？
7. 開迴路增益 2000、頻寬 50kHz。β = 0.05。求閉迴路頻寬。
8. 放大器 Ri = 5kΩ，Ro = 2kΩ。串聯-並聯回授，T = 50。求閉迴路 Rif 和 Rof。
9. 增益交越頻率 ωgc 處 ∠T = -135°。PM 是多少？穩定嗎？

<details>
<summary>點擊查看答案</summary>

6. T = Aβ = 5000 × 0.02 = 100
   Af = 5000/101 = **49.5**
   A 下降 20%：A' = 4000，Af' = 4000/(1+80) = 4000/81 = 49.38
   變化 = (49.5-49.38)/49.5 = **0.24%**（A 變 20%，Af 只變 0.24%）

7. 1+Aβ = 1 + 2000×0.05 = 101
   BWf = 50k × 101 = **5.05 MHz**

8. Rif = Ri × (1+T) = 5k × 51 = **255 kΩ**
   Rof = Ro/(1+T) = 2k/51 = **39.2 Ω**

9. PM = 180° + (-135°) = **45°** → 穩定，但剛好在邊界（建議 ≥ 45°）。

</details>

---

> **下一篇**：[electronics_10_CMOS數位電路與OPA設計](electronics_10_CMOS數位電路與OPA設計.md) — 學習數位電路基礎和運算放大器設計！
