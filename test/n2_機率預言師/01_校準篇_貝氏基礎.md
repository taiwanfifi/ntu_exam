# 機率教室 第一篇：校準 — 貝氏統計基礎

> 對應小說第 1-12 章。這一篇涵蓋了整本小說最核心的數學：**貝氏定理**。
> 讀完這一篇，你會知道「先驗」「似然」「後驗」不是什麼神秘咒語，而是你每天都在做的事。

---

## 1. Beta 分布 — 萬物皆可 Beta

**小說出處**：第1章（透鏡日常）、第20-21章（密碼 Beta(72,28)）

### 什麼是 Beta 分布？

Beta 分布是定義在 [0, 1] 區間上的連續機率分布，專門用來描述「機率的機率」。

$$f(\theta; \alpha, \beta) = \frac{\theta^{\alpha-1}(1-\theta)^{\beta-1}}{B(\alpha, \beta)}$$

其中 $B(\alpha, \beta) = \frac{\Gamma(\alpha)\Gamma(\beta)}{\Gamma(\alpha+\beta)}$ 是 Beta 函數。

### 直覺理解

想像你在猜一枚硬幣正面朝上的機率 $\theta$：

- **你完全不知道** → Beta(1, 1)，就是均勻分布，任何值都一樣可能
- **你猜大概 0.5** → Beta(5, 5)，對稱地集中在 0.5 附近
- **你有 72 次成功、28 次失敗的證據** → Beta(72, 28)，非常確定 θ ≈ 0.72

### 關鍵公式

| 性質 | 公式 | 第1章數值 | 第21章數值 |
|------|------|-----------|-----------|
| 期望值 | $E[\theta] = \frac{\alpha}{\alpha+\beta}$ | $\frac{6.2}{10} = 0.62$ | $\frac{72}{100} = 0.72$ |
| 變異數 | $\text{Var}(\theta) = \frac{\alpha\beta}{(\alpha+\beta)^2(\alpha+\beta+1)}$ | ≈ 0.0096 | ≈ 0.002 |
| 眾數 | $\frac{\alpha-1}{\alpha+\beta-2}$ (α,β > 1) | ≈ 0.65 | ≈ 0.724 |

### 數值範例：跟著小說算

**第1章的 Beta(6.2, 3.8)**：

```
α = 6.2, β = 3.8, α + β = 10

期望值 = 6.2 / 10 = 0.62（透鏡顯示：62%）
標準差 = √(6.2 × 3.8 / (100 × 11)) ≈ 0.098

95% 的機率，真實值在 0.62 ± 2×0.098 = [0.424, 0.816] 之間
```

**第21章的 Beta(72, 28)**——小說的關鍵密碼：

```
α = 72, β = 28, α + β = 100

期望值 = 72 / 100 = 0.72
  → 72% 的區域先驗被修改過！

變異數 = 72 × 28 / (100² × 101) ≈ 0.002
標準差 ≈ 0.045

分布非常集中——α+β = 100 代表「很有信心」
如果 α+β = 10，標準差會是 0.15（三倍寬）
```

![Beta Distribution](圖表/01_beta_distribution.png)

> 「百分之六十二。不高不低。剛好是一個你不會太在意、但也不會完全忽略的數字。」——第一章，貝葉的透鏡日常

### 為什麼 α + β 代表信心？

$\alpha + \beta$ 可以理解為「等效觀測次數」：

- Beta(1, 1)：0 次觀測 → 什麼都不知道
- Beta(6.2, 3.8)：約 8 次觀測 → 有點感覺
- Beta(72, 28)：100 次觀測 → 非常確定

每多一次觀測，分布就更窄、更集中。這就是為什麼 Beta(72,28) 的圖形像一根針——100 次觀測的信心，讓不確定性壓縮到只剩 σ ≈ 0.045。

---

## 2. 貝氏定理 — 小說的靈魂公式

**小說出處**：第4章（十一秒）、第11章（父親的定理）

### 公式

$$P(\theta | D) = \frac{P(D | \theta) \cdot P(\theta)}{P(D)}$$

或者用比例式：

$$\underbrace{P(\theta | D)}_{\text{後驗}} \propto \underbrace{P(\theta)}_{\text{先驗}} \times \underbrace{P(D | \theta)}_{\text{似然}}$$

### 中文翻譯

> **你更新後的信念** = **你原本的信念** × **新證據的說服力**

### 小說怎麼用的

在第4章，貝葉用十一秒做了一次貝氏更新：

```
場景：路口有人跟蹤嗎？

先驗 P(跟蹤) = 0.03（平常被跟蹤的背景機率很低）

新證據：同一個人出現在三個路口
似然 P(出現在三個路口 | 跟蹤) = 0.85
似然 P(出現在三個路口 | 巧合) = 0.02

後驗 P(跟蹤 | 三個路口) = (0.85 × 0.03) / (0.85 × 0.03 + 0.02 × 0.97)
                        = 0.0255 / (0.0255 + 0.0194)
                        = 0.0255 / 0.0449
                        ≈ 0.568

從 3% 跳到 56.8%！一個觀測改變了一切。
```

### P(A|B) ≠ P(B|A)——最致命的混淆

第4章特別強調：

```
P(下雨 | 帶傘) ≠ P(帶傘 | 下雨)

P(帶傘 | 下雨) 可能很高（80%——下雨大家帶傘）
P(下雨 | 帶傘) 可能很低（20%——帶傘的人很多是預防性帶的）

這兩個不一樣！混淆它們是統計學最常見的錯誤。
```

> 「後驗正比於先驗乘以似然。先驗是你的。似然是我的。後驗是我們的。」——第五十九章，紙條背面

![Bayesian Update](圖表/02_bayesian_update.png)

---

## 3. 似然函數與最大似然估計 (MLE)

**小說出處**：第5章（太整齊了）、第7章（似然函數）

### 什麼是似然函數？

似然函數和機率密度函數長得一模一樣——但意思完全不同：

- **機率**：固定參數 θ，問「數據 x 出現的可能性有多大？」→ $f(x | \theta)$
- **似然**：固定數據 x，問「哪個參數 θ 最有可能產生這些數據？」→ $L(\theta | x) = f(x | \theta)$

### MLE：找到讓似然最大的 θ

$$\hat{\theta}_{MLE} = \arg\max_\theta L(\theta | x_1, ..., x_n) = \arg\max_\theta \prod_{i=1}^{n} f(x_i | \theta)$$

實務上取對數更方便：

$$\hat{\theta}_{MLE} = \arg\max_\theta \sum_{i=1}^{n} \log f(x_i | \theta)$$

### 小說怎麼用的（第7章）

蘇立恆計算 Poisson 似然函數：

```
觀測數據：某區域的事件次數
MLE 結果：λ̂ = 2.63
官方公佈：λ = 1.8

偏差 = |2.63 - 1.8| / 1.8 = 46%

似然比 = L(λ=1.8) / L(λ=2.63) = 0.218

意思是：用官方的 λ=1.8 來解釋數據，
只有 MLE 解釋力的 21.8%。

官方數字——是錯的。
```

> 「MLE 是 2.63。官方的 λ 是 1.8。偏差百分之四十六。這不是雜訊。這是有人在說謊。」——第七章，蘇立恆

![Likelihood Function](圖表/04_likelihood_function.png)

### Poisson 分布的 MLE

對 Poisson 分布 $P(X=k) = \frac{e^{-\lambda}\lambda^k}{k!}$：

$$\log L(\lambda) = \sum_{i=1}^n (x_i \log\lambda - \lambda - \log x_i!)$$

對 λ 微分令其等於零：

$$\frac{d}{d\lambda} \log L = \frac{\sum x_i}{\lambda} - n = 0$$

$$\hat{\lambda}_{MLE} = \bar{x} = \frac{\sum x_i}{n}$$

**結論：Poisson 的 MLE 就是樣本平均值！**

---

## 4. Poisson 分布 — 稀有事件的數學

**小說出處**：第4-5章、第53章

### 公式

$$P(X = k) = \frac{e^{-\lambda} \lambda^k}{k!}, \quad k = 0, 1, 2, ...$$

### 性質

| 性質 | 公式 | λ=1.67 (Ch.5) | λ=0.58 (Ch.53) |
|------|------|---------------|----------------|
| 期望值 | E[X] = λ | 1.67 | 0.58 |
| 變異數 | Var(X) = λ | 1.67 | 0.58 |
| 偏態係數 | 1/√λ | 0.77 | 1.31 |

### 偏態係數的陷阱（第5章）

蘇立恆發現大安區的偏態係數 = 0.02。

```
Poisson(λ=1.67) 的理論偏態 = 1/√1.67 = 0.77

觀測偏態 = 0.02

差距：0.77 vs 0.02

「太整齊了。」

Poisson 分布本來就是右偏的。偏態接近零——
意味著數據被人工「修整」成對稱的了。
真正的隨機，不會這麼漂亮。
```

> 「太整齊了。真正的隨機，不會這麼漂亮。」——第五章，蘇立恆

![Poisson Distribution](圖表/05_poisson_distribution.png)

---

## 5. 似然比檢定 — 統計法庭的證據

**小說出處**：第9章（似然比）

### 公式

$$\Lambda = \frac{L(\theta_0 | \text{data})}{L(\hat{\theta}_{MLE} | \text{data})} = \frac{\text{虛無假設下的似然}}{\text{最佳解釋下的似然}}$$

- $\Lambda$ 接近 1 → 虛無假設解釋得不錯 → 不拒絕
- $\Lambda$ 很小 → 虛無假設解釋得很差 → 拒絕

### 小說中的數據（第9章）

| 區域 | 似然比 | p-value | 判定 |
|------|--------|---------|------|
| 大安區 | 4.72 | < 0.001 | ★★★ 異常 |
| 信義區 | 3.18 | < 0.005 | ★★ 異常 |
| 中正區 | 5.01 | < 0.001 | ★★★ 異常 |
| 內湖區 | 4.33 | < 0.001 | ★★★ 異常 |
| 松山區 | 3.77 | < 0.001 | ★★★ 異常 |
| 中山區 | 0.04 | 0.84 | 正常 |
| 萬華區 | 0.07 | 0.79 | 正常 |

五個高似然比的區域，全部往低偏移了 45%。

三顆星（★★★）= p < 0.001 = 千分之一以下的機率是巧合。

> 「不是 Bug。是有人修改了先驗。」

![Likelihood Ratio](圖表/25_likelihood_ratio.png)

---

## 6. 逐步貝氏更新 — 從無知到確信

**小說出處**：第11章（父親的定理）

### 過程

每收到一筆新數據，後驗就更新一次：

$$\theta_0 \xrightarrow{D_1} \theta_1 \xrightarrow{D_2} \theta_2 \xrightarrow{D_3} \theta_3 \to \cdots$$

Beta 分布的美妙之處在於更新公式極其簡單：

```
起始：Beta(α₀, β₀)

觀測到 1 次成功：Beta(α₀ + 1, β₀)
觀測到 1 次失敗：Beta(α₀, β₀ + 1)

觀測到 k 次成功、n-k 次失敗：
Beta(α₀ + k, β₀ + n - k)
```

### 數值範例

```
起始：Beta(1, 1) — 完全不知道

第 1 筆：成功 → Beta(2, 1), E = 0.667
第 2 筆：成功 → Beta(3, 1), E = 0.750
第 3 筆：失敗 → Beta(3, 2), E = 0.600
...
第 100 筆：72 成功 28 失敗 → Beta(73, 29), E = 0.716

越來越接近真實值 0.72！
```

> 「P(θ|data) ∝ P(θ) × P(data|θ)。她寫在這張紙上。十六年前。這就是一切的起點。」——第十一章，貝葉讀母親的論文

![Sequential Bayesian](圖表/03_sequential_bayesian.png)

---

## 練習題

**題目 1**：如果透鏡顯示某件事的機率是 Beta(10, 40)，求期望值和標準差。這代表什麼意思？

<details>
<summary>解答</summary>

```
E[θ] = 10 / (10 + 40) = 10/50 = 0.20
Var(θ) = (10 × 40) / (50² × 51) = 400 / 127500 ≈ 0.00314
σ = √0.00314 ≈ 0.056

意思：這件事發生的機率大約 20%，
而且我們有 50 筆觀測的信心（α+β=50），
所以 95% 信賴區間大約是 [0.09, 0.31]。
```
</details>

**題目 2**：你的先驗是「這枚硬幣正面機率 = 0.5」(Beta(10, 10))。你擲了 20 次，得到 15 次正面。新的後驗是什麼？你的信念改變了多少？

<details>
<summary>解答</summary>

```
先驗：Beta(10, 10), E = 0.50
數據：k = 15, n = 20
後驗：Beta(10+15, 10+5) = Beta(25, 15), E = 25/40 = 0.625

信念從 0.50 移動到 0.625。
數據（15/20 = 0.75）把你的信念從 0.50 往 0.75 拉了——
但沒有拉到 0.75，因為先驗也有力量。

如果先驗很弱 Beta(1,1)：後驗 = Beta(16, 6), E = 0.727
如果先驗很強 Beta(100,100)：後驗 = Beta(115, 105), E = 0.523

先驗越強，越難被數據動搖。
這就是柏朗做的事——他把所有人的先驗加強了，
讓數據無法改變他們的信念。
```
</details>
