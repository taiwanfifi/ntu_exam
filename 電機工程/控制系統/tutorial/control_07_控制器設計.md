# 控制系統（七）：控制器設計

## 🔰 本章基礎觀念（零基礎必讀）

> 前六章你學會了分析系統——建模、看響應、判穩定、畫根軌跡和波德圖。但如果系統的性能不滿意怎麼辦？例如穩態誤差太大、超越量太高、響應太慢？這時就需要加一個**控制器（Compensator）**來「修正」系統的行為。本章介紹三大控制器設計方法：PID 控制、超前補償、滯後補償。這是控制工程最核心的實務技能。

---

## 一、控制器的目標

加入控制器 $G_c(s)$ 後：

```
R(s) → ⊕ → [Gc(s)] → [G(s)] → Y(s)
       ↑-                        |
       └────────────────────────┘
```

設計目標通常包括：
- 穩態誤差滿足規格（如 ess ≤ 2%）
- 暫態規格（如 Mp ≤ 10%, ts ≤ 1s）
- 穩定性（PM > 45°, GM > 6 dB）
- 抗干擾能力

---

## 二、PID 控制器

### 2.1 三個基本動作

#### P 控制（比例控制，Proportional）

$$G_c(s) = K_p$$

- 輸出與誤差成正比
- **效果**：增加增益 → 減小穩態誤差，加快響應
- **代價**：增益太大可能不穩定，無法完全消除穩態誤差（Type 0 系統）

#### I 控制（積分控制，Integral）

$$G_c(s) = \frac{K_i}{s}$$

- 輸出與誤差的**積分**成正比（累積歷史誤差）
- **效果**：增加系統型別 → 可以完全消除穩態誤差
- **代價**：增加相位落後 -90° → 降低穩定邊限，使響應變慢

#### D 控制（微分控制，Derivative）

$$G_c(s) = K_d s$$

- 輸出與誤差的**微分**（變化率）成正比
- **效果**：預測未來趨勢 → 增加阻尼，改善暫態響應
- **代價**：放大高頻雜訊（實際上用 $K_d s/(1+\tau_d s)$）

### 2.2 PID 控制器的轉移函數

$$\boxed{G_c(s) = K_p + \frac{K_i}{s} + K_d s = K_p\left(1 + \frac{1}{T_i s} + T_d s\right)}$$

其中 $T_i = K_p/K_i$（積分時間），$T_d = K_d/K_p$（微分時間）。

等效形式：
$$G_c(s) = \frac{K_d s^2 + K_p s + K_i}{s} = \frac{K_d(s + z_1)(s + z_2)}{s}$$

PID 提供：
- **一個極點在原點**（積分 → 提升型別）
- **兩個零點**（可以用來改善暫態響應）

### 2.3 各控制動作的效果總整理

| 控制動作 | 上升時間 | 超越量 | 安定時間 | 穩態誤差 |
|----------|---------|--------|---------|---------|
| 增加 Kp | 減小 | 增加 | 影響不大 | 減小 |
| 增加 Ki | 減小 | 增加 | 增加 | 消除 |
| 增加 Kd | 影響不大 | 減小 | 減小 | 影響不大 |

> 注意：以上是大致趨勢，具體效果取決於系統。

### 2.4 Ziegler-Nichols 調參法

#### 方法一：臨界增益法（Closed-Loop Method）

1. 先只用 P 控制，逐漸增加 $K_p$
2. 找到使系統**剛好持續振盪**的 $K_p = K_{cr}$（臨界增益）
3. 量測持續振盪的週期 $P_{cr}$
4. 查表設定 PID 參數

| 控制器 | $K_p$ | $T_i$ | $T_d$ |
|--------|-------|-------|-------|
| P | 0.5 Kcr | — | — |
| PI | 0.45 Kcr | Pcr/1.2 | — |
| PID | 0.6 Kcr | Pcr/2 | Pcr/8 |

#### 方法二：反應曲線法（Open-Loop Method）

1. 給開迴路系統一個步階輸入
2. 若響應呈 S 形曲線，在反曲點畫切線
3. 量測：延遲時間 L（切線與時間軸的交點）和時間常數 T（切線與最終值的交點）

| 控制器 | $K_p$ | $T_i$ | $T_d$ |
|--------|-------|-------|-------|
| P | T/L | — | — |
| PI | 0.9T/L | L/0.3 | — |
| PID | 1.2T/L | 2L | 0.5L |

**【例題 1】Ziegler-Nichols 臨界增益法**

系統 $G(s) = \frac{1}{s(s+1)(s+5)}$，用臨界增益法設計 PID。

**步驟一**：找 $K_{cr}$

特徵方程：$s^3 + 6s^2 + 5s + K = 0$

Routh 表：

| | C1 | C2 |
|---|---|---|
| s³ | 1 | 5 |
| s² | 6 | K |
| s¹ | (30-K)/6 | |
| s⁰ | K | |

K = 30 時 s¹ 行 = 0 → $K_{cr} = 30$

輔助多項式：$6s^2 + 30 = 0 \Rightarrow s = \pm j\sqrt{5}$

$P_{cr} = 2\pi/\sqrt{5} = 2.81$ 秒

**步驟二**：查表

| 參數 | PID 公式 | 值 |
|------|---------|-----|
| $K_p$ | 0.6 × 30 | 18 |
| $T_i$ | 2.81/2 | 1.405 s |
| $T_d$ | 2.81/8 | 0.351 s |

$$G_c(s) = 18\left(1 + \frac{1}{1.405s} + 0.351s\right) = 18 + \frac{12.81}{s} + 6.32s$$

> Ziegler-Nichols 調參通常給出 Mp ≈ 25% 的響應，之後可以再微調。

---

## 三、超前補償器（Lead Compensator）

### 3.1 轉移函數

$$\boxed{G_c(s) = K_c \frac{s + z}{s + p} = K_c \frac{T s + 1}{\alpha T s + 1}}, \quad |z| < |p|, \quad \alpha = z/p < 1$$

- 零點 z 比極點 p 靠近虛軸
- 在波德圖上，超前補償器在零點和極點之間**增加正相位**

### 3.2 超前補償器的特性

最大相位超前 $\phi_m$ 出現在頻率 $\omega_m = 1/(T\sqrt{\alpha})$：

$$\sin\phi_m = \frac{1-\alpha}{1+\alpha}$$

| α | 最大相位超前 φm |
|---|----------------|
| 0.5 | 19.5° |
| 0.3 | 30.0° |
| 0.2 | 38.9° |
| 0.1 | 54.9° |
| 0.05 | 64.8° |

### 3.3 波德圖設計步驟

**目標**：增加相位邊限（改善暫態響應）。

1. 由穩態誤差要求，求出需要的開迴路增益 $K$
2. 畫出 $KG(s)$ 的波德圖，找出目前的 PM
3. 計算所需的額外相位：$\phi_m = PM_{要求} - PM_{目前} + 安全裕量(5°\sim12°)$
4. 由 $\sin\phi_m = (1-\alpha)/(1+\alpha)$ 求 α
5. 求新的增益交越頻率 $\omega_m$：在 $|KG(j\omega_m)| = -10\log(1/\alpha)$ dB 處（補償器在 ωm 的增益為 $-10\log\alpha$ dB 的一半... 更精確地說，令 $|KG(j\omega_m)| = 1/\sqrt{\alpha}$ 的倒數）

   更簡單的方法：在原始波德圖上找增益為 $-10\log_{10}(1/\alpha)$ dB 的頻率，即 $|KG(j\omega)| = \sqrt{\alpha}$ → 這就是新的 $\omega_{gc}$

6. 求 $T = 1/(\omega_m\sqrt{\alpha})$
7. 零點 $z = 1/T$，極點 $p = 1/(\alpha T)$
8. 計算 $K_c$ 使開迴路增益不變

**【例題 2】超前補償器設計**

$$G(s) = \frac{4}{s(s+2)}$$

要求：(1) 斜坡 ess ≤ 0.2；(2) PM ≥ 50°

**步驟一**：穩態誤差
$$K_v = \lim_{s\to0} sKG(s) = \lim_{s\to0} \frac{4K}{s+2} = 2K$$

$e_{ss} = 1/K_v = 1/(2K) \leq 0.2 \Rightarrow K \geq 2.5$

取 K = 2.5，$KG(s) = 10/[s(s+2)]$

**步驟二**：目前 PM

$$\angle KG(j\omega) = -90° - \tan^{-1}(\omega/2)$$

找 ωgc：$10/(\omega\sqrt{4+\omega^2}) = 1 \Rightarrow 100 = \omega^2(4+\omega^2)$
$\omega^4 + 4\omega^2 - 100 = 0$
$\omega^2 = (-4+\sqrt{16+400})/2 = (-4+20.4)/2 = 8.2$
$\omega_{gc} = 2.86$ rad/s

$PM = 180° + (-90° - \tan^{-1}(2.86/2)) = 180° - 90° - 55.1° = 34.9°$

**步驟三**：需要額外相位
$\phi_m = 50° - 34.9° + 10°（安全裕量）= 25.1°$

**步驟四**：求 α
$\sin(25.1°) = 0.424 = (1-\alpha)/(1+\alpha)$
$0.424 + 0.424\alpha = 1 - \alpha$
$1.424\alpha = 0.576$
$\alpha = 0.404$

**步驟五**：新 ωgc

在原始圖上找 $|KG(j\omega)| = 1/\sqrt{0.404} = 1.573$ 即 3.94 dB 的位置（因為補償器在 ωm 處增益為 $1/\sqrt{\alpha}$，需 $|KG|\cdot(1/\sqrt{\alpha})=1$，所以 $|KG|=\sqrt{\alpha}$）

$10/(\omega\sqrt{4+\omega^2}) = \sqrt{0.404} = 0.636$

$100 = 0.404\omega^2(4+\omega^2)$
$\omega^4 + 4\omega^2 - 247.5 = 0$
$\omega^2 = (-4+\sqrt{16+990})/2 = (-4+31.72)/2 = 13.86$
$\omega_m = 3.72$ rad/s

**步驟六**：求 T

$T = 1/(\omega_m\sqrt{\alpha}) = 1/(3.72\times0.636) = 0.423$ s

零點：$z = 1/T = 2.37$
極點：$p = 1/(\alpha T) = 1/(0.404\times0.423) = 5.85$

**步驟七**：補償器

$$G_c(s) = K_c\frac{s+2.37}{s+5.85}$$

$K_c$ 使直流增益一致：$K_c = p/z = 5.85/2.37 = 2.47$（或取 $K_c = 1/\alpha = 2.48$）

整體：$K_c \cdot K = 2.47 \times 2.5 = 6.18$

$$G_c(s)KG(s) = \frac{6.18 \cdot 4(s+2.37)}{s(s+2)(s+5.85)} = \frac{24.7(s+2.37)}{s(s+2)(s+5.85)}$$

驗證 PM ≈ 50° ✓

---

## 四、滯後補償器（Lag Compensator）

### 4.1 轉移函數

$$\boxed{G_c(s) = K_c \frac{s + z}{s + p} = K_c \frac{Ts + 1}{\beta Ts + 1}}, \quad |z| > |p|, \quad \beta = p/z < 1$$

注意：和超前補償器相反，零點 z 比極點 p **遠離**虛軸。

### 4.2 滯後補償器的原理

**不是增加相位**（實際上會微量降低相位），而是利用**高頻衰減**來降低增益交越頻率，使 PM 在更低頻率處獲得足夠的值。

同時，低頻增益增加 → 改善穩態誤差。

### 4.3 波德圖設計步驟

1. 由穩態誤差要求求 K
2. 畫 KG(s) 的波德圖
3. 找到相位 = -(180°-PM要求-5°) 的頻率 → 設為新 ωgc
4. 在新 ωgc 處，|KG| 的值為 A dB → 需要滯後補償器在此頻率衰減 A dB
5. 令 β = 10^(-A/20)
6. 零點 z = ωgc/10（足夠低，不影響相位）
7. 極點 p = βz
8. $K_c = 1/\beta$（或適當調整）

**【例題 3】滯後補償器設計**

$$G(s) = \frac{1}{s(s+1)(s+2)}$$

要求：(1) 斜坡 ess ≤ 0.1；(2) PM ≥ 40°

**步驟一**：
$K_v = \lim sKG(s) = K/(1\times2) = K/2$

$e_{ss} = 1/K_v = 2/K \leq 0.1 \Rightarrow K \geq 20$

取 K = 20。

**步驟二**：目前未補償的波德圖

$KG(s) = 20/[s(s+1)(s+2)]$

找 PM：先找 ωgc（|KG|=1）：

$20/(\omega\sqrt{1+\omega^2}\sqrt{4+\omega^2}) = 1$

數值解 ωgc ≈ 2.5 rad/s（大約）

$\angle KG(j2.5) = -90° - \tan^{-1}(2.5) - \tan^{-1}(1.25) = -90° - 68.2° - 51.3° = -209.5°$

$PM = 180° - 209.5° = -29.5°$（已經不穩定！）

**步驟三**：找新 ωgc

需要相位 = -(180°-40°-5°) = -135° 的頻率

$-90° - \tan^{-1}\omega - \tan^{-1}(\omega/2) = -135°$
$\tan^{-1}\omega + \tan^{-1}(\omega/2) = 45°$

試 ω = 0.5：$\tan^{-1}(0.5) + \tan^{-1}(0.25) = 26.6° + 14.0° = 40.6°$
試 ω = 0.6：$\tan^{-1}(0.6) + \tan^{-1}(0.3) = 31.0° + 16.7° = 47.7°$
試 ω = 0.55：$\approx 28.8° + 15.4° = 44.2°$

$\omega_{gc,new} \approx 0.56$ rad/s

**步驟四**：在新 ωgc 處的增益

$|KG(j0.56)| = 20/(0.56\sqrt{1+0.314}\sqrt{4+0.314}) = 20/(0.56\times1.146\times2.077) = 20/1.333 = 15.0$

需衰減 15.0 倍 → $20\log(15) = 23.5$ dB

**步驟五**：$\beta = 1/15 = 0.067$

**步驟六**：零點和極點

$z = \omega_{gc,new}/10 = 0.056$ rad/s
$p = \beta z = 0.067 \times 0.056 = 0.00373$ rad/s

**補償器**：

$$G_c(s) = K_c \frac{s + 0.056}{s + 0.00373}$$

$K_c = p/z = 0.00373/0.056 = 0.067$（使高頻增益不變）

或者 $K_c = 1$ 並將增益 K 調整：$K_{new} = K \cdot \beta = 20 \times 0.067 = 1.33$...

更常見的做法：$G_c(s) = \frac{s+0.056}{s+0.00373}$，此補償器的低頻增益為 $0.056/0.00373 = 15$，剛好提供所需的增益。

---

## 五、超前-滯後補償器（Lead-Lag Compensator）

### 5.1 何時需要

當單獨使用超前或滯後補償都無法同時滿足暫態和穩態要求時，使用超前-滯後組合。

### 5.2 轉移函數

$$G_c(s) = K_c \frac{(s+z_1)(s+z_2)}{(s+p_1)(s+p_2)}$$

其中：
- $(s+z_1)/(s+p_1)$：超前部分（|z₁| < |p₁|）
- $(s+z_2)/(s+p_2)$：滯後部分（|z₂| > |p₂|）

### 5.3 設計策略

1. 滯後部分負責穩態誤差（提升低頻增益）
2. 超前部分負責暫態響應（增加 PM）
3. 兩部分的頻率範圍應分開，避免互相干擾

**【例題 4】超前-滯後補償器設計概念**

$$G(s) = \frac{1}{s(s+1)(0.5s+1)}$$

要求：Kv = 50, PM ≥ 40°

若只用增益 K=50：PM 嚴重不足（系統可能不穩定）。
若只用超前補償：需要的超前角度太大（>60°），不實際。
若只用滯後補償：ωgc 壓得太低，系統太慢。

**解決方案**：
- 滯後部分：提升增益到 K=50（$K_v$ 要求），在低頻增加增益
- 超前部分：在新的 ωgc 附近增加 30°~40° 的相位

（詳細計算略，方法是分別套用超前和滯後的設計步驟）

---

## 六、根軌跡法設計補償器

### 6.1 超前補償器的根軌跡設計

1. 確定期望的閉迴路主極點位置 $s_d$（由 ζ, ωn 決定）
2. 計算 $\angle G(s_d) = \theta$
3. 需要的補償角度：$\phi = 180° - |\theta|$
4. 選擇零點和極點使其在 $s_d$ 處貢獻角度 φ
5. 用幅值條件求 K

### 6.2 滯後補償器的根軌跡設計

1. 先用根軌跡設計期望的閉迴路極點（暫態OK）
2. 計算此時的 Kv（或 Kp, Ka）
3. 若穩態誤差不夠，加滯後補償器提升 Kv
4. 零點和極點都放在很靠近原點的地方（不改變根軌跡形狀）
5. z/p 的比值 = 需要的增益提升倍數

---

## 七、關鍵術語表

| 中文 | 英文 | 白話解釋 | 例子 |
|------|------|----------|------|
| PID 控制器 | PID Controller | 比例+積分+微分控制 | 工業最常用 |
| 比例控制 | Proportional (P) | 輸出正比於誤差 | Kp·e(t) |
| 積分控制 | Integral (I) | 輸出正比於誤差積分 | 消除穩態誤差 |
| 微分控制 | Derivative (D) | 輸出正比於誤差微分 | 增加阻尼 |
| 超前補償 | Lead Compensator | 增加相位 → 改善暫態 | (s+2)/(s+10) |
| 滯後補償 | Lag Compensator | 增加低頻增益 → 改善穩態 | (s+0.1)/(s+0.01) |
| 臨界增益 | Critical Gain (Kcr) | 使系統剛好振盪的增益 | Z-N 調參用 |
| 最大超前角 | Maximum Phase Lead (φm) | 超前補償器能提供的最大相位 | 依 α 值決定 |
| Ziegler-Nichols | Ziegler-Nichols Method | 經驗調參法 | 兩種方法 |
| 頻寬 | Bandwidth | 響應速度的指標 | 超前補償增加頻寬 |

---

## 八、題型鑑別表

| 題目特徵 | 解題方法 |
|----------|----------|
| 設計 PID 參數 | Z-N 法（臨界增益或反應曲線）|
| 增加 PM（暫態） | 超前補償器（波德圖法）|
| 減小 ess（穩態） | 滯後補償器 或 增加積分 |
| 同時改善暫態+穩態 | 超前-滯後 或 PID |
| 已知期望極點位置 | 根軌跡法設計補償器 |
| P/I/D 各有什麼效果 | 查效果表 |
| 求超前補償器參數 | 波德圖法六步驟 |

---

## ✅ 自我檢測

<details>
<summary><strong>Q1：PID 中的 I 控制為什麼能消除穩態誤差？</strong></summary>

**答**：I 控制在轉移函數中加了一個 1/s（積分器），等於在開迴路中多了一個原點極點，使系統型別增加 1。例如 Type 0 變 Type 1，就能消除步階誤差。直覺理解：積分器「累積」歷史誤差，只要誤差不為零就持續調整輸出，直到誤差歸零。
</details>

<details>
<summary><strong>Q2：超前補償器和滯後補償器在波德圖上的主要區別？</strong></summary>

**答**：
- **超前補償器**：在中高頻增加正相位 → 增加 PM → 改善暫態。增益在高頻增加。
- **滯後補償器**：在低頻增加增益（不改變高頻）→ 改善穩態誤差。ωgc 降低使 PM 增加。
</details>

<details>
<summary><strong>Q3：Ziegler-Nichols 臨界增益法中，如何找到 Kcr？</strong></summary>

**答**：逐漸增加比例增益 Kp（不加 I 和 D），直到系統輸出出現**等幅持續振盪**。此時的 Kp 就是 Kcr，振盪週期就是 Pcr。也可以用 Routh 判據讓 s¹ 行為零來計算。
</details>

<details>
<summary><strong>Q4：為什麼超前補償器設計時要加 5°~12° 的安全裕量？</strong></summary>

**答**：因為加入超前補償器後，ωgc 會移動（通常增大），而新 ωgc 處的原始系統相位通常比舊 ωgc 更負。所以實際得到的 PM 會比計算的少一些，需要額外的安全裕量來補償這個效果。
</details>

<details>
<summary><strong>Q5：什麼情況下需要用超前-滯後補償？</strong></summary>

**答**：當穩態誤差要求很小（需要大增益）且暫態響應要求也很嚴格（需要大 PM）時。單獨的超前補償器需要的超前角太大（超過 60° 不實際），單獨的滯後補償器會使系統太慢。此時用滯後部分解決穩態，超前部分解決暫態。
</details>

---

> **下一章預告**：前面所有分析都基於轉移函數（一個輸入一個輸出）。第八章進入**狀態空間**方法——它能處理多輸入多輸出（MIMO）系統，是現代控制理論的基礎！
