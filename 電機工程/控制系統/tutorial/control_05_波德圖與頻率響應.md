# 控制系統（五）：波德圖與頻率響應

## 🔰 本章基礎觀念（零基礎必讀）

> 前幾章都在「時域」分析——給一個步階或斜坡，看輸出怎麼變。但工程上我們常常遇到**不同頻率的訊號**，例如音響喇叭要忠實重現 20Hz 到 20kHz 的聲音，或者電力系統要過濾 60Hz 的雜訊。**頻率響應**告訴你：對每個頻率 ω，系統把訊號放大/縮小多少（增益），以及延遲多少（相位）。**波德圖（Bode Plot）**就是把增益和相位對頻率畫成兩張圖，是分析和設計控制器最實用的工具之一。台大必考！

---

## 一、頻率響應的基本概念

### 1.1 定義

給穩定的線性系統一個正弦輸入 $u(t) = A\sin(\omega t)$，經過暫態消退後，穩態輸出也是同頻率的正弦：

$$y_{ss}(t) = A|G(j\omega)| \sin(\omega t + \angle G(j\omega))$$

- $|G(j\omega)|$：增益（Magnitude），輸出振幅是輸入的幾倍
- $\angle G(j\omega)$：相位（Phase），輸出比輸入超前或落後幾度

### 1.2 頻率響應函數

將 s = jω 代入轉移函數 G(s)：

$$G(j\omega) = |G(j\omega)| \angle G(j\omega) = \text{Re}[G(j\omega)] + j\text{Im}[G(j\omega)]$$

---

## 二、波德圖（Bode Plot）

波德圖由兩張圖組成：
1. **增益圖（Magnitude Plot）**：20log₁₀|G(jω)| (dB) vs log₁₀ω
2. **相位圖（Phase Plot）**：∠G(jω) (度) vs log₁₀ω

> **分貝（dB）**的定義：$\text{dB} = 20\log_{10}|G(j\omega)|$

| 增益倍率 | dB 值 |
|----------|-------|
| 1 | 0 dB |
| 2 | 6 dB |
| 10 | 20 dB |
| 100 | 40 dB |
| 0.1 | -20 dB |
| 0.5 | -6 dB |
| 1/√2 ≈ 0.707 | -3 dB |

---

## 三、基本因子的波德圖

任何轉移函數都可以分解為以下基本因子的組合。在波德圖上，**各因子的增益（dB）相加，相位也相加**。

### 3.1 常數 K

$$G(j\omega) = K$$

- 增益：$20\log_{10}|K|$ dB，水平線
- 相位：K > 0 → 0°；K < 0 → -180°

### 3.2 積分因子 $1/(j\omega)^N$

$$G(j\omega) = \frac{1}{(j\omega)^N}$$

- 增益：$-20N \log_{10}\omega$ dB → 通過 (ω=1, 0dB)，斜率 **-20N dB/dec**
- 相位：$-90° \times N$（常數）

**N=1**（最常見）：斜率 -20 dB/dec，相位 -90°

### 3.3 微分因子 $(j\omega)^N$

- 增益：$+20N$ dB/dec
- 相位：$+90° \times N$

### 3.4 一階因子 $1/(1+j\omega\tau)$

轉折頻率（Corner Frequency）：$\omega_c = 1/\tau$

**近似波德圖**：
- **增益**：
  - ω << 1/τ：0 dB（水平線）
  - ω >> 1/τ：-20 dB/dec（下降線）
  - ω = 1/τ（轉折點）：實際值 -3 dB
- **相位**：
  - ω << 0.1/τ：0°
  - ω = 1/τ：-45°
  - ω >> 10/τ：-90°
  - 在 0.1/τ 到 10/τ 之間：從 0° 線性變化到 -90°

```
增益 (dB)
  0 ─────────┐
             │╲ ← 轉折點 ω=1/τ，實際-3dB
             │  ╲
             │    ╲  -20 dB/dec
             │      ╲
─────────────────────────→ log ω

相位 (度)
  0° ────────╲
              ╲
  -45° ........╲.......... ← ω=1/τ
                 ╲
  -90° ───────────╲──────→ log ω
```

### 3.5 一階因子 $(1+j\omega\tau)$（在分子）

與上面相反：
- 增益：轉折後 +20 dB/dec
- 相位：從 0° 到 +90°

### 3.6 二階因子 $1/(1+j2\zeta(\omega/\omega_n) - (\omega/\omega_n)^2)$

即 $\frac{\omega_n^2}{(j\omega)^2 + 2\zeta\omega_n(j\omega) + \omega_n^2}$

轉折頻率：$\omega_n$

**近似波德圖**：
- **增益**：
  - ω << ωn：0 dB
  - ω >> ωn：-40 dB/dec
  - ω = ωn（共振點）：峰值 $M_r = \frac{1}{2\zeta\sqrt{1-\zeta^2}}$（ζ < 0.707 時有共振峰）
  - 共振峰高度 ≈ $-20\log_{10}(2\zeta)$ dB
- **相位**：
  - ω << ωn：0°
  - ω = ωn：-90°（不論 ζ 值！）
  - ω >> ωn：-180°
  - ζ 越小，相位變化越陡峭

| ζ | 共振峰 Mr (dB) | 相位變化速度 |
|---|----------------|-------------|
| 0.1 | +14 dB | 很陡 |
| 0.3 | +5.7 dB | 陡 |
| 0.5 | +1.9 dB | 中等 |
| 0.707 | 0 dB（無峰）| 緩 |
| 1.0 | -6 dB | 很緩 |

---

## 四、手繪近似波德圖步驟

### 步驟

1. **化標準式**：將 G(s) 拆成基本因子的乘積
2. **找轉折頻率**：列出所有 1/τ 或 ωn
3. **畫增益圖**：
   - 從最低頻開始，先畫初始斜率（由 1/(jω)^N 和 K 決定）
   - 每遇到分母的轉折頻率，斜率 -20 dB/dec
   - 每遇到分子的轉折頻率，斜率 +20 dB/dec
   - 二階因子轉折處斜率變化 ±40 dB/dec
4. **畫相位圖**：各因子相位累加
5. **修正**：在轉折點附近修正（-3 dB 或 ±幾度）

**【例題 1】手繪波德圖**

$$G(s) = \frac{10(s+1)}{s(s+10)}$$

**步驟一：化標準式**

$$G(s) = \frac{10 \cdot 1 \cdot (s+1)}{s \cdot 10 \cdot (s/10+1)} = \frac{1 \cdot (s+1)}{s(0.1s+1)} = \frac{(1+s)}{s(1+s/10)}$$

$G(j\omega) = \frac{(1+j\omega)}{j\omega \cdot (1+j\omega/10)}$

**步驟二：識別因子**

| 因子 | 類型 | 轉折頻率 |
|------|------|---------|
| 1 (K=1) | 常數 | — |
| 1/(jω) | 積分 | — |
| (1+jω) | 分子一階 | ω = 1 |
| 1/(1+jω/10) | 分母一階 | ω = 10 |

**步驟三：增益圖**

- ω < 1：只有 1/(jω) 貢獻 → 斜率 -20 dB/dec
  - ω=1 時：|G| = 1/(1) = 1 → 0 dB（初始線通過 (1, 0dB)）
- ω = 1：分子轉折 → 斜率 +20 → 總斜率 -20+20 = 0 dB/dec（水平）
- ω = 10：分母轉折 → 斜率 -20 → 總斜率 0-20 = -20 dB/dec

```
增益 (dB)
 20 ╲
     ╲  -20dB/dec
  0 ──╲──────────────╲
       ω=1          ω=10 ╲  -20dB/dec
       (0dB/dec 水平)      ╲
-20                         ╲
─────────────────────────────→ log ω
   0.1  1    10    100
```

**步驟四：相位圖**

- 1/(jω)：-90°（常數）
- (1+jω)：0° → +90°（轉折在 ω=1）
- 1/(1+jω/10)：0° → -90°（轉折在 ω=10）

累加：
- ω << 0.1：-90° + 0° + 0° = -90°
- ω = 1：-90° + 45° + 0° ≈ -45°
- ω = 10：-90° + 90° + (-45°) = -45°
- ω >> 100：-90° + 90° + (-90°) = -90°

---

## 五、增益邊限（GM）與相位邊限（PM）

### 5.1 定義

這兩個邊限量化了系統「離不穩定有多遠」。

**增益邊限 GM（Gain Margin）**：
- 在**相位交越頻率**（Phase Crossover Frequency）$\omega_{pc}$：∠G(jω) = -180° 的頻率
- $GM = -20\log_{10}|G(j\omega_{pc})| \text{ dB} = \frac{1}{|G(j\omega_{pc})|}$（倍數）

**相位邊限 PM（Phase Margin）**：
- 在**增益交越頻率**（Gain Crossover Frequency）$\omega_{gc}$：|G(jω)| = 1（0 dB）的頻率
- $PM = 180° + \angle G(j\omega_{gc})$

### 5.2 穩定性判據

> **對最小相位系統：PM > 0 且 GM > 0（GM > 0 dB）→ 穩定**

- PM 越大 → 越穩定（一般要求 PM > 30°，最好 45°~60°）
- GM 越大 → 越穩定（一般要求 GM > 6 dB）

### 5.3 圖形判讀

```
增益 (dB)
       ↑
       |    ╲
  GM   |     ╲
  ↕    |      ╲
  0dB──|───────╲────── ← ωgc（增益交越）
       |        ╲
       |         ╲─── ← ωpc（相位交越，相位=-180°）
       |              此處增益為負dB，GM=這個距離
───────────────────→ log ω

相位 (度)
       ↑
  0° ──|
       |  ╲
       |   ╲
 -90° ─|    ╲
       |     ╲── ← ωgc 處的相位
       | PM ↕ ╲
-180° ─|───────╲──── ← ωpc
       |        ╲
───────────────────→ log ω
```

**【例題 2】求 GM 和 PM**

$$G(s) = \frac{10}{s(s+1)(s+5)}$$

求 ωpc（相位 = -180°）和 ωgc（增益 = 0dB）。

**求 ωpc**：
$$\angle G(j\omega) = -90° - \tan^{-1}\omega - \tan^{-1}(\omega/5) = -180°$$
$$\tan^{-1}\omega + \tan^{-1}(\omega/5) = 90°$$

用恆等式：$\tan^{-1}a + \tan^{-1}b = 90°$ 當 $ab = 1$

$$\omega \cdot \omega/5 = 1 \Rightarrow \omega^2 = 5 \Rightarrow \omega_{pc} = \sqrt{5} \approx 2.236 \text{ rad/s}$$

**求 GM**：
$$|G(j\omega_{pc})| = \frac{10}{\sqrt{5} \cdot \sqrt{1+5} \cdot \sqrt{5+5}} = \frac{10}{\sqrt{5}\cdot\sqrt{6}\cdot\sqrt{10}}$$
$$= \frac{10}{\sqrt{300}} = \frac{10}{17.32} = 0.577$$

$$GM = \frac{1}{0.577} = 1.732 \quad \Rightarrow \quad GM_{dB} = 20\log(1.732) = 4.77 \text{ dB}$$

**求 ωgc**（|G(jω)|=1）：
$$\frac{10}{\omega\sqrt{1+\omega^2}\sqrt{25+\omega^2}} = 1$$
$$100 = \omega^2(1+\omega^2)(25+\omega^2)$$

數值解得 $\omega_{gc} \approx 1.73$ rad/s

**求 PM**：
$$\angle G(j1.73) = -90° - \tan^{-1}(1.73) - \tan^{-1}(1.73/5)$$
$$= -90° - 59.97° - 19.08° = -169.05°$$

$$PM = 180° + (-169.05°) = 10.95°$$

結論：GM = 4.77 dB > 0，PM = 10.95° > 0 → 系統穩定，但邊限偏小，暫態響應會有較大的超越量。

---

## 六、頻域規格與時域規格對應

### 6.1 相位邊限與阻尼比

$$\boxed{PM \approx 100\zeta \text{（度）}} \quad \text{（當 } \zeta < 0.7 \text{ 時近似）}$$

更精確的近似：$PM \approx \tan^{-1}\frac{2\zeta}{\sqrt{\sqrt{1+4\zeta^4}-2\zeta^2}}$

| PM (°) | 近似 ζ |
|--------|--------|
| 30° | 0.30 |
| 45° | 0.45 |
| 60° | 0.60 |
| 70° | 0.70 |

### 6.2 頻寬與速度

**頻寬 $\omega_{BW}$**：閉迴路增益從 0 dB 降到 -3 dB 的頻率。

- 頻寬越大 → 上升時間越小 → 響應越快
- 近似：$\omega_{BW} \approx \omega_n\sqrt{(1-2\zeta^2)+\sqrt{4\zeta^4-4\zeta^2+2}}$

### 6.3 共振峰值 Mr

$$M_r = \frac{1}{2\zeta\sqrt{1-\zeta^2}} \quad (\zeta < 0.707)$$

Mr 越大 → Mp 越大（更大的超越量）

---

## 七、更多數值例題

**【例題 3】已知波德圖特徵，反推 G(s)**

觀察波德圖得到以下資訊：
- 低頻斜率 -20 dB/dec
- 在 ω=2 處，斜率變為 -40 dB/dec
- 在 ω=10 處，斜率變為 -20 dB/dec
- 在 ω=1 時，增益為 20 dB

求 G(s)。

**解**：
- 低頻 -20 dB/dec → 分母有一個 s（積分因子）
- ω=2 斜率多 -20 → 分母有 (1+s/2)
- ω=10 斜率 +20 → 分子有 (1+s/10)

$$G(s) = \frac{K(1+s/10)}{s(1+s/2)}$$

在 ω=1 求 K：低頻時 G(jω) ≈ K/(jω)

$|G(j1)| \approx K/1 = K$

20 dB = 20log₁₀K → K = 10

$$G(s) = \frac{10(1+s/10)}{s(1+s/2)} = \frac{10(s+10)}{10 \cdot s \cdot (s+2)/2} = \frac{(s+10)}{s(s+2)/2}$$

整理：$G(s) = \frac{10(s+10)}{s(s+2)} = \frac{10s+100}{s^2+2s}$

**【例題 4】波德圖判穩定**

$$G(s) = \frac{K}{s(s+2)(s+8)}$$

求使系統穩定的 K 範圍（用波德圖法）。

**解**：
先找 ωpc：
$$\angle G(j\omega) = -90° - \tan^{-1}(\omega/2) - \tan^{-1}(\omega/8) = -180°$$
$$\tan^{-1}(\omega/2) + \tan^{-1}(\omega/8) = 90°$$
$$\frac{\omega}{2} \cdot \frac{\omega}{8} = 1 \Rightarrow \omega^2 = 16 \Rightarrow \omega_{pc} = 4$$

穩定條件：在 ω=4 時，|G(jω)| < 1（增益 < 0 dB）

$$|G(j4)| = \frac{K}{4\sqrt{4+16}\sqrt{64+16}} = \frac{K}{4\cdot\sqrt{20}\cdot\sqrt{80}} = \frac{K}{4\cdot4.47\cdot8.94} = \frac{K}{160}$$

要求 $K/160 < 1 \Rightarrow K < 160$

$$\boxed{K < 160}$$

驗證（Routh）：$s^3 + 10s^2 + 16s + K = 0$

| | C1 | C2 |
|---|---|---|
| s³ | 1 | 16 |
| s² | 10 | K |
| s¹ | (160-K)/10 | |
| s⁰ | K | |

穩定：K > 0 且 K < 160 ✓

**【例題 5】由 PM 設計增益**

$$G(s) = \frac{K}{s(1+0.5s)(1+0.1s)}$$

要求 PM ≥ 45°，求 K 的最大值。

**解**：
PM = 45° → 在 ωgc 處，∠G = -180°+45° = -135°

$$\angle G(j\omega) = -90° - \tan^{-1}(0.5\omega) - \tan^{-1}(0.1\omega) = -135°$$
$$\tan^{-1}(0.5\omega) + \tan^{-1}(0.1\omega) = 45°$$

令 $f(\omega) = \tan^{-1}(0.5\omega) + \tan^{-1}(0.1\omega)$

試 ω = 1：$\tan^{-1}(0.5) + \tan^{-1}(0.1) = 26.6° + 5.7° = 32.3°$（太小）
試 ω = 2：$\tan^{-1}(1) + \tan^{-1}(0.2) = 45° + 11.3° = 56.3°$（太大）
試 ω = 1.5：$\tan^{-1}(0.75) + \tan^{-1}(0.15) = 36.9° + 8.5° = 45.4°$ ≈ 45° ✓

$\omega_{gc} \approx 1.5$ rad/s

在 ωgc 處要求 |G| = 1：
$$\frac{K}{1.5\sqrt{1+0.5625}\sqrt{1+0.0225}} = 1$$
$$K = 1.5 \times 1.25 \times 1.011 = 1.896$$

$$\boxed{K \approx 1.9}$$

**【例題 6】完整波德圖繪製與分析**

$$G(s) = \frac{50(s+2)}{s(s+10)(s+50)}$$

**標準化**：
$$G(s) = \frac{50 \cdot 2 \cdot (s/2+1)}{s \cdot 10 \cdot (s/10+1) \cdot 50 \cdot (s/50+1)} = \frac{0.2(1+s/2)}{s(1+s/10)(1+s/50)}$$

K = 0.2 → 20log(0.2) = -14 dB

轉折頻率：ω = 2, 10, 50

**增益圖**：
- ω < 2：1/s 斜率 -20dB/dec，在 ω=1 增益為 0.2 → -14dB
- ω = 2：分子轉折 +20 → 斜率 0 dB/dec
- ω = 10：分母轉折 -20 → 斜率 -20 dB/dec
- ω = 50：分母轉折 -20 → 斜率 -40 dB/dec

**相位圖**：
- 低頻：-90°（只有 1/s）
- ω = 2 附近：開始增加（分子零點）
- ω = 10 附近：開始減少（分母極點）
- ω = 50 附近：繼續減少
- 高頻：-90° + 90° - 90° - 90° = -180°

---

## 八、關鍵術語表

| 中文 | 英文 | 白話解釋 | 例子 |
|------|------|----------|------|
| 波德圖 | Bode Plot | 增益和相位 vs 頻率的圖 | 兩張圖 |
| 分貝 | Decibel (dB) | 20log₁₀|G| | 增益×2 = +6dB |
| 轉折頻率 | Corner/Break Frequency | 斜率改變之處 | ω = 1/τ |
| 增益邊限 | Gain Margin (GM) | 相位=-180°時增益離 0dB 多遠 | GM = 10 dB |
| 相位邊限 | Phase Margin (PM) | 增益=0dB 時相位離-180°多遠 | PM = 45° |
| 增益交越頻率 | Gain Crossover Freq. (ωgc) | |G|=0dB 的頻率 | ωgc = 5 rad/s |
| 相位交越頻率 | Phase Crossover Freq. (ωpc) | ∠G=-180° 的頻率 | ωpc = 10 rad/s |
| 頻寬 | Bandwidth (ωBW) | 閉迴路增益 -3dB 的頻率 | ωBW = 20 rad/s |
| 共振峰 | Resonant Peak (Mr) | 二階系統的增益峰值 | Mr = 1.5 |
| 十倍頻 | Decade (dec) | 頻率增加 10 倍 | 1→10 為一個 dec |

---

## 九、題型鑑別表

| 題目特徵 | 解題方法 |
|----------|----------|
| 畫波德圖 | 化標準式→找轉折頻率→逐段畫 |
| 由波德圖求 G(s) | 看斜率變化→找轉折頻率→組合因子 |
| 求 GM 和 PM | 找 ωpc 和 ωgc → 代公式 |
| 由 PM 設計 K | 列相位方程→解 ωgc→幅值條件求 K |
| 頻域→時域對應 | PM ≈ 100ζ，ωBW ↔ 速度 |
| 判斷穩定性 | GM>0dB 且 PM>0° → 穩定 |
| 畫二階因子波德圖 | 注意 ζ 對共振峰和相位的影響 |

---

## ✅ 自我檢測

<details>
<summary><strong>Q1：增益 20 dB 對應多少倍的放大？</strong></summary>

**答**：$20 = 20\log_{10}|G|$，所以 $|G| = 10^1 = 10$ 倍。
</details>

<details>
<summary><strong>Q2：因子 1/(1+jωτ) 在轉折頻率 ω=1/τ 處，實際增益誤差是多少？</strong></summary>

**答**：實際 $|G| = 1/\sqrt{1+1} = 1/\sqrt{2}$，即 $-3$ dB。近似值 0 dB，所以誤差 = **3 dB**。
</details>

<details>
<summary><strong>Q3：相位邊限 PM=60° 大約對應阻尼比多少？</strong></summary>

**答**：$PM \approx 100\zeta$，所以 $\zeta \approx 0.6$。
</details>

<details>
<summary><strong>Q4：如果 GM > 0 但 PM < 0，系統穩定嗎？</strong></summary>

**答**：**不穩定**。兩者都要大於零才穩定（對最小相位系統）。
</details>

<details>
<summary><strong>Q5：1/(jω)² 的波德圖斜率和相位分別是多少？</strong></summary>

**答**：斜率 $-40$ dB/dec，相位 $-180°$（常數）。
</details>

<details>
<summary><strong>Q6：在波德圖上，增加增益 K 相當於什麼操作？</strong></summary>

**答**：增益圖整體上移 $20\log_{10}K$ dB，相位圖不變。所以增加 K 會改變 ωgc（因此改變 PM），但不會改變 ωpc（因此 GM 以 dB 表示也會改變）。
</details>

---

> **下一章預告**：波德圖是用「分貝+度」看頻率響應，而奈奎斯特圖則是在「複數平面」上直接畫出 G(jω) 的軌跡。奈奎斯特穩定性判據比波德圖更強大——它可以處理開迴路就不穩定的系統！
