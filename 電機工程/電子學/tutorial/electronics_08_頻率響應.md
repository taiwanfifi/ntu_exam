# 電子學（八）：頻率響應

## 🔰 本章基礎觀念（零基礎必讀）

### 為什麼放大器有頻寬限制？

你可能以為放大器對任何頻率的信號都放大相同的倍數。但實際上，**放大器的增益會隨頻率而變化**：

- **太低的頻率**：信號被耦合電容和旁路電容擋住
- **太高的頻率**：電晶體內部的寄生電容把信號短路到地

> **白話比喻**：放大器就像一條高速公路——速度太慢（低頻）的車不讓上，速度太快（高頻）的車會失控打滑。只有在一定速度範圍內（**中頻帶**），一切正常。

### 頻率響應的基本形狀

```
增益(dB)
  |          ___________
  |         /           \
  |        /             \
  |       /               \
  |______/                 \________
  |
  +----+----+----+----+----+-----> 頻率(log)
      fL   中頻帶    fH
```

- **fL**：低頻截止頻率（-3dB 頻率）
- **fH**：高頻截止頻率（-3dB 頻率）
- **BW = fH - fL ≈ fH**：頻寬（Bandwidth）

---

## 一、低頻響應

### 1.1 影響低頻的元件

低頻響應由**外部電容**決定（它們在低頻時阻抗很大）：

1. **耦合電容（Coupling Capacitors, CC）**：連接信號源和放大器、放大器和負載
2. **旁路電容（Bypass Capacitor, CE / CS）**：旁路射極/源極電阻

### 1.2 耦合電容產生的極點

每個耦合電容 CC 和它看到的電阻形成一個**高通濾波器**：

$$f_p = \frac{1}{2\pi R_{eq} C}$$

其中 Req 是電容兩端看到的等效電阻。

**輸入耦合電容**：
$$f_{p,in} = \frac{1}{2\pi (R_S + R_{in}) C_{C1}}$$

**輸出耦合電容**：
$$f_{p,out} = \frac{1}{2\pi (R_{out} + R_L) C_{C2}}$$

### 1.3 旁路電容產生的極點

射極/源極旁路電容通常產生**最高的低頻極點**（即低頻截止頻率通常由它決定）。

CE 放大器的旁路電容極點：

$$f_{p,E} = \frac{1}{2\pi R_E' C_E}$$

其中 RE' 是 CE 看到的等效電阻：

$$R_E' = R_E \| \left(\frac{r_\pi + R_S \| R_1 \| R_2}{\beta + 1}\right)$$

**因為 RE' 通常很小**（幾十歐姆），所以這個極點頻率最高，主導低頻截止。

### 1.4 低頻截止頻率 fL

$$f_L \approx \text{max}(f_{p,in}, f_{p,out}, f_{p,E})$$

更精確的方法是用**開路時間常數法（Open-Circuit Time Constant, OCTC）**：

$$f_L \approx \frac{1}{2\pi} \sum_i \frac{1}{R_i C_i}$$

### 數值例題 8.1：低頻截止頻率

> **題目**：CE 放大器，RS = 1kΩ，Rin = 5kΩ，Rout = 10kΩ，RL = 10kΩ。
> CC1 = 1μF，CC2 = 1μF，CE = 10μF，RE = 1kΩ。
> 已知 rπ = 2.6kΩ，β = 100，R1∥R2 = 8kΩ。求 fL。
>
> **解答**：
> 輸入耦合電容極點：
> fp,in = 1/(2π × (1k + 5k) × 1μ) = 1/(2π × 6k × 10⁻⁶) = 26.5 Hz
>
> 輸出耦合電容極點：
> fp,out = 1/(2π × (10k + 10k) × 1μ) = 1/(2π × 20k × 10⁻⁶) = 7.96 Hz
>
> 旁路電容極點：
> RE' = 1k ∥ (2.6k + 1k∥8k)/(101) = 1k ∥ (2.6k + 889)/101
> = 1k ∥ 3489/101 = 1k ∥ 34.5 = 33.3Ω
> fp,E = 1/(2π × 33.3 × 10μ) = 1/(2π × 333μ) = 478 Hz
>
> **fL ≈ fp,E = 478 Hz**（旁路電容主導）

---

## 二、高頻響應

### 2.1 影響高頻的元件

高頻響應由電晶體**內部寄生電容**決定：

**BJT**：
- Cπ（Cbe）：BE 接面電容（擴散 + 空乏電容）
- Cμ（Cbc）：BC 接面電容（空乏電容，通常較小）

**MOSFET**：
- Cgs：閘極-源極電容
- Cgd：閘極-汲極電容（**米勒效應的元兇！**）
- Cdb：汲極-體端電容

### 2.2 米勒效應（Miller Effect）——超級重要！

### 核心觀念

當一個電容 Cgd 跨接在反相放大器（增益 = -A）的輸入和輸出之間時：

- **從輸入看**：等效電容 = Cgd × (1 + |A|)
- **從輸出看**：等效電容 = Cgd × (1 + 1/|A|) ≈ Cgd

$$C_{in,Miller} = C_{gd}(1 + |A_v|)$$

### 為什麼米勒效應這麼可怕？

假設 Cgd = 0.5 pF，Av = -100：
$$C_{in,Miller} = 0.5 × (1+100) = 50.5 \text{ pF}$$

一個小小的 0.5pF 電容被放大成了 50pF！這嚴重降低了高頻截止頻率。

### 2.3 米勒定理（Miller Theorem）

一般化的米勒效應。若一個阻抗 Z 跨接在增益為 K 的放大器輸入和輸出之間：

- 輸入端等效阻抗：Z1 = Z/(1-K)
- 輸出端等效阻抗：Z2 = Z/(1-1/K)

當 Z = 1/(jωC) 且 K = -|A|：

$$C_1 = C(1+|A|), \quad C_2 = C\left(1+\frac{1}{|A|}\right)$$

### 數值例題 8.2：米勒效應

> **題目**：CS 放大器，Av = -50，Cgd = 0.2 pF，Cgs = 1 pF，Cdb = 0.3 pF。
> 求輸入端和輸出端的總等效電容。
>
> **解答**：
> **輸入端**：
> Cin = Cgs + Cgd(1 + |Av|) = 1 + 0.2(1 + 50) = 1 + 10.2 = **11.2 pF**
>
> **輸出端**：
> Cout = Cdb + Cgd(1 + 1/|Av|) = 0.3 + 0.2(1 + 0.02) = 0.3 + 0.204 ≈ **0.5 pF**
>
> 米勒效應使輸入電容從 1.2pF 增加到 11.2pF！

---

## 三、高頻截止頻率分析

### 3.1 分析步驟

1. 畫出高頻小信號等效電路（加入寄生電容）
2. 用米勒定理處理 Cgd/Cμ
3. 找出各節點的等效電阻和電容
4. 計算每個極點 fp = 1/(2πRC)
5. 高頻截止 fH ≈ 最低頻的極點（**主極點**）

### 3.2 CS/CE 放大器的高頻分析

**輸入極點**（通常是主極點）：

$$f_{p,in} = \frac{1}{2\pi R_{in}' C_{in}}$$

$$C_{in} = C_{gs} + C_{gd}(1+g_m R_D')$$

$$R_{in}' = R_S \| R_1 \| R_2$$

**輸出極點**：

$$f_{p,out} = \frac{1}{2\pi R_{out}' C_{out}}$$

$$C_{out} = C_{db} + C_{gd}(1+1/(g_m R_D'))$$

$$R_{out}' = R_D \| R_L$$

### 3.3 短路時間常數法（SCTC）

$$f_H \approx \frac{1}{2\pi \sum_i R_i C_i}$$

每個電容 Ci 對應的電阻 Ri 是**其他電容都短路時**，Ci 兩端看到的等效電阻。

### 數值例題 8.3：CS 放大器的高頻截止

> **題目**：CS 放大器，gm = 5mS，RD = 10kΩ，RS = 1kΩ，R1∥R2 = 500kΩ。
> Cgs = 2pF，Cgd = 0.5pF，Cdb = 0.2pF。求 fH。
>
> **解答**：
> 步驟一：中頻增益
> Av = -gm × RD = -5m × 10k = -50
>
> 步驟二：米勒等效
> Cin = Cgs + Cgd(1+|Av|) = 2 + 0.5 × 51 = 2 + 25.5 = 27.5 pF
> Cout = Cdb + Cgd(1+1/50) = 0.2 + 0.51 ≈ 0.71 pF
>
> 步驟三：等效電阻
> Rin' = RS ∥ (R1∥R2) = 1k ∥ 500k ≈ 998 Ω ≈ 1 kΩ
> Rout' = RD = 10 kΩ
>
> 步驟四：極點頻率
> fp,in = 1/(2π × 1k × 27.5p) = 1/(2π × 27.5n) = 5.79 MHz
> fp,out = 1/(2π × 10k × 0.71p) = 1/(2π × 7.1n) = 22.4 MHz
>
> **fH ≈ fp,in = 5.79 MHz**（輸入極點主導）

---

## 四、增益頻寬積（GBW / GBP）

### 4.1 定義

$$GBW = |A_v| \times f_H$$

**增益頻寬積在很多情況下近似為常數**（特別是對單極點系統）。

### 4.2 意義

- 增加增益 → 頻寬減小
- 增加頻寬 → 增益減小
- 這是基本的設計折衷（trade-off）

### 數值例題 8.4：增益頻寬積

> **題目**：CS 放大器的 GBW = 100 MHz。
> (a) 若增益 = 10，頻寬多少？
> (b) 若增益 = 100，頻寬多少？
> (c) 若需要頻寬 = 50MHz，最大增益多少？
>
> **解答**：
> (a) fH = GBW/|Av| = 100M/10 = **10 MHz**
> (b) fH = 100M/100 = **1 MHz**
> (c) |Av| = GBW/fH = 100M/50M = **2**

---

## 五、波德圖（Bode Plot）

### 5.1 基本概念

波德圖是頻率響應的圖形表示：
- **橫軸**：頻率（對數刻度）
- **縱軸**：增益（dB）或相位（度）

### 5.2 極點的影響

每個極點（pole）在其頻率處：
- 增益：開始以 **-20 dB/decade** 下降
- 相位：移動 **-90°**（在極點頻率處為 -45°）

### 5.3 零點的影響

每個零點（zero）在其頻率處：
- 增益：開始以 **+20 dB/decade** 上升
- 相位：移動 **+90°**

### 5.4 波德圖繪製步驟

1. 求出所有極點和零點頻率
2. 排列：fp1 < fp2 < fp3 ...
3. 從中頻增益開始畫水平線
4. 每遇到一個極點，斜率減 20 dB/dec
5. 每遇到一個零點，斜率加 20 dB/dec

### 數值例題 8.5：波德圖繪製

> **題目**：放大器的轉移函數有中頻增益 40dB，極點在 fp1 = 1MHz 和 fp2 = 10MHz。
> 描述波德圖的形狀。
>
> **解答**：
> - f < 1 MHz：增益 = 40 dB（水平）
> - 1 MHz < f < 10 MHz：斜率 = -20 dB/dec
>   - 在 10 MHz：增益 = 40 - 20×log(10M/1M) = 40 - 20 = 20 dB
> - f > 10 MHz：斜率 = -40 dB/dec（兩個極點疊加）
>   - 在 100 MHz：增益 = 20 - 40×log(100M/10M) = 20 - 40 = -20 dB
>
> -3dB 頻率 ≈ fp1 = 1 MHz（主極點近似）

---

## 六、各組態的頻率響應比較

### 6.1 CE / CS（共射極/共源極）

- **米勒效應嚴重**：Cμ/Cgd 被放大
- 高頻表現**最差**
- fH 最低
- 適合**低頻、高增益**應用

### 6.2 CB / CG（共基極/共閘極）

- **沒有米勒效應**：閘極（基極）接地，Cgd 直接接地
- 高頻表現**最好**
- fH 最高
- 適合**高頻**應用
- 缺點：低輸入阻抗

### 6.3 CC / CD（共集極/共汲極）

- 米勒效應很小（增益 ≈ 1）
- 頻寬**寬**
- 常用於**寬頻緩衝器**

### 6.4 Cascode（CE+CB / CS+CG）

- 結合 CE 的高增益和 CB 的好頻率特性
- CG 級抑制了 CS 級的米勒效應
- **既有高增益又有寬頻帶**

### 比較表

| 組態 | 中頻增益 | fH | GBW | 適用場合 |
|------|---------|-----|-----|---------|
| CS/CE | 高 | 低 | 中 | 低頻放大 |
| CG/CB | 高 | **高** | 高 | 高頻放大 |
| CD/CC | ≈1 | 很高 | 低 | 寬頻緩衝 |
| Cascode | 很高 | 中~高 | **高** | 高性能放大 |

### 數值例題 8.6：Cascode 的頻率優勢

> **題目**：CS 放大器：gm = 5mS，RD = 10kΩ，Cgd = 0.5pF，Cgs = 2pF。
> 同參數的 Cascode 放大器，假設 CG 級消除了米勒效應。
> 比較兩者的 fH。
>
> **解答**：
> **CS**：
> Av = -gm × RD = -50
> Cin = Cgs + Cgd(1+50) = 2 + 25.5 = 27.5 pF
> 假設 Rin' = 1kΩ：
> fH = 1/(2π × 1k × 27.5p) = 5.79 MHz
>
> **Cascode**：
> CG 級使得 CS 級的增益只有 ≈ -gm × (1/gm) = -1
> Cin = Cgs + Cgd(1+1) = 2 + 1 = 3 pF
> fH = 1/(2π × 1k × 3p) = 53.1 MHz
>
> **Cascode 的 fH 是 CS 的 9 倍！**
>
> 而 Cascode 的增益（用主動負載）可以和 CS+主動負載一樣高甚至更高。

---

## 七、轉移頻率 fT（Unity Gain Frequency）

### 7.1 定義

fT 是**短路電流增益等於 1** 的頻率，是電晶體的本質速度指標。

**MOSFET**：
$$f_T = \frac{g_m}{2\pi(C_{gs} + C_{gd})} \approx \frac{g_m}{2\pi C_{gs}}$$

**BJT**：
$$f_T = \frac{g_m}{2\pi(C_\pi + C_\mu)}$$

### 7.2 提高 fT 的方法

$$f_T \propto \frac{g_m}{C_{gs}} \propto \frac{\mu V_{OV}}{L^2}$$

- 縮小通道長度 L
- 增大 VOV
- 使用高遷移率材料

### 數值例題 8.7：轉移頻率

> **題目**：NMOS，gm = 10mS，Cgs = 50fF，Cgd = 10fF。求 fT。
>
> **解答**：
> fT = gm/(2π(Cgs + Cgd))
> = 10m/(2π × 60f)
> = 10m/(377 × 10⁻¹⁵)
> = 10⁻² / (3.77 × 10⁻¹³)
> = 2.65 × 10¹⁰ Hz = **26.5 GHz**

---

## 八、高頻分析的完整範例

### 數值例題 8.8：CE 放大器完整頻率響應

> **題目**：CE 放大器完整參數：
> - 偏壓：IC = 1mA，β = 100，VA = 100V
> - 外部元件：RS = 2kΩ，R1∥R2 = 20kΩ，RC = 5kΩ，RE = 1kΩ，RL = 10kΩ
> - 耦合/旁路：CC1 = CC2 = 1μF，CE = 47μF
> - 寄生電容：Cπ = 10pF，Cμ = 1pF
>
> 求中頻增益、fL、fH。
>
> **解答**：
>
> **小信號參數**：
> gm = 1m/0.026 = 38.46 mS
> rπ = 100/38.46m = 2.6 kΩ
> ro = 100/1m = 100 kΩ
>
> **中頻增益**（CE 旁路，耦合電容短路）：
> Rin = R1∥R2 ∥ rπ = 20k ∥ 2.6k = 2.3 kΩ
> Av = -gm(RC∥RL∥ro) = -38.46m × (5k∥10k∥100k) = -38.46m × 3.23k = -124.2
>
> **低頻截止 fL**：
> fp,in = 1/(2π(RS + Rin)CC1) = 1/(2π × 4.3k × 1μ) = 37 Hz
> fp,out = 1/(2π(RC + RL)CC2) = 1/(2π × 15k × 1μ) = 10.6 Hz
> RE' = RE ∥ (rπ + RS∥R1∥R2)/(β+1)
> = 1k ∥ (2.6k + 2k∥20k)/101
> = 1k ∥ (2.6k + 1.818k)/101
> = 1k ∥ 43.74 = 41.9Ω
> fp,E = 1/(2π × 41.9 × 47μ) = 80.9 Hz
>
> **fL ≈ 80.9 Hz**（旁路電容主導）
>
> **高頻截止 fH**：
> Cin = Cπ + Cμ(1+|gm(RC∥RL)|) = 10p + 1p × (1+38.46m×3.23k)
> = 10p + 1p × 125.2 = 135.2 pF
> Rin' = RS ∥ (R1∥R2) ∥ (不對，從閘極往裡看要包含 rπ)
>
> 修正：從 B 看進去包含 rπ，但從信號源端看：
> RB' = RS ∥ R1 ∥ R2 = 2k ∥ 20k = 1.818kΩ
> 但 Cπ 和 Cμ 是在 rπ 上，所以要考慮 rπ 和 RB' 的組合：
> Rπ_eff = RB'∥rπ 的部分... 使用 SCTC 更準確：
>
> 用簡化的米勒近似：
> Rin_total = (RS∥R1∥R2∥rπ) = (2k∥20k)∥2.6k = 1.818k∥2.6k = 1.069kΩ
> fp,in = 1/(2π × 1.069k × 135.2p) = 1.10 MHz
>
> **fH ≈ 1.10 MHz**
>
> **頻寬 = fH - fL ≈ 1.10 MHz**

---

## 關鍵術語表

| 中文 | 英文 | 白話解釋 | 例子 |
|------|------|---------|------|
| 頻率響應 | Frequency Response | 增益隨頻率的變化曲線 | 波德圖 |
| 頻寬 | Bandwidth (BW) | 增益不低於-3dB的頻率範圍 | fH - fL |
| 耦合電容 | Coupling Capacitor | 阻隔直流、傳遞交流 | CC1, CC2 |
| 旁路電容 | Bypass Capacitor | 交流短路射極/源極電阻 | CE, CS |
| 寄生電容 | Parasitic Capacitance | 元件內部不想要的電容 | Cgs, Cgd, Cπ, Cμ |
| 米勒效應 | Miller Effect | 跨接電容被增益放大 | Cgd(1+\|Av\|) |
| 米勒定理 | Miller Theorem | 將跨接阻抗等效為兩端阻抗 | Z1=Z/(1-K) |
| 極點 | Pole | 增益開始下降-20dB/dec的頻率 | fp = 1/(2πRC) |
| 零點 | Zero | 增益開始上升+20dB/dec的頻率 | 旁路電容產生 |
| 主極點 | Dominant Pole | 頻率最低的極點，決定fH | 通常在輸入端 |
| 增益頻寬積 | Gain-Bandwidth Product (GBW) | \|Av\|×fH，近似常數 | 設計折衷指標 |
| 波德圖 | Bode Plot | 對數頻率vs增益/相位的圖 | 分析工具 |
| 轉移頻率 | Unity Gain Frequency (fT) | 電流增益=1的頻率 | 元件速度指標 |
| -3dB 頻率 | -3dB Frequency | 增益下降3dB（=0.707×中頻）| 截止頻率定義 |

---

## 題型鑑別

| 看到什麼條件 | 用什麼方法 |
|-------------|-----------|
| 「低頻截止」、有耦合/旁路電容 | 逐一算每個電容的極點，取最大值 |
| 「高頻截止」、有寄生電容 | 用米勒效應處理 Cgd/Cμ，求主極點 |
| 「米勒效應」 | Cin = Cgd(1+\|Av\|)，代入求 fp |
| 「求增益頻寬積」 | GBW = \|Av\| × fH |
| 「波德圖」 | 找極點零點，每個極點 -20dB/dec |
| 「比較 CS 和 Cascode」 | Cascode 消除米勒效應，fH 更高 |
| 「求 fT」 | fT = gm/(2π(Cgs+Cgd)) |

---

## ✅ 自我檢測

### 概念題

1. 放大器低頻增益下降的原因是什麼？高頻增益下降的原因呢？
2. 什麼是米勒效應？為什麼它主要影響 CS/CE 放大器？
3. 增益頻寬積（GBW）代表什麼設計折衷？
4. 為什麼 Cascode 放大器的頻寬比 CS 放大器好？
5. 旁路電容通常產生低頻響應中最高的極點頻率，為什麼？

<details>
<summary>點擊查看答案</summary>

1. **低頻下降是因為耦合電容和旁路電容在低頻阻抗很大，無法有效傳遞或旁路信號。高頻下降是因為電晶體的寄生電容在高頻阻抗很小，將信號短路到地。**

2. **米勒效應是跨接在反相放大器輸入和輸出之間的電容被「放大」的現象。** 等效輸入電容 = Cgd(1+|Av|)。它主要影響 CS/CE 是因為這些組態有大的反相增益。CG/CB 的閘極/基極接地，沒有這個放大效果。

3. **GBW = |Av| × fH 近似為常數，代表增益和頻寬不能同時增大。** 想要更高的增益就必須犧牲頻寬，反之亦然。這是單極點系統的基本限制。

4. **因為 CG 級讓 CS 級看到的負載只有約 1/gm（很小），所以 CS 級的增益接近 1，米勒效應被大幅抑制。** 同時整體增益由 CG 級的大負載決定，仍然很高。

5. **因為旁路電容兩端的等效電阻 RE' 非常小（通常只有幾十歐姆）。** fp = 1/(2πRE'CE)，分母中 RE' 很小，所以即使 CE 很大，fp 仍然比較高。

</details>

### 計算題

6. CS 放大器，Av = -20，Cgd = 0.3pF，Cgs = 1.5pF。求因米勒效應的等效輸入電容。
7. 上題，若 RS∥(R1∥R2) = 2kΩ，求高頻截止 fH。
8. 放大器 GBW = 200MHz，若需要 |Av| = 50，最大頻寬是多少？
9. NMOS fT = 30GHz，Cgs = 40fF，Cgd = 8fF。求 gm。

<details>
<summary>點擊查看答案</summary>

6. Cin = Cgs + Cgd(1+|Av|) = 1.5 + 0.3×21 = 1.5 + 6.3 = **7.8 pF**

7. fH ≈ 1/(2π × 2k × 7.8p) = 1/(2π × 15.6n) = **10.2 MHz**

8. fH = GBW/|Av| = 200M/50 = **4 MHz**

9. gm = fT × 2π(Cgs + Cgd) = 30G × 2π × 48f
   = 30×10⁹ × 3.016×10⁻¹³ = **9.05 mS**

</details>

---

> **下一篇**：[electronics_09_回授與穩定性](electronics_09_回授與穩定性.md) — 學習如何用回授改善放大器性能！
