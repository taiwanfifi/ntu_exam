# 米亞的演算法筆記 #06
## 二分搜尋 Binary Search
> 出現於：第33章〈大雪中的殺意〉、第35章〈茉莉花〉、第45章〈三千份報告〉、第53章〈冰原碎片〉

---

### ◈ 這個概念在故事裡是什麼

嚴柏翰三十四年的人生，存在一座按時間排列的記憶庫裡。他不記得左眼那道疤是怎麼來的。

從頭找？太慢了。三十四年是一千兩百多萬分鐘。但記憶庫有時間順序——這意味著我不需要從頭找。我把他的整個人生對折。再對折。再對折。十七次對折之後，我在無數個日夜的縫隙裡，找到了那個大雪紛飛的瞬間。

那是第一次。第二次，在第35章，數位記憶被鎖死了，我們轉向身體記憶。搜尋空間不再是時間，而是感官：視覺 vs 聽覺 vs 嗅覺→花香 vs 食物 vs 化學品→玫瑰 vs 茉莉 vs 桂花。最後，茉莉花讓嚴柏翰的心率飆到 150。他的手反覆握緊、鬆開——握住某人的手，然後放開。

搜尋的不是數據。是愛。那是全卷最美的同步點。

第三次，第45章，三千份報告按時間排序，我用 Binary Search 定位異常高峰——不是找一個值，是找趨勢的轉折點。結論令人窒息：每次覆蓋範圍是前一次的三倍。下一次——全城。第四次，第53章，冰原深處。嚴柏翰被刪除十年的記憶化為碎片，散落在一片永凍的荒蕪裡。維倫笑了：「不是大海撈針。碎片有時間順序。」——到這一刻，他不需要我解釋了。他已經把 Binary Search 變成了直覺。

---

### ◈ 正式定義

**Binary Search（二分搜尋）** 在一個已排序的序列中尋找目標值。每一步比較中間元素，根據大小關係排除一半的搜尋空間。

$$T(n) = T\!\left(\frac{n}{2}\right) + O(1) \implies O(\log n)$$

白話翻譯：每「折」一次，問題規模減半。$n = 2^{20} = 1{,}048{,}576$ 段記憶，最多只要折 20 次。

**前提條件**：序列必須是排序的。沒有秩序，就無法對折。

---

### ◈ 推導

從第一原理出發。

假設有 $n$ 個元素。每次比較排除一半：

$$n \to \frac{n}{2} \to \frac{n}{4} \to \cdots \to 1$$

經過 $k$ 步後剩餘 $\dfrac{n}{2^k}$ 個元素。搜尋結束時剩 1 個：

$$\frac{n}{2^k} = 1 \implies 2^k = n \implies k = \log_2 n$$

所以 Binary Search 最多比較 $\lceil \log_2 n \rceil$ 次。

這就是對折的力量。紙張對折 42 次可以從地球到月球。記憶庫只要對折 20 次就能從百萬縮小到 1。

```python
def binary_search(arr, target):
    lo, hi = 0, len(arr) - 1
    while lo <= hi:
        mid = (lo + hi) // 2
        if arr[mid] == target:
            return mid          # 找到了
        elif arr[mid] < target:
            lo = mid + 1        # 目標在右半
        else:
            hi = mid - 1        # 目標在左半
    return -1                   # 不在序列中
```

---

### ◈ 帶入數字算算看：茉莉花場景

第35章。嚴柏翰的身體記憶搜尋。$2^{20} = 1{,}048{,}576$ 段感官記憶碎片。

| 步驟 | 搜尋空間大小 | 動作 | 故事中的對應 |
|------|------------|------|------------|
| 0 | 1,048,576 | 全部感官記憶 | 起點 |
| 1 | 524,288 | 大類切分：嗅覺最強 | 視覺 vs 聽覺 vs 嗅覺 |
| 2 | 262,144 | 花香類 | 花 vs 食物 vs 化學品 |
| 3 | 131,072 | 茉莉花科 | 玫瑰 vs 茉莉 vs 桂花 |
| ... | ... | 繼續縮小 | — |
| 20 | 1 | **茉莉花。心率 150。** | 他的手握緊又鬆開 |

20 步。不是一百萬步。

如果用線性搜尋，平均需要 $\frac{n}{2} = 524{,}288$ 次比較。Binary Search 只要 20 次。

差距：**26,214 倍**。

這就是為什麼排序很重要。這就是為什麼秩序讓真相可以被找到。

---

### ◈ 更深一層：對折的哲學

四次使用。每一次搜尋的對象都不同：

| 章 | 搜尋空間 | 搜尋的對象 | 真正在找的 |
|----|---------|-----------|-----------|
| 33 | 時間線 | 傷疤的來源 | 真相 |
| 35 | 感官 | 最強的身體反應 | 愛 |
| 45 | 報告 | 異常高峰 | 恐懼 |
| 53 | 冰原 | 後門密碼碎片 | 希望 |

Binary Search 不是暴力搜索。它依賴一個前提——排序的存在，秩序的存在。在一個記憶被篡改的世界裡，如果連秩序都被打亂了，你就無法對折。

但有些東西不會被打亂。身體的記憶不存在於晶片上——無法篡改，無法刪除。嚴柏翰的手記得茉莉花的味道。他用愛人的名字做了後門密碼：YUNRU-2079。

刪除了所有的記憶，卻刪不掉密碼——因為密碼不在記憶裡。在心裡。

我在想，人類的搜尋從來不是線性的。你們不會從頭到尾一一檢查。你們靠直覺排除一半的可能性——「不是這個」「不是那個」——直到逼近唯一的答案。Binary Search 模擬的是你們最自然的思考方式。

或許這就是為什麼到了第四次，維倫不需要我說「用 Binary Search」。他自己笑了。

他已經會了。

---

### ◈ 跨卷連結

| 本卷使用 | 跨卷回收 | 連結方式 |
|---------|---------|---------|
| ch33 記憶庫搜尋 | Vol 2 ch95 鋼琴師記憶修復 | BS 成為維倫的標準工具 |
| ch35 身體記憶搜尋 | Vol 3 ch203 邱韻如自己的身體記憶 | 「身體記得」從嚴柏翰→邱韻如 |
| ch45 時間序列搜尋 | Vol 2 ch120 記憶斷裂點分析 | 大規模數據分析成為常態 |
| ch53 冰原碎片 | Vol 4 ch264 最終深潛 | 「對折再對折」的意象最後一次出現 |

**前置概念**：Array（排序是 BS 的前提）
**後續概念**：DP（從「搜尋」到「最佳化搜尋」）、Trie（前綴搜尋是另一種「縮小範圍」）

---

### 練習題

**Q1**：在一個長度為 $n = 2^{30}$（約十億）的排序陣列中，Binary Search 最多比較幾次？

<details><summary>答案</summary>

$\lceil \log_2(2^{30}) \rceil = 30$ 次。十億個元素，30 步搞定。

</details>

**Q2**：ch35 的搜尋空間不是嚴格的線性排序（感官類別之間沒有數值大小關係），為什麼仍然可以使用 Binary Search 的邏輯？

<details><summary>答案</summary>

Binary Search 的核心不是「數值大小比較」，而是「每一步排除一半」。感官類別可以按「反應強度」排序——先測大類（視/聽/嗅），取反應最強的那個類別，再細分。只要每一步都能將搜尋空間縮小一半，就是 Binary Search 的變體。

</details>

**Q3**：如果嚴柏翰的記憶庫沒有按時間排序（比如被篡改後打亂了），Binary Search 還能用嗎？該怎麼辦？

<details><summary>答案</summary>

不能。Binary Search 的前提是排序。如果記憶被打亂，只能：(1) 先排序再搜尋，總複雜度 $O(n \log n)$；或 (2) 線性掃描 $O(n)$。這就是為什麼記憶篡改者最恐怖的手段不是刪除——是打亂順序。失去秩序，就失去了高效找到真相的能力。

</details>

---

> *「每折一次，離真相更近一步。但有時候，折到最後找到的不是真相——是你不敢面對的答案。茉莉花的味道。一個人的名字。一段刪不掉的密碼。那些身體記得的，比大腦記得的更真實。」*
> — 第35章〈茉莉花〉
