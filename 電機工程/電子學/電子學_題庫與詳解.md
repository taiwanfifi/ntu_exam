# 電子學（Electronics）完整題庫與詳解

> 本題庫涵蓋台大電機系電子學(一)(二)(三)所有重要主題，共 60 題
> 適用：台大電機博士班資格考、碩士班入學考、業界面試準備
> 參考教材：Erta Sedra/Smith《Microelectronic Circuits》、Razavi《Design of Analog CMOS Integrated Circuits》

---

## Part 1：半導體基礎與二極體（Semiconductor Fundamentals & Diodes）

---

### 題目 1：PN 接面內建電位計算
**來源**：台大電機 / 經典題型
**難度**：★★☆☆☆
**主題**：PN 接面物理（PN Junction Physics）

**題目**：

一矽（Silicon）PN 接面二極體，在室溫 T = 300K 下，P 型側摻雜濃度 N_A = 10^17 cm^-3，N 型側摻雜濃度 N_D = 10^16 cm^-3。矽的本質載子濃度 n_i = 1.5 × 10^10 cm^-3。

(a) 求內建電位（built-in potential）V_0。
(b) 若施加反向偏壓 V_R = 5V，求空乏區總寬度 W。
（矽的介電常數 ε_s = 11.7ε_0，ε_0 = 8.854 × 10^-14 F/cm）

**詳解**：

**解題思路**：利用內建電位公式與空乏區寬度公式直接計算。

**步驟**：

(a) 內建電位公式：

```
V_0 = V_T × ln(N_A × N_D / n_i²)
```

其中熱電壓（thermal voltage）V_T = kT/q = 26 mV（在 300K）

代入數值：

```
V_0 = 0.026 × ln(10^17 × 10^16 / (1.5 × 10^10)²)
     = 0.026 × ln(10^33 / 2.25 × 10^20)
     = 0.026 × ln(4.44 × 10^12)
     = 0.026 × 29.12
     = 0.757 V
```

> **答案 (a)：V_0 ≈ 0.757 V**

(b) 空乏區寬度公式（反向偏壓時 V_R 為正值）：

```
W = √(2ε_s / q × (1/N_A + 1/N_D) × (V_0 + V_R))
```

計算各項：

```
ε_s = 11.7 × 8.854 × 10^-14 = 1.036 × 10^-12 F/cm
q = 1.6 × 10^-19 C

1/N_A + 1/N_D = 1/10^17 + 1/10^16 = 10^-17 + 10^-16 = 1.1 × 10^-16 cm^3

V_0 + V_R = 0.757 + 5 = 5.757 V

W = √(2 × 1.036 × 10^-12 / 1.6 × 10^-19 × 1.1 × 10^-16 × 5.757)
  = √(1.295 × 10^7 × 1.1 × 10^-16 × 5.757)
  = √(8.20 × 10^-9)
  = 9.06 × 10^-5 cm
  = 0.906 μm
```

> **答案 (b)：W ≈ 0.906 μm**

**延伸思考**：若 N_A >> N_D，空乏區幾乎全部在 N 側，這就是單邊突變接面（one-sided step junction）的概念，常見於實際二極體設計。

---

### 題目 2：Shockley 二極體方程與溫度效應
**來源**：台大電機 / 經典題型
**難度**：★★☆☆☆
**主題**：二極體 I-V 特性（Diode I-V Characteristics）

**題目**：

一矽二極體在 T = 300K 時，反向飽和電流 I_S = 10^-14 A，理想因子（ideality factor）n = 1。

(a) 求順向偏壓 V_D = 0.7V 時的二極體電流 I_D。
(b) 若溫度升高至 T = 350K，假設 I_S 增為原來的 128 倍，求維持相同電流 I_D 時所需的 V_D。
(c) 由 (b) 的結果，估算二極體順向壓降的溫度係數（mV/°C）。

**詳解**：

**解題思路**：直接套用 Shockley 方程，注意溫度對 V_T 和 I_S 的雙重影響。

**步驟**：

(a) Shockley 方程：

```
I_D = I_S × (e^(V_D / nV_T) - 1)
```

V_T = 26 mV = 0.026 V（T = 300K）

```
I_D = 10^-14 × (e^(0.7/0.026) - 1)
    = 10^-14 × (e^26.92 - 1)
    = 10^-14 × 4.88 × 10^11
    ≈ 4.88 × 10^-3 A
    ≈ 4.88 mA
```

> **答案 (a)：I_D ≈ 4.88 mA**

(b) 在 T = 350K：

```
V_T(350K) = kT/q = 0.026 × (350/300) = 0.03017 V
I_S(350K) = 128 × 10^-14 = 1.28 × 10^-12 A
```

要使 I_D 不變，由 I_D = I_S' × e^(V_D'/nV_T') 求 V_D'：

```
V_D' = n × V_T' × ln(I_D / I_S')
     = 1 × 0.03017 × ln(4.88 × 10^-3 / 1.28 × 10^-12)
     = 0.03017 × ln(3.81 × 10^9)
     = 0.03017 × 22.06
     = 0.6655 V
```

> **答案 (b)：V_D' ≈ 0.666 V**

(c) 溫度係數：

```
ΔV_D / ΔT = (0.666 - 0.700) / (350 - 300) = -0.034 / 50 = -0.68 mV/°C
```

> **答案 (c)：溫度係數 ≈ -0.68 mV/°C（接近典型值 -2 mV/°C 的量級）**

**延伸思考**：實際矽二極體的溫度係數約為 -1.8 至 -2.2 mV/°C。本題 I_S 的變化量較保守，實際上 I_S 隨溫度呈指數增長，每升高約 5°C，I_S 約增為兩倍。

---

### 題目 3：二極體小信號電阻與疊加分析
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：小信號模型（Small-Signal Model）

**題目**：

一二極體工作在直流偏壓點 I_D = 1 mA，理想因子 n = 1，T = 300K。在直流偏壓點上疊加一小信號 v_d = 5 mV（峰值）的正弦波。

(a) 求小信號電阻 r_d。
(b) 求小信號電流 i_d 的峰值。
(c) 若要小信號近似有效（失真 < 10%），v_d 的峰值不應超過多少？

**詳解**：

**解題思路**：利用小信號電阻公式，並分析小信號近似的有效範圍。

**步驟**：

(a) 小信號電阻：

```
r_d = nV_T / I_D = 1 × 26 mV / 1 mA = 26 Ω
```

> **答案 (a)：r_d = 26 Ω**

(b) 小信號電流峰值：

```
i_d = v_d / r_d = 5 mV / 26 Ω = 0.192 mA ≈ 0.19 mA
```

> **答案 (b)：i_d ≈ 0.19 mA（峰值）**

(c) 小信號近似的有效條件要求 v_d << nV_T。一般經驗法則：

```
v_d(peak) ≤ nV_T / 2 = 26/2 = 13 mV（較嚴格）
```

更精確地，展開指數函數到二階項，失真分量與基波之比為：

```
失真比 ≈ v_d / (4 × nV_T)
```

令失真 < 10%：

```
v_d / (4 × 26) < 0.1
v_d < 10.4 mV
```

> **答案 (c)：v_d(peak) ≤ 約 10 mV（保守取 nV_T/2 ≈ 13 mV）**

**延伸思考**：在放大器設計中，「小信號近似有效範圍」決定了線性動態範圍（linear dynamic range），這是類比電路設計的核心考量之一。

---

### 題目 4：半波整流器與漣波電壓
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：整流器設計（Rectifier Design）

**題目**：

一半波整流器（half-wave rectifier）接一濾波電容 C，負載電阻 R_L = 1 kΩ。輸入正弦波 v_s = 10sin(2π × 60t) V，二極體為理想（V_D = 0）。

```
  v_s ──|>|──┬── v_o
              |
             C = 100μF    R_L = 1kΩ
              |             |
             GND ─────── GND
```

(a) 求輸出直流電壓 V_DC（近似值）。
(b) 求峰對峰漣波電壓（ripple voltage）V_r。
(c) 若改用全波橋式整流器（bridge rectifier），非理想二極體 V_D = 0.7V，求新的 V_DC 和 V_r。

**詳解**：

**解題思路**：利用漣波電壓近似公式，分別分析半波與全波情況。

**步驟**：

(a) 理想二極體，V_p = 10V（峰值），半波整流輸出直流近似為峰值減去漣波一半：

先算漣波：

```
V_r = V_p / (f × R_L × C)
    = 10 / (60 × 1000 × 100 × 10^-6)
    = 10 / 6
    = 1.667 V
```

直流平均值：

```
V_DC ≈ V_p - V_r/2 = 10 - 0.833 = 9.167 V
```

> **答案 (a)：V_DC ≈ 9.17 V**

(b) 峰對峰漣波電壓：

> **答案 (b)：V_r ≈ 1.67 V（峰對峰）**

(c) 全波橋式整流器，每次有兩個二極體導通：

```
V_p(output) = V_p(input) - 2V_D = 10 - 1.4 = 8.6 V
```

全波整流的等效頻率為 2f = 120 Hz：

```
V_r = V_p(output) / (2f × R_L × C)
    = 8.6 / (120 × 1000 × 100 × 10^-6)
    = 8.6 / 12
    = 0.717 V

V_DC ≈ 8.6 - 0.717/2 = 8.6 - 0.358 = 8.24 V
```

> **答案 (c)：V_DC ≈ 8.24 V，V_r ≈ 0.72 V**

**延伸思考**：全波整流漣波頻率為輸入的兩倍，漣波電壓約為半波的一半，因此在實務上全波橋式整流器是最常用的架構。增大 C 或 R_L 可進一步降低漣波。

---

### 題目 5：齊納二極體穩壓電路
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：齊納穩壓電路（Zener Regulator）

**題目**：

一齊納穩壓電路如下，齊納電壓 V_Z = 5.1V，齊納電阻 r_z = 10Ω，串聯電阻 R_S = 470Ω。輸入電壓 V_S 在 9V 至 15V 間變動，負載 R_L = 1 kΩ。

```
     R_S = 470Ω
V_S ──/\/\/──┬── V_o
             |
            [ ] Zener V_Z=5.1V, r_z=10Ω
             |
            GND

        R_L=1kΩ 接於 V_o 與 GND 之間
```

(a) 當 V_S = 12V 時，求 V_o、齊納電流 I_Z、負載電流 I_L。
(b) 求線調節率（line regulation）= ΔV_o/ΔV_S。
(c) 求 V_S 的最小值使齊納仍維持穩壓（假設 I_Z(min) = 1 mA）。

**詳解**：

**解題思路**：先確認齊納在崩潰區工作，再用分壓/分流分析。考慮 r_z 時需用更精確模型。

**步驟**：

(a) 考慮 r_z 的齊納模型，V_o = V_Z + I_Z × r_z（但 r_z 很小，先近似 V_o ≈ V_Z）。

用迭代法。先假設 V_o ≈ 5.1V：

```
I_L = V_o / R_L = 5.1 / 1000 = 5.1 mA

I_total = (V_S - V_o) / R_S = (12 - 5.1) / 470 = 6.9 / 470 = 14.68 mA

I_Z = I_total - I_L = 14.68 - 5.1 = 9.58 mA
```

更精確：V_o = V_Z + I_Z × r_z = 5.1 + 9.58 × 10^-3 × 10 = 5.1 + 0.096 = 5.196V

重新迭代（通常一次即夠）：

```
I_L = 5.196 / 1000 = 5.196 mA
I_total = (12 - 5.196) / 470 = 6.804 / 470 = 14.48 mA
I_Z = 14.48 - 5.196 = 9.28 mA
V_o = 5.1 + 9.28 × 10^-3 × 10 = 5.193 V
```

> **答案 (a)：V_o ≈ 5.19 V，I_Z ≈ 9.3 mA，I_L ≈ 5.2 mA**

(b) 線調節率：利用分壓原理，r_z 與 R_S 形成分壓：

```
ΔV_o / ΔV_S = r_z || R_L / (R_S + r_z || R_L)
```

r_z || R_L = 10 × 1000 / (10 + 1000) = 9.9 Ω

```
ΔV_o / ΔV_S = 9.9 / (470 + 9.9) = 9.9 / 479.9 ≈ 0.0206
```

即 V_S 變化 1V，V_o 僅變化約 20.6 mV。

> **答案 (b)：線調節率 ≈ 0.021（即 2.1%，或 20.6 mV/V）**

(c) 最小 V_S 使 I_Z ≥ I_Z(min) = 1 mA：

```
V_o(min) = 5.1 + 1 × 10^-3 × 10 = 5.11 V
I_L = 5.11 / 1000 = 5.11 mA
I_total(min) = I_Z(min) + I_L = 1 + 5.11 = 6.11 mA
V_S(min) = V_o(min) + I_total(min) × R_S = 5.11 + 6.11 × 10^-3 × 470 = 5.11 + 2.87 = 7.98 V
```

> **答案 (c)：V_S(min) ≈ 8.0 V**

**延伸思考**：齊納穩壓器的效率不高（多餘電流流經齊納），在大電流應用中通常使用三端穩壓器（如 LM7805）或開關式穩壓器（switching regulator）。

---

### 題目 6：二極體限幅器電路分析
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：限幅器（Clipper / Limiter）

**題目**：

下圖為雙向限幅器，二極體導通壓降 V_D = 0.7V，電池電壓 V_1 = 3V，V_2 = 5V。輸入 v_i = 10sin(ωt) V，求輸出 v_o 的波形，標示所有轉折點電壓。

```
          R = 1kΩ
v_i ──/\/\/──┬── v_o
             |
        D1 ──┤── +V_1 = 3V（D1 陽極接節點，陰極接 V_1）
             |
        D2 ──┤── -V_2 = -5V（D2 陰極接節點，陽極接 -V_2）
```

**詳解**：

**解題思路**：分析各二極體的導通條件，確定輸出的限幅電壓值。

**步驟**：

分析 D1（上限幅）：
- D1 陽極接 v_o 節點，陰極接 +3V
- D1 導通條件：v_o > V_1 + V_D = 3 + 0.7 = 3.7V
- 當 D1 導通，v_o 被限制在 3.7V

分析 D2（下限幅）：
- D2 陰極接 v_o 節點，陽極接 -5V
- D2 導通條件：v_o < -V_2 - V_D = -5 - 0.7 = -5.7V
- 當 D2 導通，v_o 被限制在 -5.7V

輸出波形三個區間：
```
(1) v_i > 3.7V 時：v_o = 3.7V（D1 導通，上限幅）
(2) -5.7V ≤ v_i ≤ 3.7V 時：v_o = v_i（兩個二極體皆截止）
(3) v_i < -5.7V 時：v_o = -5.7V（D2 導通，下限幅）
```

轉折點時間計算：
```
上限幅開始：10sin(ωt) = 3.7 → ωt = arcsin(0.37) ≈ 21.7°
下限幅開始：10sin(ωt) = -5.7 → ωt = 180° + arcsin(0.57) ≈ 214.7°
```

> **答案：v_o 在 -5.7V 至 +3.7V 之間，為非對稱限幅正弦波。上限幅電壓 +3.7V，下限幅電壓 -5.7V。**

**延伸思考**：若將電池方向反接，則限幅器變為「窗口」型限幅器，僅在特定範圍內截取信號。此電路廣泛用於波形整形和保護電路中。

---

### 題目 7：二極體箝位器（直流位準平移）
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：箝位器（Clamper / DC Restorer）

**題目**：

一箝位器電路如下，輸入為對稱方波 v_i 在 +5V 和 -5V 之間切換，頻率夠高使 RC 時間常數遠大於週期。二極體理想（V_D = 0）。

```
         C
v_i ──||──┬── v_o
          |
         D（陽極接地，陰極接節點）
          |
         R_L（接至 GND）
```

(a) 畫出穩態 v_o 波形並標示電壓值。
(b) 若二極體反接（陽極接節點，陰極接地），v_o 如何變化？

**詳解**：

**解題思路**：箝位器利用電容充電使輸出波形的某一極值被「箝住」在特定電壓。

**步驟**：

(a) 原電路分析：

二極體陽極接地、陰極接輸出節點。二極體在 v_o < 0 時導通（即節點電壓低於地電位時）。

第一個負半週：v_i = -5V
- 電容透過導通的二極體充電
- v_o 被箝在 0V（二極體導通，陰極被拉至 ≈ 0V）
- 電容兩端電壓：V_C = v_i - v_o = -5 - 0 = -5V（左正右負... 修正：左為 v_i 側）
- V_C = v_o - v_i = 0 - (-5) = 5V（v_o 側為正）

穩態後電容電壓固定為 V_C = 5V。

正半週：v_i = +5V
```
v_o = v_i + V_C = 5 + 5 = 10V
```
此時二極體反偏（v_o = 10V > 0），不導通，正確。

負半週：v_i = -5V
```
v_o = v_i + V_C = -5 + 5 = 0V
```
二極體恰好零偏壓，不充放電，穩態一致。

穩態 v_o 波形：在 0V 和 +10V 之間切換的方波。

> **答案 (a)：v_o 為 0V 至 +10V 的方波，負峰被箝在 0V。**

(b) 二極體反接（陽極接節點，陰極接地）：

二極體在 v_o > 0 時導通，將正峰箝在 0V。

正半週時二極體導通：v_o = 0V，V_C = 0 - 5 = -5V（v_o 側為負）

穩態：
```
正半週：v_o = v_i + V_C = 5 + (-5) = 0V
負半週：v_o = v_i + V_C = -5 + (-5) = -10V
```

> **答案 (b)：v_o 為 -10V 至 0V 的方波，正峰被箝在 0V。**

**延伸思考**：箝位器常用於電視信號處理中的「直流恢復」（DC restoration），以及 DRAM 中的電荷泵（charge pump）電路。若在二極體上串聯一個直流電壓源，可將箝位電壓調整到任意值。

---

### 題目 8：正向偏壓二極體的電荷儲存與開關時間
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：二極體動態特性（Diode Switching Characteristics）

**題目**：

一 PN 接面二極體工作在正向電流 I_F = 10 mA 時，少數載子生命期（minority carrier lifetime）τ_s = 100 ns。突然切換至反向偏壓，反向電流限制為 I_R = 5 mA。

(a) 求儲存時間（storage time）t_s。
(b) 求正向偏壓時二極體中儲存的電荷 Q。
(c) 說明為何快速恢復二極體（fast recovery diode）和蕭特基二極體（Schottky diode）可改善此問題。

**詳解**：

**解題思路**：二極體從正向切換到反向時，需先移除儲存在基區的少數載子電荷，期間二極體維持低阻抗導通反向電流。

**步驟**：

(a) 儲存時間公式：

```
t_s = τ_s × ln(1 + I_F/I_R)
    = 100 × 10^-9 × ln(1 + 10/5)
    = 100 × 10^-9 × ln(3)
    = 100 × 10^-9 × 1.099
    ≈ 110 ns
```

> **答案 (a)：t_s ≈ 110 ns**

(b) 儲存電荷：

```
Q = I_F × τ_s = 10 × 10^-3 × 100 × 10^-9 = 1 × 10^-9 C = 1 nC
```

> **答案 (b)：Q = 1 nC**

(c) 改善方法：

- **快速恢復二極體**：透過金摻雜（gold doping）或電子照射（electron irradiation）減小 τ_s，典型 τ_s < 10 ns，但會增大漏電流。

- **蕭特基二極體**：使用金屬-半導體接面（metal-semiconductor junction），為多數載子元件（majority carrier device），沒有少數載子儲存問題，切換時間可達 ps 等級。缺點是反向漏電流較大，耐壓較低。

> **答案 (c)：蕭特基二極體無少數載子儲存效應，開關速度最快；快速恢復二極體透過減小載子生命期加速恢復。**

**延伸思考**：在高頻開關電源（switching power supply）中，二極體的反向恢復電流會造成額外功耗和 EMI，因此蕭特基二極體在低壓應用中被廣泛使用。

---

### 題目 9：光二極體與太陽能電池等效電路
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：光電元件（Optoelectronic Devices）

**題目**：

一矽太陽能電池在標準光照下，光生電流（photocurrent）I_ph = 100 mA，暗電流（dark current）參數 I_S = 10^-10 A，n = 1.2，T = 300K。

```
等效電路：
I_ph（電流源）── 並聯 ── 二極體 D ── 並聯 ── R_sh ── 串聯 R_s ── 外部負載 R_L

簡化：忽略 R_s 和 R_sh
```

(a) 求開路電壓（open-circuit voltage）V_OC。
(b) 求短路電流 I_SC。
(c) 若負載 R_L 使操作在最大功率點（maximum power point），估算填充因子（fill factor）FF，並求最大輸出功率。

**詳解**：

**解題思路**：太陽能電池等效為光生電流源並聯一個二極體，輸出電流 I = I_ph - I_D。

**步驟**：

(a) 開路時 I = 0，所有光電流流經二極體：

```
I_ph = I_S × (e^(V_OC / nV_T) - 1)
```

因為 I_ph >> I_S：

```
V_OC = nV_T × ln(I_ph / I_S)
     = 1.2 × 0.026 × ln(100 × 10^-3 / 10^-10)
     = 0.0312 × ln(10^9)
     = 0.0312 × 20.72
     = 0.646 V
```

> **答案 (a)：V_OC ≈ 0.646 V**

(b) 短路電流：V = 0，二極體電流為零

```
I_SC = I_ph = 100 mA
```

> **答案 (b)：I_SC = 100 mA**

(c) 填充因子的經驗公式（對矽太陽能電池）：

定義正規化電壓 v_oc = V_OC / nV_T = 0.646 / 0.0312 = 20.7

```
FF ≈ (v_oc - ln(v_oc + 0.72)) / (v_oc + 1)
   = (20.7 - ln(21.42)) / 21.7
   = (20.7 - 3.065) / 21.7
   = 17.635 / 21.7
   ≈ 0.813
```

最大輸出功率：

```
P_max = FF × V_OC × I_SC
      = 0.813 × 0.646 × 0.1
      = 0.0525 W ≈ 52.5 mW
```

> **答案 (c)：FF ≈ 0.81，P_max ≈ 52.5 mW**

**延伸思考**：串聯電阻 R_s 會降低 FF，而並聯電阻 R_sh（漏電）會降低 V_OC。實際矽太陽能電池 FF 約 0.75-0.85，V_OC 約 0.55-0.65V。多晶片串聯可提高系統電壓。

---

### 題目 10：雪崩崩潰與齊納崩潰機制比較
**來源**：台大電機 / 經典題型
**難度**：★★☆☆☆
**主題**：崩潰機制（Breakdown Mechanisms）

**題目**：

(a) 比較雪崩崩潰（avalanche breakdown）與齊納崩潰（Zener breakdown）的物理機制。
(b) 已知某二極體的崩潰電壓 V_BR = 6V。當溫度從 25°C 升至 75°C，V_BR 增加了 30 mV。判斷此二極體以哪種崩潰機制為主，並解釋原因。
(c) 為何 V_BR ≈ 5V 附近的二極體溫度係數最小？在精密參考電壓電路中如何利用此特性？

**詳解**：

**解題思路**：從物理機制出發，分析兩種崩潰的溫度特性差異。

**步驟**：

(a) 兩種崩潰機制比較：

| 特性 | 齊納崩潰（Zener） | 雪崩崩潰（Avalanche） |
|------|-------------------|----------------------|
| 機制 | 強電場直接將價帶電子拉至導帶（量子穿隧效應，tunneling） | 載子被電場加速，碰撞游離產生新的電子-電洞對（impact ionization） |
| 崩潰電壓 | 較低（< 5V） | 較高（> 7V） |
| 摻雜濃度 | 高摻雜（窄空乏區，高電場） | 低摻雜（寬空乏區，載子獲得足夠動能） |
| 溫度係數 | 負（溫度升高，帶隙縮小，更易穿隧，V_BR 降低） | 正（溫度升高，晶格散射增加，碰撞游離更難，V_BR 升高） |

> **答案 (a)：齊納崩潰靠量子穿隧，溫度係數為負；雪崩崩潰靠碰撞游離，溫度係數為正。**

(b) V_BR = 6V，溫度升高 50°C 時 V_BR 增加 30 mV：

溫度係數 = +30 mV / 50°C = +0.6 mV/°C（正溫度係數）

→ 以**雪崩崩潰**為主。

在 5V < V_BR < 7V 範圍，兩種機制共存，但此處正溫度係數佔優，說明雪崩效應主導。

> **答案 (b)：正溫度係數（+0.6 mV/°C），以雪崩崩潰為主。**

(c) V_BR ≈ 5V 附近：

此電壓區間，齊納崩潰（負溫度係數）和雪崩崩潰（正溫度係數）同時存在且貢獻相當，兩者的溫度效應互相抵消，使得淨溫度係數接近零。

在精密參考電壓設計中：
- 選用 V_BR ≈ 5.1V 的齊納二極體，可獲得極低溫度係數
- 或者將齊納二極體（負溫度係數）與正向偏壓二極體（約 -2 mV/°C，也是負的）串聯調配
- 著名的帶隙參考（bandgap reference）即利用 V_BE 的負溫度係數與 ΔV_BE 的正溫度係數互補，產生約 1.25V 的穩定參考電壓

> **答案 (c)：在 V_BR ≈ 5V 處，兩種崩潰機制的溫度係數互消，淨溫度係數最小。精密參考電壓電路常選用此電壓的齊納二極體，或採用帶隙參考（bandgap reference）架構。**

**延伸思考**：商業上的「齊納二極體」不論實際崩潰機制為何，統一稱為齊納二極體。帶隙參考電壓（bandgap reference）是類比 IC 中最重要的基礎模組之一，幾乎所有 ADC、DAC、電源管理 IC 都會用到。

---

## Part 2：雙極性接面電晶體 BJT（Bipolar Junction Transistor）

---

### 題目 11：BJT 操作區域判斷
**來源**：台大電機 / 經典題型
**難度**：★★☆☆☆
**主題**：BJT 操作模式（Operating Regions）

**題目**：

一 NPN BJT，β = 100，V_BE(on) = 0.7V，V_CE(sat) = 0.2V。在下列各電路中判斷 BJT 的操作區域（截止 cutoff / 主動 active / 飽和 saturation）。

```
電路 (a)：            電路 (b)：            電路 (c)：
VCC=5V               VCC=5V               VCC=5V
  |                    |                    |
 R_C=1kΩ             R_C=10kΩ            R_C=1kΩ
  |                    |                    |
  C                    C                    C
  |                    |                    |
  B─R_B=100kΩ─5V     B─R_B=100kΩ─5V     B─R_B=100kΩ─0V
  |                    |                    |
  E                    E                    E
  |                    |                    |
 GND                  GND                  GND
```

**詳解**：

**解題思路**：先假設在主動區，計算 I_C，再驗證 V_CE 是否滿足主動區條件。

**步驟**：

**電路 (a)：**

假設主動區：
```
I_B = (5 - 0.7) / 100k = 4.3 / 100k = 43 μA
I_C = β × I_B = 100 × 43μ = 4.3 mA
V_CE = VCC - I_C × R_C = 5 - 4.3 × 1 = 0.7 V
```
V_CE = 0.7V > V_CE(sat) = 0.2V → BE 接面順偏，BC 接面反偏 → **主動區** ✓

**電路 (b)：**

假設主動區：
```
I_B = (5 - 0.7) / 100k = 43 μA
I_C = 100 × 43μ = 4.3 mA
V_CE = 5 - 4.3 × 10 = 5 - 43 = -38 V（不合理！）
```
V_CE 為負值 → 假設錯誤 → 進入**飽和區**

飽和時：
```
V_CE = V_CE(sat) = 0.2V
I_C(sat) = (VCC - V_CE(sat)) / R_C = (5 - 0.2) / 10k = 0.48 mA
I_B = 43 μA
β_forced = I_C / I_B = 0.48m / 43μ = 11.2
```
β_forced = 11.2 < β = 100 → 確認**飽和區** ✓

**電路 (c)：**

```
V_B = 0V → V_BE = 0 - 0 = 0V < 0.7V
```
BE 接面未順偏 → **截止區**，I_C ≈ 0，V_CE = 5V

> **答案：(a) 主動區，V_CE = 0.7V；(b) 飽和區，V_CE = 0.2V；(c) 截止區，V_CE = 5V**

**延伸思考**：判斷流程為「假設主動 → 計算 V_CE → 若 V_CE < V_CE(sat) 則飽和」。在數位電路中，BJT 作為開關時在截止和飽和之間切換。

---

### 題目 12：分壓偏壓電路 Q 點計算
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：BJT 偏壓設計（Bias Design）

**題目**：

一 NPN BJT 採用分壓偏壓（voltage divider bias），參數如下：VCC = 12V，R_1 = 56 kΩ，R_2 = 12 kΩ，R_C = 2.2 kΩ，R_E = 1 kΩ，β = 150，V_BE(on) = 0.7V。

```
        VCC = 12V
         |
        R_1 = 56kΩ      R_C = 2.2kΩ
         |                |
         ┬── B      C ──┤
         |          |
        R_2=12kΩ   E
         |          |
        GND       R_E=1kΩ
                    |
                   GND
```

(a) 用精確法（含 β 效應）求 Q 點（I_C, V_CE）。
(b) 若 β 從 100 變到 300，求 I_C 的變化百分比，並評估此偏壓電路的穩定性。

**詳解**：

**解題思路**：戴維寧等效 + KVL 求解 Q 點，再分析 β 敏感度。

**步驟**：

(a) 基極等效電路（Thevenin equivalent）：

```
V_BB = VCC × R_2 / (R_1 + R_2) = 12 × 12 / (56 + 12) = 12 × 12/68 = 2.118 V
R_BB = R_1 || R_2 = 56 × 12 / (56 + 12) = 672/68 = 9.882 kΩ
```

KVL：V_BB = I_B × R_BB + V_BE + I_E × R_E

其中 I_E = (β+1) × I_B：

```
2.118 = I_B × 9882 + 0.7 + (β+1) × I_B × 1000
1.418 = I_B × (9882 + 151 × 1000)
1.418 = I_B × 160882
I_B = 8.81 μA

I_C = β × I_B = 150 × 8.81μ = 1.322 mA
I_E = 151 × 8.81μ = 1.330 mA

V_CE = VCC - I_C × R_C - I_E × R_E
     = 12 - 1.322 × 2.2 - 1.330 × 1
     = 12 - 2.908 - 1.330
     = 7.762 V
```

> **答案 (a)：Q 點 I_C ≈ 1.32 mA，V_CE ≈ 7.76 V**

(b) β 敏感度分析：

β = 100 時：
```
I_B = 1.418 / (9882 + 101 × 1000) = 1.418 / 110882 = 12.79 μA
I_C = 100 × 12.79μ = 1.279 mA
```

β = 300 時：
```
I_B = 1.418 / (9882 + 301 × 1000) = 1.418 / 310882 = 4.56 μA
I_C = 300 × 4.56μ = 1.369 mA
```

I_C 變化：
```
ΔI_C / I_C(avg) = (1.369 - 1.279) / ((1.369 + 1.279)/2) × 100%
                 = 0.090 / 1.324 × 100% ≈ 6.8%
```

β 變化了 3 倍（100 → 300），但 I_C 僅變化 6.8%。

> **答案 (b)：I_C 變化約 6.8%。分壓偏壓電路對 β 變化的敏感度低，穩定性佳。**

**延伸思考**：穩定性的關鍵條件是 R_BB << (β+1)R_E，使得 I_C ≈ (V_BB - V_BE)/R_E，幾乎與 β 無關。實務設計中通常令 R_BB ≤ 0.1 × (β+1)R_E。

---

### 題目 13：BJT 小信號參數計算
**來源**：台大電機 / 經典題型
**難度**：★★☆☆☆
**主題**：小信號模型（Small-Signal Model）

**題目**：

一 NPN BJT 偏壓在 I_C = 1 mA，β = 200，厄利電壓（Early voltage）V_A = 100V，T = 300K。

(a) 求所有小信號參數：g_m, r_π, r_o。
(b) 若 I_C 增至 5 mA，各參數如何變化？
(c) 討論為何 r_o 在實際放大器增益中扮演重要角色。

**詳解**：

**解題思路**：直接套用小信號參數公式。

**步驟**：

(a) 在 I_C = 1 mA：

```
g_m = I_C / V_T = 1 mA / 26 mV = 38.46 mA/V ≈ 38.5 mS

r_π = β / g_m = 200 / 38.46 = 5.2 kΩ

r_o = V_A / I_C = 100V / 1mA = 100 kΩ
```

> **答案 (a)：g_m = 38.5 mS，r_π = 5.2 kΩ，r_o = 100 kΩ**

(b) 在 I_C = 5 mA：

```
g_m = 5 / 0.026 = 192.3 mS（增為 5 倍）
r_π = 200 / 192.3 = 1.04 kΩ（縮為 1/5）
r_o = 100 / 5 = 20 kΩ（縮為 1/5）
```

> **答案 (b)：g_m = 192.3 mS，r_π = 1.04 kΩ，r_o = 20 kΩ。g_m 正比於 I_C，r_π 和 r_o 反比於 I_C。**

(c) r_o 的重要性：

在共射極放大器中，電壓增益 A_v = -g_m × (R_C || r_o)。當 R_C 很大或使用主動負載時，r_o 成為限制增益的瓶頸。例如：

- 若 R_C = 10 kΩ，r_o = 100 kΩ：R_C || r_o = 9.09 kΩ ≈ R_C（r_o 影響小）
- 若使用電流鏡主動負載，等效 R_C → ∞：增益 = -g_m × (r_o1 || r_o2)，完全由 r_o 決定

> **答案 (c)：r_o 在主動負載放大器中決定最大可達增益。要提高增益需增大 r_o（降低 I_C 或使用 cascode）。**

**延伸思考**：在 IC 設計中，BJT 的 r_o 通常比同偏壓點的 MOSFET 大很多（BJT 的 V_A 通常 50-200V，而 MOSFET 的 1/λ 可能只有 10-50V），這是 BJT 在高增益精密放大器中仍有優勢的原因之一。

---

### 題目 14：共射極（CE）放大器完整分析
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：CE 放大器（Common-Emitter Amplifier）

**題目**：

共射極放大器電路如下，VCC = 10V，R_1 = 33kΩ，R_2 = 10kΩ，R_C = 4.7kΩ，R_E = 1.2kΩ，C_E 為射極旁路電容（在信號頻率完全短路），R_S = 600Ω（信號源內阻），R_L = 10kΩ（負載），β = 120，V_A = 80V。

```
        VCC=10V
     ┌────┼────┐
    R_1  R_C   │
     │    │    │
     ├──B─C────┤── C_out ── R_L ── GND
     │    │    │
    R_2   E    │
     │    │    │
    GND  R_E  C_E
          │    │
         GND  GND

信號源：v_s ── R_S ── C_in ── 基極
```

(a) 求直流 Q 點。
(b) 求中頻小信號電壓增益 A_v = v_o/v_s。
(c) 求輸入電阻 R_in（從基極看入）和輸出電阻 R_out（從集極看出）。

**詳解**：

**解題思路**：先求 Q 點，再建立小信號等效電路計算增益和阻抗。

**步驟**：

(a) 直流 Q 點：

```
V_BB = 10 × 10/(33+10) = 2.326 V
R_BB = 33||10 = 330/43 = 7.674 kΩ

I_B = (V_BB - V_BE) / (R_BB + (β+1)R_E)
    = (2.326 - 0.7) / (7674 + 121 × 1200)
    = 1.626 / (7674 + 145200)
    = 1.626 / 152874
    = 10.64 μA

I_C = 120 × 10.64μ = 1.277 mA

V_CE = VCC - I_C × R_C - I_E × R_E
     = 10 - 1.277 × 4.7 - 1.287 × 1.2
     = 10 - 6.002 - 1.545 = 2.453 V
```

> **Q 點：I_C ≈ 1.28 mA，V_CE ≈ 2.45 V（主動區）**

(b) 小信號參數：

```
g_m = I_C/V_T = 1.277/0.026 = 49.1 mS
r_π = β/g_m = 120/49.1 = 2.44 kΩ
r_o = V_A/I_C = 80/1.277 = 62.6 kΩ
```

中頻等效電路（C_E 短路）：

從基極看入的輸入電阻：
```
R_in(base) = r_π = 2.44 kΩ
R_in(total) = R_1 || R_2 || r_π = 33k || 10k || 2.44k = 7.674k || 2.44k = 1.852 kΩ
```

有效負載：
```
R_L' = R_C || r_o || R_L = 4.7k || 62.6k || 10k = 4.7k || 62.6k = 4.372k
4.372k || 10k = 3.041 kΩ
```

電壓增益（從 v_s 到 v_o）：

```
A_v = -(R_in(total) / (R_in(total) + R_S)) × g_m × R_L'
    = -(1.852 / (1.852 + 0.6)) × 49.1 × 3.041
    = -(0.755) × 149.3
    = -112.7
```

> **答案 (b)：A_v = v_o/v_s ≈ -113（含信號源內阻的損耗）**

(c) 輸入輸出電阻：

```
R_in = R_1 || R_2 || r_π = 1.852 kΩ（如上計算）

R_out = R_C || r_o = 4.7k || 62.6k = 4.372 kΩ
```

> **答案 (c)：R_in ≈ 1.85 kΩ，R_out ≈ 4.37 kΩ**

**延伸思考**：CE 放大器的主要缺點是輸入阻抗較低（受 r_π 限制）。若移除 C_E（不旁路 R_E），增益降為 A_v ≈ -R_C/R_E，但輸入阻抗提升為 R_1||R_2||(r_π + (β+1)R_E)，且線性度改善。這是增益-頻寬-線性度之間的典型取捨（trade-off）。

---

### 題目 15：共基極（CB）放大器分析
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：CB 放大器（Common-Base Amplifier）

**題目**：

一共基極放大器，I_C = 2 mA，β = 100，V_A = 150V，R_C = 5 kΩ，R_L = 10 kΩ。

(a) 求電壓增益 A_v = v_o/v_i（v_i 加在射極）。
(b) 求輸入電阻 R_in（從射極看入）。
(c) 求輸出電阻 R_out（從集極看出）。
(d) 與同偏壓點的 CE 放大器比較優缺點。

**詳解**：

**解題思路**：CB 組態的特點是低輸入阻抗、高輸出阻抗、無反相、寬頻。

**步驟**：

小信號參數：
```
g_m = 2m/26m = 76.9 mS
r_π = 100/76.9 = 1.3 kΩ
r_o = 150/2 = 75 kΩ
r_e = 1/g_m = 13 Ω（也可寫為 r_e = V_T/I_E ≈ V_T/I_C）
```

(a) 電壓增益：

```
A_v = g_m × (R_C || r_o || R_L)
    = 76.9m × (5k || 75k || 10k)
    = 76.9m × (5k || 75k = 4.688k，再 || 10k = 3.193k)
    = 76.9m × 3.193k
    = 245.5
```

注意 CB 增益為正（無反相）。

> **答案 (a)：A_v ≈ +246**

(b) 輸入電阻：

```
R_in = r_e || (r_π/(β+1))（忽略 r_o 的影響時）
     ≈ 1/g_m = V_T/I_C = 26/2 = 13 Ω
```

更精確：R_in = r_e = V_T/I_E = 26mV/2.02mA ≈ 12.9 Ω

> **答案 (b)：R_in ≈ 13 Ω**

(c) 輸出電阻（從集極看出，射極接信號源內阻 R_S 時）：

若射極端開路（R_S → ∞）：
```
R_out = r_o × (1 + g_m × (r_π || R_S)) + (r_π || R_S)
```

簡單情況（R_S = 0，即射極接地）：R_out = r_o = 75 kΩ

若 R_S 有限（例如 R_S = 50Ω）：
```
R_out ≈ r_o × (1 + g_m × R_S) = 75k × (1 + 76.9m × 50) = 75k × 4.845 = 363 kΩ
```

> **答案 (c)：R_out = 75 kΩ（R_S = 0），或更高（R_S > 0 時因 bootstrapping 效應增大）**

(d) CE vs CB 比較：

| 特性 | CE | CB |
|------|-----|-----|
| 電壓增益 | -g_m(R_C\|\|R_L) 反相 | +g_m(R_C\|\|R_L) 不反相 |
| 電流增益 | β（高） | α ≈ 1（低） |
| 輸入阻抗 | r_π（中，kΩ 量級） | r_e（低，Ω 量級） |
| 輸出阻抗 | r_o（中高） | r_o 或更高 |
| 頻寬 | 受 Miller 效應限制 | 寬頻（無 Miller 效應） |

> **答案 (d)：CB 優勢為寬頻（無 Miller 效應）、高輸出阻抗；劣勢為極低輸入阻抗、電流增益 ≈ 1。CB 常用於 cascode 的上管以及高頻 LNA。**

**延伸思考**：CB 組態在 RF 低噪聲放大器（LNA）和 cascode 架構中廣泛使用。Cascode = CE + CB 串疊，結合了 CE 的高電流增益和 CB 的寬頻特性。

---

### 題目 16：射極隨耦器（CC）完整分析
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：CC 放大器 / 射極隨耦器（Emitter Follower）

**題目**：

一射極隨耦器，VCC = 15V，偏壓 I_E = 5 mA，β = 200，V_A = ∞（忽略 r_o），R_E = 2 kΩ，R_S = 10 kΩ（信號源內阻），R_L = 500 Ω。

(a) 求電壓增益 A_v = v_o/v_s。
(b) 求輸入電阻 R_in（從基極看入）。
(c) 求輸出電阻 R_out（從射極看出）。
(d) 說明射極隨耦器在多級放大器中的作用。

**詳解**：

**解題思路**：CC 組態為電壓緩衝器，增益接近 1，具有高輸入阻抗和低輸出阻抗。

**步驟**：

小信號參數：
```
g_m = I_C/V_T ≈ I_E/V_T = 5m/26m = 192.3 mS
r_π = β/g_m = 200/192.3 = 1.04 kΩ
r_e = 1/g_m = 5.2 Ω
```

(a) 電壓增益：

從基極到射極的增益（不含信號源）：
```
A_v(base-to-emitter) = (R_E || R_L) / (r_e + R_E || R_L)
R_E || R_L = 2000 || 500 = 400 Ω

A_v(b-e) = 400 / (5.2 + 400) = 400 / 405.2 = 0.987
```

考慮信號源內阻，從 v_s 到 v_o：
```
R_in(base) = r_π + (β+1)(R_E || R_L) = 1040 + 201 × 400 = 1040 + 80400 = 81.44 kΩ

A_v = (R_in(base) / (R_in(base) + R_S)) × A_v(b-e)
    = (81.44k / (81.44k + 10k)) × 0.987
    = 0.891 × 0.987
    = 0.879
```

> **答案 (a)：A_v ≈ 0.88（接近 1，不反相）**

(b) 輸入電阻：

```
R_in = r_π + (β+1)(R_E || R_L) = 1.04k + 201 × 400 = 81.44 kΩ
```

> **答案 (b)：R_in ≈ 81.4 kΩ**

(c) 輸出電阻（從射極看出）：

```
R_out = R_E || [r_e + R_S/(β+1)]
      = 2k || [5.2 + 10k/201]
      = 2k || [5.2 + 49.75]
      = 2k || 54.95
      = 53.5 Ω
```

> **答案 (c)：R_out ≈ 53.5 Ω**

(d) 射極隨耦器的作用：

- **阻抗轉換（impedance buffering）**：高輸入阻抗 → 不載入前級；低輸出阻抗 → 能驅動低阻負載
- **級間緩衝**：放在兩個 CE 放大器之間，防止後級的低阻抗拉低前級增益
- **輸出級**：驅動低阻抗負載（如喇叭、傳輸線）

> **答案 (d)：射極隨耦器作為電壓緩衝器，提供阻抗轉換功能，常用於多級放大器的輸出級或級間隔離。**

**延伸思考**：射極隨耦器雖然電壓增益 < 1，但功率增益可以很大（因為電流增益 ≈ β+1）。在 Class-AB 推挽輸出級中，互補射極隨耦器（complementary emitter follower）是最常見的架構。

---

### 題目 17：BJT 電流鏡
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：電流鏡（Current Mirror）

**題目**：

一基本 BJT 電流鏡如下，β = 100，V_A = 100V，I_REF = 1 mA。

```
     VCC
      |          |
     R_REF     [負載]
      |          |
      |── B ── C2
   C1=B1        |
      |         E2
     E1          |
      |         GND
     GND

（Q1 二極體連接，Q2 為鏡射管）
```

(a) 考慮有限 β，求輸出電流 I_O 與 I_REF 的關係。
(b) 求輸出電阻 R_out。
(c) 若 V_CE2 從 1V 變至 10V，I_O 變化多少百分比？
(d) 畫出 Wilson 電流鏡，說明其如何改善精確度與輸出電阻。

**詳解**：

**解題思路**：分析基極電流造成的誤差，以及 Early 效應對輸出電阻的影響。

**步驟**：

(a) 基極電流誤差分析：

兩個基極電流都由 I_REF 提供：
```
I_REF = I_C1 + 2I_B = I_C1 + 2I_C1/β
```

因 Q1 和 Q2 匹配，V_BE 相同 → I_C1 = I_C2 = I_O（忽略 Early 效應）：

```
I_REF = I_O + 2I_O/β = I_O(1 + 2/β)
I_O = I_REF / (1 + 2/β) = 1mA / (1 + 2/100) = 1/1.02 = 0.980 mA
```

誤差 = 2/β = 2%

> **答案 (a)：I_O = I_REF / (1 + 2/β) ≈ 0.980 mA，誤差約 2%**

(b) 輸出電阻：

```
R_out = r_o2 = V_A / I_C2 = 100V / 0.98mA ≈ 102 kΩ
```

> **答案 (b)：R_out ≈ 102 kΩ**

(c) V_CE2 變化的影響（Early 效應）：

```
ΔI_O = ΔV_CE / r_o = (10 - 1) / 102k = 9/102k = 88.2 μA

ΔI_O / I_O = 88.2μ / 980μ = 9.0%
```

> **答案 (c)：I_O 變化約 9%（這是簡單電流鏡的主要缺點）**

(d) Wilson 電流鏡：

```
     VCC
      |          |
     R_REF     [負載]
      |          |
      ├── C3    C3
      |    |     |
      |   B3──E3 |
      |         |
   C1=B1    B2──C2
      |         |
     E1        E2
      |         |
     GND       GND

（Q3 加在 Q2 的集極與 Q1 的基極之間）
```

Wilson 電流鏡的改善：
- **精確度**：β 造成的誤差降至 2/β² ≈ 0.02%（Q3 的 β 補償了基極電流損失）
- **輸出電阻**：R_out ≈ r_o × β/2，可達數十 MΩ（Q3 提供負回授，穩定輸出電流）

> **答案 (d)：Wilson 電流鏡透過第三管 Q3 的負回授，將 β 誤差從 2/β 降至 2/β²，輸出電阻提升 β/2 倍。**

**延伸思考**：在 IC 設計中，cascode 電流鏡也能大幅提升輸出電阻，且較 Wilson 鏡在高頻下更穩定。Widlar 電流鏡則可產生微安級小電流。

---

### 題目 18：CE 放大器的射極退化效應
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：射極退化（Emitter Degeneration）

**題目**：

一 CE 放大器帶有未旁路的射極電阻 R_E = 200Ω，I_C = 1 mA，β = 150，V_A = 100V，R_C = 5 kΩ，R_L = 10 kΩ。

(a) 求電壓增益 A_v = v_o/v_i（v_i 在基極）。
(b) 與無 R_E 的 CE 比較增益、輸入阻抗、線性度。
(c) 若要求增益精確為 -20，在 R_C||R_L 固定的情況下，R_E 應為多少？

**詳解**：

**解題思路**：射極退化引入負回授（series-series feedback），犧牲增益換取線性度和穩定性。

**步驟**：

小信號參數：
```
g_m = 1m/26m = 38.46 mS
r_π = 150/38.46 = 3.9 kΩ
r_o = 100/1 = 100 kΩ
r_e = 1/g_m = 26 Ω
```

(a) 有 R_E 的 CE 增益：

有效負載：
```
R_L' = R_C || R_L || r_o = 5k || 10k || 100k = 5k || 10k = 3.333k，再 || 100k = 3.225 kΩ
```

增益公式（含射極退化）：
```
A_v = -g_m × R_L' / (1 + g_m × R_E)
    = -38.46 × 3.225 / (1 + 38.46 × 0.2)
    = -124.0 / (1 + 7.692)
    = -124.0 / 8.692
    = -14.27
```

或等價公式：
```
A_v = -R_L' / (r_e + R_E) = -3225 / (26 + 200) = -3225 / 226 = -14.27
```

> **答案 (a)：A_v ≈ -14.3**

(b) 無 R_E 時：

```
A_v(no R_E) = -g_m × R_L' = -38.46 × 3.225 = -124.0
```

比較：

| 特性 | 無 R_E | 有 R_E = 200Ω |
|------|---------|---------------|
| 電壓增益 | -124 | -14.3 |
| R_in(base) | r_π = 3.9 kΩ | r_π + (β+1)R_E = 3.9k + 151×0.2k = 34.1 kΩ |
| 線性度 | 受 v_i << V_T 限制 | 可容忍 v_i 到數百 mV |
| 增益穩定性 | 依賴 g_m（隨溫度/製程變化） | ≈ -R_C/R_E（由電阻比決定，穩定） |

> **答案 (b)：增益從 -124 降至 -14.3（降 8.7 倍），但輸入阻抗從 3.9kΩ 升至 34.1kΩ，線性度和穩定性大幅改善。**

(c) 令 A_v = -20：

```
-20 = -R_L' / (r_e + R_E)
r_e + R_E = R_L' / 20 = 3225 / 20 = 161.25 Ω
R_E = 161.25 - 26 = 135.25 Ω ≈ 135 Ω
```

> **答案 (c)：R_E ≈ 135 Ω**

**延伸思考**：當 g_m × R_E >> 1 時，A_v ≈ -R_L'/R_E，增益完全由電阻比決定，不受元件參數變化影響。這個原理就是負回授的核心精神。

---

### 題目 19：多級 BJT 放大器串接
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：多級放大器（Multi-Stage Amplifier）

**題目**：

一兩級放大器：第一級為 CE（帶 R_E 退化），第二級為射極隨耦器（CC）。各級參數如下：

第一級（CE with degeneration）：I_C1 = 0.5 mA，β_1 = 100，R_C1 = 10 kΩ，R_E1 = 500Ω，V_A1 = 80V

第二級（CC / Emitter Follower）：I_C2 = 2 mA，β_2 = 150，R_E2 = 1 kΩ，R_L = 200 Ω，V_A2 = ∞

信號源內阻 R_S = 1 kΩ。兩級之間以電容耦合。

(a) 分別求兩級的輸入阻抗和輸出阻抗。
(b) 求總電壓增益 A_v = v_o/v_s。
(c) 說明此架構的設計理念。

**詳解**：

**解題思路**：多級放大器分析要考慮級間負載效應（loading effect）。

**步驟**：

各級小信號參數：

第一級：
```
g_m1 = 0.5/26 = 19.23 mS，r_π1 = 100/19.23 = 5.2 kΩ
r_o1 = 80/0.5 = 160 kΩ
```

第二級：
```
g_m2 = 2/26 = 76.9 mS，r_π2 = 150/76.9 = 1.95 kΩ
r_e2 = 13 Ω
```

(a) 各級阻抗：

第二級（CC）輸入阻抗：
```
R_in2 = r_π2 + (β_2+1)(R_E2 || R_L)
      = 1.95k + 151 × (1k || 200) = 1.95k + 151 × 166.7
      = 1.95k + 25.17k = 27.12 kΩ
```

第二級輸出阻抗（假設由第一級的 R_out1 驅動）：
```
R_out(stage2) = R_E2 || [r_e2 + R_out1/(β_2+1)]
```
（待求 R_out1 後代入）

第一級（CE with R_E）輸入阻抗：
```
R_in1 = r_π1 + (β_1+1)R_E1 = 5.2k + 101 × 500 = 5.2k + 50.5k = 55.7 kΩ
```

第一級輸出阻抗：
```
R_out1 = R_C1 || r_o1 = 10k || 160k = 9.41 kΩ
```

第二級輸出阻抗（回代）：
```
R_out2 = R_E2 || [r_e2 + R_out1/(β_2+1)]
       = 1k || [13 + 9410/151]
       = 1k || [13 + 62.3]
       = 1k || 75.3 = 69.9 Ω
```

> **答案 (a)：R_in1 = 55.7 kΩ，R_out1 = 9.41 kΩ，R_in2 = 27.12 kΩ，R_out2 ≈ 70 Ω**

(b) 總增益計算：

第一級增益（負載為第二級輸入阻抗）：
```
R_L1' = R_C1 || r_o1 || R_in2 = 10k || 160k || 27.12k
      = 9.41k || 27.12k = 6.99 kΩ

A_v1 = -R_L1' / (r_e1 + R_E1) = -6990 / (52 + 500) = -6990 / 552 = -12.66
```

其中 r_e1 = 1/g_m1 = 52 Ω

第二級增益（CC）：
```
A_v2 = (R_E2 || R_L) / (r_e2 + R_E2 || R_L)
     = 166.7 / (13 + 166.7) = 166.7 / 179.7 = 0.928
```

信號源分壓：
```
v_b1/v_s = R_in1 / (R_in1 + R_S) = 55.7 / (55.7 + 1) = 0.982
```

總增益：
```
A_v = 0.982 × (-12.66) × 0.928 = -11.53
```

> **答案 (b)：A_v = v_o/v_s ≈ -11.5**

(c) 設計理念：

- 第一級 CE + R_E：提供穩定的電壓增益（~13），高輸入阻抗（~56kΩ）
- 第二級 CC：將第一級的高輸出阻抗（~9.4kΩ）轉換為低輸出阻抗（~70Ω），以驅動 200Ω 低阻負載
- 若無第二級，第一級直接驅動 200Ω 負載，增益將大幅下降

> **答案 (c)：CE 級提供增益，CC 級提供阻抗緩衝，是典型的「增益級 + 輸出級」架構。**

**延伸思考**：在更複雜的設計中，可加入差動輸入級（differential pair）作為第一級，形成典型的運算放大器三級架構：差動輸入 → 高增益級 → 輸出級。

---

### 題目 20：BJT 放大器最大輸出擺幅分析
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：輸出擺幅（Output Swing）

**題目**：

一 CE 放大器，VCC = 10V，R_C = 3 kΩ，R_E = 1 kΩ（有旁路電容），I_C(Q) = 2 mA，V_CE(sat) = 0.3V。

(a) 求 Q 點的 V_CE。
(b) 求最大不失真輸出電壓擺幅（peak-to-peak）。
(c) 若要最大化對稱擺幅，Q 點應設在什麼位置？I_C 應為多少？

**詳解**：

**解題思路**：輸出擺幅受限於 V_CE(sat)（下限）和 VCC（上限）。最大對稱擺幅需 Q 點在負載線中點。

**步驟**：

(a) Q 點（直流分析，R_E 不被旁路）：

```
V_CE(Q) = VCC - I_C × R_C - I_E × R_E
        ≈ 10 - 2 × 3 - 2 × 1 = 10 - 6 - 2 = 2 V
```

（近似 I_E ≈ I_C）

> **答案 (a)：V_CE(Q) = 2V**

(b) 最大擺幅分析：

交流負載線（C_E 短路 R_E）：交流負載為 R_C = 3 kΩ

向上擺：v_o 最大 = VCC - I_C×R_C（當 i_C → 0）...

更直接的分析：

正半週（v_CE 增加）：
```
v_CE 最大 = V_CE(Q) + I_C(Q) × R_C(AC) = 2 + 2m × 3k = 2 + 6 = 8V
```
但不能超過 VCC = 10V → 8V < 10V → 上限為 8V

負半週（v_CE 減小）：
```
v_CE 最小 = V_CE(sat) = 0.3V
```
可減小量 = V_CE(Q) - V_CE(sat) = 2 - 0.3 = 1.7V

因此受限於負半週，最大峰值擺幅 = 1.7V

```
v_o(peak-to-peak) = 2 × min(I_C(Q)×R_C, V_CE(Q)-V_CE(sat))
                   = 2 × min(6, 1.7) = 2 × 1.7 = 3.4 V
```

> **答案 (b)：最大不失真輸出擺幅 = 3.4 Vpp（受限於 Q 點太靠近飽和區）**

(c) 最大對稱擺幅設計：

令正負半週可用擺幅相等：
```
I_C(Q) × R_C = V_CE(Q) - V_CE(sat)
```

又 V_CE(Q) = VCC - I_C(Q) × (R_C + R_E) = 10 - I_C × 4

代入：
```
I_C × 3 = (10 - 4 × I_C) - 0.3
3 × I_C = 9.7 - 4 × I_C
7 × I_C = 9.7
I_C = 1.386 mA
```

此時：
```
V_CE(Q) = 10 - 1.386 × 4 = 4.46 V
擺幅 = I_C × R_C = 1.386 × 3 = 4.16 V（每邊）
最大 Vpp = 2 × 4.16 = 8.31 V
```

> **答案 (c)：I_C ≈ 1.39 mA，V_CE(Q) ≈ 4.46V，最大對稱擺幅 ≈ 8.3 Vpp**

**延伸思考**：在功率放大器設計中，Q 點的設定直接影響效率和失真。Class-A 放大器 Q 點在負載線中心，最大效率 25%（電阻負載）或 50%（變壓器耦合）。

---

## Part 3：金氧半場效電晶體 MOSFET（Metal-Oxide-Semiconductor FET）— 重點章節

> MOSFET 是現代 IC 設計的核心元件，也是業界面試必考重點。本部分共 15 題，涵蓋從基礎操作到進階電路設計。

---

### 題目 21：MOSFET 操作區域判斷
**來源**：台大電機 / 經典題型
**難度**：★★☆☆☆
**主題**：MOSFET 操作模式（Operating Regions）

**題目**：

一 NMOS 電晶體，V_th = 0.5V，μ_nC_ox = 200 μA/V²，W/L = 10/0.5（μm/μm），λ = 0。判斷下列各組偏壓下的操作區域，並求 I_D。

(a) V_GS = 0.3V，V_DS = 1V
(b) V_GS = 1.2V，V_DS = 0.3V
(c) V_GS = 1.2V，V_DS = 2V
(d) V_GS = 2V，V_DS = 1V

**詳解**：

**解題思路**：依序檢查：(1) V_GS vs V_th → 是否截止；(2) V_DS vs V_OV = V_GS - V_th → 線性或飽和。

**步驟**：

k_n = μ_nC_ox × (W/L) = 200 × (10/0.5) = 4000 μA/V² = 4 mA/V²

**(a) V_GS = 0.3V < V_th = 0.5V → 截止區（cutoff）**
```
I_D = 0
```

> **答案 (a)：截止區，I_D = 0**

**(b) V_GS = 1.2V > 0.5V → 導通。V_OV = 1.2 - 0.5 = 0.7V**
```
V_DS = 0.3V < V_OV = 0.7V → 線性區（triode / linear region）
I_D = k_n × [(V_GS - V_th)V_DS - V_DS²/2]
    = 4 × [(0.7)(0.3) - 0.3²/2]
    = 4 × [0.21 - 0.045]
    = 4 × 0.165 = 0.66 mA
```

> **答案 (b)：線性區，I_D = 0.66 mA**

**(c) V_GS = 1.2V，V_OV = 0.7V，V_DS = 2V > V_OV → 飽和區（saturation）**
```
I_D = (k_n/2) × V_OV² = (4/2) × 0.7² = 2 × 0.49 = 0.98 mA
```

> **答案 (c)：飽和區，I_D = 0.98 mA**

**(d) V_GS = 2V，V_OV = 1.5V，V_DS = 1V < V_OV → 線性區**
```
I_D = 4 × [(1.5)(1) - 1²/2] = 4 × [1.5 - 0.5] = 4 × 1.0 = 4 mA
```

> **答案 (d)：線性區，I_D = 4 mA**

**延伸思考**：在飽和區，MOSFET 可視為壓控電流源（voltage-controlled current source），這是放大器設計的工作基礎。在線性區，MOSFET 可視為壓控電阻（voltage-controlled resistor），常用於開關和可變電阻。

---

### 題目 22：MOSFET 飽和電流與通道長度調變
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：通道長度調變效應（Channel Length Modulation）

**題目**：

一 NMOS，V_th = 0.4V，μ_nC_ox = 250 μA/V²，W/L = 20/1，λ = 0.05 V^-1。偏壓 V_GS = 1.0V。

(a) 求 V_DS = 1V 和 V_DS = 3V 時的 I_D，並計算百分比差異。
(b) 求小信號輸出電阻 r_o。
(c) 若要 r_o = 50 kΩ，且維持相同 I_D，L 應設為多少？（假設 λ ∝ 1/L）

**詳解**：

**解題思路**：含 λ 效應的飽和電流公式，以及 r_o 與 λ、I_D 的關係。

**步驟**：

基本參數：
```
k_n = 250 × 20/1 = 5000 μA/V² = 5 mA/V²
V_OV = V_GS - V_th = 1.0 - 0.4 = 0.6V
```

先確認飽和：V_DS > V_OV = 0.6V → 兩個偏壓點都在飽和區。

(a) 含 λ 效應的飽和電流：

```
I_D = (k_n/2) × V_OV² × (1 + λV_DS)
```

V_DS = 1V：
```
I_D(1V) = (5/2) × 0.6² × (1 + 0.05 × 1) = 2.5 × 0.36 × 1.05 = 0.945 mA
```

V_DS = 3V：
```
I_D(3V) = 2.5 × 0.36 × (1 + 0.05 × 3) = 0.9 × 1.15 = 1.035 mA
```

百分比差異：
```
ΔI_D/I_D = (1.035 - 0.945)/0.945 × 100% = 9.52%
```

> **答案 (a)：I_D(1V) = 0.945 mA，I_D(3V) = 1.035 mA，差異約 9.5%**

(b) 小信號輸出電阻：

```
I_D(nom) ≈ (k_n/2) × V_OV² = 0.9 mA（忽略 λ 的一階近似）

r_o = 1/(λ × I_D) = 1/(0.05 × 0.9 × 10^-3) = 1/45μ = 22.2 kΩ
```

或用另一種表達：r_o = (V_A)/I_D，其中 V_A = 1/λ = 20V
```
r_o = 20/0.9m = 22.2 kΩ
```

> **答案 (b)：r_o ≈ 22.2 kΩ（V_A = 1/λ = 20V）**

(c) 若要 r_o = 50 kΩ，維持 I_D = 0.9 mA：

```
r_o = 1/(λ'I_D) = 50 kΩ
λ' = 1/(50k × 0.9m) = 1/45 = 0.0222 V^-1
```

因 λ ∝ 1/L：
```
λ'/λ = L/L' → L' = L × λ/λ' = 1 × 0.05/0.0222 = 2.25 μm
```

但增長 L 也會改變 W/L，需同時增大 W 以維持相同 k_n：
```
新 W/L = 20/1 → W' = 20 × 2.25/1 = 45 μm（W'/L' = 45/2.25 = 20）
```

> **答案 (c)：L ≈ 2.25 μm（同時 W 增至 45 μm 以維持 W/L = 20），代價是面積增大 (2.25)² ≈ 5 倍。**

**延伸思考**：在類比 IC 設計中，增大 L 是提高 r_o（從而提高放大器增益）的基本手段，但代價是面積增大和速度降低（f_T 下降）。這是類比設計中增益-速度-面積的三方取捨。

---

### 題目 23：MOSFET 偏壓設計
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：MOSFET 偏壓電路（MOSFET Biasing）

**題目**：

設計一 NMOS 共源極放大器的偏壓電路，使 I_D = 0.5 mA，V_DS = 1.5V。已知：VDD = 3.3V，V_th = 0.5V，μ_nC_ox = 200 μA/V²，W/L = 10/1，λ = 0。

```
        VDD = 3.3V
     ┌────┼────┐
    R_1   R_D   │
     │    │     │
     ├──G─D─────┘
     │    │
    R_2   S
     │    │
    GND  R_S
          │
         GND
```

(a) 求所需的 V_GS。
(b) 設計 R_D 和 R_S。
(c) 選擇 R_1 和 R_2（假設流經分壓器的電流為 I_D 的 10 倍，即 5 mA）。

**詳解**：

**解題思路**：由目標 I_D 反推 V_GS，再由電路 KVL 設計各電阻。

**步驟**：

(a) 飽和區電流公式（假設工作在飽和區）：

```
I_D = (μ_nC_ox/2)(W/L)(V_GS - V_th)²
0.5 = (200 × 10^-6 / 2)(10)(V_GS - 0.5)²
0.5 × 10^-3 = 1 × 10^-3 × (V_GS - 0.5)²
(V_GS - 0.5)² = 0.5
V_GS - 0.5 = √0.5 = 0.707
V_GS = 1.207 V
```

過驅電壓（overdrive voltage）V_OV = 0.707V

> **答案 (a)：V_GS = 1.207 V，V_OV = 0.707 V**

(b) R_D 和 R_S 設計：

KVL：VDD = I_D × R_D + V_DS + I_D × R_S

```
3.3 = 0.5m × R_D + 1.5 + 0.5m × R_S
0.5m × (R_D + R_S) = 1.8
R_D + R_S = 3.6 kΩ
```

需要另一個方程。由 V_GS 和 V_G 的關係：

```
V_G = V_GS + I_D × R_S = 1.207 + 0.5m × R_S
```

通常選 R_S 使得 V_S ≈ 0.3~0.5V（提供偏壓穩定性）。選 V_S = 0.4V：

```
R_S = V_S / I_D = 0.4 / 0.5m = 800 Ω
R_D = 3600 - 800 = 2800 Ω = 2.8 kΩ
```

驗證 V_DS：
```
V_DS = VDD - I_D(R_D + R_S) = 3.3 - 0.5 × 3.6 = 3.3 - 1.8 = 1.5V ✓
```

確認飽和區：V_DS = 1.5V > V_OV = 0.707V ✓

> **答案 (b)：R_S = 800 Ω，R_D = 2.8 kΩ**

(c) R_1 和 R_2 設計：

```
V_G = V_GS + V_S = 1.207 + 0.4 = 1.607 V

分壓：V_G = VDD × R_2/(R_1 + R_2) = 1.607
```

令分壓器電流 I_div = 5 mA >> I_G = 0（MOSFET 閘極不吸電流）：

```
R_1 + R_2 = VDD / I_div = 3.3 / 5m = 660 Ω
R_2 = (R_1 + R_2) × V_G/VDD = 660 × 1.607/3.3 = 321.4 Ω
R_1 = 660 - 321.4 = 338.6 Ω
```

> **答案 (c)：R_1 ≈ 339 Ω，R_2 ≈ 321 Ω**

**注意**：此分壓器電流（5 mA）遠大於信號電流，會消耗較多功耗。在低功耗設計中，通常用 MΩ 級電阻（讓分壓器電流為 μA 級），因為 MOSFET 閘極電流為零，不會因大電阻而產生偏壓誤差（這是 MOSFET 相比 BJT 的偏壓優勢）。

**延伸思考**：在 IC 中不使用大電阻分壓器，而是用電流鏡偏壓。MOSFET 的零閘極電流是其在偏壓設計上相較 BJT 的最大優勢。

---

### 題目 24：MOSFET 電流鏡（基本與 Cascode）
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：電流鏡（Current Mirror）— 業界面試必考

**題目**：

一基本 NMOS 電流鏡，兩管匹配，μ_nC_ox = 200 μA/V²，V_th = 0.5V，λ = 0.04 V^-1。參考電流 I_REF = 100 μA，(W/L)_1 = (W/L)_2 = 5/1。

```
     VDD               VDD
      |                  |
     R_REF             [負載]
      |                  |
      |── G1 ── G2 ──  D2
   D1=G1               |
      |                S2
     S1                 |
      |                GND
     GND
```

(a) 求 V_GS 和各管的 V_OV。
(b) 若 V_DS2 = 1V，求 I_OUT。若 V_DS2 = 3V，求 I_OUT。計算誤差。
(c) 求基本鏡的輸出電阻。
(d) 設計 cascode 電流鏡使輸出電阻提升至少 50 倍，畫出電路並計算新的 R_out。

**詳解**：

**解題思路**：基本鏡誤差來自通道長度調變（λ），cascode 結構透過疊加一管屏蔽 V_DS 變化來提高 R_out。

**步驟**：

(a) 由 I_REF 求 V_GS（Q1 二極體連接，V_DS1 = V_GS1）：

```
I_REF = (μ_nC_ox/2)(W/L)(V_GS - V_th)² × (1 + λV_DS1)
```

因 V_DS1 = V_GS，這是非線性方程。先忽略 λ 近似：

```
100μ = (200μ/2)(5)(V_GS - 0.5)²
100μ = 500μ × (V_GS - 0.5)²
(V_GS - 0.5)² = 0.2
V_OV = √0.2 = 0.447 V
V_GS = 0.947 V
```

驗證含 λ：I_D = 500μ × 0.2 × (1 + 0.04 × 0.947) = 100μ × 1.038 = 103.8 μA
修正 V_OV = √(100/(500 × 1.038)) = √0.1927 = 0.439V，V_GS = 0.939V

近似足夠：V_OV ≈ 0.45V，V_GS ≈ 0.95V

> **答案 (a)：V_GS ≈ 0.95V，V_OV ≈ 0.45V**

(b) Q2 的 V_GS = Q1 的 V_GS = 0.95V（共閘極），但 V_DS2 不同：

V_DS2 = 1V：
```
I_OUT = 500μ × 0.2 × (1 + 0.04 × 1) = 100μ × 1.04 = 104 μA
```

V_DS2 = 3V：
```
I_OUT = 500μ × 0.2 × (1 + 0.04 × 3) = 100μ × 1.12 = 112 μA
```

誤差（相對於理想 100 μA）：
```
V_DS2=1V：+4%
V_DS2=3V：+12%
兩者之差：8%（因 ΔV_DS = 2V）
```

> **答案 (b)：I_OUT(1V) = 104 μA，I_OUT(3V) = 112 μA。V_DS 變化 2V 造成 8% 電流變化。**

(c) 輸出電阻：

```
r_o = 1/(λ × I_D) = 1/(0.04 × 100μ) = 250 kΩ
```

等價：V_A = 1/λ = 25V，r_o = V_A/I_D = 25/100μ = 250 kΩ

> **答案 (c)：R_out = r_o ≈ 250 kΩ**

(d) Cascode 電流鏡設計：

```
     VDD               VDD
      |                  |
     R_REF             [負載]
      |                  |
   D3=G3───G4─── D4     (cascode 管)
      |          |
   D1=G1───G2   S4=D2
      |          |
     S1=S3      S2
      |          |
     GND        GND

偏壓：V_BIAS = V_GS3 提供給 G3 和 G4
```

更標準的 cascode 電流鏡：

```
         VDD              VDD
          |                |
        R_REF            [負載]
          |                |
          |── G3=G4 ──── D4（輸出）
       D3=G3              |
          |              S4
       S3=D1              |
          |── G1=G2 ──── D2
       D1=G1              |
          |              S2
         S1               |
          |               |
         GND             GND
```

Cascode 輸出電阻：

```
R_out(cascode) = g_m4 × r_o4 × r_o2

g_m = 2I_D/V_OV = 2 × 100μ/0.45 = 444 μS

R_out(cascode) = 444μ × 250k × 250k
               = 444μ × 6.25 × 10^10
               = 27.75 MΩ
```

提升倍數：
```
R_out(cascode)/R_out(basic) = g_m × r_o = 444μ × 250k = 111 倍 > 50 倍 ✓
```

> **答案 (d)：Cascode 輸出電阻 ≈ 27.8 MΩ，為基本鏡的 g_m × r_o ≈ 111 倍。**

**Cascode 的代價**：最小輸出電壓 V_out(min) = 2V_OV ≈ 0.9V（兩管都需維持在飽和區），壓縮了輸出擺幅。

**延伸思考**：低電壓 cascode（low-voltage cascode / high-swing cascode）可將 V_out(min) 降至 2V_OV，而非 V_th + 2V_OV，在低電壓設計中至關重要。在先進製程（VDD < 1V）中，telescopic cascode 和 folded cascode 架構的選擇是核心設計決策。

---

### 題目 25：MOSFET 小信號參數與偏壓關係
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：MOSFET 小信號模型（Small-Signal Model）

**題目**：

一 NMOS，μ_nC_ox = 200 μA/V²，W/L = 50/0.5，V_th = 0.4V，λ = 0.1 V^-1，偏壓在 I_D = 1 mA。

(a) 求 g_m（用三種等價公式驗證）。
(b) 求 r_o。
(c) 求本徵增益（intrinsic gain）A_0 = g_m × r_o。
(d) 若 I_D 增至 4 mA（維持同一元件），g_m、r_o、A_0 如何變化？

**詳解**：

**解題思路**：MOSFET 小信號參數有三種等價表達式，各適用於不同已知條件。

**步驟**：

(a) 先求 V_OV：

```
k_n = 200 × 50/0.5 = 20000 μA/V² = 20 mA/V²

I_D = (k_n/2) × V_OV²
1 = (20/2) × V_OV²
V_OV² = 0.1
V_OV = 0.316 V
```

三種 g_m 公式：

公式 1：g_m = 2I_D / V_OV
```
g_m = 2 × 1mA / 0.316V = 6.33 mS
```

公式 2：g_m = k_n × V_OV = μ_nC_ox × (W/L) × V_OV
```
g_m = 20 × 0.316 = 6.33 mS ✓
```

公式 3：g_m = √(2 × k_n × I_D)
```
g_m = √(2 × 20 × 1) = √40 = 6.32 mS ✓
```

> **答案 (a)：g_m ≈ 6.33 mS**

(b) 輸出電阻：
```
r_o = 1/(λI_D) = 1/(0.1 × 1m) = 10 kΩ
```

> **答案 (b)：r_o = 10 kΩ**

(c) 本徵增益：
```
A_0 = g_m × r_o = 6.33m × 10k = 63.3
```

也可表示為：A_0 = 2/(λ × V_OV) = 2/(0.1 × 0.316) = 63.3 ✓

> **答案 (c)：A_0 = g_m r_o ≈ 63（約 36 dB）**

(d) I_D 從 1 mA 增至 4 mA（4 倍）：

```
V_OV(new) = V_OV × √(I_D'/I_D) = 0.316 × √4 = 0.632 V

g_m = 2I_D/V_OV = 2×4/0.632 = 12.66 mS（增為 2 倍，∝ √I_D）
r_o = 1/(λI_D) = 1/(0.1×4m) = 2.5 kΩ（縮為 1/4，∝ 1/I_D）
A_0 = 12.66m × 2.5k = 31.65（縮為 1/2，∝ 1/√I_D）
```

> **答案 (d)：g_m 增 2 倍至 12.7 mS；r_o 縮 4 倍至 2.5 kΩ；A_0 縮 2 倍至 31.7。增大電流會降低本徵增益！**

**延伸思考**：這揭示了 MOSFET 類比設計的核心矛盾：增大 I_D 可提高 g_m（改善速度和雜訊），但會降低 r_o（降低增益）。本徵增益 A_0 = 2/(λV_OV) 表明低 V_OV（低電流或大 W/L）和長通道（小 λ）有利於高增益。這就是為什麼類比設計師傾向使用較長的通道和較低的 V_OV。

---

### 題目 26：共源極（CS）放大器完整分析
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：CS 放大器（Common-Source Amplifier）— 業界面試必考

**題目**：

一 NMOS CS 放大器，VDD = 3.3V，R_D = 5 kΩ，I_D = 0.4 mA，V_OV = 0.3V，λ = 0.05 V^-1，R_L = 10 kΩ。

```
      VDD = 3.3V
       |
      R_D = 5kΩ
       |
  G ──|
       |── D ── C_out ── R_L
  |    |
V_bias S
       |
      GND
```

(a) 求 Q 點 V_DS 並確認飽和區。
(b) 求小信號電壓增益 A_v = v_o/v_i。
(c) 求輸入阻抗和輸出阻抗。
(d) 若將 R_D 替換為 PMOS 主動負載（r_o_p = 50 kΩ），增益變為多少？

**詳解**：

**解題思路**：CS 放大器是最基本的 MOSFET 增益級。主動負載可大幅提升增益。

**步驟**：

(a) Q 點：
```
V_DS = VDD - I_D × R_D = 3.3 - 0.4 × 5 = 3.3 - 2 = 1.3 V
V_DS = 1.3V > V_OV = 0.3V → 飽和區 ✓
```

> **答案 (a)：V_DS = 1.3V，確認在飽和區**

(b) 小信號參數與增益：
```
g_m = 2I_D/V_OV = 2 × 0.4/0.3 = 2.667 mS
r_o = 1/(λI_D) = 1/(0.05 × 0.4m) = 50 kΩ

A_v = -g_m × (R_D || r_o || R_L)
    = -2.667m × (5k || 50k || 10k)
```

計算並聯：
```
5k || 50k = 5×50/(5+50) = 250/55 = 4.545 kΩ
4.545k || 10k = 45.45/14.545 = 3.125 kΩ

A_v = -2.667 × 3.125 = -8.33
```

> **答案 (b)：A_v ≈ -8.3**

(c) 阻抗：
```
R_in = ∞（MOSFET 閘極不吸電流，理想情況）
R_out = R_D || r_o = 5k || 50k = 4.545 kΩ
```

> **答案 (c)：R_in = ∞（實際受閘極偏壓電阻限制），R_out ≈ 4.55 kΩ**

(d) PMOS 主動負載：

R_D → ∞，負載變為 r_o_n || r_o_p：
```
R_L' = r_o_n || r_o_p || R_L = 50k || 50k || 10k
     = 25k || 10k = 7.143 kΩ

A_v = -g_m × R_L' = -2.667 × 7.143 = -19.05
```

若無外部 R_L（純主動負載，IC 內部）：
```
A_v = -g_m × (r_o_n || r_o_p) = -2.667 × 25 = -66.7
```

> **答案 (d)：帶 R_L = 10kΩ 時 A_v ≈ -19；無外部負載時 A_v ≈ -66.7（提升 8 倍）**

**延伸思考**：主動負載放大器的增益上限為 g_m(r_on||r_op) = 本徵增益的一半。在 IC 設計中，幾乎所有高增益放大器都使用主動負載。若需更高增益，可使用 cascode 主動負載或多級串疊。

---

### 題目 27：CS 放大器含源極退化電阻
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：源極退化（Source Degeneration）— 業界面試常考

**題目**：

一 NMOS CS 放大器帶源極退化電阻 R_S = 500Ω，I_D = 0.5 mA，V_OV = 0.4V，λ = 0.04 V^-1，R_D = 5 kΩ。

(a) 求電壓增益 A_v（精確公式，含 r_o）。
(b) 求等效轉導 G_m。
(c) 求從汲極看入的輸出電阻 R_out（含 R_S 的 bootstrapping 效應）。
(d) 說明源極退化對線性度的改善。

**詳解**：

**解題思路**：源極退化引入串聯負回授，降低增益但改善線性度，同時提升輸出阻抗。

**步驟**：

小信號參數：
```
g_m = 2 × 0.5/0.4 = 2.5 mS
r_o = 1/(0.04 × 0.5m) = 50 kΩ
```

(a) 精確增益公式（含 r_o 和 R_S）：

用小信號等效電路分析（T 模型較直觀）：

```
A_v = -g_m × R_D / (1 + g_m × R_S + R_D/r_o + R_S/r_o)
```

簡化（因 R_D/r_o = 5/50 = 0.1，R_S/r_o = 0.5/50 = 0.01，都較小）：

```
A_v ≈ -g_m × R_D / (1 + g_m × R_S)
    = -2.5 × 5 / (1 + 2.5 × 0.5)
    = -12.5 / 2.25
    = -5.56
```

精確值（含所有項）：
```
A_v = -12.5 / (1 + 1.25 + 0.1 + 0.01)
    = -12.5 / 2.36
    = -5.30
```

> **答案 (a)：A_v ≈ -5.3（精確）或 -5.6（忽略 r_o 相關小項）**

(b) 等效轉導：

```
G_m = g_m / (1 + g_m × R_S) = 2.5 / (1 + 1.25) = 2.5/2.25 = 1.111 mS
```

可驗證：A_v ≈ -G_m × R_D = -1.111 × 5 = -5.56 ✓（近似）

> **答案 (b)：G_m ≈ 1.11 mS（有效轉導因退化降低約 55%）**

(c) 從汲極看入的輸出阻抗（關鍵！）：

這是最重要的公式之一（bootstrapping 效應）：

```
R_out = r_o + R_S + g_m × r_o × R_S
      = r_o × (1 + g_m × R_S) + R_S
      = 50k × (1 + 2.5 × 0.5) + 0.5
      = 50k × 2.25 + 0.5k
      = 112.5k + 0.5k
      = 113 kΩ
```

> **答案 (c)：R_out ≈ 113 kΩ（比裸 r_o = 50 kΩ 增大 2.26 倍）**

**此公式極重要**：R_out ≈ r_o(1 + g_m R_S) 展示了源極退化如何「bootstraps」輸出阻抗。這與 cascode 的原理類似，都是透過在源極端加阻抗來提升汲極端的等效電阻。

(d) 線性度改善：

無退化時，I_D 與 V_GS 為平方關係，非線性失真（二次諧波）的比例約為：
```
HD2(無退化) ≈ V_in / (4V_OV)
```

有退化時：
```
HD2(有退化) ≈ V_in / (4V_OV × (1 + g_m R_S))
            = HD2(無退化) / (1 + g_m R_S)
            = HD2(無退化) / 2.25
```

失真減少為原來的 1/2.25 = 44%。

具體例子：若 V_in = 100 mV（峰值）
```
無退化：HD2 ≈ 100/(4 × 400) = 6.25%
有退化：HD2 ≈ 6.25/2.25 = 2.78%
```

> **答案 (d)：源極退化將二次諧波失真降低 (1 + g_m R_S) 倍。V_in 可容忍範圍從 V_OV 擴展到 (1 + g_m R_S) × V_OV。**

**延伸思考**：在 RF 低噪聲放大器（LNA）設計中，常用電感源極退化（inductive degeneration）取代電阻退化。電感不消耗功率也不產生噪聲，同時可與閘極電容共振實現 50Ω 輸入匹配，是射頻 IC 設計的經典技巧。

---

### 題目 28：共閘極（CG）放大器
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：CG 放大器（Common-Gate Amplifier）

**題目**：

一 NMOS CG 放大器，I_D = 1 mA，V_OV = 0.3V，λ = 0.05 V^-1，R_D = 3 kΩ，R_L = 10 kΩ，信號從源極輸入。

```
      VDD
       |
      R_D
       |
       D ── C_out ── R_L
       |
  V_BIAS ── G
       |
       S ── C_in ── v_i（信號）
       |
      I_BIAS（電流源偏壓）
```

(a) 求電壓增益 A_v = v_o/v_i。
(b) 求輸入阻抗 R_in（從源極看入）。
(c) 求輸出阻抗 R_out（從汲極看出，假設源極端接理想電流源）。
(d) 比較 CG 與 CS 在高頻應用中的優劣。

**詳解**：

**解題思路**：CG 組態類似 BJT 的 CB，特點是低輸入阻抗、高輸出阻抗、不反相、無 Miller 效應。

**步驟**：

小信號參數：
```
g_m = 2I_D/V_OV = 2 × 1/0.3 = 6.667 mS
r_o = 1/(λI_D) = 1/(0.05 × 1m) = 20 kΩ
```

(a) 電壓增益：

```
A_v = g_m × (R_D || r_o || R_L)

R_D || r_o = 3k || 20k = 2.609 kΩ
2.609k || 10k = 2.069 kΩ

A_v = 6.667 × 2.069 = +13.79
```

注意增益為正（不反相）。

> **答案 (a)：A_v ≈ +13.8（不反相）**

(b) 輸入阻抗（從源極看入）：

精確公式（考慮 R_D 和 r_o）：
```
R_in = 1/g_m || r_o × (1/(1 + g_m × r_o)) × ...
```

簡化（R_D << r_o 時）：
```
R_in ≈ (1/g_m) || (r_o + R_D)/(1 + g_m × r_o)
```

最常用近似：
```
R_in ≈ 1/g_m = 1/6.667m = 150 Ω
```

更精確（含 r_o 影響）：
```
R_in = (r_o + R_D || R_L) / (1 + g_m × r_o)
     = (20k + 2.308k) / (1 + 6.667 × 20)
     = 22.308k / 134.3
     = 166 Ω
```

> **答案 (b)：R_in ≈ 150 ~ 166 Ω（約 1/g_m）**

(c) 輸出阻抗（源極接理想電流源，即 R_S → ∞）：

```
R_out = r_o × (1 + g_m × R_S) + R_S
```

R_S → ∞（理想電流源）時：
```
R_out → g_m × r_o × R_S → ∞（不實用）
```

實際上，若源極端的電流源輸出阻抗為 R_CS：
```
R_out = r_o + R_CS + g_m × r_o × R_CS
```

若 R_CS = r_o（另一個匹配 MOSFET 的電流源）：
```
R_out = r_o + r_o + g_m × r_o² = 2r_o + g_m × r_o²
     ≈ g_m × r_o² = 6.667m × (20k)² = 6.667m × 4 × 10^8 = 2.667 MΩ
```

從汲極看出，不考慮源極端電路：R_out = R_D || (包含源極退化的 r_o 增強)

最簡單情況（源極接地）：
```
R_out = r_o = 20 kΩ
```

> **答案 (c)：R_out = r_o = 20 kΩ（源極接地）；若源極接電流源（R_CS），R_out ≈ g_m r_o R_CS（大幅增加，這就是 cascode 的原理）**

(d) CG vs CS 高頻比較：

| 特性 | CS | CG |
|------|-----|-----|
| Miller 效應 | 嚴重（C_gd 被放大 (1+\|A_v\|) 倍） | 無（閘極交流接地） |
| 頻寬 | 較窄 | 較寬 |
| 輸入阻抗 | 高（∞） | 低（1/g_m） |
| 適用場景 | 一般放大、高阻源 | 寬頻、低阻源（如 50Ω） |

> **答案 (d)：CG 無 Miller 效應，頻寬遠優於 CS，但輸入阻抗低（~1/g_m），需低阻信號源驅動。CG 常用在 cascode 架構的上管和寬頻放大器中。**

**延伸思考**：Cascode 放大器（CS + CG 串疊）結合了 CS 的高輸入阻抗和 CG 的高輸出阻抗及寬頻特性，是高增益寬頻放大器的核心架構。

---

### 題目 29：共汲極（CD）/ 源極隨耦器
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：源極隨耦器（Source Follower）— 業界面試常考

**題目**：

一 NMOS 源極隨耦器，I_D = 0.5 mA，V_OV = 0.3V，λ = 0.05 V^-1，R_L = 2 kΩ，偏壓電流源以 NMOS 電流鏡實現（r_o_bias = 40 kΩ）。

```
      VDD
       |
       D
       |
  v_i ── G
       |
       S ── v_o
       |
      I_BIAS（r_o_bias = 40kΩ）
       |
      GND
```

(a) 求電壓增益 A_v = v_o/v_i。
(b) 求輸出阻抗 R_out。
(c) 為何 MOSFET 源極隨耦器的增益永遠無法達到 1？（與 BJT 射極隨耦器比較）
(d) 說明 body effect 對源極隨耦器增益的影響。

**詳解**：

**解題思路**：源極隨耦器為電壓緩衝器，但 MOSFET 版本因 g_m 有限和 body effect，增益比 BJT 版本低。

**步驟**：

小信號參數：
```
g_m = 2 × 0.5/0.3 = 3.333 mS
r_o = 1/(0.05 × 0.5m) = 40 kΩ
```

(a) 電壓增益：

有效負載：R_L_eff = R_L || r_o_bias || r_o = 2k || 40k || 40k = 2k || 20k = 1.818 kΩ

不考慮 body effect：
```
A_v = g_m × R_L_eff / (1 + g_m × R_L_eff)
    = 3.333 × 1.818 / (1 + 3.333 × 1.818)
    = 6.06 / (1 + 6.06)
    = 6.06 / 7.06
    = 0.858
```

> **答案 (a)：A_v ≈ 0.86（不考慮 body effect）**

(b) 輸出阻抗：

```
R_out = (1/g_m) || r_o || r_o_bias || R_L
```

1/g_m 最小，主導：
```
1/g_m = 300 Ω

R_out = 300 || 40k || 40k || 2k
      = 300 || 20k || 2k
      = 300 || 1818
      = 258 Ω
```

或更精確：R_out = (1/g_m || r_o) || r_o_bias（先處理本管再並聯偏壓源）
```
1/g_m || r_o = 300 || 40k = 298 Ω
298 || 40k = 296 Ω
```

> **答案 (b)：R_out ≈ 258 ~ 300 Ω（主要由 1/g_m 決定）**

(c) 為何增益 < 1：

BJT 射極隨耦器增益：
```
A_v(BJT) = g_m × R_L / (1 + g_m × R_L)
```

當 R_L 很大時，A_v → 1。對 BJT，g_m = I_C/V_T，在 I_C = 1mA 時 g_m = 38.5 mS，非常大。

MOSFET 源極隨耦器：g_m = 2I_D/V_OV，通常只有 1~10 mS。

問題在於 g_m × R_L 的乘積：
- BJT：g_m × R_L = 38.5 × 2 = 77 → A_v = 77/78 = 0.987
- MOSFET：g_m × R_L = 3.33 × 2 = 6.67 → A_v = 6.67/7.67 = 0.870

MOSFET 的 g_m 天生較小（平方律 vs 指數律），因此乘積較小，增益離 1 更遠。

> **答案 (c)：MOSFET 的 g_m 由平方律決定，遠小於同偏壓電流下 BJT 的 g_m（指數律），導致 g_m R_L 乘積不夠大，增益無法接近 1。**

(d) Body effect 的影響：

當源極電壓隨信號變化時，V_SB 也跟著變（假設 B 接地），這導致 V_th 隨 V_SB 變化：

```
V_th = V_th0 + γ(√(2φ_f + V_SB) - √(2φ_f))
```

body effect 等效為一個額外的轉導 g_mb：
```
g_mb = γ × g_m / (2√(2φ_f + V_SB))
```

典型 g_mb/g_m ≈ 0.1 ~ 0.3（稱為 η = g_mb/g_m）

含 body effect 的增益：
```
A_v = g_m × R_L / (1 + (g_m + g_mb) × R_L)
    = g_m / (g_m + g_mb + 1/R_L)
```

以 η = 0.2 為例：
```
A_v = 3.333 / (3.333 + 0.667 + 1/1.818)
    = 3.333 / (3.333 + 0.667 + 0.55)
    = 3.333 / 4.55
    = 0.733
```

增益從 0.86 降至 0.73，下降約 15%。

> **答案 (d)：Body effect 引入額外轉導 g_mb，使增益降為 g_m/(g_m + g_mb + 1/R_L)，典型降幅 10~20%。解決方法：將 body 接到 source（需要 triple-well 製程或使用 PMOS）。**

**延伸思考**：在 PMOS 源極隨耦器中（源極接 VDD 側），若在 N-well 製程中，PMOS 的 body（N-well）可直接接到 source，消除 body effect，因此 PMOS 源極隨耦器常比 NMOS 有更高增益。這是 IC 設計中的實用技巧。

---

### 題目 30：Cascode 放大器
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：Cascode 放大器（Cascode Amplifier）— 高階面試必考

**題目**：

一 Cascode 放大器（CS + CG 串疊），兩管參數相同：I_D = 0.2 mA，V_OV = 0.2V，λ = 0.05 V^-1。使用 PMOS cascode 電流鏡作為主動負載（等效輸出阻抗 R_load）。

```
      VDD
       |
    [PMOS cascode 電流鏡負載] → R_load
       |
       D2（CG 管 M2 的汲極）── v_o
       |
  V_B ── G2（偏壓）
       |
       S2 = D1
       |
  v_i ── G1（CS 管 M1）
       |
       S1
       |
      GND
```

(a) 求各管的 g_m 和 r_o。
(b) 求 cascode 的輸出阻抗 R_out（NMOS 側）。
(c) 若 PMOS cascode 負載的 R_load = R_out（匹配設計），求總電壓增益。
(d) 與單級 CS 放大器比較增益提升倍數。

**詳解**：

**解題思路**：Cascode 的核心價值是將輸出阻抗從 r_o 提升到 g_m r_o²，從而大幅提升主動負載放大器的增益。

**步驟**：

(a) 小信號參數（兩管相同）：
```
g_m = 2I_D/V_OV = 2 × 0.2/0.2 = 2 mS
r_o = 1/(λI_D) = 1/(0.05 × 0.2m) = 100 kΩ
```

> **答案 (a)：g_m = 2 mS，r_o = 100 kΩ（每管）**

(b) Cascode 輸出阻抗（NMOS 側）：

CG 管 M2 的源極接 CS 管 M1 的汲極（阻抗為 r_o1）。

CG 管的輸出阻抗公式（R_S = r_o1）：
```
R_out(NMOS) = r_o2 + r_o1 + g_m2 × r_o2 × r_o1
            = 100k + 100k + 2m × 100k × 100k
            = 200k + 20M
            ≈ 20 MΩ = g_m r_o²
```

（因 g_m r_o² >> 2r_o，簡化為 g_m r_o²）

> **答案 (b)：R_out(NMOS) ≈ g_m r_o² = 20 MΩ**

(c) 總增益（PMOS cascode 負載匹配）：

```
R_load = R_out(NMOS) = 20 MΩ（假設 PMOS 側也是 cascode）

總等效負載 = R_out(NMOS) || R_load = 20M || 20M = 10 MΩ

A_v = -g_m1 × (R_out || R_load)
    = -2m × 10M
    = -20,000
```

以 dB 表示：20 × log(20000) = 86 dB

> **答案 (c)：A_v ≈ -20,000（86 dB）**

更精確的表達：A_v = -(g_m r_o)² / 2

因為 g_m r_o = 2m × 100k = 200：
```
A_v = -200² / 2 = -20,000 ✓
```

(d) 與單級 CS 比較：

單級 CS（主動負載）：
```
A_v(CS) = -g_m × (r_o_n || r_o_p) = -2m × (100k || 100k) = -2m × 50k = -100
```

增益提升：
```
20000 / 100 = 200 倍 = g_m r_o 倍
```

> **答案 (d)：Cascode 比單級 CS 增益提升 g_m r_o = 200 倍（46 dB），從 40 dB 提升到 86 dB。**

**延伸思考**：

Cascode 的代價：
1. **輸出擺幅受限**：v_o 的範圍從 2V_OV（底部）到 VDD - 2V_OV（頂部），比 CS 少了 2V_OV
2. **需要額外偏壓電路**：V_B 需精確設定使 M1 恰好在飽和區邊緣
3. **電壓裕度（headroom）**：在低壓設計中 cascode 很難實現

在超低壓（VDD < 1V）設計中，folded cascode 是更好的選擇，犧牲一些輸出阻抗換取全擺幅輸出。Telescopic cascode 效率高但擺幅小，folded cascode 擺幅大但功耗高。

---

### 題目 31：主動負載 CS 放大器設計
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：主動負載放大器（Active-Load Amplifier）

**題目**：

設計一 NMOS-input、PMOS-load 的單級放大器，目標增益 |A_v| ≥ 40（32 dB）。製程參數：NMOS：μ_nC_ox = 200 μA/V²，V_thn = 0.4V，λ_n = 0.04 V^-1；PMOS：μ_pC_ox = 80 μA/V²，V_thp = -0.4V，λ_p = 0.06 V^-1。VDD = 1.8V，I_D = 100 μA。

```
      VDD = 1.8V
       |
      M2 (PMOS, 二極體連接或電流鏡偏壓)
       |
       D2 = D1 ── v_o
       |
  v_i ── G1 (NMOS)
       |
       S1
       |
      GND
```

(a) 若 PMOS 為二極體連接負載，增益為何？能否達標？
(b) 若 PMOS 為電流源負載（由電流鏡偏壓），求所需的 V_OV(n) 使增益 ≥ 40。
(c) 設計 (W/L)_n 和 (W/L)_p。
(d) 確認 Q 點在合理範圍內。

**詳解**：

**解題思路**：比較二極體連接 vs 電流源負載的增益差異，並進行完整設計。

**步驟**：

(a) 二極體連接 PMOS 負載：

二極體連接的小信號電阻 = 1/g_mp（很低）

增益：
```
A_v = -g_mn / g_mp = -√(μ_n C_ox (W/L)_n / (μ_p C_ox (W/L)_p))
```

若 (W/L)_n = (W/L)_p：
```
|A_v| = √(μ_n/μ_p) = √(200/80) = √2.5 = 1.58
```

遠不到 40！即使調整 W/L 比：
```
|A_v| = √(μ_n(W/L)_n / (μ_p(W/L)_p))
```

要 |A_v| = 40：(W/L)_n/(W/L)_p 需為 40² × μ_p/μ_n = 1600 × 80/200 = 640，不實際。

> **答案 (a)：二極體連接負載最大增益約 √(μ_n/μ_p) ≈ 1.6（若尺寸相同），完全無法達標。**

(b) 電流源負載（PMOS 由電流鏡偏壓，保持高 r_o）：

```
A_v = -g_mn × (r_on || r_op)

g_mn = 2I_D/V_OV(n)
r_on = 1/(λ_n × I_D) = 1/(0.04 × 100μ) = 250 kΩ
r_op = 1/(λ_p × I_D) = 1/(0.06 × 100μ) = 166.7 kΩ

r_on || r_op = 250 || 166.7 = 100 kΩ
```

令 |A_v| ≥ 40：
```
g_mn × 100k ≥ 40
g_mn ≥ 0.4 mS

2 × 100μ / V_OV(n) ≥ 0.4m
V_OV(n) ≤ 200μ / 0.4m = 0.5V
```

取 V_OV(n) = 0.3V（合理值）：g_mn = 2 × 100μ/0.3 = 0.667 mS

```
|A_v| = 0.667m × 100k = 66.7（超過 40，符合）
```

> **答案 (b)：V_OV(n) ≤ 0.5V 即可。取 V_OV(n) = 0.3V，|A_v| = 66.7。**

(c) 尺寸設計：

NMOS（V_OV = 0.3V）：
```
I_D = (μ_nC_ox/2)(W/L)_n × V_OV²
100μ = (200μ/2)(W/L)_n × 0.09
(W/L)_n = 100/(100 × 0.09) = 11.1 → 取 (W/L)_n = 12/1
```

PMOS（需通過相同 I_D = 100 μA）：
```
V_OV(p) = V_SG - |V_thp|

100μ = (80μ/2)(W/L)_p × V_OV(p)²
```

選 V_OV(p) = 0.3V（與 NMOS 相同，可不同）：
```
(W/L)_p = 100/(40 × 0.09) = 27.8 → 取 (W/L)_p = 28/1
```

> **答案 (c)：(W/L)_n ≈ 12/1，(W/L)_p ≈ 28/1**

(d) Q 點驗證：

```
V_GS(n) = V_th + V_OV(n) = 0.4 + 0.3 = 0.7V
V_SG(p) = |V_thp| + V_OV(p) = 0.4 + 0.3 = 0.7V

V_out(Q) = VDD - V_SG(p) - 一些裕度...
```

實際上 v_o 的範圍：
```
v_o(min) = V_OV(n) = 0.3V（NMOS 飽和邊界）
v_o(max) = VDD - V_OV(p) = 1.8 - 0.3 = 1.5V（PMOS 飽和邊界）
```

Q 點設在中間：V_out(Q) = (0.3 + 1.5)/2 = 0.9V

擺幅：0.3V 到 1.5V，peak-to-peak = 1.2V

> **答案 (d)：Q 點 V_out ≈ 0.9V，輸出擺幅 0.3V ~ 1.5V（1.2 Vpp），在 VDD = 1.8V 下合理。**

**延伸思考**：在實際 IC 設計流程中，還需考慮：(1) PMOS 電流鏡的匹配性、(2) 共模輸入範圍、(3) 製程變異（process variation）對增益的影響。增益 A_v = g_m(r_on||r_op) = 2/(V_OV(λ_n + λ_p)) 只與 V_OV 和 λ 有關，與 I_D 無直接關係（λ 可能弱依賴 I_D）。

---

### 題目 32：MOSFET 放大器系統性比較
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：三種基本組態比較（CS / CG / CD Comparison）

**題目**：

三個 NMOS 電晶體參數完全相同：I_D = 0.5 mA，g_m = 3 mS，r_o = 40 kΩ，分別組成 CS、CG、CD 放大器。外部負載 R_L = 5 kΩ，信號源內阻 R_S = 1 kΩ。

填寫下表並解釋各項數值的物理意義：

| 特性 | CS | CG | CD |
|------|-----|-----|-----|
| A_v（含 R_S） | ? | ? | ? |
| R_in | ? | ? | ? |
| R_out | ? | ? | ? |
| 頻寬（相對） | ? | ? | ? |
| 典型應用 | ? | ? | ? |

**詳解**：

**解題思路**：分別對三種組態套用公式，進行系統性比較。

**步驟**：

**CS 放大器**：
```
R_in = ∞
有效負載 = R_L || r_o = 5k || 40k = 4.444 kΩ
A_v(from gate) = -g_m × 4.444k = -13.33
含 R_S：A_v = -13.33 × ∞/(∞+1k) = -13.33（R_S 不影響，因 R_in = ∞）
R_out = r_o = 40 kΩ（不接 R_D 時）
```

若有 R_D = 5kΩ：R_out = R_D || r_o = 4.44 kΩ

**CG 放大器**：
```
R_in = 1/g_m = 333 Ω
有效負載 = R_L || r_o = 4.444 kΩ（同上）
A_v(from source) = g_m × 4.444k = +13.33
含 R_S（信號源分壓）：
A_v = 13.33 × R_in/(R_in + R_S) = 13.33 × 333/(333+1000) = 13.33 × 0.25 = 3.33
R_out ≈ r_o = 40 kΩ
```

**CD 放大器（源極隨耦器）**：
```
R_in = ∞
A_v = g_m × R_L / (1 + g_m × R_L)（R_L 此處為源極端負載）
    = 3 × 5 / (1 + 3 × 5) = 15/16 = 0.9375
含 R_S：A_v = 0.9375（R_S 不影響，因 R_in = ∞）
R_out = 1/g_m || r_o ≈ 1/g_m = 333 Ω
```

完整表格：

| 特性 | CS | CG | CD |
|------|-----|-----|-----|
| A_v（含 R_S） | **-13.3** | **+3.3** | **+0.94** |
| R_in | **∞** | **333 Ω** | **∞** |
| R_out | **40 kΩ** | **40 kΩ** | **333 Ω** |
| 頻寬（相對） | 窄（Miller） | **寬** | **寬** |
| 典型應用 | 電壓放大 | 寬頻/cascode | 緩衝/驅動 |

> **答案：如上表。CS 提供最高增益但頻寬最窄；CG 寬頻但增益受限於低 R_in；CD 增益 ≈ 1 但提供阻抗轉換。**

**延伸思考**：在實際多級放大器設計中，典型架構為：
- 差動對（differential pair, CS 變體）→ 提供增益和差動輸入
- Cascode（CS + CG）→ 提高增益和頻寬
- 源極隨耦器（CD）→ 輸出級驅動低阻負載

---

### 題目 33：CMOS 電流鏡比例設計與失配分析
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：電流鏡設計（Current Mirror Design）— IC 設計核心

**題目**：

一 NMOS 電流鏡需產生四種電流：I_1 = 50 μA，I_2 = 100 μA，I_3 = 200 μA，I_4 = 25 μA。參考管 M_REF 通過 I_REF = 100 μA，(W/L)_REF = 10/2。所有管 V_th 相同，λ = 0.03 V^-1。

(a) 設計各鏡射管的 (W/L)。
(b) 若 V_th 的失配（mismatch）σ(ΔV_th) = 5 mV，V_OV = 0.2V，求各輸出電流的相對標準差。
(c) 為減小失配，設計上可採取哪些措施？

**詳解**：

**解題思路**：電流鏡的電流比由 W/L 比決定。失配分析是 IC 設計的關鍵課題。

**步驟**：

(a) 電流比 = (W/L)_out / (W/L)_REF：

```
M1：I_1/I_REF = 50/100 = 0.5 → (W/L)_1 = 0.5 × 10/2 = 5/2
M2：I_2/I_REF = 100/100 = 1 → (W/L)_2 = 10/2
M3：I_3/I_REF = 200/100 = 2 → (W/L)_3 = 20/2
M4：I_4/I_REF = 25/100 = 0.25 → (W/L)_4 = 2.5/2（或 5/4）
```

> **答案 (a)：(W/L)_1 = 5/2，(W/L)_2 = 10/2，(W/L)_3 = 20/2，(W/L)_4 = 5/4**

(b) V_th 失配對電流的影響：

```
I_D = (k/2)(V_GS - V_th)² = (k/2)V_OV²

ΔI_D/I_D = 2 × ΔV_th/V_OV（一階近似）

σ(ΔI_D)/I_D = 2 × σ(ΔV_th)/V_OV = 2 × 5mV/200mV = 5%
```

此結果與鏡射比無關（每支管都有相同的相對誤差）。

> **答案 (b)：所有輸出電流的相對標準差 ≈ 5%**

(c) 減小失配的措施：

1. **增大 V_OV**：ΔI/I = 2ΔV_th/V_OV，V_OV 越大越好。但 V_OV 增大會降低增益（A_0 = 2/(λV_OV)），需取捨。

2. **增大元件面積**：V_th 失配遵循 Pelgrom 定律：σ(ΔV_th) = A_VT/√(WL)，增大面積可降低失配。

3. **使用相同 L**：所有管用相同 L，只調 W，避免 L 方向的系統性誤差。

4. **佈局技巧**：
   - 共質心佈局（common-centroid layout）
   - 虛擬管（dummy devices）在陣列邊緣
   - 電流方向一致
   - 遠離應力來源

5. **Cascode 結構**：抑制 V_DS 差異造成的 λ 效應誤差。

> **答案 (c)：增大 V_OV、增大面積（Pelgrom 定律）、共質心佈局、cascode 結構。**

**延伸思考**：在高精度 DAC/ADC 設計中，電流鏡匹配精度要求可達 0.1% 以下，需要精心的佈局和校準技術。12-bit DAC 需要 1/4096 ≈ 0.024% 的精度，這對電流鏡設計是極大的挑戰。

---

### 題目 34：差動對與單端輸出
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：差動對（Differential Pair）— 跨 Part 3/4 的重要過渡

**題目**：

一 NMOS 差動對，尾電流 I_SS = 200 μA，(W/L) = 20/1（兩管相同），μ_nC_ox = 200 μA/V²，V_th = 0.5V，λ = 0.04 V^-1。使用 PMOS 電流鏡負載實現單端輸出。

```
            VDD
        |         |
       M3(P)    M4(P)（電流鏡）
        |         |
  v_o1──┤         ├── v_o（單端輸出）
        |         |
   v_i+ ──G1  G2── v_i-
        |    |    |
        S1   S2
         \  /
          \/
         I_SS = 200μA
          |
         GND
```

(a) 求每管的 V_OV 和 g_m。
(b) 求差模電壓增益 A_d = v_o/(v_i+ - v_i-)（單端輸出）。
(c) 求最大差模輸入電壓使兩管都保持在飽和區。
(d) 畫出大信號轉移曲線 I_D1 vs v_id。

**詳解**：

**解題思路**：差動對是類比 IC 的核心模組，需理解小信號增益和大信號行為。

**步驟**：

(a) 每管偏壓在 I_D = I_SS/2 = 100 μA：

```
k_n = 200 × 20/1 = 4000 μA/V² = 4 mA/V²

I_D = (k_n/2) × V_OV²
100μ = (4m/2) × V_OV²
V_OV² = 100μ/2m = 0.05
V_OV = 0.224 V

g_m = 2I_D/V_OV = 2 × 100μ/0.224 = 0.894 mS
```

或 g_m = √(2 k_n I_D) = √(2 × 4m × 100μ) = √(0.8m) = 0.894 mS ✓

> **答案 (a)：V_OV ≈ 0.224 V，g_m ≈ 0.894 mS**

(b) 單端輸出差模增益：

每管 r_o：
```
r_on = 1/(λ_n × I_D) = 1/(0.04 × 100μ) = 250 kΩ
```

PMOS 電流鏡負載：假設 λ_p ≈ λ_n = 0.04：
```
r_op = 250 kΩ
```

單端輸出增益（從 v_o 端）：
```
A_d = g_m × (r_on || r_op) = 0.894m × (250k || 250k)
    = 0.894m × 125k = 111.7
```

注意：差動對的單端增益是 g_m × (r_on || r_op)，不除以 2。這是因為 PMOS 電流鏡將另一側的電流變化「搬運」到輸出端，使得有效 g_m 為全量 g_m（非 g_m/2）。

> **答案 (b)：A_d ≈ 112（41 dB）**

(c) 最大差模輸入：

差動對的線性範圍由 V_OV 決定。當 |v_id| > √2 × V_OV 時，一管完全截止：

```
|v_id|_max = √2 × V_OV = √2 × 0.224 = 0.316 V
```

但在此之前增益已非線性。通常要求 1% 線性度時：
```
|v_id| < V_OV/4 ≈ 56 mV
```

> **答案 (c)：|v_id|_max = √2 × V_OV ≈ 316 mV（完全切換）；線性工作範圍 ≈ ±56 mV（1% 誤差）**

(d) 大信號轉移曲線：

```
I_D1 = (I_SS/2) × (1 + v_id/V_OV × √(1 - (v_id/(2V_OV))²))（精確公式）
```

近似行為：
```
v_id = 0：          I_D1 = I_SS/2 = 100 μA
v_id = +V_OV：      I_D1 ≈ 0.93 × I_SS = 186 μA
v_id = +√2×V_OV：   I_D1 = I_SS = 200 μA（M2 截止）
v_id = -√2×V_OV：   I_D1 = 0（M1 截止）
```

轉移曲線為 S 形，中心斜率 = g_m = 0.894 mS。

> **答案 (d)：S 形曲線，在 ±√2 V_OV ≈ ±316 mV 內從 0 過渡到 I_SS，中心點斜率為 g_m。**

**延伸思考**：差動對的線性範圍正比於 V_OV。增大 V_OV（增大 I_SS 或減小 W/L）可擴大線性範圍，但會降低增益（g_m 降低或 r_o 降低）。BJT 差動對的線性範圍約 ±2V_T ≈ ±52 mV，遠小於 MOSFET，但其 g_m/I_D 比（轉導效率）更高。

---

### 題目 35：折疊式 Cascode 放大器
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：Folded Cascode（折疊式串疊放大器）— IC 設計進階

**題目**：

一折疊式 cascode OTA（operational transconductance amplifier），NMOS 差動輸入對，PMOS cascode 折疊，NMOS cascode 負載。

```
              VDD
          |         |
         M5(P)    M6(P)  ← PMOS cascode（偏壓 V_BP）
          |         |
         M7(P)    M8(P)  ← PMOS 電流源
          |         |
   v_i+ ──G1  G2── v_i-  ← NMOS 差動輸入對
          |    |    |
          S1   S2
           \  /
            \/
           I_SS
            |
           GND

   折疊分支接至 NMOS cascode 負載 M9-M12
   輸出在 M6 和 M10 的交會點
```

所有管 |V_OV| = 0.2V，I_D(每管) = 100 μA，λ_n = 0.04 V^-1，λ_p = 0.06 V^-1。

(a) 求輸入管 M1 的 g_m。
(b) 求輸出阻抗 R_out（PMOS cascode 和 NMOS cascode 並聯）。
(c) 求電壓增益。
(d) 求輸出擺幅（output swing）。
(e) 與 telescopic cascode 比較優缺點。

**詳解**：

**解題思路**：Folded cascode 是最常用的高增益單級放大器架構，理解其增益和擺幅是 IC 設計面試的核心。

**步驟**：

(a) 輸入管 g_m：
```
g_m1 = 2 × I_D1 / V_OV = 2 × 100μ / 0.2 = 1 mS
```

> **答案 (a)：g_m1 = 1 mS**

(b) 輸出阻抗分析：

各管 r_o：
```
r_o(NMOS) = 1/(0.04 × 100μ) = 250 kΩ
r_o(PMOS) = 1/(0.06 × 100μ) = 166.7 kΩ

g_m(NMOS cascode 管) = 2 × 100μ/0.2 = 1 mS
g_m(PMOS cascode 管) = 1 mS
```

PMOS cascode 輸出阻抗（M5/M6 + M7/M8）：
```
R_out(P) = g_m(M6) × r_o(M6) × r_o(M8)
         = 1m × 166.7k × 166.7k
         ≈ 27.8 MΩ
```

NMOS cascode 輸出阻抗（M9/M10 + M11/M12）：
```
R_out(N) = g_m(M10) × r_o(M10) × r_o(M12)
         = 1m × 250k × 250k
         = 62.5 MΩ
```

總輸出阻抗（並聯）：
```
R_out = R_out(P) || R_out(N) = 27.8M || 62.5M = 19.25 MΩ
```

> **答案 (b)：R_out ≈ 19.3 MΩ**

(c) 電壓增益：
```
A_v = g_m1 × R_out = 1m × 19.25M = 19,250 ≈ 85.7 dB
```

> **答案 (c)：|A_v| ≈ 19,250（85.7 dB）**

(d) 輸出擺幅：

上限：v_o(max) = VDD - |V_OV(M8)| - |V_OV(M6)|
```
= VDD - 0.2 - 0.2 = VDD - 0.4V
```

下限：v_o(min) = V_OV(M12) + V_OV(M10)
```
= 0.2 + 0.2 = 0.4V
```

若 VDD = 1.8V：
```
擺幅 = (1.8 - 0.4) - 0.4 = 1.0V（peak-to-peak）
或 ±0.5V（以 Q 點 0.9V 為中心）
```

> **答案 (d)：輸出擺幅 ≈ VDD - 4V_OV = 1.8 - 0.8 = 1.0 Vpp（每邊 2V_OV 的 headroom）**

(e) Folded vs Telescopic Cascode 比較：

| 特性 | Telescopic | Folded |
|------|-----------|--------|
| 增益 | 相當（略高） | 相當（略低，因多一支管的 r_o 參與） |
| 功耗 | 低（所有電流流經信號路徑） | 高（折疊分支需額外偏壓電流） |
| 輸出擺幅 | 小（每邊 3-4 個 V_OV） | 大（每邊只 2 個 V_OV） |
| 共模輸入範圍 | 小 | 大 |
| 速度 | 快（寄生少） | 略慢（折疊節點電容） |

> **答案 (e)：Folded cascode 優勢為大擺幅和寬共模範圍，代價為較高功耗和略慢速度。在低壓設計中，folded cascode 是最常用的架構。**

**延伸思考**：在實際 OTA 設計中，folded cascode 常作為兩級 OTA 的第一級（增益級），後接 Class-AB 輸出級。增益不足時可串接第二級增益級，配合 Miller 補償保證穩定性。

---

## Part 4：差動放大器與頻率響應（Differential Amplifiers & Frequency Response）

---

### 題目 36：差動放大器 CMRR 分析
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：共模拒斥比（CMRR）

**題目**：

一 NMOS 差動對，尾電流源阻抗 R_SS = 500 kΩ（有限），每管 g_m = 2 mS，r_o = 100 kΩ，使用電阻負載 R_D = 10 kΩ。

(a) 求差模增益 A_d。
(b) 求共模增益 A_c。
(c) 求 CMRR（以 dB 表示）。
(d) 若將電阻負載改為 PMOS 電流鏡負載（單端輸出），CMRR 如何變化？

**詳解**：

**解題思路**：差模時尾節點為虛地（virtual ground），共模時尾節點電壓隨共模輸入變化。R_SS 越大，共模抑制越好。

**步驟**：

(a) 差模增益（差動輸出）：

差模半電路：每管看到的等效電路為 CS 放大器（源極接虛地）：
```
A_d = g_m × R_D = 2m × 10k = 20
```

若為單端輸出：A_d = g_m × R_D = 20（PMOS 電流鏡負載時）
或 A_d = (g_m × R_D)/2 = 10（電阻負載、單端輸出、差動輸入時）

此處假設差動輸出：

> **答案 (a)：A_d = g_m R_D = 20（差動輸出）**

(b) 共模增益：

共模半電路：每管的源極接 2R_SS（因兩管並聯看 R_SS，等效每管看 2R_SS）：

```
A_c = -R_D / (1/g_m + 2R_SS)
    ≈ -R_D / (2R_SS)（因 2R_SS >> 1/g_m）
    = -10k / (2 × 500k)
    = -0.01
```

> **答案 (b)：A_c ≈ -0.01**

(c) CMRR：

```
CMRR = |A_d / A_c| = 20 / 0.01 = 2000

CMRR(dB) = 20 × log(2000) = 66 dB
```

也可用公式：CMRR = g_m × 2R_SS = 2m × 2 × 500k = 2000 ✓

> **答案 (c)：CMRR = 2000 = 66 dB**

(d) PMOS 電流鏡負載：

PMOS 電流鏡會「追蹤」共模電流變化：M3 的電流變化被鏡射到 M4，與 M2 的電流變化在輸出端相消。

理想匹配的 PMOS 電流鏡下：
```
A_c(理想) = 0（完美共模抑制）
CMRR → ∞
```

實際上受限於：
- PMOS 電流鏡的匹配度
- 各管 r_o 的差異
- 尾電流源阻抗

實際 CMRR（含失配效應）：
```
CMRR ≈ g_m × R_SS × g_m × r_o / ΔS
```
其中 ΔS 為元件失配參數。典型可達 80-100 dB。

> **答案 (d)：PMOS 電流鏡負載大幅改善 CMRR，從 66 dB 可提升至 80-100 dB（受限於元件匹配）。**

**延伸思考**：在精密運算放大器中，CMRR 需達 100 dB 以上。除了使用電流鏡負載和高阻抗尾電流源外，還可使用共模回授（CMFB）電路動態調節偏壓以進一步抑制共模。

---

### 題目 37：差動對的輸入偏移電壓
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：偏移電壓（Input Offset Voltage）

**題目**：

一 NMOS 差動對，標稱參數：(W/L) = 20/2，V_th = 0.5V，V_OV = 0.2V，I_SS = 200 μA。由於製程變異，兩管存在以下失配：

- V_th 失配：ΔV_th = 3 mV
- (W/L) 失配：Δ(W/L)/(W/L) = 1%
- R_D 失配：ΔR_D/R_D = 0.5%

(a) 求 V_th 失配造成的輸入偏移電壓。
(b) 求 W/L 失配造成的輸入偏移電壓。
(c) 求 R_D 失配造成的輸入偏移電壓。
(d) 求總輸入偏移電壓（RSS 合成）。

**詳解**：

**解題思路**：將各種失配等效為輸入端的直流偏移電壓。

**步驟**：

(a) V_th 失配造成的偏移：

```
V_OS(V_th) = ΔV_th = 3 mV
```

直接反映到輸入端。

> **答案 (a)：V_OS(V_th) = 3 mV**

(b) W/L 失配造成的偏移：

```
I_D = (k/2) × V_OV² → ΔI_D/I_D = Δk/k = Δ(W/L)/(W/L)
```

等效到輸入偏移：
```
V_OS(W/L) = (V_OV/2) × Δ(W/L)/(W/L)
          = (0.2/2) × 0.01 = 1 mV
```

> **答案 (b)：V_OS(W/L) = 1 mV**

(c) R_D 失配造成的偏移：

輸出偏移電壓 = A_d × V_OS(R_D)：
```
ΔV_out = I_D × ΔR_D = g_m × V_OV/2 × ΔR_D

V_OS(R_D) = (V_OV/2) × ΔR_D/R_D = (0.2/2) × 0.005 = 0.5 mV
```

> **答案 (c)：V_OS(R_D) = 0.5 mV**

(d) 總偏移（假設各項獨立，用 RSS 合成）：

```
V_OS(total) = √(V_OS(V_th)² + V_OS(W/L)² + V_OS(R_D)²)
            = √(3² + 1² + 0.5²)
            = √(9 + 1 + 0.25)
            = √10.25
            = 3.2 mV
```

> **答案 (d)：V_OS(total) ≈ 3.2 mV（V_th 失配為主要來源）**

**延伸思考**：V_th 失配通常是最大的偏移來源。Pelgrom 模型：σ(ΔV_th) = A_VT/√(WL)。在先進製程中，A_VT 約 3-5 mV·μm，要使 σ(ΔV_th) < 1 mV，需 WL > 9-25 μm²。

---

### 題目 38：米勒效應與高頻增益衰減
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：米勒效應（Miller Effect）

**題目**：

一 CS 放大器，g_m = 5 mS，r_o = 40 kΩ，R_D = 5 kΩ（∴ R_L' = R_D||r_o = 4.44 kΩ），C_gs = 100 fF，C_gd = 20 fF，R_S = 1 kΩ（信號源內阻）。

(a) 求中頻增益 A_v。
(b) 用米勒定理計算等效輸入電容 C_in。
(c) 求 -3dB 頻率 f_H。
(d) 求增益-頻寬積（GBW = |A_v| × f_H）。
(e) 若使用 CG（cascode）來消除 Miller 效應，新的 f_H 為多少？

**詳解**：

**解題思路**：Miller 效應使 C_gd 被放大 (1+|A_v|) 倍，成為主導高頻極點的主因。

**步驟**：

(a) 中頻增益：
```
A_v = -g_m × R_L' = -5m × 4.44k = -22.2
```

> **答案 (a)：A_v = -22.2**

(b) Miller 等效輸入電容：

```
C_in = C_gs + C_gd × (1 + |A_v|)
     = 100 + 20 × (1 + 22.2)
     = 100 + 20 × 23.2
     = 100 + 464
     = 564 fF
```

注意 C_gd 的 Miller 放大效應使 20 fF 變成 464 fF，遠超 C_gs！

輸出端 Miller 電容：
```
C_out(Miller) = C_gd × (1 + 1/|A_v|) ≈ C_gd = 20 fF（影響較小）
```

> **答案 (b)：C_in ≈ 564 fF（其中 Miller 電容貢獻 464 fF，佔 82%）**

(c) -3dB 頻率（假設輸入極點主導）：

```
f_H = 1 / (2π × R_S × C_in)
    = 1 / (2π × 1k × 564 × 10^-15)
    = 1 / (3.544 × 10^-9)
    = 282 MHz
```

> **答案 (c)：f_H ≈ 282 MHz**

(d) 增益-頻寬積：
```
GBW = |A_v| × f_H = 22.2 × 282 MHz = 6.26 GHz
```

> **答案 (d)：GBW ≈ 6.26 GHz**

(e) 使用 cascode 消除 Miller 效應：

CG 管將 CS 管的增益「遮蔽」，使 C_gd1 看到的增益僅為 ≈ -1（而非 -22.2）。

新的等效輸入電容：
```
C_in(cascode) = C_gs + C_gd × (1 + 1) = 100 + 20 × 2 = 140 fF
```

新 f_H：
```
f_H(cascode) = 1 / (2π × 1k × 140f) = 1.137 GHz
```

頻寬改善倍數：1137/282 = 4.03 倍

但 cascode 的增益更高（假設 cascode 增益 ≈ g_m × g_m r_o²/2 ≈ 更高，但此處只看頻寬）：

> **答案 (e)：f_H(cascode) ≈ 1.14 GHz，頻寬改善約 4 倍。**

**延伸思考**：Miller 效應是限制 CS 放大器頻寬的主要因素。消除 Miller 效應的三種方法：(1) Cascode；(2) 中和電容（neutralization）；(3) Cascode-like layout 技巧。在 RF 設計中，這些技術是提升 f_T 利用率的關鍵。

---

### 題目 39：MOSFET 高頻模型與 f_T
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：截止頻率 f_T（Unity-Gain Frequency）

**題目**：

一 NMOS，g_m = 10 mS，C_gs = 200 fF，C_gd = 40 fF，C_db = 30 fF，C_sb = 20 fF。

(a) 求本徵截止頻率（intrinsic unity-gain frequency）f_T。
(b) 求考慮所有電容後的 f_T。
(c) 若要提高 f_T，在設計上可調整哪些參數？各有何代價？
(d) 若此 MOSFET 的 L = 0.18 μm，估算其 f_T 是否合理。

**詳解**：

**解題思路**：f_T 是 MOSFET 高頻性能的指標，定義為短路電流增益降至 1 的頻率。

**步驟**：

(a) 本徵 f_T（僅考慮閘極電容）：

```
f_T = g_m / (2π × (C_gs + C_gd))
    = 10m / (2π × (200f + 40f))
    = 10m / (2π × 240f)
    = 10 × 10^-3 / (1.508 × 10^-9)
    = 6.63 GHz
```

> **答案 (a)：f_T(intrinsic) ≈ 6.63 GHz**

(b) 考慮所有電容（嚴格來說 f_T 只看閘極到通道的電容）：

標準定義（輸入短路電流增益）：
```
f_T = g_m / (2π(C_gs + C_gd))
```

實際上 C_db 和 C_sb 不直接出現在 f_T 定義中，但會影響在電路中的實際頻寬。

> **答案 (b)：f_T ≈ 6.63 GHz（C_db, C_sb 不影響 f_T 定義，但影響電路頻寬）**

(c) 提高 f_T 的方法：

1. **增大 g_m**：增大 V_OV 或 I_D
   - g_m = 2I_D/V_OV → 增大 I_D 或 V_OV
   - 代價：功耗增加，V_OV 增大降低本徵增益

2. **減小 C_gs + C_gd**：
   - C_gs ≈ (2/3)W L C_ox → 減小 L
   - 代價：短通道效應、r_o 降低

3. **縮短通道長度 L**：
   - f_T ∝ V_OV / L²（因 g_m ∝ WV_OV/L，C_gs ∝ WL）
   - 代價：r_o 降低，匹配惡化

4. **增大 V_OV**：
   - f_T = μ_n V_OV / (2πL² × 2/3)（不含 C_gd 項近似）
   - 代價：增益降低

> **答案 (c)：最有效方法為減小 L 和增大 V_OV。f_T ∝ V_OV/L²。代價分別為 r_o 降低和增益降低。**

(d) 合理性驗證：

```
f_T ≈ μ_n V_OV / (2π × (2/3) × L²)
```

假設 V_OV = 0.2V，μ_n ≈ 400 cm²/V·s（0.18μm 製程）：
```
f_T = 400 × 10^-4 × 0.2 / (2π × 0.667 × (0.18 × 10^-4)²)
    = 400 × 10^-4 × 0.2 / (4.19 × (3.24 × 10^-10))
    = 8 × 10^-3 / (1.358 × 10^-9)
    = 5.9 GHz
```

與 (a) 的 6.63 GHz 量級一致，合理。0.18μm 製程典型 f_T 約 40-60 GHz（在最佳偏壓），6.63 GHz 偏低（因 g_m/C 比可能更高），但量級正確。

> **答案 (d)：0.18μm NMOS 的典型 f_T 在最佳偏壓下約 40-60 GHz，本題的 6.63 GHz 對應較低的 V_OV 或較大的 W（額外寄生電容），量級合理。**

**延伸思考**：在 RF IC 設計中，f_T 決定了放大器可工作的最高頻率。一般需要 f_T > 10 × f_operation。先進 FinFET 製程（5nm）的 f_T 可超過 300 GHz。

---

### 題目 40：共源極放大器的完整頻率響應
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：頻率響應分析（Frequency Response Analysis）

**題目**：

一 CS 放大器的完整高頻等效電路如下。g_m = 4 mS，R_S = 2 kΩ，R_D = 5 kΩ，r_o = 50 kΩ，C_gs = 80 fF，C_gd = 15 fF，C_L = 50 fF（負載電容）。

(a) 用開路時間常數法（open-circuit time constant method, OCTC）估算 -3dB 頻寬。
(b) 用 Miller 近似法估算 -3dB 頻寬，並與 (a) 比較。
(c) 精確求解兩個極點頻率。
(d) 求零點頻率，並解釋其物理意義。

**詳解**：

**解題思路**：OCTC 法提供頻寬下界估算，Miller 法是近似但直覺好，精確解需求轉移函數。

**步驟**：

R_L' = R_D || r_o = 5k || 50k = 4.545 kΩ

中頻增益：A_v = -g_m × R_L' = -4 × 4.545 = -18.18

(a) OCTC 法：

各電容看到的等效電阻：

**C_gs**：短路 C_gd 和 C_L，從 C_gs 兩端看入的電阻：
```
R_gs = R_S = 2 kΩ（閘極端為 R_S，源極端接地）
```

**C_gd**：短路 C_gs 和 C_L，從 C_gd 兩端看入的電阻（Miller）：
```
R_gd = R_S(1 + g_m R_L') + R_L'
     = 2k × (1 + 18.18) + 4.545k
     = 2k × 19.18 + 4.545k
     = 38.36k + 4.545k
     = 42.91 kΩ
```

**C_L**：短路 C_gs 和 C_gd，從 C_L 兩端看入的電阻：
```
R_CL = R_L' = 4.545 kΩ
```

總時間常數：
```
Στ = R_gs × C_gs + R_gd × C_gd + R_CL × C_L
   = 2k × 80f + 42.91k × 15f + 4.545k × 50f
   = 160 ps + 643.7 ps + 227.3 ps
   = 1031 ps
```

注意 C_gd 的貢獻（643.7 ps）最大！

```
f_H ≈ 1 / (2π × Στ) = 1 / (2π × 1.031n) = 154.4 MHz
```

> **答案 (a)：f_H(OCTC) ≈ 154 MHz（C_gd 貢獻 62% 的時間常數）**

(b) Miller 近似：

```
C_in = C_gs + C_gd(1 + |A_v|) = 80 + 15 × 19.18 = 80 + 287.7 = 367.7 fF
C_out = C_L + C_gd(1 + 1/|A_v|) = 50 + 15 × 1.055 = 65.8 fF

f_p1(input) = 1/(2π × R_S × C_in) = 1/(2π × 2k × 367.7f) = 216.5 MHz
f_p2(output) = 1/(2π × R_L' × C_out) = 1/(2π × 4.545k × 65.8f) = 532 MHz
```

主極點法：f_H ≈ f_p1 = 216.5 MHz（因 f_p1 < f_p2）

但若用根均方法：
```
1/f_H² ≈ 1/f_p1² + 1/f_p2² → f_H ≈ 1/√(1/216.5² + 1/532²) ≈ 199 MHz
```

> **答案 (b)：f_H(Miller) ≈ 199 ~ 217 MHz（比 OCTC 稍高，因 OCTC 給出的是下界）**

(c) 精確極點（利用轉移函數分母）：

轉移函數分母為二次式：s² + s×b₁ + b₀

```
b₁ = 1/Στ 的倒數...
```

用更系統的方法。轉移函數：

```
A(s) = A_v(mid) × (1 - s C_gd/g_m) / (1 + s×a₁ + s²×a₂)
```

其中：
```
a₁ = C_gs R_S + C_gd[R_S(1+g_m R_L') + R_L'] + C_L R_L'
   = Στ = 1.031 ns（同 OCTC）

a₂ = R_S R_L'(C_gs C_gd + C_gs C_L + C_gd C_L)
   = 2k × 4.545k × (80×15 + 80×50 + 15×50) × 10^-30
   = 9.09 × 10^6 × (1200 + 4000 + 750) × 10^-30
   = 9.09 × 10^6 × 5950 × 10^-30
   = 5.41 × 10^-20 s²
```

兩極點：
```
ω_p1 ≈ 1/a₁ = 1/1.031n = 9.7 × 10^8 rad/s → f_p1 = 154.4 MHz
ω_p2 ≈ a₁/a₂ = 1.031n / 5.41 × 10^-20 = 1.905 × 10^10 rad/s → f_p2 = 3.03 GHz
```

> **答案 (c)：f_p1 ≈ 154 MHz，f_p2 ≈ 3.03 GHz（遠離主極點，主極點近似有效）**

(d) 零點頻率：

```
f_z = g_m / (2π C_gd) = 4m / (2π × 15f) = 42.4 GHz
```

物理意義：在此頻率，通過 C_gd 的前饋電流恰好等於 g_m 產生的電流，但相位相反。在 s = +g_m/C_gd 處（右半平面零點），信號通過 C_gd 直接「繞過」放大器，增益降為零。

這是一個**右半平面零點（RHP zero）**，它會增加相位延遲（而非減少），對穩定性不利。

> **答案 (d)：f_z = g_m/(2πC_gd) ≈ 42.4 GHz（RHP zero），在極高頻處信號直接通過 C_gd 前饋，破壞增益。**

**延伸思考**：RHP 零點在 Miller 補償的兩級放大器中特別重要，它限制了可達到的單位增益頻率。消除 RHP 零點的方法包括：(1) 在 Miller 電容上串聯零化電阻（nulling resistor）、(2) 使用 cascode Miller 補償、(3) 使用電流緩衝器。

---

### 題目 41：多極點系統的頻寬估算
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：頻寬收縮（Bandwidth Shrinkage）

**題目**：

一三級放大器串接，每級增益 A_i = -10（i = 1,2,3），每級 -3dB 頻率相同 f_Hi = 100 MHz。

(a) 求總增益。
(b) 求總 -3dB 頻寬（考慮頻寬收縮）。
(c) 求 GBW 是否守恒？
(d) 若改為兩級，每級增益 -31.6（使總增益相同），每級 f_H = 100 MHz，總頻寬為何？

**詳解**：

**解題思路**：多級串接時，頻寬因各級極點疊加而收縮。

**步驟**：

(a) 總增益：
```
A_total = A_1 × A_2 × A_3 = (-10)³ = -1000（60 dB）
```

> **答案 (a)：|A_total| = 1000（60 dB）**

(b) 頻寬收縮：

三級相同極點的總響應：
```
|A(f)|² = |A_total|² / (1 + (f/f_H)²)³
```

總 -3dB 頻率滿足：
```
(1 + (f_H3/f_H)²)³ = 2
1 + (f_H3/f_H)² = 2^(1/3) = 1.26
(f_H3/f_H)² = 0.26
f_H3/f_H = √0.26 = 0.51
```

```
f_H(total) = 0.51 × 100 MHz = 51 MHz
```

一般公式：n 級相同極點，f_H(total) = f_H × √(2^(1/n) - 1)

> **答案 (b)：f_H(total) ≈ 51 MHz（頻寬收縮至單級的 51%）**

(c) GBW 守恒：

```
GBW(每級) = 10 × 100 MHz = 1 GHz
GBW(總) = 1000 × 51 MHz = 51 GHz
```

GBW 不守恒！串接 n 級，GBW 隨 n 增加而增大（以頻寬為代價）。

但「增益頻寬積守恒」僅對單級回授放大器成立（閉環情況下 A_f × BW = A × f_H）。

> **答案 (c)：GBW 不守恒於開環串接。總 GBW 增大（51 GHz vs 1 GHz/級），代價是頻寬下降。**

(d) 兩級串接：

```
n = 2，f_H(total) = f_H × √(2^(1/2) - 1) = 100 × √(1.414 - 1) = 100 × √0.414 = 64.3 MHz
```

> **答案 (d)：兩級頻寬 ≈ 64.3 MHz（比三級的 51 MHz 寬，但總增益相同 = 1000）**

結論：用較少級數、每級較高增益，可獲得較大頻寬。但單級增益受限於 g_m r_o（本徵增益）。

**延伸思考**：在寬頻放大器設計中，常用「分散式放大器」（distributed amplifier）或「Cherry-Hooper 架構」來避免頻寬收縮。在數位電路中，邏輯門的 fan-out 也會造成類似的延遲累積效應。

---

### 題目 42：BJT 差動對的尾電流源對 CMRR 的影響
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：尾電流源設計（Tail Current Source）

**題目**：

一 BJT 差動對，I_EE = 2 mA，β = 200，V_A = 100V，R_C = 5 kΩ（雙端輸出）。尾電流源以單一 BJT 電流鏡實現。

(a) 求差模增益 A_d。
(b) 求尾電流源的輸出阻抗 R_EE。
(c) 求共模增益 A_c 和 CMRR。
(d) 若尾電流源改為 Wilson 電流鏡，CMRR 改善多少？

**詳解**：

**解題思路**：差動對的 CMRR 直接由尾電流源阻抗 R_EE 決定。

**步驟**：

每管偏壓：I_C = I_EE/2 = 1 mA

小信號參數：
```
g_m = I_C/V_T = 1/0.026 = 38.46 mS
r_π = β/g_m = 200/38.46 = 5.2 kΩ
r_o = V_A/I_C = 100/1 = 100 kΩ
```

(a) 差模增益（雙端輸出）：
```
A_d = g_m × R_C = 38.46 × 5 = 192.3
```

（雙端輸出，差模半電路中每管 CS 增益）

> **答案 (a)：A_d = 192（即 g_m R_C）**

(b) 尾電流源輸出阻抗：

單一 BJT 電流鏡的 R_EE = r_o(tail) = V_A/I_EE = 100/2 = 50 kΩ

> **答案 (b)：R_EE = 50 kΩ**

(c) 共模增益和 CMRR：

```
A_c = -R_C / (2R_EE + 1/g_m)（每半電路的 CE with degeneration 2R_EE）
    ≈ -R_C / (2R_EE)（因 2R_EE >> 1/g_m）
    = -5k / (2 × 50k) = -0.05

CMRR = |A_d/A_c| = 192/0.05 = 3840 = 71.7 dB
```

或用公式：CMRR = g_m × 2R_EE = 38.46 × 100k = 3846 ✓

> **答案 (c)：A_c = -0.05，CMRR ≈ 3840（71.7 dB）**

(d) Wilson 電流鏡尾電流源：

Wilson 鏡輸出阻抗 ≈ r_o × β/2 = 50k × 100 = 5 MΩ

```
CMRR(Wilson) = g_m × 2R_EE(Wilson) = 38.46m × 2 × 5M = 384,600 = 111.7 dB
```

改善：111.7 - 71.7 = 40 dB（100 倍）

> **答案 (d)：Wilson 尾電流源使 CMRR 改善約 40 dB，從 72 dB 提升到 112 dB。**

**延伸思考**：在高性能運算放大器中，CMRR > 100 dB 是基本要求。除了高阻抗尾電流源，還需注意電源供應拒斥比（PSRR）和元件匹配度。在 CMOS 設計中，cascode 尾電流源是標準做法。

---

### 題目 43：放大器的完整波德圖分析
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：波德圖（Bode Plot Analysis）

**題目**：

一放大器的轉移函數為：

```
A(s) = -1000 × (1 + s/(2π × 10^7)) / ((1 + s/(2π × 10^5))(1 + s/(2π × 10^8)))
```

(a) 求中頻增益（dB）。
(b) 求所有極點和零點頻率。
(c) 畫出增益和相位的波德圖（標示關鍵頻率和斜率）。
(d) 求 -3dB 頻寬和單位增益頻率（unity-gain frequency）。

**詳解**：

**解題思路**：辨識轉移函數中的極點和零點，逐段畫出波德圖。

**步驟**：

(a) 中頻增益（s → 0 但高於低頻截止）：

在 f_p1 < f < f_z 範圍：
```
|A(mid)| = 1000 = 60 dB
```

> **答案 (a)：|A_0| = 1000 = 60 dB**

(b) 極點和零點：

```
極點 1：f_p1 = 10^5 Hz = 100 kHz
極點 2：f_p2 = 10^8 Hz = 100 MHz
零點 1：f_z1 = 10^7 Hz = 10 MHz
```

> **答案 (b)：f_p1 = 100 kHz，f_z1 = 10 MHz，f_p2 = 100 MHz**

(c) 波德圖：

**增益（magnitude）**：
```
f < 100 kHz：       |A| = 60 dB（平坦）
100 kHz ~ 10 MHz：  -20 dB/dec（一個極點）
                     在 10 MHz：|A| = 60 - 20×log(10M/100k) = 60 - 40 = 20 dB
10 MHz ~ 100 MHz：   0 dB/dec（零點抵消極點，斜率 -20+20 = 0）
                     在 100 MHz：|A| = 20 dB
f > 100 MHz：       -20 dB/dec（第二個極點）
```

**相位**：
```
f << 100 kHz：      φ = 180°（反相）
100 kHz 附近：      φ 從 180° 開始下降（極點帶來 -90°）
10 MHz 附近：       零點帶來 +90°
100 MHz 附近：      第二極點帶來 -90°
f >> 100 MHz：      φ → 180° - 90° + 90° - 90° = 90°
```

精確相位計算在幾個關鍵頻率：

f = 100 kHz：φ = 180° - 45° + 0.57° - 0.06° ≈ 135.5°
f = 10 MHz：φ = 180° - 89.4° + 45° - 5.7° ≈ 129.9°
f = 100 MHz：φ = 180° - 89.9° + 84.3° - 45° ≈ 129.4°

> **答案 (c)：增益波德圖呈「平坦 → -20dB/dec → 平坦 → -20dB/dec」形狀。**

(d) -3dB 頻寬和單位增益頻率：

-3dB 頻寬（從中頻增益下降 3dB）：
```
f_H ≈ f_p1 = 100 kHz（主極點，因為與零點和第二極點距離遠）
```

單位增益頻率（|A(f_u)| = 1 = 0 dB）：

在 f > 100 MHz 區域，|A| 以 -20 dB/dec 下降。
在 100 MHz 處 |A| = 20 dB。

```
20 dB - 20 × log(f_u/100M) = 0
log(f_u/100M) = 1
f_u = 1 GHz
```

> **答案 (d)：f_H ≈ 100 kHz，f_u ≈ 1 GHz**

**延伸思考**：零點在兩個極點之間的情況（pole-zero doublet）在 OPA 的 Miller 補償中很常見。若零點離極點很近，會造成慢速暫態（slow settling），在高速 ADC 應用中必須避免。

---

### 題目 44：差動放大器的頻率響應
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：差動放大器頻率響應

**題目**：

一 MOSFET 差動對（PMOS 電流鏡負載，單端輸出），每管 g_m = 2 mS，r_o = 50 kΩ。寄生電容：C_gs = 60 fF，C_gd = 10 fF，電流鏡節點電容 C_M = 100 fF，輸出節點電容 C_L = 200 fF。

(a) 求中頻增益。
(b) 辨識主要的頻率極點。
(c) 估算 -3dB 頻寬。
(d) 此放大器作為 OPA 第一級時，其頻率特性對整體穩定性有何影響？

**詳解**：

**解題思路**：差動對的頻率響應需考慮鏡像極點（mirror pole）——PMOS 電流鏡節點的寄生電容。

**步驟**：

(a) 中頻增益：
```
R_out = r_on || r_op = 50k || 50k = 25 kΩ
A_v = g_m × R_out = 2m × 25k = 50（34 dB）
```

> **答案 (a)：A_v = 50（34 dB）**

(b) 極點辨識：

**極點 1（輸出極點）**：
```
f_p1 = 1/(2π × R_out × C_L) = 1/(2π × 25k × 200f)
     = 1/(2π × 5 × 10^-9) = 31.8 MHz
```

**極點 2（鏡像極點，mirror pole）**：
電流鏡節點（M3 的汲極 = M4 的閘極）的電容 C_M 和等效電阻：
```
R_mirror = 1/g_m3 = 1/2m = 500 Ω（二極體連接管的阻抗）

f_p2(mirror) = 1/(2π × R_mirror × C_M)
             = 1/(2π × 500 × 100f)
             = 1/(2π × 5 × 10^-11)
             = 3.18 GHz
```

等等 —— 需要更仔細分析。鏡像節點的等效電容包含 C_gs3 + C_gs4 + 走線寄生：

C_mirror = C_gs3 + C_gs4 + C_M ≈ 60 + 60 + 100 = 220 fF（較大估算）

```
f_p2(mirror) = g_m3 / (2π × C_mirror) = 2m / (2π × 220f) = 1.45 GHz
```

**極點 3（輸入極點）**：通常被 Miller 效應影響
```
C_in = C_gs1 + C_gd1(1 + g_m × R_out/2) ≈ 60 + 10 × 26 = 320 fF
f_p3 ≈ 需要知道 R_S
```

> **答案 (b)：主要極點：(1) 輸出極點 ≈ 31.8 MHz，(2) 鏡像極點 ≈ 1.45 GHz，(3) 輸入極點（取決於 R_S）**

(c) -3dB 頻寬：

由輸出極點主導：
```
f_H ≈ f_p1 = 31.8 MHz
```

> **答案 (c)：f_H ≈ 32 MHz（由輸出極點主導）**

(d) 對 OPA 穩定性的影響：

鏡像極點 f_p2 = 1.45 GHz 是一個**非主導極點（non-dominant pole）**。在兩級 OPA 設計中：

- 若 OPA 的單位增益頻率 f_u 接近或超過 f_p2，鏡像極點會造成額外的相位延遲，降低相位邊限
- 經驗法則：f_u 需小於 f_p2 的 1/3 以保證 60° 相位邊限
- 因此 f_u < 1.45G/3 ≈ 483 MHz

改善方法：
- 增大 g_m3（增大電流鏡的 W/L 或 I_D）以推高鏡像極點
- 減小鏡像節點的寄生電容（縮小 PMOS 尺寸，但會增加失配）

> **答案 (d)：鏡像極點是差動對的隱藏頻率限制，它限制了 OPA 的可達單位增益頻率。需確保 f_u << f_mirror 以維持穩定性。**

**延伸思考**：在高速 OPA 設計中，鏡像極點常是頻寬瓶頸。解決方案包括：(1) 使用「前饋補償」繞過電流鏡、(2) 加大電流鏡偏壓電流、(3) 使用 folded cascode 避免鏡像節點。

---

### 題目 45：低頻截止與耦合電容設計
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：低頻響應（Low-Frequency Response）

**題目**：

一 CS 放大器有三個耦合/旁路電容：輸入耦合 C_C1，輸出耦合 C_C2，源極旁路 C_S。電路參數：R_S = 10 kΩ，R_G = 1 MΩ，g_m = 2 mS，R_D = 5 kΩ，R_L = 10 kΩ，R_S(source) = 500 Ω。

(a) 求各電容對應的低頻極點公式。
(b) 若要低頻 -3dB 點 f_L ≤ 100 Hz，設計 C_C1、C_C2、C_S 的最小值。
(c) 哪個電容通常決定 f_L？

**詳解**：

**解題思路**：每個耦合/旁路電容貢獻一個低頻極點。分析各極點的等效電阻。

**步驟**：

(a) 各低頻極點：

**C_C1 極點**（輸入耦合電容）：
```
f_L1 = 1 / (2π × C_C1 × (R_S + R_G))
     = 1 / (2π × C_C1 × 1.01 MΩ)
```

**C_C2 極點**（輸出耦合電容）：
```
f_L2 = 1 / (2π × C_C2 × (R_D + R_L))
     = 1 / (2π × C_C2 × 15 kΩ)
```

**C_S 極點**（源極旁路電容）：
```
等效電阻 = R_S(source) || (1/g_m) = 500 || 500 = 250 Ω

但更精確：C_S 看到的電阻是在源極短路 C_S 後，從 C_S 兩端看入的：
R_eq(C_S) = R_S(source) || (1/g_m + (R_S || R_G)/(β+1))

對 MOSFET（β → ∞）：
R_eq(C_S) = R_S(source) || (1/g_m) = 500 || 500 = 250 Ω

f_L3 = 1 / (2π × C_S × 250)
```

> **答案 (a)：f_L1 = 1/(2πC_C1 × 1.01M)，f_L2 = 1/(2πC_C2 × 15k)，f_L3 = 1/(2πC_S × 250)**

(b) 設計各電容：

策略：令每個極點遠低於 f_L = 100 Hz，例如令每個極點在 10 Hz（保守設計）。

C_C1（看到最大電阻，極點最容易達標）：
```
C_C1 = 1/(2π × 10 × 1.01M) = 15.8 nF → 取 22 nF
```

C_C2：
```
C_C2 = 1/(2π × 10 × 15k) = 1.06 μF → 取 1 μF
```

C_S（看到最小電阻，需最大電容！）：
```
C_S = 1/(2π × 10 × 250) = 63.7 μF → 取 100 μF
```

> **答案 (b)：C_C1 ≥ 22 nF，C_C2 ≥ 1 μF，C_S ≥ 100 μF**

(c) C_S 通常需要最大的電容值，因為它看到的等效電阻最小（≈ 1/g_m || R_S(source)）。若 C_S 不夠大，其極點頻率最高，成為決定 f_L 的瓶頸。

> **答案 (c)：C_S（源極旁路電容）通常決定 f_L，因為它看到的等效電阻最小。**

**延伸思考**：在 IC 設計中不使用耦合電容（直接耦合），因此沒有低頻極點，可放大到 DC。這是 IC 放大器的重要優勢。在分離元件電路中，C_S 的值常為數十至數百 μF。

---

## Part 5：回授與穩定性（Feedback & Stability）

---

### 題目 46：四種回授架構辨識
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：回授架構分類（Feedback Topologies）

**題目**：

辨識下列四個電路的回授類型（取樣方式 × 混合方式），並說明對輸入/輸出阻抗的影響。

```
電路 (a)：反相放大器         電路 (b)：同相放大器
     ┌── R_2 ──┐               R_1
     │         │                │
v_i ─R_1─┤(-)   ├── v_o    v_i ──┤(+)   ├── v_o
         │ OPA  │                 │ OPA  │
    GND──┤(+)   │           GND──R_2──┤(-)   │
         └──────┘                      │     │
                                       └─────┘

電路 (c)：CE with R_E         電路 (d)：shunt-shunt 回授
     VCC                           VCC
      |                             |
     R_C                           R_C
      |                             |
      C ── v_o                      C ── v_o
      |                             |    |
      B                             B    R_F
      |                             |    |
  v_i──                         v_i──────┘
      E
      |
     R_E ← 回授元件
      |
     GND
```

**詳解**：

**解題思路**：先判斷取樣方式（output sampling：電壓或電流），再判斷混合方式（input mixing：串聯或並聯）。

**步驟**：

| 電路 | 取樣方式 | 混合方式 | 回授類型 | R_in 效應 | R_out 效應 |
|------|---------|---------|---------|----------|-----------|
| (a) 反相放大器 | 電壓取樣（shunt at output） | 並聯混合（shunt at input） | **Shunt-Shunt**（電壓-電流回授） | 降低 | 降低 |
| (b) 同相放大器 | 電壓取樣（shunt at output） | 串聯混合（series at input） | **Series-Shunt**（電壓-電壓回授） | 增加 | 降低 |
| (c) CE with R_E | 電流取樣（series at output） | 串聯混合（series at input） | **Series-Series**（電流-電流回授） | 增加 | 增加 |
| (d) Shunt-shunt | 電壓取樣 | 並聯混合 | **Shunt-Shunt**（同 (a)） | 降低 | 降低 |

四種回授架構的完整分類：

```
                    取樣方式
              電壓（Shunt out）  電流（Series out）
混合    串聯   Series-Shunt     Series-Series
方式    (Series in)  （同相 amp）     （CE+R_E）
        並聯   Shunt-Shunt      Shunt-Series
        (Shunt in)   （反相 amp）     （較少見）
```

阻抗效應口訣：
- **Series（串聯）→ 阻抗增加**（乘以 (1+Aβ)）
- **Shunt（並聯）→ 阻抗降低**（除以 (1+Aβ)）

> **答案：(a) Shunt-Shunt，(b) Series-Shunt，(c) Series-Series，(d) Shunt-Shunt。串聯端阻抗增加，並聯端阻抗降低。**

**延伸思考**：辨識回授類型的簡便方法：(1) 把輸出設為零看回授是否消失 → 電壓取樣；把輸出開路看回授是否消失 → 電流取樣。(2) 信號源與回授信號在同一節點相加 → 並聯；在不同的端子形成迴路 → 串聯。

---

### 題目 47：閉迴路增益與回授效應
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：回授分析（Feedback Analysis）

**題目**：

一運算放大器開迴路增益 A = 10^5（100 dB），輸入阻抗 R_i = 1 MΩ，輸出阻抗 R_o = 100 Ω，主極點 f_p = 10 Hz（單極點模型）。使用電阻回授組成同相放大器，R_1 = 9 kΩ，R_2 = 1 kΩ。

(a) 求回授因子 β 和迴路增益 T = Aβ。
(b) 求閉迴路增益 A_f。
(c) 求閉迴路輸入阻抗和輸出阻抗。
(d) 求閉迴路 -3dB 頻寬。
(e) 計算增益靈敏度（sensitivity）：若 A 變化 10%，A_f 變化多少？

**詳解**：

**解題思路**：同相放大器為 Series-Shunt 回授，利用閉迴路公式計算所有參數。

**步驟**：

(a) 回授因子：
```
β = R_2 / (R_1 + R_2) = 1k / (9k + 1k) = 0.1

迴路增益 T = Aβ = 10^5 × 0.1 = 10^4 = 10000
```

> **答案 (a)：β = 0.1，T = 10,000（80 dB）**

(b) 閉迴路增益：
```
A_f = A / (1 + Aβ) = 10^5 / (1 + 10^4) ≈ 10^5/10^4 = 10.001 ≈ 10

精確值：A_f = 100000/10001 = 9.999
理想值：1/β = 10
```

> **答案 (b)：A_f ≈ 10（20 dB），非常接近理想值 1/β = 10**

(c) 阻抗變化：

Series-Shunt 回授：
- 輸入端為 Series → R_in 增加
- 輸出端為 Shunt → R_out 降低

```
R_in(CL) = R_i × (1 + T) = 1M × 10001 ≈ 10 GΩ
R_out(CL) = R_o / (1 + T) = 100 / 10001 ≈ 0.01 Ω = 10 mΩ
```

> **答案 (c)：R_in ≈ 10 GΩ，R_out ≈ 10 mΩ**

(d) 閉迴路頻寬：

開迴路：單極點，f_p = 10 Hz，GBW = A × f_p = 10^5 × 10 = 10^6 Hz = 1 MHz

閉迴路 -3dB 頻寬（增益-頻寬積守恆）：
```
f_H(CL) = f_p × (1 + T) = 10 × 10001 ≈ 100 kHz
```

驗證：A_f × f_H(CL) = 10 × 100k = 1 MHz = GBW ✓

> **答案 (d)：f_H(CL) ≈ 100 kHz（頻寬擴展 10,000 倍，增益降低 10,000 倍）**

(e) 增益靈敏度：

```
dA_f/A_f = (1/(1+T)) × (dA/A)

若 dA/A = 10%：
dA_f/A_f = 10% / (1+10000) ≈ 0.001% = 10 ppm
```

> **答案 (e)：A 變化 10%，A_f 僅變化 0.001%。回授使增益靈敏度降低 (1+T) = 10,001 倍。**

**延伸思考**：回授的四大好處：(1) 增益去敏（desensitization）；(2) 頻寬擴展；(3) 非線性失真降低；(4) 阻抗改善。代價是增益降低和穩定性問題。所有好處的改善倍數都是 (1+T)。

---

### 題目 48：相位邊限與增益邊限
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：穩定性分析（Stability Analysis）

**題目**：

一運算放大器的開迴路轉移函數為：

```
A(s) = 10^4 / ((1 + s/ω_1)(1 + s/ω_2)(1 + s/ω_3))
```

其中 ω_1 = 2π × 10^3 rad/s，ω_2 = 2π × 10^6 rad/s，ω_3 = 2π × 10^7 rad/s。

回授因子 β = 0.01。

(a) 求迴路增益 T_0 = A_0 × β。
(b) 求增益交越頻率 f_c（|T(jω_c)| = 1）。
(c) 求相位邊限 PM。
(d) 求增益邊限 GM。
(e) 此系統是否穩定？如何改善？

**詳解**：

**解題思路**：在波德圖上找增益交越頻率（PM 定義點）和相位交越頻率（GM 定義點）。

**步驟**：

(a) 直流迴路增益：
```
T_0 = A_0 × β = 10^4 × 0.01 = 100 = 40 dB
```

> **答案 (a)：T_0 = 100（40 dB）**

(b) 增益交越頻率：

|T(jω)| 的波德圖：

```
f < 1 kHz：|T| = 40 dB（平坦）
1 kHz ~ 1 MHz：-20 dB/dec → 在 1 MHz：40 - 20×3 = 40 - 60 = -20 dB
```

等等，需要更仔細計算。

從 f_1 = 1 kHz 開始 -20 dB/dec：
```
在 f = 10 kHz：40 - 20 = 20 dB
在 f = 100 kHz：40 - 40 = 0 dB
```

所以增益交越 f_c ≈ 100 kHz。

但在 f_2 = 1 MHz 之前就已經交越了，所以在 f_c = 100 kHz 處只有一個極點在作用。

精確計算：在 100 kHz 附近，|T| 的斜率是 -20 dB/dec。

```
|T(f_c)| = T_0 / (f_c/f_1) = 100 / (f_c/1000)（在 f_1 和 f_2 之間，單極點衰減）
令 |T| = 1：f_c/1000 = 100 → f_c = 100 kHz
```

> **答案 (b)：f_c ≈ 100 kHz**

(c) 相位邊限：

在 f_c = 100 kHz 處的相位：
```
φ(f_c) = -arctan(f_c/f_1) - arctan(f_c/f_2) - arctan(f_c/f_3)
       = -arctan(100k/1k) - arctan(100k/1M) - arctan(100k/10M)
       = -arctan(100) - arctan(0.1) - arctan(0.01)
       = -89.4° - 5.7° - 0.57°
       = -95.7°
```

相位邊限：
```
PM = 180° + φ(f_c) = 180° - 95.7° = 84.3°
```

> **答案 (c)：PM ≈ 84°（非常穩定！）**

(d) 增益邊限：

相位交越頻率 f_180（φ = -180°）：

在三個極點系統中，-180° 發生在：
```
arctan(f/f_1) + arctan(f/f_2) + arctan(f/f_3) = 180°
```

近似（f_1 << f_2 < f_3）：當 f >> f_1 時，arctan(f/f_1) ≈ 90°。

所以需要：arctan(f/f_2) + arctan(f/f_3) = 90°

令 x = f/f_2，a = f_2/f_3 = 0.1：
```
arctan(x) + arctan(ax) = 90°
arctan(ax) = 90° - arctan(x) = arctan(1/x)
ax = 1/x → x² = 1/a = 10 → x = √10 = 3.162
```

f_180 = x × f_2 = 3.162 × 1 MHz = 3.162 MHz

此處 |T| 的值：
```
|T(f_180)| = T_0 / √(1+(f_180/f_1)²) / √(1+(f_180/f_2)²) / √(1+(f_180/f_3)²)
           = 100 / √(1+3162²) / √(1+3.162²) / √(1+0.3162²)
           = 100 / 3162 / 3.316 / 1.049
           = 100 / 11,000
           = 0.00909 = -40.8 dB
```

增益邊限：
```
GM = 1 / |T(f_180)| = 1/0.00909 = 110 = 40.8 dB
```

> **答案 (d)：GM ≈ 41 dB（在 f_180 ≈ 3.16 MHz）**

(e) 穩定性判斷：

PM = 84° >> 45°（最低安全值）
GM = 41 dB >> 10 dB（最低安全值）

**系統非常穩定**。這是因為 β = 0.01 很小（高閉迴路增益 = 100），增益交越遠在第二和第三極點之前。

若 β = 1（unity-gain buffer）：
```
f_c 升至 A_0 × f_1 = 10^4 × 1k = 10 MHz

φ(10MHz) = -90° - arctan(10) - arctan(1) = -90° - 84.3° - 45° = -219.3°
PM = 180° - 219.3° = -39.3°（不穩定！）
```

→ **需要補償**。

> **答案 (e)：β = 0.01 時穩定（PM = 84°）。但 β = 1（unity-gain）時不穩定（PM < 0°），需要頻率補償。**

**延伸思考**：這就是為什麼「未補償」的 OPA 不能用於 unity-gain。通用型 OPA（如 741）內部已做 Miller 補償（dominant pole compensation），使得在任何 β 下都穩定。但代價是 GBW 被限制在較低值。

---

### 題目 49：Miller 補償設計
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：Miller 補償（Miller Compensation）— IC 設計核心

**題目**：

一兩級 CMOS OTA，第一級增益 A_1 = -g_m1(r_o1||r_o2) = -200，第二級增益 A_2 = -g_m2(r_o3||r_o4) = -100。非主導極點 f_p2 = 50 MHz（第二級輸出極點）。第一級輸出電容 C_1 = 0.5 pF，第二級輸出電容 C_L = 5 pF。g_m1 = 1 mS，g_m2 = 5 mS。

(a) 無補償時，此放大器在 unity-gain 回授下是否穩定？
(b) 設計 Miller 補償電容 C_C 使相位邊限 ≥ 60°。
(c) 求補償後的主極點、非主極點和 GBW。
(d) 若加入零化電阻 R_Z 消除 RHP 零點，R_Z 應為多少？

**詳解**：

**解題思路**：Miller 補償利用 C_C 在兩級之間產生極點分裂（pole splitting），將主極點推低、非主極點推高。

**步驟**：

(a) 無補償的穩定性：

總增益：A_0 = A_1 × A_2 = 200 × 100 = 20,000（86 dB）

兩個極點位置（無補償）：
```
f_p1(原) = 1/(2π × R_out1 × C_1)（需知 R_out1）

R_out1 = |A_1|/g_m1 = 200/1m = 200 kΩ
f_p1 = 1/(2π × 200k × 0.5p) = 1.59 MHz

f_p2 = 50 MHz（已知）
```

GBW = A_0 × f_p1 = 20000 × 1.59M = 31.8 GHz

Unity-gain 下 f_c ≈ GBW = 31.8 GHz >> f_p2 = 50 MHz

→ **在 f_c 處已經通過第二極點，相位延遲 > 180°，不穩定。**

> **答案 (a)：不穩定。兩個極點相距不夠遠，在 unity-gain 時 f_c 遠超 f_p2。**

(b) Miller 補償電容設計：

補償後的極點位置：

主極點（被推低）：
```
f_p1' = 1 / (2π × R_out1 × C_C × |A_2|)（Miller 效應放大 C_C）
      = 1 / (2π × 200k × C_C × 100)
```

非主極點（被推高）：
```
f_p2' = g_m2 / (2π × C_L)（近似）
      = 5m / (2π × 5p) = 159 MHz
```

或更精確：f_p2' = g_m2 × C_C / (2π × C_1 × C_L)

GBW = g_m1 / (2π × C_C)

60° 相位邊限要求：f_p2' ≥ 2.2 × GBW（經驗法則）或更精確 f_p2' ≥ tan(30°) × ...

簡化條件：f_p2' > 2 × GBW（保守，約 63° PM）

```
g_m2/(2π C_L) > 2 × g_m1/(2π C_C)

C_C > 2 × g_m1 × C_L / g_m2 = 2 × 1m × 5p / 5m = 2 pF
```

取 C_C = 2.5 pF（留裕量）。

GBW = g_m1/(2π C_C) = 1m/(2π × 2.5p) = 63.7 MHz

驗證：f_p2' = g_m2/(2π C_L) = 5m/(2π × 5p) = 159 MHz

f_p2'/GBW = 159/63.7 = 2.5 > 2 → PM > 60° ✓

更精確的 PM 計算：
```
PM = 180° - arctan(GBW/f_p1') - arctan(GBW/f_p2') - arctan(GBW/f_z)
   ≈ 180° - 90° - arctan(63.7/159) - small
   = 90° - 21.8° ≈ 68° ✓
```

> **答案 (b)：C_C ≈ 2.5 pF，GBW = 63.7 MHz，PM ≈ 68°**

(c) 補償後的參數：

```
主極點：f_p1' = GBW/A_0 = 63.7M/20000 = 3.19 kHz
非主極點：f_p2' = 159 MHz
GBW = 63.7 MHz
```

RHP 零點：
```
f_z = g_m2/(2π C_C) = 5m/(2π × 2.5p) = 318 MHz
```

> **答案 (c)：f_p1' ≈ 3.2 kHz，f_p2' ≈ 159 MHz，GBW ≈ 64 MHz，f_z(RHP) ≈ 318 MHz**

(d) 零化電阻消除 RHP 零點：

RHP 零點在 s = +g_m2/C_C。加入 R_Z 串聯 C_C 後，零點移至：
```
f_z = 1 / (2π × C_C × (1/g_m2 - R_Z))
```

令零點移到無窮遠（消除）：
```
1/g_m2 - R_Z = 0
R_Z = 1/g_m2 = 1/5m = 200 Ω
```

或者把零點推到左半平面與 f_p2' 抵消：
```
R_Z = 1/g_m2 + C_L/(g_m2 × C_C) = 200 + 5p/(5m × 2.5p) = 200 + 400 = 600 Ω
```

> **答案 (d)：R_Z = 1/g_m2 = 200 Ω（消除 RHP 零點），或 R_Z = 600 Ω（將零點推到左半平面與 f_p2' 對消，增加 PM）。**

**延伸思考**：Miller 補償是兩級 OPA 設計的標準技術。在先進設計中，可用 cascode 管的 g_m 作為「電流緩衝」完全阻隔前饋路徑（cascode compensation），免去 R_Z。三級放大器需要「巢套式 Miller 補償」（nested Miller compensation）或「反相器 Miller 補償」等更複雜的技術。

---

### 題目 50：回授對非線性失真的改善
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：回授降低失真（Distortion Reduction by Feedback）

**題目**：

一放大器開迴路增益 A = 1000，二次諧波失真（THD2）= 5%。使用負回授，β = 0.099。

(a) 求閉迴路增益。
(b) 求閉迴路 THD2。
(c) 若要將 THD2 降至 0.01%，需要多大的開迴路增益？（維持 A_f = 10，β = 0.099）
(d) 討論回授對噪聲的影響（與失真有何不同？）。

**詳解**：

**解題思路**：負回授將失真降低 (1+Aβ) 倍，但對噪聲的影響取決於噪聲注入點。

**步驟**：

(a) 閉迴路增益：
```
1 + Aβ = 1 + 1000 × 0.099 = 1 + 99 = 100

A_f = A/(1+Aβ) = 1000/100 = 10
```

> **答案 (a)：A_f = 10**

(b) 閉迴路失真：

失真降低 (1+Aβ) 倍：
```
THD2(CL) = THD2(OL) / (1+Aβ) = 5% / 100 = 0.05%
```

> **答案 (b)：THD2(CL) = 0.05%（降低 100 倍 = 40 dB）**

(c) 要 THD2(CL) = 0.01%：

```
0.01% = 5% / (1+Aβ)
1+Aβ = 5/0.01 = 500
Aβ = 499

又 A_f = A/(1+Aβ) = 10
→ A = 10 × 500 = 5000

β = 499/5000 = 0.0998（≈ 0.1）
```

> **答案 (c)：A = 5000（開迴路增益需增至 5000），β ≈ 0.1**

(d) 回授對噪聲的影響：

**關鍵區別**：回授降低失真，但**不一定降低噪聲**！

- **開迴路增益級產生的失真**：被降低 (1+Aβ) 倍 ✓
- **放大器輸入端的噪聲**：與信號一起被放大，**不被降低**
- **輸出端注入的噪聲**（如負載噪聲）：被降低 (1+Aβ) 倍
- **回授網路的噪聲**：直接加到輸入端，**反而可能增大**

等效輸入噪聲（input-referred noise）不受回授影響。

回授改善失真的原因：失真產生在放大器**內部**（非線性產生的諧波），等效於在「放大器輸出端」注入干擾，因此被回授抑制。

> **答案 (d)：回授降低放大器內部產生的失真（(1+Aβ) 倍），但不降低等效輸入噪聲。噪聲性能主要由前級（input stage）決定。**

**延伸思考**：這就是為什麼低噪聲設計的關鍵在第一級（前置放大器），而不是回授多少。高增益的第一級可「壓低」後級噪聲的影響（Friis 公式的概念）。

---

### 題目 51：回授放大器的閉迴路阻抗推導
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：回授對阻抗的影響（Feedback Impedance Modification）

**題目**：

一電壓串聯回授（series-shunt feedback）放大器，開迴路電壓增益 A = 500，回授因子 β = 0.02，開迴路輸入阻抗 R_i = 10 kΩ，開迴路輸出阻抗 R_o = 1 kΩ。

(a) 求閉迴路增益、輸入阻抗、輸出阻抗。
(b) 證明：Series 端阻抗乘以 (1+T)，Shunt 端阻抗除以 (1+T)。
(c) 若要設計一個放大器，R_in > 10 MΩ 且 R_out < 1 Ω，最少需要多大的迴路增益？
(d) 若把回授改為 Shunt-Series 架構（互導放大器），阻抗效果反轉。求新的 R_in 和 R_out。

**詳解**：

**解題思路**：回授對阻抗的影響取決於「取樣方式」和「混合方式」在各端口的類型。

**步驟**：

(a) 計算：

```
T = Aβ = 500 × 0.02 = 10
1 + T = 11

A_f = A/(1+T) = 500/11 = 45.45

Series-Shunt：
- 輸入端為 Series → R_in 增加
- 輸出端為 Shunt → R_out 降低

R_in(CL) = R_i × (1+T) = 10k × 11 = 110 kΩ
R_out(CL) = R_o / (1+T) = 1k / 11 = 90.9 Ω
```

> **答案 (a)：A_f ≈ 45.5，R_in = 110 kΩ，R_out = 90.9 Ω**

(b) 物理解釋和推導：

**Series 端（輸入端）**：

回授信號 v_f = β × v_o 與輸入信號 v_s 串聯。放大器輸入端的電壓 v_i = v_s - v_f。

輸入電流 i_i = v_i / R_i = (v_s - β v_o) / R_i

但 v_o = A × v_i = A × i_i × R_i

因此：i_i = (v_s - β A i_i R_i) / R_i = v_s/R_i - βA × i_i

```
i_i(1 + βA) = v_s/R_i
v_s/i_i = R_i(1 + T)
```

**R_in(CL) = R_i × (1+T)** ✓（Series 端乘以 (1+T)）

**Shunt 端（輸出端）**：

在輸出端加測試電壓 v_x，令 v_s = 0：

v_i = -v_f = -β v_x

輸出端電流 i_x = (v_x - A v_i)/R_o = (v_x + Aβ v_x)/R_o = v_x(1+T)/R_o

```
R_out = v_x/i_x = R_o/(1+T)
```

**R_out(CL) = R_o/(1+T)** ✓（Shunt 端除以 (1+T)）

> **答案 (b)：推導如上。核心原理：Series 連接看到的有效電壓因回授減小，等效阻抗增大；Shunt 連接看到的電壓因回授改變，等效阻抗減小。**

(c) 最小迴路增益：

```
R_in(CL) > 10 MΩ：R_i × (1+T) > 10M → (1+T) > 10M/10k = 1000
R_out(CL) < 1 Ω：R_o / (1+T) < 1 → (1+T) > 1k/1 = 1000
```

兩個條件都要求：**(1+T) > 1000，即 T > 999 ≈ 1000（60 dB）**

> **答案 (c)：需要迴路增益 T ≥ 1000（60 dB）**

(d) Shunt-Series 架構：

- 輸入端為 Shunt → R_in 降低
- 輸出端為 Series → R_out 增加

```
R_in(CL) = R_i / (1+T) = 10k / 11 = 909 Ω
R_out(CL) = R_o × (1+T) = 1k × 11 = 11 kΩ
```

> **答案 (d)：Shunt-Series 下 R_in = 909 Ω（降低），R_out = 11 kΩ（增加）。這是電流放大器的特性（低 R_in 吸收電流，高 R_out 輸出穩定電流）。**

**延伸思考**：四種回授架構對應四種理想放大器：
- Series-Shunt → 電壓放大器（高 R_in，低 R_out）
- Shunt-Shunt → 互阻放大器（低 R_in，低 R_out）
- Series-Series → 互導放大器（高 R_in，高 R_out）
- Shunt-Series → 電流放大器（低 R_in，高 R_out）

---

### 題目 52：頻率補償與條件穩定系統
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：頻率補償技術（Frequency Compensation Techniques）

**題目**：

一三級放大器，A_0 = 80 dB，三個極點：f_p1 = 1 MHz，f_p2 = 10 MHz，f_p3 = 50 MHz。β = 1（unity-gain buffer）。

(a) 求無補償時的相位邊限。
(b) 若使用主極點補償（dominant pole compensation），將 f_p1 推低到多少可獲得 60° PM？
(c) 補償後的 GBW 為多少？與未補償時比較。
(d) 說明「條件穩定」（conditionally stable）系統的現象，本系統是否可能條件穩定？

**詳解**：

**解題思路**：主極點補償透過增加輸入端電容（或 Miller 電容）將第一極點推低，使增益在到達第二極點前已降至 0 dB。

**步驟**：

(a) 無補償的相位邊限：

A_0 = 80 dB = 10^4

找增益交越頻率 f_c（|A(jω_c) × β| = 1，β = 1）：

從 f_p1 = 1 MHz 開始 -20 dB/dec：
```
1 MHz ~ 10 MHz：-20 dB/dec
在 10 MHz：80 - 20 = 60 dB
```

從 f_p2 = 10 MHz 開始 -40 dB/dec：
```
10 MHz ~ 50 MHz：-40 dB/dec
在 50 MHz：60 - 40×log(50/10) = 60 - 28 = 32 dB
```

從 f_p3 = 50 MHz 開始 -60 dB/dec：
```
50 MHz 以上：-60 dB/dec
令 |A| = 0 dB：32 - 60×log(f_c/50M) = 0 → log(f_c/50M) = 0.533
f_c = 50M × 10^0.533 = 50M × 3.41 = 171 MHz
```

相位在 f_c = 171 MHz：
```
φ = -arctan(171/1) - arctan(171/10) - arctan(171/50)
  = -89.7° - 86.7° - 73.7°
  = -250.1°

PM = 180° - 250.1° = -70.1°（不穩定！）
```

> **答案 (a)：PM = -70°（嚴重不穩定）**

(b) 主極點補償（dominant pole compensation）：

將 f_p1 推低到 f_p1'，使 f_c 落在 f_p2 之前。

PM = 60° 的條件：在 f_c 處總相位延遲 = 120°。

若 f_c << f_p2 = 10 MHz，第二和第三極點的相位貢獻小：

```
φ(f_c) ≈ -90° - arctan(f_c/10M) - arctan(f_c/50M) = -120°

-arctan(f_c/10M) - arctan(f_c/50M) = -30°
```

令 f_c = 3 MHz（試算）：
```
arctan(3/10) + arctan(3/50) = 16.7° + 3.4° = 20.1°（不夠）
```

令 f_c = 5 MHz：
```
arctan(5/10) + arctan(5/50) = 26.6° + 5.7° = 32.3°（超過 30°，略多）
```

令 f_c = 4.5 MHz：
```
arctan(0.45) + arctan(0.09) = 24.2° + 5.1° = 29.3°（接近 30°）
```

取 f_c ≈ 4.6 MHz。

新的 f_p1' 使 |A(f_c)| = 0 dB：

在 f_p1' < f_c < f_p2 區間，|A| 以 -20 dB/dec 衰減：
```
80 - 20 × log(f_c/f_p1') = 0
log(f_c/f_p1') = 4
f_p1' = f_c / 10^4 = 4.6M / 10000 = 460 Hz
```

> **答案 (b)：需將 f_p1 從 1 MHz 推低至約 460 Hz**

(c) 補償後的 GBW：
```
GBW = A_0 × f_p1' = 10^4 × 460 = 4.6 MHz
```

未補償時（假設穩定的話）：
```
GBW(原) = A_0 × f_p1 = 10^4 × 1M = 10 GHz
```

GBW 從 10 GHz 降至 4.6 MHz，下降超過 2000 倍！

> **答案 (c)：GBW = 4.6 MHz（代價極大，這就是主極點補償的主要缺點）**

(d) 條件穩定（conditionally stable）：

在某些多極點系統中，迴路增益的相位可能先超過 -180°，然後又回到 -180° 以內。此時：

- 在高迴路增益（低 β）下穩定
- 在某個 β 範圍內不穩定
- 在更高 β（更低增益）下又穩定

本系統（三極點，-270° 最大相位延遲）：相位單調遞減，**不會條件穩定**。

條件穩定通常發生在有零點（相位回升）或極點-零點交錯的系統中，例如帶有 Miller 補償和 RHP 零點的系統。

> **答案 (d)：本系統三個極點，相位單調下降至 -270°，不會條件穩定。條件穩定需要相位非單調（有零點回升），例如在 lead-lag 補償或某些帶通系統中。**

**延伸思考**：主極點補償的 GBW 代價過大時，可改用「零點補償」（lead compensation）在相位交越附近增加零點回升相位，或使用「極點-零點對消」（pole-zero cancellation）。在 CMOS OPA 設計中，Miller 補償比主極點補償更高效，因為它利用第二級的增益來「放大」補償電容。

---

## Part 6：CMOS 數位電路與運算放大器（CMOS Digital & OPA）

---

### 題目 53：CMOS 反相器電壓轉移特性（VTC）
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：CMOS 反相器（CMOS Inverter VTC）

**題目**：

一 CMOS 反相器，VDD = 1.8V，NMOS 參數：V_thn = 0.4V，k_n = μ_nC_ox(W/L)_n = 200 μA/V²；PMOS 參數：V_thp = -0.4V，k_p = μ_pC_ox(W/L)_p = 200 μA/V²（已調尺寸使 k_n = k_p）。

(a) 求反相器的切換閾值 V_M（switching threshold）。
(b) 求 VTC 上五個操作區域及其邊界電壓。
(c) 求 V_M 處的小信號增益（transition slope）。
(d) 若 k_p = 100 μA/V²（未調尺寸），V_M 變為多少？如何調整 PMOS 尺寸使 V_M = VDD/2？

**詳解**：

**解題思路**：切換閾值由 NMOS 和 PMOS 電流相等的條件決定。

**步驟**：

(a) 切換閾值 V_M：

在 V_M 處，V_in = V_out = V_M，且 I_Dn = I_Dp。

因為 k_n = k_p 且 |V_thn| = |V_thp|（對稱反相器）：

```
V_M = VDD/2 = 1.8/2 = 0.9V
```

推導（一般情況）：令兩管都在飽和區（V_in = V_out = V_M）

NMOS：V_GS = V_M，V_DS = V_M，V_DS > V_OV = V_M - V_thn → 飽和（需驗證）
```
I_Dn = (k_n/2)(V_M - V_thn)²
```

PMOS：V_SG = VDD - V_M，V_SD = VDD - V_M
```
I_Dp = (k_p/2)(VDD - V_M - |V_thp|)²
```

令 I_Dn = I_Dp，k_n = k_p：
```
(V_M - V_thn)² = (VDD - V_M - |V_thp|)²
V_M - 0.4 = VDD - V_M - 0.4（取正根）
2V_M = VDD
V_M = VDD/2 = 0.9V
```

> **答案 (a)：V_M = 0.9V = VDD/2（對稱反相器）**

(b) 五個操作區域：

```
區域 1：0 ≤ V_in < V_thn = 0.4V
  NMOS 截止，PMOS 線性區
  V_out = VDD = 1.8V

區域 2：V_thn ≤ V_in < V_M
  NMOS 飽和，PMOS 線性區
  V_out 隨 V_in 增加而開始下降

區域 3：V_in ≈ V_M = 0.9V
  NMOS 飽和，PMOS 飽和
  增益最大（過渡區）

區域 4：V_M < V_in ≤ VDD - |V_thp| = 1.4V
  NMOS 線性區，PMOS 飽和
  V_out 接近 0V

區域 5：VDD - |V_thp| < V_in ≤ VDD
  NMOS 線性區，PMOS 截止
  V_out = 0V
```

> **答案 (b)：邊界電壓：0.4V, V_M ≈ 0.9V, 1.4V。VTC 在 V_M 附近急劇下降。**

(c) V_M 處的小信號增益：

在 V_M 處兩管都在飽和區，等效為兩個電流源並聯，增益為：

```
A_v = -(g_mn + g_mp) × (r_on || r_op)
```

g_mn = k_n × V_OV = 200μ × (0.9 - 0.4) = 100 μA/V = 0.1 mS（等等，這太小了）

修正：g_m = k_n × (V_M - V_thn) = 200μ × 0.5 = 100 μS

若 λ_n = λ_p = 0.1 V^-1，I_D = k_n/2 × V_OV² = 200μ/2 × 0.25 = 25 μA

```
r_on = 1/(λ_n × I_D) = 1/(0.1 × 25μ) = 400 kΩ
r_op = 400 kΩ

A_v = -(g_mn + g_mp)(r_on || r_op)
    = -(0.1m + 0.1m) × 200k
    = -0.2m × 200k = -40
```

> **答案 (c)：|A_v| ≈ 40（在過渡區斜率很陡）。實際值取決於 λ，典型 |A_v| = 20~50。**

(d) 不對稱情況（k_p = 100 μA/V²，k_n = 200 μA/V²）：

```
(k_n/2)(V_M - V_thn)² = (k_p/2)(VDD - V_M - |V_thp|)²

200(V_M - 0.4)² = 100(1.4 - V_M)²

2(V_M - 0.4)² = (1.4 - V_M)²

√2 × (V_M - 0.4) = 1.4 - V_M

1.414V_M - 0.566 = 1.4 - V_M

2.414V_M = 1.966

V_M = 0.814V
```

V_M 偏低（因 NMOS 較強，拉低更快）。

要使 V_M = VDD/2 = 0.9V：
```
需 k_p = k_n → (W/L)_p = k_n/(μ_pC_ox) = (W/L)_n × μ_n/μ_p
```

若 μ_n/μ_p = 2（典型值）：
```
(W/L)_p = 2 × (W/L)_n
```

> **答案 (d)：不對稱時 V_M = 0.814V。要使 V_M = VDD/2，需 (W/L)_p = 2 × (W/L)_n（補償 PMOS 較低的遷移率）。**

**延伸思考**：在數位設計中，通常設定 V_M = VDD/2 以獲得最大雜訊邊限。在標準元件庫中，反相器的 PMOS 通常是 NMOS 寬度的 2~3 倍。

---

### 題目 54：CMOS 反相器雜訊邊限
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：雜訊邊限（Noise Margins）

**題目**：

一對稱 CMOS 反相器，VDD = 1.8V，V_thn = |V_thp| = 0.4V，k_n = k_p = 200 μA/V²。

(a) 求 V_IL 和 V_IH（VTC 斜率 = -1 的點）。
(b) 求 V_OL 和 V_OH。
(c) 求 NM_H = V_OH - V_IH 和 NM_L = V_IL - V_OL。
(d) 若 VDD 降至 1.0V，V_th 不變，雜訊邊限如何變化？評估 VDD 最小值。

**詳解**：

**解題思路**：V_IL 和 V_IH 定義為 VTC 斜率 dV_out/dV_in = -1 的兩個點。

**步驟**：

(a) 對於對稱 CMOS 反相器（k_n = k_p，|V_thn| = |V_thp|），有簡化公式：

利用對稱性，V_M = VDD/2 = 0.9V

V_IL 和 V_IH 可由 dV_out/dV_in = -1 條件求得。

對於對稱反相器（精確推導）：

```
V_IL = (2V_out + V_thn - VDD + |V_thp|)/...（複雜）
```

簡化的經典結果（對稱情況，長通道）：

```
V_IL = (3VDD + 2V_thn) / 8 = (3 × 1.8 + 2 × 0.4) / 8 = (5.4 + 0.8)/8 = 0.775V
V_IH = (5VDD - 2V_thn) / 8 = (9.0 - 0.8)/8 = 1.025V
```

或用另一個更常用的近似（假設過渡區兩管都在飽和）：

```
V_IL = V_thn + (VDD - 2V_thn)/(1 + √(k_n/k_p)) × ...
```

最簡單的對稱反相器結果：
```
V_IL = (3V_M + V_thn)/4 = (3×0.9 + 0.4)/4 = 3.1/4 = 0.775V（不完全正確）
```

用更標準的方法，對稱反相器：
```
V_IL = VDD/8 × (5 - 2V_thn/VDD × ...)
```

直接用數值方法或常見教科書結果：

對稱 CMOS 反相器的 V_IL, V_IH（Sedra/Smith 結果）：
```
V_IL = 3/8 × VDD = 0.675V（若 V_th = 0 的理想情況）
V_IH = 5/8 × VDD = 1.125V
```

含 V_th 的修正需精確解。實際常用近似：

```
V_IL ≈ V_M - V_M/(|A_v(V_M)|+1) × VDD/2
V_IH ≈ V_M + V_M/(|A_v(V_M)|+1) × VDD/2
```

更實用的做法 —— 使用斜率條件在 VTC 上求解：

在過渡區（兩管飽和），V_out 與 V_in 的關係：

令 dV_out/dV_in = -1，對稱反相器的解為：

```
V_IL = (3VDD - 2|V_th|)/8 + |V_th|/4 ≈ 0.775V
V_IH = (5VDD + 2|V_th|)/8 - |V_th|/4 ≈ 1.025V
```

> **答案 (a)：V_IL ≈ 0.78V，V_IH ≈ 1.03V**

(b) VOL 和 VOH：

```
V_OH = VDD = 1.8V（PMOS 完全導通，NMOS 截止）
V_OL = 0V（NMOS 完全導通，PMOS 截止）
```

（CMOS 反相器的輸出可達到 rail-to-rail）

> **答案 (b)：V_OH = 1.8V，V_OL = 0V（理想 rail-to-rail）**

(c) 雜訊邊限：

```
NM_H = V_OH - V_IH = 1.8 - 1.025 = 0.775V
NM_L = V_IL - V_OL = 0.775 - 0 = 0.775V
```

對稱反相器：NM_H = NM_L（對稱）

> **答案 (c)：NM_H = NM_L ≈ 0.775V（約 VDD 的 43%）**

(d) VDD = 1.0V：

```
V_M = 0.5V，V_OV = 0.5 - 0.4 = 0.1V（過驅電壓很小）

NM ≈ VDD × 0.43 = 0.43V（粗估）
```

更準確地，當 VDD 接近 2|V_th| = 0.8V 時，兩管的過驅電壓趨近於零，增益降低，VTC 變得平緩，雜訊邊限急劇下降。

最小 VDD 使反相器仍能正常工作：
```
VDD(min) = V_thn + |V_thp| = 0.4 + 0.4 = 0.8V
```

在此電壓下 V_OV → 0，增益很低，雜訊邊限接近零。

實用最小值通常取 VDD > 3|V_th|（留足裕量）。

> **答案 (d)：VDD = 1.0V 時 NM ≈ 0.43V。VDD(min) = 2|V_th| = 0.8V（理論最低），但實用最小值約 3|V_th| = 1.2V。**

**延伸思考**：在先進製程中，V_th 隨 VDD 的下降（DIBL 效應）以及次臨界電流（subthreshold current）的存在，使得反相器在 VDD < 2V_th 時仍可工作，但速度極慢。超低壓設計（near-threshold computing）是當前研究熱點。

---

### 題目 55：CMOS 反相器動態功耗
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：CMOS 功耗分析（CMOS Power Dissipation）

**題目**：

一 CMOS 反相器鏈（10 級串接），VDD = 1.2V，每級的負載電容 C_L = 50 fF，工作頻率 f = 1 GHz，活動因子（activity factor）α = 0.3。

(a) 求單一反相器的動態功耗。
(b) 求 10 級鏈的總動態功耗。
(c) 若漏電流 I_leak = 100 nA/級，求靜態功耗，並比較動靜態功耗比。
(d) 若要降低功耗 50%，有哪些策略？各有何代價？

**詳解**：

**解題思路**：CMOS 動態功耗由充放電負載電容主導，靜態功耗由漏電流決定。

**步驟**：

(a) 單級動態功耗：

```
P_dyn = α × C_L × VDD² × f
      = 0.3 × 50 × 10^-15 × 1.2² × 10^9
      = 0.3 × 50 × 10^-15 × 1.44 × 10^9
      = 0.3 × 72 × 10^-6
      = 21.6 μW
```

> **答案 (a)：P_dyn(單級) = 21.6 μW**

(b) 10 級總動態功耗：

```
P_total_dyn = 10 × 21.6μ = 216 μW
```

> **答案 (b)：P_total_dyn = 216 μW**

(c) 靜態功耗：

```
P_static(單級) = I_leak × VDD = 100n × 1.2 = 120 nW = 0.12 μW
P_static(10級) = 10 × 0.12μ = 1.2 μW
```

動靜態比：
```
P_dyn / P_static = 216 / 1.2 = 180
```

> **答案 (c)：P_static = 1.2 μW，動態功耗是靜態的 180 倍。在高頻工作時動態功耗主導。**

(d) 降低功耗策略：

1. **降低 VDD**（最有效！）：P ∝ VDD²
   - 從 1.2V 降至 0.85V：功耗降為 (0.85/1.2)² = 50% ✓
   - 代價：速度降低（延遲 ∝ VDD/(VDD-V_th)²）

2. **降低頻率 f**：P ∝ f
   - 降至 500 MHz：功耗降 50% ✓
   - 代價：性能降低

3. **降低活動因子 α**：
   - 使用時鐘閘控（clock gating）
   - 代價：設計複雜度增加

4. **降低 C_L**：
   - 減小電晶體尺寸、優化佈局
   - 代價：驅動能力降低

5. **多閾值設計（Multi-V_th）**：
   - 關鍵路徑用低 V_th（快但漏電大）
   - 非關鍵路徑用高 V_th（慢但漏電小）
   - 代價：製程和設計複雜度增加

> **答案 (d)：最有效的策略是降低 VDD（平方關係）。VDD 降至約 0.85V 即可減半功耗，但速度約降低 2~3 倍。**

**延伸思考**：在先進製程（5nm 以下），靜態功耗（漏電流）可佔總功耗的 30-50%，不再可忽略。電源閘控（power gating）、體偏壓（body biasing）和 FinFET 結構都是控制漏電的重要技術。

---

### 題目 56：CMOS 反相器傳播延遲
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：傳播延遲（Propagation Delay）

**題目**：

一 CMOS 反相器，VDD = 1.8V，V_thn = |V_thp| = 0.4V，k_n = 400 μA/V²，k_p = 200 μA/V²，C_L = 30 fF。

(a) 求 t_pHL（輸出從高到低的傳播延遲）。
(b) 求 t_pLH（輸出從低到高的傳播延遲）。
(c) 求平均傳播延遲 t_p = (t_pHL + t_pLH)/2。
(d) 若要使 t_pHL = t_pLH（對稱延遲），k_p 應為多少？(W/L)_p 應如何調整？

**詳解**：

**解題思路**：傳播延遲定義為輸出電壓到達 VDD/2 所需的時間。可用平均電流法或 Elmore 延遲估算。

**步驟**：

使用平均電流法（Shockley 模型）：

(a) t_pHL（NMOS 放電 C_L）：

NMOS 從 V_in = VDD = 1.8V 導通。放電過程中 V_out 從 VDD 降至 VDD/2 = 0.9V。

平均放電電流（取 V_out = VDD 和 V_out = VDD/2 時的 I_D 平均）：

V_out = VDD = 1.8V 時（NMOS 剛導通）：
```
V_GS = 1.8V，V_DS = 1.8V > V_OV = 1.4V → 飽和
I_D1 = (k_n/2)(V_GS - V_thn)² = (400μ/2)(1.4)² = 200μ × 1.96 = 392 μA
```

V_out = VDD/2 = 0.9V 時：
```
V_GS = 1.8V，V_DS = 0.9V < V_OV = 1.4V → 線性區
I_D2 = k_n[(V_GS-V_thn)V_DS - V_DS²/2] = 400μ[(1.4)(0.9) - 0.81/2]
     = 400μ[1.26 - 0.405] = 400μ × 0.855 = 342 μA
```

平均電流：I_avg = (I_D1 + I_D2)/2 = (392 + 342)/2 = 367 μA

```
t_pHL = C_L × ΔVDD / (2 × I_avg) = C_L × (VDD/2) / I_avg
      = 30f × 0.9 / 367μ = 27f / 367μ = 73.6 ps
```

> **答案 (a)：t_pHL ≈ 74 ps**

(b) t_pLH（PMOS 充電 C_L）：

PMOS 從 V_in = 0 導通。充電過程中 V_out 從 0 升至 VDD/2 = 0.9V。

V_out = 0V 時（PMOS 剛導通）：
```
V_SG = 1.8V，V_SD = 1.8V > |V_OVp| = 1.4V → 飽和
I_D1 = (k_p/2)(1.4)² = 100μ × 1.96 = 196 μA
```

V_out = 0.9V 時：
```
V_SG = 1.8V，V_SD = 0.9V < 1.4V → 線性區
I_D2 = k_p[(1.4)(0.9) - 0.81/2] = 200μ × 0.855 = 171 μA
```

平均電流：I_avg = (196 + 171)/2 = 183.5 μA

```
t_pLH = 30f × 0.9 / 183.5μ = 27f / 183.5μ = 147.1 ps
```

> **答案 (b)：t_pLH ≈ 147 ps**

(c) 平均傳播延遲：
```
t_p = (74 + 147)/2 = 110.5 ps
```

> **答案 (c)：t_p ≈ 111 ps**

(d) 對稱延遲條件：

要 t_pHL = t_pLH，需要 PMOS 的平均電流等於 NMOS 的平均電流。

因為 μ_p < μ_n，需要增大 (W/L)_p：

```
k_p(新) = k_n = 400 μA/V²
(W/L)_p(新) = k_p(新) / μ_pC_ox

原來 k_p = 200μ = μ_pC_ox × (W/L)_p(原)
新的 k_p = 400μ → (W/L)_p(新) = 2 × (W/L)_p(原)
```

> **答案 (d)：需 k_p = k_n，即 (W/L)_p = 2 × (W/L)_p(原) = μ_n/μ_p × (W/L)_n。典型 PMOS 寬度為 NMOS 的 2~3 倍。**

**延伸思考**：在標準元件庫中，反相器常提供多種驅動強度（x1, x2, x4 等），透過等比例放大 W 來降低延遲。延遲優化是 VLSI 設計中的核心問題，邏輯努力（logical effort）方法提供了系統性的優化框架。

---

### 題目 57：CMOS NAND/NOR 門延遲分析
**來源**：台大電機 / 經典題型
**難度**：★★★☆☆
**主題**：CMOS 邏輯門（CMOS Logic Gates）

**題目**：

一 2-input CMOS NAND 門和一 2-input CMOS NOR 門，要求與等效反相器有相同的最差情況延遲。等效反相器參數：(W/L)_n = 1（最小尺寸），(W/L)_p = 2。

(a) 設計 NAND 門的所有電晶體尺寸。
(b) 設計 NOR 門的所有電晶體尺寸。
(c) 比較兩者的面積，解釋為何 NAND 門更常用。
(d) 若用邏輯努力（logical effort）方法，2-input NAND 和 NOR 的邏輯努力分別為多少？

**詳解**：

**解題思路**：串聯的電晶體等效電阻加倍，需加倍寬度補償；並聯的電晶體等效電阻減半，可維持最小尺寸。

**步驟**：

(a) 2-input NAND 門：

結構：2 個 NMOS 串聯（下拉），2 個 PMOS 並聯（上拉）

```
         VDD    VDD
          |      |
         MP1    MP2（並聯）
          |      |
          └──┬───┘
             |── v_o
          ┌──┘
         MN1    ← A 輸入
          |
         MN2    ← B 輸入
          |
         GND
```

NMOS 串聯 → 最差情況（兩管都導通）下拉電阻 = 2 × R_n。需要每管 W 加倍以補償：
```
(W/L)_n(NAND) = 2 × (W/L)_n(inv) = 2 × 1 = 2
```

PMOS 並聯 → 最差情況（一管導通）上拉電阻 = R_p（與反相器相同）：
```
(W/L)_p(NAND) = (W/L)_p(inv) = 2
```

> **答案 (a)：NAND 門：(W/L)_n = 2（每管），(W/L)_p = 2（每管）。共 4 管，總寬度 = 2+2+2+2 = 8。**

(b) 2-input NOR 門：

結構：2 個 NMOS 並聯（下拉），2 個 PMOS 串聯（上拉）

NMOS 並聯 → 最差情況（一管導通）下拉電阻 = R_n（與反相器相同）：
```
(W/L)_n(NOR) = (W/L)_n(inv) = 1
```

PMOS 串聯 → 最差情況（兩管都導通）上拉電阻 = 2R_p。需加倍：
```
(W/L)_p(NOR) = 2 × (W/L)_p(inv) = 2 × 2 = 4
```

> **答案 (b)：NOR 門：(W/L)_n = 1（每管），(W/L)_p = 4（每管）。共 4 管，總寬度 = 1+1+4+4 = 10。**

(c) 面積比較：

```
NAND 總寬度 = 8
NOR 總寬度 = 10
反相器總寬度 = 1 + 2 = 3
```

NOR 門面積比 NAND 大 25%（10 vs 8），主要因為 PMOS 串聯需要很大的尺寸（PMOS 本身就比 NMOS 大 2 倍，串聯再乘 2）。

> **答案 (c)：NOR 門面積比 NAND 大約 25%。在 CMOS 中 NAND 更高效（因 NMOS 串聯比 PMOS 串聯面積小），這就是為什麼 NAND 門是 CMOS 邏輯的基礎單元。**

(d) 邏輯努力：

邏輯努力 g = (等效門輸入電容) / (等效反相器輸入電容)

等效反相器輸入電容 = (W/L)_n + (W/L)_p = 1 + 2 = 3

NAND（每個輸入）：
```
每個輸入控制一個 NMOS（W=2）和一個 PMOS（W=2）
C_in = 2 + 2 = 4
g(NAND) = 4/3 ≈ 1.33
```

NOR（每個輸入）：
```
每個輸入控制一個 NMOS（W=1）和一個 PMOS（W=4）
C_in = 1 + 4 = 5
g(NOR) = 5/3 ≈ 1.67
```

> **答案 (d)：g(NAND2) = 4/3，g(NOR2) = 5/3。NAND 的邏輯努力更小，因此在相同 fan-out 下延遲更短。**

**延伸思考**：邏輯努力方法是分析和優化多級邏輯路徑延遲的強大工具。最優延遲設計要求每級的「級努力」（stage effort = g × h，h 為 fan-out）相等。在實際 VLSI 設計中，NAND 門和反相器是最常用的基礎元件。

---

### 題目 58：兩級 OTA 完整設計
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：兩級運算跨導放大器（Two-Stage OTA）— IC 設計核心

**題目**：

設計一兩級 CMOS OTA，規格如下：
- VDD = 1.8V，C_L = 10 pF
- DC 增益 ≥ 60 dB
- GBW ≥ 10 MHz
- 相位邊限 PM ≥ 60°
- 迴轉率（slew rate）SR ≥ 10 V/μs

製程參數：μ_nC_ox = 200 μA/V²，μ_pC_ox = 80 μA/V²，V_thn = 0.4V，|V_thp| = 0.5V，λ_n = 0.04 V^-1，λ_p = 0.06 V^-1。

```
第一級：NMOS 差動對 + PMOS 電流鏡負載
第二級：PMOS CS 放大器 + NMOS 電流源負載
Miller 補償：C_C 跨接在第二級輸入和輸出之間
```

(a) 由 SR 和 GBW 規格決定 I_tail 和 C_C。
(b) 設計第一級（差動對和電流鏡）的所有電晶體尺寸。
(c) 設計第二級的電晶體尺寸和偏壓電流。
(d) 驗證增益和 PM 是否滿足規格。
(e) 計算輸入共模範圍。

**詳解**：

**解題思路**：從規格反推設計參數，這是類比 IC 設計的標準設計流程。

**步驟**：

(a) 由 SR 和 GBW 決定基本參數：

迴轉率：SR = I_tail / C_C（第一級尾電流充放電 C_C）
```
C_C ≥ I_tail / SR
```

GBW = g_m1 / (2π C_C)

先由 SR 和 GBW 建立聯立方程。令 g_m1 = 2I_D1/V_OV1 = I_tail/V_OV1（因 I_D1 = I_tail/2）。

```
GBW = g_m1/(2π C_C) = (I_tail/V_OV1)/(2π C_C)

SR = I_tail/C_C
```

因此：GBW = SR / (2π V_OV1)

```
V_OV1 = SR / (2π × GBW) = (10 × 10^6) / (2π × 10 × 10^6) = 10/(20π) = 0.159V
```

取 V_OV1 = 0.2V（留裕量）。

由 SR：
```
C_C = I_tail / SR
```

令 C_C > (2.2/2π) × C_L × g_m1/g_m2（PM ≥ 60° 條件，待定）

先從 GBW 求 C_C 和 I_tail：

```
GBW = g_m1/(2π C_C) → C_C = g_m1/(2π × GBW)
g_m1 = I_tail/V_OV1 = I_tail/0.2

SR = I_tail/C_C → C_C = I_tail/SR = I_tail/(10 × 10^6)
```

聯立：
```
I_tail/(10^7) = (I_tail/0.2)/(2π × 10^7)
```

這恆成立（因為 GBW = SR/(2π V_OV1)），所以需要一個額外條件。

取 I_tail 使 SR 滿足：

```
C_C = g_m1/(2π × GBW)

g_m1 = I_tail/V_OV1 = I_tail/0.2

C_C = (I_tail/0.2)/(2π × 10M) = I_tail/(0.2 × 6.28 × 10^7) = I_tail/(1.257 × 10^7)
```

SR = I_tail/C_C = I_tail × 1.257 × 10^7 / I_tail = 1.257 × 10^7 V/s = 12.57 V/μs > 10 V/μs ✓

所以 V_OV1 = 0.2V 自動滿足 SR > 10 V/μs。

選擇 I_tail = 200 μA（合理功耗）：

```
g_m1 = I_tail/V_OV1 = 200μ/0.2 = 1 mS
C_C = g_m1/(2π × GBW) = 1m/(2π × 10M) = 15.9 pF
```

C_C = 15.9 pF 太大！重新選擇。

問題出在 C_L = 10 pF 很大。需要更大的 g_m1 或接受較小的 C_C。

重新計算：C_C 通常取 0.2~0.5 × C_L。取 C_C = 3 pF。

```
g_m1 = 2π × GBW × C_C = 2π × 10M × 3p = 188.5 μS ≈ 0.19 mS

I_tail = g_m1 × V_OV1 = 0.19m × 0.2 = 38 μA
```

SR = I_tail/C_C = 38μ/3p = 12.7 V/μs > 10 V/μs ✓

> **答案 (a)：I_tail = 38 μA（取 40 μA），C_C = 3 pF，g_m1 = 0.19 mS**

(b) 第一級設計：

差動對 M1/M2（NMOS）：
```
I_D1 = I_tail/2 = 20 μA

g_m1 = 2I_D1/V_OV1 = 2 × 20μ/0.2 = 200 μS = 0.2 mS

(W/L)_1 = 2I_D1/(μ_nC_ox × V_OV1²) = 2 × 20μ/(200μ × 0.04) = 40/8 = 5
```

取 (W/L)_1 = (W/L)_2 = 5/1

電流鏡 M3/M4（PMOS）：
```
I_D3 = 20 μA，取 V_OV3 = 0.2V

(W/L)_3 = 2 × 20μ/(80μ × 0.04) = 40/3.2 = 12.5
```

取 (W/L)_3 = (W/L)_4 = 12.5/1（或 13/1）

> **答案 (b)：M1/M2：(W/L) = 5/1，M3/M4：(W/L) = 13/1**

(c) 第二級設計：

PM ≥ 60° 條件：非主導極點 f_p2 > 2.2 × GBW

```
f_p2 = g_m2/(2π C_L) > 2.2 × 10 MHz = 22 MHz

g_m2 > 2π × 22M × 10p = 1.382 mS
```

取 g_m2 = 1.5 mS。

第二級為 PMOS CS（M6），偏壓電流 I_D6：

```
g_m2 = 2I_D6/V_OV6 → I_D6 = g_m2 × V_OV6/2
```

取 V_OV6 = 0.3V：
```
I_D6 = 1.5m × 0.3/2 = 225 μA

(W/L)_6 = 2I_D6/(μ_pC_ox × V_OV6²) = 2 × 225μ/(80μ × 0.09) = 450/7.2 = 62.5
```

取 (W/L)_6 = 63/1

NMOS 電流源 M7：
```
I_D7 = 225 μA，V_OV7 = 0.2V

(W/L)_7 = 2 × 225μ/(200μ × 0.04) = 450/8 = 56.25
```

取 (W/L)_7 = 56/1

> **答案 (c)：M6(PMOS)：(W/L) = 63/1，I_D = 225 μA；M7(NMOS)：(W/L) = 56/1**

(d) 驗證增益和 PM：

第一級增益：
```
r_o1 = 1/(λ_n × 20μ) = 1.25 MΩ
r_o3 = 1/(λ_p × 20μ) = 833 kΩ
A_1 = g_m1 × (r_o1 || r_o3) = 0.2m × (1.25M || 833k) = 0.2m × 500k = 100
```

第二級增益：
```
r_o6 = 1/(λ_p × 225μ) = 74 kΩ
r_o7 = 1/(λ_n × 225μ) = 111 kΩ
A_2 = g_m2 × (r_o6 || r_o7) = 1.5m × (74k || 111k) = 1.5m × 44.4k = 66.7
```

總增益：
```
A_0 = A_1 × A_2 = 100 × 66.7 = 6670 = 76.5 dB > 60 dB ✓
```

PM 驗證：
```
GBW = g_m1/(2π C_C) = 0.2m/(2π × 3p) = 10.6 MHz ✓
f_p2 = g_m2/(2π C_L) = 1.5m/(2π × 10p) = 23.9 MHz
f_p2/GBW = 23.9/10.6 = 2.25

PM ≈ 90° - arctan(GBW/f_p2) = 90° - arctan(1/2.25) = 90° - 24° = 66° > 60° ✓
```

> **答案 (d)：A_0 = 76.5 dB > 60 dB ✓，PM ≈ 66° > 60° ✓，所有規格滿足。**

(e) 輸入共模範圍：

下限（NMOS 差動對和尾電流源都在飽和）：
```
V_ICM(min) = V_OV(tail) + V_GS1 = V_OV(tail) + V_thn + V_OV1
```

取 V_OV(tail) = 0.2V：
```
V_ICM(min) = 0.2 + 0.4 + 0.2 = 0.8V
```

上限（PMOS 電流鏡在飽和）：
```
V_ICM(max) = VDD - V_SG3 + V_thn = VDD - (|V_thp| + V_OV3) + V_thn
           = 1.8 - (0.5 + 0.2) + 0.4 = 1.5V
```

> **答案 (e)：V_ICM 範圍：0.8V ~ 1.5V（共 0.7V）**

**延伸思考**：此設計的主要限制是 C_L = 10 pF 較大，導致第二級需要較大的電流（225 μA）來推動非主導極點。在低功耗設計中，可使用 class-AB 輸出級來在不增加靜態電流的情況下驅動大電容負載。

---

### 題目 59：OTA 迴轉率與大信號暫態
**來源**：台大電機 / 經典題型
**難度**：★★★★☆
**主題**：迴轉率（Slew Rate）

**題目**：

一兩級 OTA 組成的 unity-gain buffer，I_tail = 100 μA，C_C = 5 pF，C_L = 20 pF。輸入為 1V 的步階信號（step input）。

(a) 求正向和負向迴轉率 SR+ 和 SR-。
(b) 求迴轉時間（slewing time）和線性建立時間（linear settling time），假設 GBW = 5 MHz。
(c) 求 0.1% 精確度的總建立時間（total settling time）。
(d) 說明迴轉率對 OPA 全功率頻寬（full-power bandwidth）的限制。

**詳解**：

**解題思路**：大信號暫態分為迴轉（slewing）和線性建立（linear settling）兩個階段。

**步驟**：

(a) 迴轉率：

在 unity-gain buffer 中，C_C 被 Miller 補償放大，但迴轉率由第一級尾電流決定：

```
SR = I_tail / C_C = 100μ / 5p = 20 V/μs
```

（注意：SR 由 C_C 決定，不是 C_L，因為在迴轉期間第一級的差動對完全切換，所有尾電流流經 C_C）

正向和負向相同（對稱差動對）：
```
SR+ = SR- = 20 V/μs
```

> **答案 (a)：SR+ = SR- = 20 V/μs**

(b) 迴轉時間和線性建立時間：

**迴轉階段**：輸出以 SR 的速度線性上升，直到誤差 < 某個小值（約 V_OV/2 ≈ 幾十 mV）。

以 1V 步階、SR = 20 V/μs 為例，大部分擺幅在迴轉模式：

迴轉距離 ≈ 1V - V_OV ≈ 1 - 0.1 ≈ 0.9V（近似）
```
t_slew ≈ 0.9V / 20V/μs = 45 ns
```

**線性建立階段**：迴轉結束後，放大器進入線性模式，以指數衰減方式建立。

時間常數 τ = 1/(2π × GBW) = 1/(2π × 5M) = 31.8 ns

> **答案 (b)：t_slew ≈ 45 ns，τ(linear) ≈ 32 ns**

(c) 0.1% 精確度的總建立時間：

線性建立到 0.1% 精確度需 e^(-t/τ) < 0.001：
```
t_linear = τ × ln(1000) = 31.8 × 6.91 = 219.7 ns
```

但這假設線性建立從迴轉結束處的剩餘誤差開始。更精確地：

迴轉結束後剩餘誤差 ≈ V_OV ≈ 0.1V（佔 1V 步階的 10%）

線性建立到 0.1%（即 1 mV）：
```
0.1 × e^(-t/τ) = 0.001
e^(-t/τ) = 0.01
t = τ × ln(100) = 31.8 × 4.605 = 146.4 ns
```

總建立時間：
```
t_total = t_slew + t_linear = 45 + 146 = 191 ns
```

> **答案 (c)：t_total ≈ 191 ns（0.1% settling）**

(d) 全功率頻寬（full-power bandwidth）：

全功率頻寬定義為輸出正弦波可達到的最大頻率（在最大擺幅下不發生迴轉限制）。

最大輸出正弦波斜率 = V_p × ω = V_p × 2πf

令最大斜率 = SR：
```
f_FP = SR / (2π V_p)
```

假設 V_p = VDD/2 = 0.9V（最大擺幅）：
```
f_FP = 20 × 10^6 / (2π × 0.9) = 3.54 MHz
```

若 GBW = 5 MHz，但 f_FP = 3.54 MHz < GBW → 在大信號時，迴轉率限制先於頻寬限制！

> **答案 (d)：f_FP = SR/(2πV_p) ≈ 3.54 MHz。在大信號下迴轉率成為頻寬瓶頸（f_FP < GBW）。增大 I_tail 可提高 SR。**

**延伸思考**：高速 ADC 驅動器需要很高的 SR，通常使用 class-AB 輸出級（SR 不受靜態電流限制）。在 class-A OTA 中，SR = I_tail/C_C，增大 SR 需增大功耗。Class-AB 輸出級的 SR 可以是 class-A 的 10-100 倍，而靜態功耗相同。

---

### 題目 60：共模回授電路（CMFB）
**來源**：台大電機 / 經典題型
**難度**：★★★★★
**主題**：共模回授（Common-Mode Feedback, CMFB）— IC 設計進階

**題目**：

一全差動（fully differential）folded cascode OTA 需要 CMFB 電路。差動輸出 V_o+ 和 V_o-，目標共模輸出電壓 V_CM = VDD/2 = 0.9V。

(a) 解釋為何全差動 OTA 需要 CMFB。
(b) 描述連續時間（continuous-time）CMFB 的工作原理（電阻平均法）。
(c) 描述開關電容（switched-capacitor）CMFB 的工作原理。
(d) CMFB 迴路的頻寬應如何設計？與差模迴路的頻寬有何關係？

**詳解**：

**解題思路**：全差動電路的共模輸出電壓沒有自然穩定機制，需要額外的回授迴路來控制。

**步驟**：

(a) 為何需要 CMFB：

在單端輸出 OTA 中，輸出共模電壓由電路的偏壓條件自然決定（例如由 PMOS 電流鏡「鎖定」）。

但在全差動 OTA 中：
- 差模回授（外部）控制 V_o+ - V_o-
- **沒有機制控制 (V_o+ + V_o-)/2 = V_CM**
- 共模輸出阻抗極高（cascode 結構），任何微小的電流失配都會使 V_CM 漂移到 rail

具體問題：若不加 CMFB，共模輸出電壓會漂向 VDD 或 GND，使所有電晶體離開飽和區，OTA 失效。

> **答案 (a)：全差動 OTA 的共模輸出無自穩定機制。高輸出阻抗使微小電流失配即可導致 V_CM 飄移至電源軌，需 CMFB 將 V_CM 鎖定在期望值。**

(b) 連續時間 CMFB（電阻平均法）：

```
      V_o+ ──R──┬── R ── V_o-
                 |
              V_sense = (V_o+ + V_o-)/2
                 |
          ┌──────┴──────┐
          │  誤差放大器   │
          │  + : V_CM_ref │
          │  - : V_sense  │
          └──────┬──────┘
                 |
              V_ctrl → 調節尾電流源偏壓
```

工作原理：
1. 兩個等值電阻 R 從 V_o+ 和 V_o- 取平均值 → V_sense = V_CM
2. 誤差放大器比較 V_sense 和參考值 V_CM_ref = VDD/2
3. 誤差信號 V_ctrl 調節偏壓電流（如 NMOS cascode 的偏壓電壓或尾電流源）
4. 若 V_CM > V_CM_ref → V_ctrl 增加 NMOS 電流 → V_CM 下降 → 負回授穩定

**缺點**：R 會降低差模輸出阻抗和增益。R 需很大（MΩ 級）以減少影響，但大電阻佔面積且有噪聲。

> **答案 (b)：電阻分壓取共模平均值，誤差放大器比較並調節偏壓。缺點是電阻降低輸出阻抗。**

(c) 開關電容 CMFB：

```
Phase 1 (φ1)：
  C_1a 連接 V_o+ 和偵測節點
  C_1b 連接 V_o- 和偵測節點

Phase 2 (φ2)：
  C_1a 連接 V_CM_ref 和偵測節點
  C_1b 連接 V_CM_ref 和偵測節點

偵測節點電壓 = V_CM_ref + (V_o+ + V_o-)/2 - V_CM_ref
             = (V_o+ + V_o-)/2（理想情況）
```

工作原理：
1. 利用開關電容取樣 V_o+ 和 V_o- 的共模值
2. 在另一個相位，與 V_CM_ref 比較
3. 差值通過回授調節偏壓

**優點**：
- 不用大電阻，節省面積
- 不會降低差模輸出阻抗
- 可與開關電容電路（如 SC 積分器）良好配合

**缺點**：
- 需要時鐘信號
- 時鐘饋通（clock feedthrough）和電荷注入（charge injection）
- 僅在時鐘邊沿更新，離散時間系統

> **答案 (c)：開關電容 CMFB 用取樣電容偵測共模電壓，不降低輸出阻抗，適合 SC 電路，但需時鐘且有電荷注入問題。**

(d) CMFB 頻寬設計：

**關鍵原則**：CMFB 迴路頻寬必須 ≥ 差模迴路頻寬。

原因：
- 若 CMFB 較慢，大信號暫態時共模輸出會先漂移再恢復
- 在迴轉期間，差動對單邊截止，共模輸出會大幅偏移
- CMFB 必須快速追蹤這些變化，否則電晶體可能離開飽和區

實際設計準則：
```
GBW(CMFB) ≥ GBW(差模)
```

通常 CMFB 使用較簡單的放大器（增益不需太高，40-50 dB 即可），以確保足夠的速度。

**穩定性**：CMFB 迴路本身也需要穩定（PM > 45°），其極點通常由輸出節點電容決定。

> **答案 (d)：CMFB 迴路頻寬必須 ≥ 差模迴路頻寬，以確保大信號暫態期間共模電壓不會失控。CMFB 本身也需要穩定的相位邊限。**

**延伸思考**：在高速 pipeline ADC 中，CMFB 的速度常是設計瓶頸。增益提升（gain-boosting）技術可用於提高 CMFB 的環路增益而不犧牲頻寬。在超低壓設計中，CMFB 的設計更具挑戰性，因為可用的電壓裕度極小。

---

## 總結與考試策略

### 各主題重要性排序（以台大電機博士資格考為準）：

| 優先級 | 主題 | 題數 | 佔比 |
|--------|------|------|------|
| ★★★★★ | MOSFET 放大器（CS/CG/CD/Cascode） | 15 | 25% |
| ★★★★★ | 差動放大器 & OPA | 8 | 13% |
| ★★★★☆ | 回授與穩定性 | 7 | 12% |
| ★★★★☆ | 頻率響應 | 5 | 8% |
| ★★★☆☆ | BJT 放大器 | 10 | 17% |
| ★★★☆☆ | 半導體基礎 & 二極體 | 10 | 17% |
| ★★★☆☆ | CMOS 數位電路 | 5 | 8% |

### 考試必備公式速查：

```
MOSFET 飽和：     I_D = (μC_ox/2)(W/L)(V_GS-V_th)²(1+λV_DS)
MOSFET g_m：      g_m = 2I_D/V_OV = √(2μC_ox(W/L)I_D)
MOSFET r_o：      r_o = 1/(λI_D) = V_A/I_D
本徵增益：         A_0 = g_m × r_o = 2/(λV_OV)

BJT：              g_m = I_C/V_T，r_π = β/g_m，r_o = V_A/I_C

CS 增益：          A_v = -g_m(R_D||r_o||R_L)
CE 含 R_E：        A_v = -R_L'/(r_e + R_E)
Cascode R_out：    R_out = g_m r_o × r_o（下管）

回授：             A_f = A/(1+Aβ)，BW_f = BW × (1+Aβ)
Miller 效應：      C_in = C_gd(1+|A_v|)
迴轉率：           SR = I_tail/C_C
GBW：             GBW = g_m1/(2πC_C)

CMOS 功耗：       P = αC_LV_DD²f + I_leak×V_DD
傳播延遲：        t_p = C_L × V_DD / (2 × I_avg)
```

---

> 本題庫完成，共 60 題，涵蓋電子學(一)(二)(三)完整範圍。建議搭配 Sedra/Smith 和 Razavi 教科書使用，先理解概念再大量練習計算。祝考試順利！
